var plotscape=function(M){"use strict";var ie=document.createElement("style");ie.textContent=`html,body{width:100%;height:100%}#app{width:100%;height:100%;padding:2%;box-sizing:border-box}.ps-scene-container{-webkit-user-select:none;user-select:none;background-color:#deded9;width:100%;height:100%;position:relative;display:grid!important;grid-template-columns:repeat(var(--ncols),1fr);grid-template-rows:repeat(var(--nrows),1fr);box-sizing:border-box;padding:min(5vmin,50px);grid-gap:20px;overflow:hidden}.ps-plot-container{overflow:auto;z-index:0;position:relative;border:1px solid black;border:2px solid transparent}.ps-plot-container textarea{resize:none;width:100%;height:100%;padding:20px;box-sizing:border-box;background-color:#f5f5f5;color:#3d3d3d;border:none;outline:none}.ps-plot-container.active{border:2px solid #7a7a7a}.ps-plot-context{position:absolute;top:0;right:0;width:100%;height:100%}.ps-plot-context.inner{background-color:#fefffe;top:var(--tmargin);right:var(--rmargin);width:calc(100% - var(--lmargin) - var(--rmargin));height:calc(100% - var(--bmargin) - var(--tmargin));border-bottom:1px solid black;border-left:1px solid black}.ps-help-modal{font-size:min(2.5vmin,14pt);color:#3d3d3d;background-color:#fefffe;border:1px solid #3d3d3d;outline:none;overflow:hidden;padding:2vmin 5vmin}.ps-help-modal h1,h2,h3,hr{margin:0;font-weight:lighter;font-family:sans-serif}.ps-help-modal ul{list-style:none;padding:0}.ps-help-button{position:absolute;top:0;right:0;width:30px;height:30px;font-weight:700;float:right;border:none;font-weight:100;font-size:medium}.ps-query-display{display:none;white-space:nowrap;z-index:30;position:absolute;width:fit-content;background-color:#fff;border:1px solid #7a7a7a;padding:2%;pointer-events:none}.ps-widget-modal{position:absolute;font-size:min(2.5vmin,14pt);color:#3d3d3d;background-color:#fefffe;border:1px solid #3d3d3d;outline:none;padding:0}.ps-widget span{font-family:sans-serif;font-weight:700}.ps-widget button{border:none}.ps-widget-display{min-width:40vmin;padding-top:2vmin;padding-bottom:2vmin}.ps-widget-display button{position:absolute;top:10px;right:10px}.ps-widget{background-color:#f5f5f5;margin:2vmin 5vmin;padding:2vmin 3vmin}.ps-widget-draglist ul{background-color:#f5f5f5;list-style:none;padding-left:0}.ps-widget-draglist li{background-color:#fefffe;padding:5px}.ps-widget-draglist li:hover{opacity:.75}.ps-widget-draglist li:nth-child(odd){background-color:#deded9}.ps-widget-draglist li.dragged{opacity:.3;cursor:move}.ps-widget-range input{text-overflow:ellipsis;margin-left:10px}
`,document.head.appendChild(ie);function S(t){return{node:document.createElement(t),get:Ze,append:Je,appendTo:tn,text:en,html:nn,addClass:sn,setAttribute:rn,setStyles:on}}var Ze=function(){return this.node},Je=function(t){return this.node.appendChild(t),this},tn=function(t){return t.appendChild(this.node),this},en=function(t){return this.node.innerText=t,this},nn=function(t){return this.node.innerHTML=t,this},sn=function(t){return this.node.classList.add(t),this},rn=function(t,e){return this.node[t]=e,this},on=function(t){for(const[e,n]of Object.entries(t))this.node.style[e]=n;return this};function Ot(t){throw new Error(t)}function X(t){return t}function xt(t,e){return function(n){return e(t(n))}}function an(t,e){return function(...n){t(n),e(n)}}function cn(){}function vt(){return this}function oe(t){return t+1}function ln(t){return t-1}function un(t){return function(e){return t*e}}function ae(t){return t**2}function ce(t){return Math.sqrt(t)}function hn(t){return parseInt(t,10)}function dn(t){return t.charAt(0).toUpperCase()+t.slice(1)}function fn(t){return t.toLocaleLowerCase()}function pn(t){return t.toLocaleUpperCase()}function mn(t){return t.replace(/\s/g,"")}async function gn(t){return await(await fetch(t)).json()}function O(t,e){return t-e}function le(t,e){return t+e}function yn(t,e){return t*e}function Et(t,e){return t.localeCompare(e,"en",{numeric:!0})}function bn(t,e,n){return Math.min(Math.max(t,e),n)}function st(t){return bn(t,0,1)}function Lt(t,e=0){return Math.round(t*10**e)/10**e}function rt(t){return t[t.length-1]}function it(t,e,n){const s=Math.abs(e-t);n=n??Math.ceil(s)+1;const r=s/(n-1),i=e>=t?1:-1;return Array.from(Array(n),(o,a)=>t+i*r*a)}function Ht(t){let[e,n]=[1/0,-1/0];for(let s=0;s<t.length;s++)e=Math.min(e,t[s]),n=Math.max(n,t[s]);return[e,n]}function wt(t,e){return Array(e).fill(t)}function At(t,e,n=0,s=e.length){const r=Array(s-n);for(let i=0;i<s-n;i++)r[i]=t[e[n+i]];return r}function xn(t,...e){const n=Array(t.length*e.length);for(let s=0;s<e.length;s++){const r=e[s];for(let i=0;i<t.length;i++)n[t.length*s+i]=r(t[i])}return n}function ue(t,e){return Math.floor(t+Math.random()*e)}function vn(t,e,n=e-t){const s=e-t,r=[],i=new Set;for(;r.length<Math.min(n,s);){let o=ue(t,e);for(;i.has(o);)o=ue(t,e);r.push(o),i.add(o)}return r}function ot(t){const e=Array(t.length);e[0]=t[0];for(let n=1;n<t.length;n++)e[n]=t[n]+e[n-1];return e}function P(t){return Object.values(t)}function U(t){return Object.entries(t)}function wn(t){return Reflect.ownKeys(t)}function E(t){const e=[];for(const n of wn(t))e.push([n,t[n]]);return e}function An(t){for(const[e,n]of U(t))n===void 0&&delete t[e];return t}function Mt(t,e){let n=0;return(...s)=>{const r=new Date().getTime();r-n<e||(n=r,t(...s))}}function at(t,e){for(const n of e)t.add(n);return t}function Bt(t,e){const n=1/(e-t);return[-t*n,n-t*n,n]}function Mn(t,e,n=4){const s=(e-t)/n,r=Math.floor(Math.log10(s)),i=[1,2,4,5,10];let[o,a]=[1/0,0];for(let p=0;p<i.length;p++){const y=(i[p]*10**r-s)**2;y<o&&([o,a]=[y,i[p]])}const c=10**r*a,l=Math.ceil(t/c)*c,u=Math.floor(e/c)*c,h=Math.round((u-l)/c),d=[];for(let p=0;p<h+1;p++){const y=l+p*c;d.push(y)}return d}var kn=function(t){return function(e){return t[e]}};function Sn(t){return t.split("").map(kn(zn)).join("")}function Dn(t){let[e,n]=t.split("e");return n=Sn(n),e+"×10"+n}var Gt=t=>()=>t,he=Gt(0),zn={"-":"⁻","+":"",0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹"};function j(t){return{...t,_name:void 0,name:_n,hasName:$n,setName:Pn}}function _n(t="[name missing]"){return this._name??t}function $n(){return this._name!=null}function Pn(t){return this._name=t,this}function kt(t){"@babel/helpers - typeof";return kt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},kt(t)}var Rn=/^\s+/,Cn=/\s+$/;function f(t,e){if(t=t||"",e=e||{},t instanceof f)return t;if(!(this instanceof f))return new f(t,e);var n=Tn(t);this._originalInput=t,this._r=n.r,this._g=n.g,this._b=n.b,this._a=n.a,this._roundA=Math.round(100*this._a)/100,this._format=e.format||n.format,this._gradientType=e.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=n.ok}f.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(e.r*299+e.g*587+e.b*114)/1e3},getLuminance:function(){var e=this.toRgb(),n,s,r,i,o,a;return n=e.r/255,s=e.g/255,r=e.b/255,n<=.03928?i=n/12.92:i=Math.pow((n+.055)/1.055,2.4),s<=.03928?o=s/12.92:o=Math.pow((s+.055)/1.055,2.4),r<=.03928?a=r/12.92:a=Math.pow((r+.055)/1.055,2.4),.2126*i+.7152*o+.0722*a},setAlpha:function(e){return this._a=ye(e),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var e=fe(this._r,this._g,this._b);return{h:e.h*360,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=fe(this._r,this._g,this._b),n=Math.round(e.h*360),s=Math.round(e.s*100),r=Math.round(e.v*100);return this._a==1?"hsv("+n+", "+s+"%, "+r+"%)":"hsva("+n+", "+s+"%, "+r+"%, "+this._roundA+")"},toHsl:function(){var e=de(this._r,this._g,this._b);return{h:e.h*360,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=de(this._r,this._g,this._b),n=Math.round(e.h*360),s=Math.round(e.s*100),r=Math.round(e.l*100);return this._a==1?"hsl("+n+", "+s+"%, "+r+"%)":"hsla("+n+", "+s+"%, "+r+"%, "+this._roundA+")"},toHex:function(e){return pe(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(e){return Ln(this._r,this._g,this._b,this._a,e)},toHex8String:function(e){return"#"+this.toHex8(e)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(v(this._r,255)*100)+"%",g:Math.round(v(this._g,255)*100)+"%",b:Math.round(v(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+Math.round(v(this._r,255)*100)+"%, "+Math.round(v(this._g,255)*100)+"%, "+Math.round(v(this._b,255)*100)+"%)":"rgba("+Math.round(v(this._r,255)*100)+"%, "+Math.round(v(this._g,255)*100)+"%, "+Math.round(v(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":this._a<1?!1:Yn[pe(this._r,this._g,this._b,!0)]||!1},toFilter:function(e){var n="#"+me(this._r,this._g,this._b,this._a),s=n,r=this._gradientType?"GradientType = 1, ":"";if(e){var i=f(e);s="#"+me(i._r,i._g,i._b,i._a)}return"progid:DXImageTransform.Microsoft.gradient("+r+"startColorstr="+n+",endColorstr="+s+")"},toString:function(e){var n=!!e;e=e||this._format;var s=!1,r=this._a<1&&this._a>=0,i=!n&&r&&(e==="hex"||e==="hex6"||e==="hex3"||e==="hex4"||e==="hex8"||e==="name");return i?e==="name"&&this._a===0?this.toName():this.toRgbString():(e==="rgb"&&(s=this.toRgbString()),e==="prgb"&&(s=this.toPercentageRgbString()),(e==="hex"||e==="hex6")&&(s=this.toHexString()),e==="hex3"&&(s=this.toHexString(!0)),e==="hex4"&&(s=this.toHex8String(!0)),e==="hex8"&&(s=this.toHex8String()),e==="name"&&(s=this.toName()),e==="hsl"&&(s=this.toHslString()),e==="hsv"&&(s=this.toHsvString()),s||this.toHexString())},clone:function(){return f(this.toString())},_applyModification:function(e,n){var s=e.apply(null,[this].concat([].slice.call(n)));return this._r=s._r,this._g=s._g,this._b=s._b,this.setAlpha(s._a),this},lighten:function(){return this._applyModification(Kn,arguments)},brighten:function(){return this._applyModification(Fn,arguments)},darken:function(){return this._applyModification(Wn,arguments)},desaturate:function(){return this._applyModification(Hn,arguments)},saturate:function(){return this._applyModification(Bn,arguments)},greyscale:function(){return this._applyModification(Gn,arguments)},spin:function(){return this._applyModification(jn,arguments)},_applyCombination:function(e,n){return e.apply(null,[this].concat([].slice.call(n)))},analogous:function(){return this._applyCombination(Vn,arguments)},complement:function(){return this._applyCombination(qn,arguments)},monochromatic:function(){return this._applyCombination(Xn,arguments)},splitcomplement:function(){return this._applyCombination(In,arguments)},triad:function(){return this._applyCombination(ge,[3])},tetrad:function(){return this._applyCombination(ge,[4])}},f.fromRatio=function(t,e){if(kt(t)=="object"){var n={};for(var s in t)t.hasOwnProperty(s)&&(s==="a"?n[s]=t[s]:n[s]=ct(t[s]));t=n}return f(t,e)};function Tn(t){var e={r:0,g:0,b:0},n=1,s=null,r=null,i=null,o=!1,a=!1;return typeof t=="string"&&(t=Jn(t)),kt(t)=="object"&&(G(t.r)&&G(t.g)&&G(t.b)?(e=Nn(t.r,t.g,t.b),o=!0,a=String(t.r).substr(-1)==="%"?"prgb":"rgb"):G(t.h)&&G(t.s)&&G(t.v)?(s=ct(t.s),r=ct(t.v),e=En(t.h,s,r),o=!0,a="hsv"):G(t.h)&&G(t.s)&&G(t.l)&&(s=ct(t.s),i=ct(t.l),e=On(t.h,s,i),o=!0,a="hsl"),t.hasOwnProperty("a")&&(n=t.a)),n=ye(n),{ok:o,format:t.format||a,r:Math.min(255,Math.max(e.r,0)),g:Math.min(255,Math.max(e.g,0)),b:Math.min(255,Math.max(e.b,0)),a:n}}function Nn(t,e,n){return{r:v(t,255)*255,g:v(e,255)*255,b:v(n,255)*255}}function de(t,e,n){t=v(t,255),e=v(e,255),n=v(n,255);var s=Math.max(t,e,n),r=Math.min(t,e,n),i,o,a=(s+r)/2;if(s==r)i=o=0;else{var c=s-r;switch(o=a>.5?c/(2-s-r):c/(s+r),s){case t:i=(e-n)/c+(e<n?6:0);break;case e:i=(n-t)/c+2;break;case n:i=(t-e)/c+4;break}i/=6}return{h:i,s:o,l:a}}function On(t,e,n){var s,r,i;t=v(t,360),e=v(e,100),n=v(n,100);function o(l,u,h){return h<0&&(h+=1),h>1&&(h-=1),h<.16666666666666666?l+(u-l)*6*h:h<.5?u:h<.6666666666666666?l+(u-l)*(.6666666666666666-h)*6:l}if(e===0)s=r=i=n;else{var a=n<.5?n*(1+e):n+e-n*e,c=2*n-a;s=o(c,a,t+.3333333333333333),r=o(c,a,t),i=o(c,a,t-.3333333333333333)}return{r:s*255,g:r*255,b:i*255}}function fe(t,e,n){t=v(t,255),e=v(e,255),n=v(n,255);var s=Math.max(t,e,n),r=Math.min(t,e,n),i,o,a=s,c=s-r;if(o=s===0?0:c/s,s==r)i=0;else{switch(s){case t:i=(e-n)/c+(e<n?6:0);break;case e:i=(n-t)/c+2;break;case n:i=(t-e)/c+4;break}i/=6}return{h:i,s:o,v:a}}function En(t,e,n){t=v(t,360)*6,e=v(e,100),n=v(n,100);var s=Math.floor(t),r=t-s,i=n*(1-e),o=n*(1-r*e),a=n*(1-(1-r)*e),c=s%6,l=[n,o,i,i,a,n][c],u=[a,n,n,o,i,i][c],h=[i,i,a,n,n,o][c];return{r:l*255,g:u*255,b:h*255}}function pe(t,e,n,s){var r=[R(Math.round(t).toString(16)),R(Math.round(e).toString(16)),R(Math.round(n).toString(16))];return s&&r[0].charAt(0)==r[0].charAt(1)&&r[1].charAt(0)==r[1].charAt(1)&&r[2].charAt(0)==r[2].charAt(1)?r[0].charAt(0)+r[1].charAt(0)+r[2].charAt(0):r.join("")}function Ln(t,e,n,s,r){var i=[R(Math.round(t).toString(16)),R(Math.round(e).toString(16)),R(Math.round(n).toString(16)),R(be(s))];return r&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)&&i[3].charAt(0)==i[3].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0)+i[3].charAt(0):i.join("")}function me(t,e,n,s){var r=[R(be(s)),R(Math.round(t).toString(16)),R(Math.round(e).toString(16)),R(Math.round(n).toString(16))];return r.join("")}f.equals=function(t,e){return!t||!e?!1:f(t).toRgbString()==f(e).toRgbString()},f.random=function(){return f.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})};function Hn(t,e){e=e===0?0:e||10;var n=f(t).toHsl();return n.s-=e/100,n.s=St(n.s),f(n)}function Bn(t,e){e=e===0?0:e||10;var n=f(t).toHsl();return n.s+=e/100,n.s=St(n.s),f(n)}function Gn(t){return f(t).desaturate(100)}function Kn(t,e){e=e===0?0:e||10;var n=f(t).toHsl();return n.l+=e/100,n.l=St(n.l),f(n)}function Fn(t,e){e=e===0?0:e||10;var n=f(t).toRgb();return n.r=Math.max(0,Math.min(255,n.r-Math.round(255*-(e/100)))),n.g=Math.max(0,Math.min(255,n.g-Math.round(255*-(e/100)))),n.b=Math.max(0,Math.min(255,n.b-Math.round(255*-(e/100)))),f(n)}function Wn(t,e){e=e===0?0:e||10;var n=f(t).toHsl();return n.l-=e/100,n.l=St(n.l),f(n)}function jn(t,e){var n=f(t).toHsl(),s=(n.h+e)%360;return n.h=s<0?360+s:s,f(n)}function qn(t){var e=f(t).toHsl();return e.h=(e.h+180)%360,f(e)}function ge(t,e){if(isNaN(e)||e<=0)throw new Error("Argument to polyad must be a positive number");for(var n=f(t).toHsl(),s=[f(t)],r=360/e,i=1;i<e;i++)s.push(f({h:(n.h+i*r)%360,s:n.s,l:n.l}));return s}function In(t){var e=f(t).toHsl(),n=e.h;return[f(t),f({h:(n+72)%360,s:e.s,l:e.l}),f({h:(n+216)%360,s:e.s,l:e.l})]}function Vn(t,e,n){e=e||6,n=n||30;var s=f(t).toHsl(),r=360/n,i=[f(t)];for(s.h=(s.h-(r*e>>1)+720)%360;--e;)s.h=(s.h+r)%360,i.push(f(s));return i}function Xn(t,e){e=e||6;for(var n=f(t).toHsv(),s=n.h,r=n.s,i=n.v,o=[],a=1/e;e--;)o.push(f({h:s,s:r,v:i})),i=(i+a)%1;return o}f.mix=function(t,e,n){n=n===0?0:n||50;var s=f(t).toRgb(),r=f(e).toRgb(),i=n/100,o={r:(r.r-s.r)*i+s.r,g:(r.g-s.g)*i+s.g,b:(r.b-s.b)*i+s.b,a:(r.a-s.a)*i+s.a};return f(o)},f.readability=function(t,e){var n=f(t),s=f(e);return(Math.max(n.getLuminance(),s.getLuminance())+.05)/(Math.min(n.getLuminance(),s.getLuminance())+.05)},f.isReadable=function(t,e,n){var s=f.readability(t,e),r,i;switch(i=!1,r=ts(n),r.level+r.size){case"AAsmall":case"AAAlarge":i=s>=4.5;break;case"AAlarge":i=s>=3;break;case"AAAsmall":i=s>=7;break}return i},f.mostReadable=function(t,e,n){var s=null,r=0,i,o,a,c;n=n||{},o=n.includeFallbackColors,a=n.level,c=n.size;for(var l=0;l<e.length;l++)i=f.readability(t,e[l]),i>r&&(r=i,s=f(e[l]));return f.isReadable(t,s,{level:a,size:c})||!o?s:(n.includeFallbackColors=!1,f.mostReadable(t,["#fff","#000"],n))};var Kt=f.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},Yn=f.hexNames=Un(Kt);function Un(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[t[n]]=n);return e}function ye(t){return t=parseFloat(t),(isNaN(t)||t<0||t>1)&&(t=1),t}function v(t,e){Qn(t)&&(t="100%");var n=Zn(t);return t=Math.min(e,Math.max(0,parseFloat(t))),n&&(t=parseInt(t*e,10)/100),Math.abs(t-e)<1e-6?1:t%e/parseFloat(e)}function St(t){return Math.min(1,Math.max(0,t))}function _(t){return parseInt(t,16)}function Qn(t){return typeof t=="string"&&t.indexOf(".")!=-1&&parseFloat(t)===1}function Zn(t){return typeof t=="string"&&t.indexOf("%")!=-1}function R(t){return t.length==1?"0"+t:""+t}function ct(t){return t<=1&&(t=t*100+"%"),t}function be(t){return Math.round(parseFloat(t)*255).toString(16)}function xe(t){return _(t)/255}var C=function(){var t="[-\\+]?\\d+%?",e="[-\\+]?\\d*\\.\\d+%?",n="(?:"+e+")|(?:"+t+")",s="[\\s|\\(]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")\\s*\\)?",r="[\\s|\\(]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")\\s*\\)?";return{CSS_UNIT:new RegExp(n),rgb:new RegExp("rgb"+s),rgba:new RegExp("rgba"+r),hsl:new RegExp("hsl"+s),hsla:new RegExp("hsla"+r),hsv:new RegExp("hsv"+s),hsva:new RegExp("hsva"+r),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function G(t){return!!C.CSS_UNIT.exec(t)}function Jn(t){t=t.replace(Rn,"").replace(Cn,"").toLowerCase();var e=!1;if(Kt[t])t=Kt[t],e=!0;else if(t=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var n;return(n=C.rgb.exec(t))?{r:n[1],g:n[2],b:n[3]}:(n=C.rgba.exec(t))?{r:n[1],g:n[2],b:n[3],a:n[4]}:(n=C.hsl.exec(t))?{h:n[1],s:n[2],l:n[3]}:(n=C.hsla.exec(t))?{h:n[1],s:n[2],l:n[3],a:n[4]}:(n=C.hsv.exec(t))?{h:n[1],s:n[2],v:n[3]}:(n=C.hsva.exec(t))?{h:n[1],s:n[2],v:n[3],a:n[4]}:(n=C.hex8.exec(t))?{r:_(n[1]),g:_(n[2]),b:_(n[3]),a:xe(n[4]),format:e?"name":"hex8"}:(n=C.hex6.exec(t))?{r:_(n[1]),g:_(n[2]),b:_(n[3]),format:e?"name":"hex"}:(n=C.hex4.exec(t))?{r:_(n[1]+""+n[1]),g:_(n[2]+""+n[2]),b:_(n[3]+""+n[3]),a:xe(n[4]+""+n[4]),format:e?"name":"hex8"}:(n=C.hex3.exec(t))?{r:_(n[1]+""+n[1]),g:_(n[2]+""+n[2]),b:_(n[3]+""+n[3]),format:e?"name":"hex"}:!1}function ts(t){var e,n;return t=t||{level:"AA",size:"small"},e=(t.level||"AA").toUpperCase(),n=(t.size||"small").toLowerCase(),e!=="AA"&&e!=="AAA"&&(e="AA"),n!=="small"&&n!=="large"&&(n="small"),{level:e,size:n}}const K={defaultGapPct:.8,defaultGapPx:1,defaultNormX:.05,defaultNormY:.05,defaultRadius:5,axisTitleFontsize:18,axisLabelFontsize:14,marginLines:[4,4,1,1],groupColors:["#984ea3","#e41a1c","#4daf4a","#377eb8"]};function lt(t){return{...t,with(e){return lt(e(this))}}}function es(t,e,n){const s=Array(t.length);for(let r=0;r<t.length;r++)s[r]=n(t[r],e[r]);return s}function ns(t,e){return(t+e)/2}function Q(){const{marginLines:t,axisTitleFontsize:e}=K;return t.map(un(e))}function Ft(t,e){const[n,s]=[t[0],t[2]].sort(O),[r,i]=[t[1],t[3]].sort(O),[o,a]=[e[0],e[2]].sort(O),[c,l]=[e[1],e[3]].sort(O);return!(s<o||n>a||i<c||r>l)}function ve(t){const[e,n,s,r]=t;return[e,n,s-e,r-n]}function we(t,e,n){return!(t<e)&&!(t>n)}function Dt(t,e){let[n,s,r,i]=ve(t),[o,a,c,l]=ve(e);const u=c*i-r*l,h=((n-o)*i-(s-a)*r)/u,d=-(-(n-o)*l+(s-a)*c)/u;return we(h,0,1)&&we(d,0,1)}function Ae(t,e){const[n,s,r,i]=t;return Dt([n,s,r,s],e)||Dt([n,s,n,i],e)||Dt([r,s,r,i],e)||Dt([n,i,r,i],e)}function Wt(t,e){const[n,s]=t,[r,i,o,a]=e;return!(n<r||n>o||s<i||s>a)}function ss(t){return typeof t[0]=="number"}function jt(t){if(typeof t!="number")return t;const e=Math.floor(Math.log10(Math.abs(t)));return e>4?Lt(t).toString():e<=4&&e>0?Lt(t,4-e).toString():Lt(t,Math.abs(e)+2).toString()}function rs(t,e){if(!ss(t))return t;const n=(e==null?void 0:e.decimalPlaces)??4,s=o=>o!=0&&Math.abs(Math.log10(o))>n,i=Ht(t).some(s)?is:os;return t.map(i)}function is(t){return t===0?"0":Dn(t.toExponential())}function os(t){return t===0?"0":parseFloat(t.toPrecision(12)).toString()}function as(t){const e=[...t].sort(O),n=Array(t.length),s={};for(let r=0;r<t.length;r++){const i=t[r];s[i]===void 0?s[i]=0:s[i]++,n[r]=e.indexOf(i)+s[i]}return n}function F(t,e,n=0,s=e.length){const r=Array(s-n);for(let i=0;i<s-n;i++)r[e[n+i]]=t[i];return r}function cs(t){return f(t).saturate(30).lighten(30).toHexString()}function qt(t){return{...t,n:ls,values:us,valueAt:hs,scaledAt:ds,retrain:fs}}function ls(){return this.array.length}function us(){const t=this.n(),e=[];for(let n=0;n<t;n++)e.push(this.valueAt(n));return e}function hs(t,e=0){return this.array[t+e]}function ds(t,e){return e.pushforward(this.valueAt(t))}function fs(t){return this.domain.retrain(t),this}function zt(t){return{...t,proxy:Me}}function Me(t){return{...this,source:this,indexfn:t,n:ps,valueAt:ms,proxy:Me}}function ps(){return this.indexfn().length}function ms(t,e=0){return this.source.valueAt(this.indexfn()[t],e)}function _t(t){return{...t,...{setReducer:gs,stack:ys,normalizeByParent:bs,shiftLeft:xs,parent:vs}}}function gs(t){return this.reducer=t,this}function ys(){if(!this.reducer)return this;let e=this.reducer.stack().result;return this.indexfn&&(e=e.proxy(this.indexfn)),e}function bs(){if(!this.reducer)return this;const t=this.reducer.normalizeByParent();let e=t.result;return this.indexfn&&(e=e.proxy(this.indexfn)),t.result}function xs(){if(!this.reducer)return this;const t=this,e={...this};return e.valueAt=function(n){var s;return n===0?(s=e.reducer)==null?void 0:s.reducer.initialfn():t.valueAt(n,-1)},e}function vs(){const{reducer:t}=this;if(!t)return this;const{parent:e,factor:n}=t;if(!e||!n||!n.parent)return this;const r=e.clone().result.proxy(()=>n.parent.levels);return _t(r)}function D(t){return{...t,observers:new Set,listen:As,emit:ws,remove:Ms}}function ws(){for(const t of this.observers)t();return this}function As(t){return this.observers.add(t),this}function Ms(t){return this.observers.delete(t),this}function ks(t,e){const n=t.emit;t.emit=vt,e(),t.emit=n}function Ss(t){const e=S("div").addClass("ps-widget").addClass("ps-widget-range").get(),n="",{min:s,max:r}=t,a=D({...{container:e,name:n,source:t,min:s,max:r},...{setName:Ds,render:zs,min:s,max:r}});return a.render(),a}function Ds(t){return this.name=t,this.render(),this}function zs(){const{container:t,source:e}=this;for(;t.lastChild;)t.removeChild(t.lastChild);const n=S("span").appendTo(t).get(),s=S("input").appendTo(t).get(),r=S("input").appendTo(t).get();n.innerText=`Range of ${this.name}: `,s.size=6,r.size=6,s.value=jt(e.min),r.value=jt(e.max);const i=o=>{o.code==="Enter"&&(this.min=parseFloat(s.value),this.max=parseFloat(r.value),this.emit(),this.render())};s.addEventListener("keydown",i),r.addEventListener("keydown",i)}function L(t=0,e=1){const n="ExpanseContinuous",[s,r,i]=[t,e,1],[o,a]=[X,X],u={...{[Symbol.toStringTag]:n,min:t,max:e,scale:i,defaultMin:s,defaultMax:r},...{clone:Ks,range:_s,normalize:$s,unnormalize:Ps,setMin:Rs,setMax:Cs,setMinMax:Ts,setDefaultMin:Ns,setDefaultMax:Os,setScale:Es,trans:o,inv:a,setTransform:Ls,expand:Hs,defaultize:Bs,retrain:Gs,breaks:Fs,widget:Ws}};return D(u)}function _s(){return this.trans(this.max-this.min)}function $s(t){return(this.trans(t)-this.trans(this.min))/this.range()/this.scale}function Ps(t){return this.inv(this.min)+this.inv(t*this.range())*this.scale}function Rs(t){return this.min=t,this.emit(),this}function Cs(t){return this.max=t,this.emit(),this}function Ts(t,e){return ks(this,()=>this.setMin(t).setMax(e)),this.emit(),this}function Ns(t){return this.defaultMin=t,this.setMin(t),this}function Os(t){return this.defaultMax=t,this.setMax(t),this}function Es(t){return this.scale=t,this}function Ls(t,e){return this.trans=t,this.inv=e,this}function Hs(t){const{min:e,max:n}=this,s=this.range(),r=(t-1)*s/2;return this.setDefaultMin(e-r).setDefaultMax(n+r),this}function Bs(){return this.min=this.defaultMin,this.max=this.defaultMax,this.emit(),this}function Gs(t){const[e,n]=Ht(t);return this.setDefaultMin(e).setDefaultMax(n),this}function Ks(){const t=L();return t.setDefaultMin(this.defaultMin).setDefaultMax(this.defaultMax),t.setTransform(this.trans,this.inv),t}function Fs(t){let[e,n]=[t.normalize(0),t.normalize(1)];return e=this.unnormalize(e),n=this.unnormalize(n),Mn(e,n)}function Ws(t){let[e,n]=[t.normalize(0),t.normalize(1)];e=this.unnormalize(e),n=this.unnormalize(n);const s=D({min:e,max:n}),r=Ss(s);return r.listen(()=>{let{min:i,max:o}=r;s.min=i,s.max=o,[i,o]=[i,o].map(this.normalize.bind(this)),[i,o]=Bt(i,o),t.setMin(i).setMax(o)}),r}function q(t,e){const n="Continuous";e=e??L(...Ht(t));const i={...{array:t,domain:e,[Symbol.toStringTag]:n},...{range:Vs,min:qs,max:Is,clone:js}};return lt(i).with(j).with(qt).with(zt).with(_t)}function js(){const t=[...this.array];return q(t)}function qs(){return this.domain.min}function Is(){return this.domain.max}function Vs(){return this.domain.range()}function Xs(){return j({options:{center:!1,scale:!1},parse:Ys,center:Us,scale:Qs})}function Ys(t){const{center:e,scale:n}=this.options;if(!(e||n))return q(t);const s=[],r={mean:0,sumSquares:0,sd:0};for(let i=0;i<t.length;i++){const{mean:o,sumSquares:a}=r,c=t[i],l=o,u=(i*o+c)/(i+1),h=a+(c-l)*(c-u);r.mean=u,r.sumSquares=h}r.sd=Math.sqrt(r.sumSquares/t.length);for(let i=0;i<t.length;i++){const o=e?r.mean:0,a=n?r.sd:1;s[i]=(t[i]-o)/a}return q(s)}function Us(){return this.options.center=!0,this}function Qs(){return this.options.scale=!0,this}function ke(t){const s={name:"",container:S("div").addClass("ps-widget").addClass("ps-widget-draglist").get(),source:t},i=D({...s,...{setName:Zs,render:Js}});return i.render(),i}function Zs(t){return this.name=t,this.render(),this}function Js(){const{container:t,source:e}=this,n=e.values;for(;t.lastChild;)t.removeChild(t.lastChild);const s=S("span").appendTo(t).get(),r=S("ul").appendTo(t).get();s.innerText=`Levels of ${this.name}: `;for(const i of n){const o=S("li").setAttribute("draggable",!0).text(i).appendTo(r).get();o.addEventListener("dragstart",()=>o.classList.add("dragged")),o.addEventListener("dragend",()=>{const a=Array.from(r.childNodes);for(let c=0;c<a.length;c++)n[c]=a[c].innerText;this.emit(),o.classList.remove("dragged")})}r.addEventListener("mousedown",i=>i.stopPropagation()),r.addEventListener("dragover",i=>tr(r,i.clientY))}function tr(t,e){const n=Array.from(t.childNodes),s=n.findIndex(o=>o.classList.contains("dragged")),r=n.splice(s,1);let i={element:n[0],distance:1/0};for(const o of n){const a=o.getBoundingClientRect(),c=e-a.top-a.height/2;Math.abs(c)<i.distance&&(i={element:o,distance:c})}i.distance>0?t.insertBefore(i.element,r[0]):t.insertBefore(r[0],i.element)}function It(t){const e="ExpanseDiscreteWeighted",n=it(0,t.length-1),s=wt(1,t.length),r=ot(s),a={...{[Symbol.toStringTag]:e,order:n,values:t,weights:s,cumWeights:r},...{clone:hr,normalize:er,unnormalize:nr,width:sr,setValues:ir,setWeights:or,setOrder:ar,setDefaultWeights:cr,setDefaultOrder:lr,getWidthExpanse:rr,retrain:ur,breaks:dr,widget:fr}};return D(a)}function er(t){const[e,n,s]=Se(this,t);return(e+(n-e)/2)/s}function nr(t){throw new Error("Not implemented yet")}function sr(t){const[e,n,s]=Se(this,t);return(n-e)/s}function rr(){const t={...this};return t.normalize=this.width,t.clone=vt.bind(t),t}function ir(t){for(let e=0;e<t.length;e++)this.values[e]=t[e];return this.emit(),this}function or(t){const e=ot(At(t,this.order));for(let n=0;n<t.length;n++)this.weights[n]=t[n];for(let n=0;n<e.length;n++)this.cumWeights[n]=e[n];return this.emit(),this}function ar(t){for(let n=0;n<t.length;n++)this.order[n]=t[n];const e=ot(F(this.weights,this.order));for(let n=0;n<e.length;n++)this.cumWeights[n]=e[n];return this.emit(),this}function cr(){this.weights.fill(1);for(let t=0;t<this.cumWeights.length;t++)this.cumWeights[t]=t+1;return this.emit(),this}function lr(){for(let e=0;e<this.order.length;e++)this.order[e]=e;const t=ot(F(this.weights,this.order));for(let e=0;e<t.length;e++)this.cumWeights[e]=t[e];return this.emit(),this}function ur(t){const e=Array.from(new Set(t)).sort(Et),n=wt(1,e.length),s=ot(n);return this.values=e,this.weights=n,this.cumWeights=s,this.emit(),this}function hr(){const t=It(this.values);return t.order=this.order,t.weights=this.weights,t.cumWeights=this.cumWeights,t.normalize=this.normalize,t}function dr(){return F(this.values,this.order)}function Se(t,e){const{order:n,values:s,cumWeights:r}=t,i=n[s.indexOf(e)];return[r[i-1]??0,r[i],rt(r)]}function fr(){const{values:t}=this,e={values:[...t]},n=ke(e);return n.listen(()=>{const s=Array(t.length);for(let r=0;r<t.length;r++)s[r]=e.values.indexOf(t[r]);this.setOrder(s)}),n}function ut(t,e){const n=Array.from(new Set(t)).sort(Et),s="Discrete";e=e??It(n);const o={...{array:t,domain:e,[Symbol.toStringTag]:s},...{width:mr,clone:pr}};return lt(o).with(j).with(qt).with(zt).with(_t)}function pr(){const t=[...this.array],e=ut(t);return e.domain=this.domain.clone(),e}function mr(){const t=this.clone();return t.domain=this.domain.getWidthExpanse(),t}function gr(){return j({options:{case:0,capitalize:!1,stripWS:!1},parse:yr,toLowerCase:br,toUpperCase:xr,capitalize:vr,stripWhitespace:wr})}function yr(t){const{case:e,capitalize:n,stripWS:s}=this.options;if(e===0&&!(n||s))return ut(t.map(String));const r=Array(t.length);let i=X;e===1&&(i=xt(i,fn)),e===2&&(i=xt(i,pn)),s&&(i=xt(i,mn)),n&&(i=xt(i,dn));for(let o=0;o<t.length;o++)r[o]=i(String(t[o]));return ut(r)}function br(){return this.options.case=1,this}function xr(){return this.options.case=2,this}function vr(){return this.options.capitalize=!0,this}function wr(){return this.options.stripWS=!0,this}function Ar(t){return t==="continuous"?Xs():gr()}function $(t){const e="Dataframe",r={...{[Symbol.toStringTag]:e,columns:t},...{n:kr,keys:Sr,col:Dr,cols:zr,row:_r,rows:$r,select:Pr,join:Rr,proxy:Cr}};return D(r)}function Mr(t,e,n){const s={},r=$(s),{maxRows:i,sample:o}=n??{},a=Object.values(t)[0].length,c=vn(0,a-1,o??1);let l=0;for(const[u,h]of Object.entries(e)){u in t||Ot(`Property ${u} missing from raw data`),Array.isArray(t[u])||Ot(`Property "${u}" is not an array.`);let d=t[u];l===0&&(l=d.length),d.length!=l&&Ot(`Array "${u}" has different length from previously seen columns`),o&&(d=At(d,c)),i&&d.length>i&&(d.length=i),h.hasName()||h.setName(u);const p=h.parse(d);p.setName(h.name()),s[u]=p}return r}function kr(){if(this.cachedN)return this.cachedN();for(const t of P(this.columns))if(t.n())return this.cachedN=t.n.bind(t),this.cachedN();throw new Error("No fixed-length variables present in the data")}function Sr(){return Object.keys(this.columns)}function Dr(t){return this.columns[t]}function zr(){return this.columns}function _r(t,e){e=e??{};for(const[n,s]of E(this.columns))e[n]=s.valueAt(t);return e}function $r(){const t=this.n(),e=Array(t);for(let n=0;n<t;n++)e[n]=this.row(n);return e}function Pr(t){const{columns:e}=this,n=An(t(e));for(const[r,i]of E(e))typeof r=="symbol"&&(n[r]=i);const s=$(n);return this.listen(()=>s.emit()),s}function Rr(t){const e={...this.columns,...t.columns},n=$(e);return this.listen(()=>n.emit()),t.listen(()=>n.emit()),n}function Cr(t){const e={...this.columns},n=$(e);n.cachedN=()=>t.length;for(const[s,r]of E(n.columns))n.columns[s]=r.proxy(()=>t);return n}const Z={name:"sum",initialfn:he,reducefn:le},Tr={...Z,name:"count"},Nr={name:"max",initialfn:Gt(-1/0),reducefn:Math.max},Or={name:"paste",initialfn:Gt(""),reducefn:(t,e)=>t+e.toString()};function De(t){return{scale:t,render:Er}}function Er(t){const{scale:e}=this,n=e.aes,s=t[`${n}Axis`],r=e.breaks(),i=rs(r),[o,a,c,l]=Q(),u=e.other.codomain.min-s.fontsize/2;if(s.clear(),n==="x"){let h=0,d=0;for(let p=0;p<i.length;p++){const y=i[p],x=e.pushforward(r[p]),m=s.textWidth(y)+1;x<a||x>s.width-l||Lr(h,x,d,m)||([h,d]=[x,m],s.text(x,u,y))}}else if(n==="y"){let h=0;for(let d=0;d<i.length;d++){const p=i[d],y=e.pushforward(r[d]),x=s.textHeight(p)+5;y<o||y>s.height-c||y-x<h||(h=y,s.text(u,y,p))}}}function Lr(t,e,n,s){const[r,i]=[t-n/2,t+n/2],[o,a]=[e-s/2,e+s/2];return r<a&&i>=o}function ze(t){return{scale:t,render:Hr}}function Hr(t){const e=this.scale.aes;if(!e)return;const n=t.base,s=this.scale.name(),r=Q(),i=e==="x"?r[0]:r[1],o=this.scale.codomain.unnormalize(.5),a=this.scale.other.codomain.unnormalize(0)-i*2/3;e==="x"&&n.text(o,a,s),e==="y"&&n.text(a,o,s,{vertical:!0})}function _e(t){return!!t.setMin}function Y(t,e,n){const s="Scale";t=t??L(),e=e??L(),n=n??L();const o=D(j({...{[Symbol.toStringTag]:s,domain:t,norm:e,codomain:n},...{clone:Br,setAes:Gr,setDomain:jr,setCodomain:qr,setOther:Kr,setMin:Ir,setMax:Vr,setOrder:Ur,setWeights:Xr,setDefaultOrder:Qr,setDefaultWeights:Zr,getOrder:Yr,pushforward:Fr,pullback:Wr,move:Jr,freezeMin:ni,freezeMax:si,link:ti,breaks:ei,ratio:ri,widget:ii}}));return o.norm.listen(()=>o.emit()),o}function Br(){return Y(this.domain.clone(),this.norm.clone(),this.codomain.clone())}function Gr(t){return this.aes=t,this}function Kr(t){return this.other=t,this}function Fr(t){const{domain:e,norm:n,codomain:s}=this;return s.unnormalize(n.unnormalize(e.normalize(t)))}function Wr(t){const{domain:e,norm:n,codomain:s}=this;return e.unnormalize(n.normalize(s.normalize(t)))}function jr(t){return this.domain=t,t.listen(()=>this.emit()),this}function qr(t){return this.codomain=t,this}function Ir(t){var e,n;return(n=(e=this.domain).setDefaultMin)==null||n.call(e,t),this}function Vr(t){var e,n;return(n=(e=this.domain).setDefaultMax)==null||n.call(e,t),this}function Xr(t){var e,n;return(n=(e=this.domain).setWeights)==null||n.call(e,t),this}function Yr(){return this.domain.order}function Ur(t){var e,n;return(n=(e=this.domain).setOrder)==null||n.call(e,t),this}function Qr(){var t,e;return(e=(t=this.domain).setDefaultOrder)==null||e.call(t),this}function Zr(){var t,e;return(e=(t=this.domain).setDefaultWeights)==null||e.call(t),this}function Jr(t){const{min:e,max:n}=this.norm;return this.norm.setMinMax(e+t,n+t),this}function ti(t){const e=this.move.bind(this);return this.move=n=>(e(n),t.move(n),this),this}function ei(){return this.domain.breaks(this.norm)}function ni(){return this.norm.setMin=vt,this}function si(){return this.norm.setMax=vt,this}function ri(){if(!Vt(this))return-1;const{domain:t,norm:e,codomain:n}=this;return t.range()/e.range()/n.range()}function ii(){const t=this.domain.widget(this.norm);if(t)return t.setName(this.name())}function Vt(t){return _e(t.domain)}var H=(t=>(t[t.Transient=255]="Transient",t[t.Group1=7]="Group1",t[t.Group2=6]="Group2",t[t.Group3=5]="Group3",t[t.Group4=4]="Group4",t))(H||{}),k=(t=>(t[t.Absolute=0]="Absolute",t[t.Proportion=1]="Proportion",t))(k||{}),J=(t=>(t[t.Alphanumeric=0]="Alphanumeric",t[t.Custom=1]="Custom",t))(J||{}),ht=(t=>(t[t.Middle=.5]="Middle",t[t.Top=1]="Top",t[t.Bottom=0]="Bottom",t))(ht||{}),$t=(t=>(t[t.Center=.5]="Center",t[t.Left=1]="Left",t[t.Right=0]="Right",t))($t||{});function tt(t){const e=S("canvas").appendTo(t),n=e.get(),s=n.getContext("2d"),r={node:n,container:t,canvas:n,canvasWrapper:e,context:s,contextProps:{}},i={clipped:!1,margins:[0,0,0,0],fontsize:K.axisLabelFontsize,width:0,height:0,scalingFactor:2},a=D({...r,...i,...{resize:oi,clip:ai,setMargins:ci,addClass:di,getProp:fi,setAttribute:li,setStyles:ui,setProps:pi,setBackgroundColor:hi,textWidth:wi,textHeight:Ai,clear:mi,point:gi,rectangleXY:yi,rectangleWH:bi,line:xi,text:vi}});return a.resize(),window.addEventListener("resize",()=>a.resize()),a}function oi(){const{context:t,canvas:e,contextProps:n,scalingFactor:s,clipped:r}=this,{clientWidth:i,clientHeight:o,clientLeft:a,clientTop:c}=e,l=i-a,u=o-c;this.width=l,this.height=u,this.canvas.width=l*s,this.canvas.height=u*s;for(const[h,d]of U(n))t[h]=d;return t.scale(s,s),r&&this.clip(),this.emit(),this}function ai(){let{context:t,width:e,height:n}=this;const[s,r,i,o]=this.margins;return e=e-r-o,n=n-i-s,t.beginPath(),t.rect(r,i,e,n),t.clip(),this}function ci(t){return this.margins=t,this.clipped=!0,this}function li(t,e){return this.canvasWrapper.setAttribute(t,e),this}function ui(t){return this.canvasWrapper.setStyles(t),this}function hi(t){return this.setStyles({backgroundColor:t}),this}function di(t){return this.canvasWrapper.addClass(t),this}function fi(t){return this.context[t]}function pi(t){for(const[e,n]of U(t))this.contextProps[e]=n,this.context[e]=n;return this}function mi(){return this.context.clearRect(0,0,this.width,this.height),this}function gi(t,e,n){const{height:s}=this,r=(n==null?void 0:n.radius)??K.defaultRadius,i=(n==null?void 0:n.hAnchor)??$t.Center,o=(n==null?void 0:n.vAnchor)??ht.Middle;return t=t+2*(i-.5)*r,e=s-e+2*(.5-o)*r,this.context.beginPath(),this.context.arc(t,e,r,0,Math.PI*2),this.context.fill(),this}function yi(t,e,n,s){const{context:r,height:i}=this;return r.fillRect(t,i-e,n-t,e-s),this}function bi(t,e,n,s,r){const{height:i}=this,o=(r==null?void 0:r.hAnchor)??$t.Center,a=(r==null?void 0:r.vAnchor)??ht.Middle;return t=t-o*n,e=i-e+a*s,this.context.fillRect(t,e,n,-s),this}function xi(t,e){const{context:n,height:s}=this;n.beginPath(),n.moveTo(t[0],s-e[0]);for(let r=1;r<t.length;r++)n.lineTo(t[r],s-e[r]);return n.stroke(),this}function vi(t,e,n,s){const{context:r,height:i}=this;return r.save(),r.translate(t,i-e),s!=null&&s.vertical&&r.rotate(-Math.PI/2),r.fillText(n,0,0),r.translate(-t,-(i-e)),r.restore(),this}function wi(t){return this.context.measureText(t).width}function Ai(t){const e=this.context.measureText(t);return e.actualBoundingBoxAscent+e.actualBoundingBoxDescent}function Mi(t){const e=S("div").appendTo(t).addClass("ps-query-display").get();return{parentContainer:t,container:e,clear:ki,renderQuery:Si}}function ki(){this.container.style.display="none"}function Si(t,e){if(!e)return;let n="";for(const[h,d]of Object.entries(e))n+=`${h}: ${jt(d)}<br>`;const{container:s,parentContainer:r}=this,{clientWidth:i,clientHeight:o}=r;s.innerHTML=n,s.style.display="inline-block";const a=getComputedStyle(s),c=parseFloat(a.width.slice(0,-2)),[l,u]=t;l+c>i?(s.style.left="auto",s.style.right=`${i-l+5}px`):(s.style.left=`${l+5}px`,s.style.right="auto"),s.style.top=`${o-u}px`}function Di(){return D({coords:[0,0,0,0],setCoords:zi,clear:_i,render:$i})}function zi(t){this.coords=t,this.emit()}function _i(){this.setCoords([0,0,0,0])}function $i(t){const[e,n,s,r]=this.coords;t.user.clear(),t.user.rectangleXY(e,n,s,r)}function Pi(t){const e=S("dialog").addClass("ps-widget-modal").appendTo(t).get(),n=S("div").addClass("ps-widget-display").appendTo(e).get();return e.onclick=i=>(i.stopPropagation(),e.close()),n.onclick=i=>i.stopPropagation(),n.onmousemove=i=>i.stopPropagation(),{initialized:!1,container:n,modal:e,show:Ri,addWidget:Ci}}function Ri(){this.container.childNodes.length&&this.modal.showModal()}function Ci(t){t&&this.container.appendChild(t.container)}function Ti(){const{defaultNormX:t,defaultNormY:e}=K;return{...{coords:[[t,e,1-t,1-e]]},...{push:Ni,pop:Li,clear:Oi,isEmpty:Ei,current:Hi,currentStretch:Bi}}}function Ni(t){const[e,n]=Bt(t[0],t[2]),[s,r]=Bt(t[1],t[3]);return this.coords.push([e,s,n,r]),this}function Oi(){return this.coords.length=1,this}function Ei(){return this.coords.length===1}function Li(){return this.coords.length>1&&this.coords.pop(),rt(this.coords)}function Hi(){return rt(this.coords)}function Bi(){if(this.coords.length===1)return[1,1,1];const[t,e,n,s]=rt(this.coords),r=n-t,i=s-e,o=Math.max(r,i);return[r,i,o]}const et=[0,1,2,3,4,5,6,7],Xt=[4,5,6,7];function I(t){const e=S("div").addClass("ps-plot-container").get(),n={},{groupColors:s,axisTitleFontsize:r,axisLabelFontsize:i}=K,o=s.slice(),a=o.length;for(let N=0;N<a;N++)o.push(cs(o[N]));const c=Q();for(const N of et)n[N]=tt(e).setAttribute("id",`data-layer${N}`).addClass("ps-plot-context").setStyles({zIndex:`${7-N+1}`}).setProps({fillStyle:o[N],strokeStyle:o[N],font:`${i}px sans`}).setMargins(c);n.base=tt(e).addClass("ps-plot-context").addClass("base").setStyles({backgroundColor:"whitesmoke"}).setProps({textAlign:"center",textBaseline:"middle",font:`${r}px sans`}),n.under=tt(e).addClass("ps-plot-context").addClass("inner"),n.user=tt(e).addClass("ps-plot-context").addClass("user").setStyles({zIndex:"10"}).setProps({fillStyle:"#99999933",strokeStyle:"#00000000"}).setMargins(c),n.xAxis=tt(e).addClass("ps-plot-context").setProps({textBaseline:"top",textAlign:"center",font:`${i}px serif`,fillStyle:"#3B4854"}),n.yAxis=tt(e).addClass("ps-plot-context").setProps({textBaseline:"middle",textAlign:"right",font:`${i}px serif`,fillStyle:"#3B4854"});const l={x:Y(),y:Y(),size:Y(),width:Y(),height:Y(),area:Y()},{defaultNormX:u,defaultNormY:h}=K;l.x.setOther(l.y).setAes("x"),l.x.norm.setDefaultMin(u).setDefaultMax(1-u),l.x.norm.defaultize(),l.y.setOther(l.x).setAes("y"),l.y.norm.setDefaultMin(h).setDefaultMax(1-h),l.y.norm.defaultize(),l.size.codomain.setDefaultMin(1).setDefaultMax(10).defaultize(),l.width.norm.setDefaultMax(1-2*u).defaultize(),l.height.norm.setDefaultMax(1-2*h).defaultize(),l.width.freezeMin(),l.height.freezeMin();const d=[],p=!1,y=!1,x=0,m=0,g=0,w=0,A="",Xe=void 0,nt=Di(),Tt=Ti(),ne=Mi(e),Nt=Pi(e),b={pars:{active:p,mousedown:y,mousebutton:x,mode:m,lastX:g,lastY:w,lastKey:A,aspectRatio:Xe},...{scene:t,container:e,contexts:n,scales:l,graphicObjects:d,selectionRect:nt,zoomStack:Tt,queryDisplay:ne,widgetDisplay:Nt,localKeyActions:{},globalKeyActions:{}},...{activate:Gi,deactivate:Ki,render:Wi,resize:Yt,reset:ji,setAlpha:Vi,scaleAlpha:Xi,setAspectRatio:Yi,trainScales:Fi,pushGraphicObject:qi,addKeyAction:Ii}};window.addEventListener("resize",Mt(Yt.bind(b),10)),window.addEventListener("keydown",co.bind(b)),window.addEventListener("keyup",lo.bind(b)),e.addEventListener("mousedown",to.bind(b)),e.addEventListener("mousemove",Mt(no.bind(b),20)),e.addEventListener("mouseup",eo.bind(b)),e.addEventListener("dblclick",ao.bind(b)),e.addEventListener("contextmenu",oo.bind(b)),new ResizeObserver(Mt(Yt.bind(b),10)).observe(e),b.addKeyAction("KeyQ",()=>b.pars.mode=2),b.addKeyAction("BracketRight",()=>b.scaleAlpha(1.1111111111111112)),b.addKeyAction("BracketLeft",()=>b.scaleAlpha(.9)),b.addKeyAction("KeyR",()=>(b.reset(),b.render())),b.addKeyAction("KeyP",Ui.bind(b)),b.addKeyAction("KeyZ",Zi.bind(b)),b.addKeyAction("KeyX",Ji.bind(b)),b.addKeyAction("KeyS",()=>e.style.resize="both"),nt.listen(Mt(Qi.bind(b),20)),b.pushGraphicObject(De(l.x)),b.pushGraphicObject(De(l.y)),b.pushGraphicObject(ze(l.x)),b.pushGraphicObject(ze(l.y)),b.pushGraphicObject(nt),t.addPlot(b);for(const N of P(b.scales))N.listen(()=>b.render());return b}function Yt(){const{contexts:t,scales:e,container:n,pars:s}=this;for(const d of Object.values(t))d.resize();const{clientWidth:r,clientHeight:i}=n,[o,a,c,l]=Q(),u=r-a-l,h=i-c-o;if(e.x.codomain.setMin(a).setMax(Math.max(a,r-l)),e.y.codomain.setMin(o).setMax(Math.max(o,i-c)),e.width.codomain.setMax(u),e.height.codomain.setMax(h),e.area.codomain.setMax(Math.min(u,h)),s.aspectRatio!=null){const{x:d,y:p}=e,[y,x]=[d,p].map(A=>A.ratio()),m=y/x;if(m===0||isNaN(m)||!isFinite(m))return;const[g,w]=[d,p].map(A=>A.codomain.range()/A.norm.range());g>w?e.x.norm.expand(m):e.y.norm.expand(1/m)}this.render()}function Gi(){this.pars.active=!0,this.container.classList.add("active")}function Ki(){this.pars.active=!1,this.container.classList.remove("active"),this.selectionRect.clear()}function Fi(t,e){const n=e(t.columns),{scales:s}=this;for(const[r,i]of U(n)){const o=s[r];o&&(i.domain&&o.setDomain(i.domain.clone()),i.hasName()&&o.setName(i.name()))}for(const r of["height","width","area"])s[r].setMin(0);this.render()}function Wi(){for(const t of Object.values(this.contexts))t.clear();for(const t of this.graphicObjects)t.render&&t.render(this.contexts);return this}function ji(){const{container:t,scales:e,contexts:n,selectionRect:s,zoomStack:r}=this,{clientWidth:i,clientHeight:o}=t,[a,c,l,u]=Q(),h=i-c-u,d=o-l-a;for(const p of P(e))p.norm.defaultize();e.size.codomain.defaultize(),e.width.codomain.setMax(h),e.height.codomain.setMax(d),e.area.codomain.setMax(Math.min(h,d)),s.clear(),r.clear();for(const p of P(n))p.setProps({globalAlpha:1});this.render()}function qi(t){if(this.graphicObjects.push(t),t.keyActions)for(const[e,n]of U(t.keyActions))this.addKeyAction(e,n);this.render()}function Ii(t,e){this.localKeyActions[t]?this.localKeyActions[t]=an(this.localKeyActions[t],e):this.localKeyActions[t]=e}function Vi(t){const{contexts:e}=this;for(const n of Xt)e[n].setProps({globalAlpha:t});this.render()}function Xi(t){const{contexts:e}=this;for(const n of Xt){const s=e[n],r=s.getProp("globalAlpha");s.setProps({globalAlpha:st(r*t)})}this.render()}function Yi(t){const{x:e,y:n}=this.scales;return!Vt(e)||!Vt(n)?this:(this.pars.aspectRatio=t,this.resize(),this)}function Ui(t){if(t.preventDefault(),this.widgetDisplay.initialized)this.widgetDisplay.show();else{for(const e of["x","y"]){const n=this.scales[e].widget();n&&this.widgetDisplay.addWidget(n)}this.widgetDisplay.show(),this.widgetDisplay.initialized=!0}}function Qi(){const{scene:t,graphicObjects:e,selectionRect:n}=this,{coords:s}=n,r=new Set;if(s.every(i=>i===0)){t.marker.update(r);return}for(const i of e)i.check&&at(r,i.check(s));this.scene.marker.update(r)}function Zi(){const{scales:t,selectionRect:e,zoomStack:n}=this;let[s,r,i,o]=e.coords;if(Math.abs(i-s)<10||Math.abs(o-r)<10)return;const{x:a,y:c}=t;s=a.norm.normalize(st(a.codomain.normalize(s))),i=a.norm.normalize(st(a.codomain.normalize(i))),r=c.norm.normalize(st(c.codomain.normalize(r))),o=c.norm.normalize(st(c.codomain.normalize(o))),[s,i]=[s,i].sort(O),[r,o]=[r,o].sort(O),n.push([s,r,i,o]);const[l,u,h,d]=n.current();t.x.norm.setMin(l).setMax(h),t.y.norm.setMin(u).setMax(d),e.clear(),this.render()}function Ji(){const{zoomStack:t,scales:e}=this;if(t.isEmpty())return;t.pop();const[n,s,r,i]=t.current();e.x.norm.setMin(n).setMax(r),e.y.norm.setMin(s).setMax(i),this.render()}function to(t){const{scene:e,container:n,selectionRect:s}=this;if(e.deactivateAllExcept(this),this.activate(),this.pars.mousedown=!0,this.pars.mousebutton=t.button,t.button===0&&(this.pars.mode=0),t.button===2&&(this.pars.mode=1),this.pars.mode===0){const{clientHeight:r}=n,i=t.offsetX,o=r-t.offsetY;s.setCoords([i,o,i,o])}}function eo(){this.pars.mousedown=!1}function no(t){switch(this.pars.mode){case 0:so(this,t);break;case 1:ro(this,t);break;case 2:io(this,t)}}function so(t,e){if(!t.pars.active||!t.pars.mousedown)return t;const{container:n,selectionRect:s}=t,{clientHeight:r}=n,i=e.offsetX,o=r-e.offsetY,{coords:a}=s;return s.setCoords([a[0],a[1],i,o]),t}function ro(t,e){if(!t.pars.active||!t.pars.mousedown)return t;const{scales:n}=t,{lastX:s,lastY:r}=t.pars,{clientWidth:i,clientHeight:o}=t.container,a=e.offsetX,c=o-e.offsetY,l=(a-s)/i,u=(c-r)/o;return n.x.move(l),n.y.move(u),t.pars.lastX=a,t.pars.lastY=c,t}function io(t,e){var c;const{offsetX:n,offsetY:s}=e,{clientHeight:r}=t.container,i=n,o=r-s;let a;for(const l of t.graphicObjects)if(a=(c=l.query)==null?void 0:c.call(l,[i,o]),a)break;return a?t.queryDisplay.renderQuery([i,o],a):t.queryDisplay.clear(),t}function oo(t){t.preventDefault(),this.selectionRect.clear(),this.pars.mousebutton=2,this.pars.lastX=t.offsetX,this.pars.lastY=this.container.clientHeight-t.offsetY}function ao(){this.deactivate(),this.scene.marker.clearAll()}function co(t){var e,n,s,r;t.code==="KeyQ"&&t.code===this.pars.lastKey||(this.queryDisplay.clear(),(n=(e=this.globalKeyActions)[t.code])==null||n.call(e,t),this.pars.active&&((r=(s=this.localKeyActions)[t.code])==null||r.call(s,t)),this.pars.lastKey=t.code)}function lo(){this.container.style.resize="none",this.pars.mode=0,this.pars.lastKey="",this.queryDisplay.clear()}var dt=(t=>(t[t.Pct=0]="Pct",t[t.Px=1]="Px",t))(dt||{}),$e=(t=>(t[t.Width=0]="Width",t[t.Both=1]="Both",t[t.Height=2]="Height",t))($e||{});function uo(){const[s,r]=[.8,1];return D({...{type:0,dimension:1,amount:.8,defaultGapPct:s,defaultGapPx:r},...{setGapType:ho,setGapDimension:fo,setDefaultGap:po,defaultize:mo,decreaseGap:yo,increaseGap:go,applyGap:bo}})}function ho(t){const{defaultGapPct:e,defaultGapPx:n}=this;return this.amount=t===0?e:n,this.type=t,this.emit(),this}function fo(t){return this.dimension=t,this.emit(),this}function po(t,e){const{type:n}=this;return this.amount=n===0?t:e,this.defaultGapPct=t,this.defaultGapPx=e,this}function mo(){const{type:t,defaultGapPct:e,defaultGapPx:n}=this;return this.amount=t===0?e:n,this.emit(),this}function go(){return this.type===0?this.amount=this.amount*9/10:this.amount=Math.max(this.amount-1,0),this.emit(),this}function yo(){return this.type===0?this.amount=this.amount*10/9:this.amount++,this.emit(),this}function bo(t,e){const{type:n,dimension:s,amount:r}=this,i=n===0?yn:O;return s<=1&&(t=Math.max(i(t,r),1)),s>=1&&(e=Math.max(i(e,r),1)),[t,e]}const B=Symbol("positions"),xo=Symbol("parent"),ft=Symbol("layer");function pt(t,e){const n="Derived",s=L(),o={...{[Symbol.toStringTag]:n,variable:e,domain:s},...{clone:vo,n:wo,derivefn:t,valueAt:Mo,scaledAt:ko,setDomain:Ao}};return lt(o).with(j).with(zt)}function vo(){return this}function wo(){return-1}function Ao(t){return this.domain=t,this}function Mo(t){return this.derivefn(t,this.variable)}function ko(t,e){return e.pushforward(this.valueAt(t))}const V=pt(()=>0),T=pt(()=>1);pt(t=>t);const So=pt(t=>new Set([t])),Pe=$({[B]:So});function W(t){const e="Reference",n=L(),i={...{array:t,domain:n,[Symbol.toStringTag]:e},...{clone:Do}};return lt(i).with(j).with(qt).with(zt)}function Do(){const t=[...this.array];return W(t)}function zo(){const e=[0],n=he,s=$({});return D({cardinality:1,levels:e,data:s,levelAt:n})}function mt(t,e,n,s){return s=s??zo(),D({parent:s,cardinality:t,levels:e,data:n,levelAt:_o})}function _o(t){return this.levels[t]}function Ut(t,e){const n=t.values();e=e??t.domain.values;const s=[],r={};for(let l=0;l<n.length;l++){const u=e.indexOf(n[l].toString());r[u]||(r[u]=new Set),r[u].add(l),s.push(u)}const i=It(e),o={label:ut(e,i),[B]:W(Object.values(r))};o.label.setName(t.name());const a=$(o);return mt(e.length,s,a)}function Qt(t,e){const n=Re(t,e),s=()=>{const r=Re(t,e);n.parent=r.parent,n.cardinality=r.cardinality,n.levels=r.levels;const i=n.data.cols(),o=r.data.cols();for(const[a,c]of E(o))i[a].domain=c.domain,i[a].array=c.array,i[a].source=c.source,i[a].indexfn=c.indexfn;n.emit()};return t.listen(s),e.listen(s),n}function Re(t,e){const n=Math.max(t.cardinality,e.cardinality)+1,s=[],r=new Set,i={},o={},a={};for(let g=0;g<t.levels.length;g++){const w=n*t.levelAt(g)+e.levelAt(g);w in i||(i[w]=t.levelAt(g),o[w]=e.levelAt(g),a[w]=new Set),s.push(w),r.add(w),a[w].add(g)}const c=Array.from(r).sort(O),l=s;for(let g=0;g<l.length;g++)l[g]=c.indexOf(l[g]);const u=Object.values(i),h=Object.values(o),d={};for(const[g,w]of E(t.data.cols()))d[g]=w.proxy(()=>u),d[g].setName(w.name());for(let[g,w]of E(e.data.cols())){if(typeof g=="string")for(;g in d;)g+="$";d[g]=w.proxy(()=>h),d[g].setName(w.name())}d[B]=W(Object.values(a)),d[xo]=W(Object.values(i));const p=mt(t.cardinality,u,$({})),y=r.size,x=$(d);return mt(y,l,x,p)}function $o(t,e){const n={};for(const[a,c]of E(e))n[a]=c.clone().setFactor(t);const s={};for(const[a,c]of E(t.data.cols()))s[a]=c;for(const[a,c]of E(n))c.setFactor(t),s[a]=c.result;const r=$(s),o=D({...r,...{factor:t,reducers:n,recompute:Po}});return o.recompute(),t.listen(o.recompute.bind(o)),o}function Po(){const{reducers:t}=this;for(const e of P(t))e.recompute();this.cachedN=void 0,this.emit()}function gt(t,e){return{reducers:t,factor:e,refine:Ro,data:Co}}function Ro(t){const{factor:e,reducers:n}=this,s=e?Qt(e,t):t,r=gt(n,s);if(r._data=$o(s,n),this._data)for(const[i,o]of U(this._data.reducers))r._data.reducers[i].setParent(o);return r}function Co(){const{_data:t}=this;if(!t)throw new Error("No factor to reduce data by");return t}function yt(t,e){var u;const n=Ko(e.initialfn());let s;(u=t.hasName)!=null&&u.call(t)?s=`${e.name} of ${t.name()}`:s="count";const r=_t(n([]));r.setName(s);const[i,o]=[!1,!1],l=D({...{name:s,reducer:e,source:t,result:r,stacked:i,normalized:o},...{clone:Oo,setParent:No,setFactor:To,recompute:Eo,stack:Lo,normalizeByParent:Ho}});return l.result.setReducer(l),l}function To(t){return this.factor=t,this}function No(t){return this.parent=t,this}function Oo(){const{source:t,reducer:e,factor:n,parent:s}=this,r=yt(t,e);return r.result.array=[...this.result.array],r.stacked=this.stacked,r.normalized=this.normalized,s&&r.setParent(s),n&&r.setFactor(n),this.listen(()=>r.recompute()),r}function Eo(){const{factor:t,source:e,result:n,reducer:s,stacked:r,normalized:i}=this;if(t===void 0)throw new Error("Factor has not been registered");const{cardinality:o}=t,a=n.array;a.length=o;for(let c=0;c<o;c++)a[c]=s.initialfn();for(let c=0;c<t.levels.length;c++){const l=t.levelAt(c);a[l]=s.reducefn(a[l],e.valueAt(c))}return r&&Bo(this),i&&Go(this),n.domain.retrain(a),this.emit(),this}function Lo(){const{factor:t}=this;if(!t||!t.parent)return this;const e=this.clone();return e.stacked=!0,e.recompute(),e}function Ho(){const{parent:t,factor:e}=this;if(!t||!e||!e.parent)return this;const n=this.clone();return n.normalized=!0,n.recompute(),n}function Bo(t){const{factor:e,reducer:n}=t;if(!e||!e.parent)return t;const s=e.parent,r=Array(s.cardinality);for(let o=0;o<s.cardinality;o++)r[o]=n.initialfn();const i=t.result.array;for(let o=0;o<i.length;o++){const a=s.levelAt(o);r[a]=n.reducefn(r[a],i[o]),i[o]=r[a]}}function Go(t){const{parent:e,factor:n}=t;if(!e||!n||!n.parent)return t;const s=n.parent,r=t.result.array,i=e.result.array;for(let o=0;o<s.levels.length;o++){const a=r[o],c=i[s.levelAt(o)];r[o]=a/c}}function Ko(t){const e=typeof t;return e==="number"?q:e==="string"?ut:W}function Pt(t){this.boundaryData=t}function Rt(t){this.renderData=t}function Ct(t,e){this.scales[t]=this.scales[e]}function Zt(t){const{scales:e,contexts:n}=t,[s,r]=[$t.Center,ht.Middle],i=uo(),o={};o.Equal=()=>i.decreaseGap(),o.Minus=()=>i.increaseGap(),o.KeyR=()=>i.defaultize();const l={...{scales:e,contexts:n,keyActions:o,hAnchor:s,vAnchor:r,gapHandler:i},...{setBoundaryData:Pt,setRenderData:Rt,render:Fo,check:Wo,query:jo,setHAnchor:qo,setVAnchor:Io,setGapType:Vo,setGapDimension:Xo,setDefaultGap:Yo,noGap:Uo,mapEncodingToScale:Ct}};return i.listen(l.render.bind(l)),l}function Fo(){if(!this.renderData)return;const{renderData:t,scales:e,contexts:n}=this,{hAnchor:s,vAnchor:r,gapHandler:i}=this,o=t.n();for(const a of et)n[a].clear();for(let a=0;a<o;a++){const c=t.col(ft).valueAt(a),l=t.col("x").scaledAt(a,e.x),u=t.col("y").scaledAt(a,e.y);let h=t.col("width").scaledAt(a,e.width),d=t.col("height").scaledAt(a,e.height);[h,d]=i.applyGap(h,d),n[c].rectangleWH(l,u,h,d,{vAnchor:r,hAnchor:s})}}function Wo(t){if(!this.boundaryData)return new Set;const{boundaryData:e,scales:n,vAnchor:s,hAnchor:r}=this,i=e.n(),o=new Set;for(let a=0;a<i;a++){const c=e.col("x").scaledAt(a,n.x),l=e.col("y").scaledAt(a,n.y);let u=e.col("width").scaledAt(a,n.width),h=e.col("height").scaledAt(a,n.height);const d=[c-u*r,l-s*h,c+u*r,l+(1-s)*h];Ft(t,d)&&at(o,e.col(B).valueAt(a))}return o}function jo(t){if(!this.boundaryData)return;const{boundaryData:e,scales:n,vAnchor:s,hAnchor:r}=this,i=e.n();for(let o=0;o<i;o++){const a=e.col("x").scaledAt(o,n.x),c=e.col("y").scaledAt(o,n.y);let l=e.col("width").scaledAt(o,n.width),u=e.col("height").scaledAt(o,n.height);const h=[a-l*r,c-s*u,a+l*r,c+(1-s)*u];if(Wt(t,h)){const d={};for(const p of P(e.cols()))p&&p.hasName()&&!(p.name()in d)&&(d[p.name()]=p.valueAt(o));return d}}}function qo(t){return this.hAnchor=t,this}function Io(t){return this.vAnchor=t,this}function Vo(t){return this.gapHandler.setGapType(t),this}function Xo(t){return this.gapHandler.setGapDimension(t),this}function Yo(t,e){return this.gapHandler.setDefaultGap(t,e),this}function Uo(){return this.gapHandler.applyGap=(t,e)=>[t,e],this}function Ce(t,e,n){const s=I(t),r=t.data.select(e),i=r.col("v2")??T,o=(n==null?void 0:n.reducer)??Z,a={stat1:yt(i,o)},c=Ut(r.col("v1")),l=gt(a).refine(c),u=l.refine(t.marker.factor),h=l.data(),d=u.data(),[p,y]=[k.Absolute,J.Alphanumeric],x=Zt(s);x.setVAnchor(ht.Bottom).setGapDimension($e.Width);const m={...s,bars:x,type:p,order:y,partition1Data:h,partition2Data:d};return Jt(m),m.pushGraphicObject(m.bars),m.scales.y.freezeMin().link(m.scales.height),m.addKeyAction("KeyR",Qo.bind(m)),m.addKeyAction("KeyO",Jo.bind(m)),m.addKeyAction("KeyN",Zo.bind(m)),d.listen(m.render.bind(m)),m}function Qo(){this.scales.x.setDefaultOrder(),this.order=J.Alphanumeric,Jt(this)}function Zo(){this.type===k.Absolute?ta(this):Jt(this)}function Jo(){if(this.order===J.Alphanumeric){const t=as(this.partition1Data.col("stat1").values());this.scales.x.setOrder(t),this.order=J.Custom}else this.scales.x.setDefaultOrder(),this.order=J.Alphanumeric;this.render()}function Jt(t){const{partition1Data:e,partition2Data:n,bars:s}=t,r=e.select(ea),i=n.select(na);s.setBoundaryData(r),s.setRenderData(i),s.setGapType(dt.Pct),t.type=k.Absolute,t.trainScales(r,a=>({...a,y:a.height,width:a.x.width()}));const o=t.scales.x.getOrder();t.scales.x.setDefaultWeights(),o&&t.scales.x.setOrder(o),t.scales.y.setMin(0),t.render()}function ta(t){const{partition1Data:e,partition2Data:n,bars:s}=t,r=e.select(sa),i=n.select(ra);s.setBoundaryData(r),s.setRenderData(i),s.setGapType(dt.Px),t.type=k.Proportion,t.trainScales(r,c=>({...c,y:c.height,width:c.x.width()}));const o=t.scales.x.getOrder(),a=e.col("stat1").values();t.scales.x.setWeights(a),o&&t.scales.x.setOrder(o),t.scales.width.setMax(a.reduce(le)),t.scales.y.setMin(0),t.render()}const ea=t=>({x:t.label,y:V,width:t.label,height:t.stat1}),na=t=>({x:t.label,y:V,width:t.label,height:t.stat1.stack()}),sa=t=>({x:t.label,y:V,width:t.label,height:T,aux1:t.stat1}),ra=t=>({x:t.label,y:V,width:t.label,height:t.stat1.stack().normalizeByParent()});function Te(t,e){const n=I(t),s=t.data.select(e),r={stat1:yt(T,Z)},i=Ut(s.col("v1")),o=Ut(s.col("v2")),a=Qt(i,o),c=gt(r).refine(a),l=c.refine(t.marker.factor),u=c.data(),h=l.data(),d=k.Absolute,p=Zt(n).setDefaultGap(1,0);p.mapEncodingToScale("width","area"),p.mapEncodingToScale("height","area");const y={...n,squares:p,type:d,partition1Data:u,partition2Data:h};Ne(y),n.pushGraphicObject(p);const x=Math.max(i.cardinality,o.cardinality)+1;n.scales.area.codomain.setScale(1/x).setTransform(ae,ce),y.partition1Data.listen(n.render.bind(n)),y.partition2Data.listen(n.render.bind(n)),y.addKeyAction("KeyR",()=>{y.scales.x.setDefaultOrder(),y.scales.y.setDefaultOrder()}),y.addKeyAction("KeyN",()=>y.type===k.Absolute?ia(y):Ne(y)),y.render()}function Ne(t){const{partition1Data:e,partition2Data:n,squares:s}=t,r=e.select(oa),i=n.select(aa);s.setBoundaryData(r),s.setRenderData(i),s.setGapType(dt.Pct),t.type=k.Absolute,t.trainScales(r,o=>({x:o.x,y:o.y,area:o.width})),t.render()}function ia(t){const{partition1Data:e,partition2Data:n,squares:s}=t,r=e.select(ca),i=n.select(la);s.setBoundaryData(r),s.setRenderData(i),s.setGapType(dt.Px),t.type=k.Proportion,t.trainScales(r,o=>({x:o.x,y:o.y,area:o.width})),t.render()}const oa=t=>({x:t.label,y:t.label$,width:t.stat1,height:t.stat1}),aa=t=>({x:t.label,y:t.label$,width:t.stat1.stack(),height:t.stat1.stack()}),ca=t=>({x:t.label,y:t.label$,width:T,height:T}),la=t=>({x:t.label,y:t.label$,width:t.stat1.stack().normalizeByParent(),height:t.stat1.stack().normalizeByParent()});function bt(t){const s={...{value:t,defaultValue:t},...{defaultize:ua,setValue:ha}};return D(s)}function te(t){return t===void 0?!1:t&&typeof t=="object"&&"listen"in t}function Oe(t){return t&&te(t)?()=>t.value:()=>t}function ua(){this.value=this.defaultValue,this.emit()}function ha(t){this.value=typeof t!="function"?t:t(this.value),this.emit()}function ee(t,e,n){const s=Oe(e),r=Oe(n),i=Ee(t,s(),r()),o=()=>{const a=Ee(t,s(),r());i.parent=a.parent,i.cardinality=a.cardinality,i.levels=a.levels;for(const[c,l]of E(a.data.columns))i.data.columns[c].domain=l.domain,i.data.columns[c].array=l.array,i.data.columns[c].source=l.source,i.data.columns[c].indexfn=l.indexfn;i.emit()};return te(e)&&e.listen(o),te(n)&&n.listen(o),i}function Ee(t,e,n){const s=t.array,{min:r,max:i}=t.domain,o=t.domain.range(),a=e?Math.ceil(o/e)+1:10;e=e??o/(a-1),n=n??r;const c=r-e+(n-r)%e,l=i+e-(i-n)%e,u=Array(a+2);u[0]=c,u[u.length-1]=l;for(let z=1;z<u.length-1;z++)u[z]=c+z*e;const h=new Set,d=[],p={};for(let z=0;z<s.length;z++){const b=u.findIndex(Qe=>Qe>=s[z])-1;p[b]||(p[b]=new Set),p[b].add(z),h.add(b),d.push(b)}const y=Array.from(h).sort(O),x={};for(const[z,b]of Object.entries(y))x[b]=hn(z);const m=d;for(let z=0;z<m.length;z++)m[z]=x[m[z]];const[g,w]=[u[y[0]],u[rt(y)+1]],A=L(g,w);q(u,A).setName(t.name());const nt=At(u,y),Tt=At(u,y.map(oe)),ne=es(nt,Tt,ns),Nt=q(nt,A),se=q(Tt,A),re=q(ne,A);t.hasName()&&(Nt.setName(`lower ${t.name()}`),se.setName(`upper ${t.name()}`),re.setName(t.name()));const Ye={binStart:Nt,binMid:re,binEnd:se,[B]:W(Object.values(p))},Ue=$(Ye);return mt(y.length,m,Ue)}function da(t){const{scales:e,contexts:n}=t;return{...{scales:e,contexts:n},...{setBoundaryData:Pt,setRenderData:Rt,render:fa,check:pa,query:ma,mapEncodingToScale:Ct}}}function fa(t){if(!this.renderData)return;const{renderData:e,scales:n}=this,s=e.n();for(const r of et)t[r].clear();for(let r=0;r<s;r++){const i=e.col(ft).valueAt(r),o=e.col("x0").scaledAt(r,n.x),a=e.col("y0").scaledAt(r,n.y),c=e.col("x1").scaledAt(r,n.x),l=e.col("y1").scaledAt(r,n.y);t[i].rectangleXY(o,a,c,l)}}function pa(t){if(!this.boundaryData)return new Set;const{boundaryData:e,scales:n}=this,s=e.n(),r=new Set;for(let i=0;i<s;i++){const o=e.col("x0").scaledAt(i,n.x),a=e.col("y0").scaledAt(i,n.y),c=e.col("x1").scaledAt(i,n.x),l=e.col("y1").scaledAt(i,n.y);Ft(t,[o,a,c,l])&&at(r,e.col(B).valueAt(i))}return r}function ma(t){if(!this.boundaryData)return;const{boundaryData:e,scales:n}=this,s=e.n();for(let r=0;r<s;r++){const i=e.col("x0").scaledAt(r,n.x),o=e.col("y0").scaledAt(r,n.y),a=e.col("x1").scaledAt(r,n.x),c=e.col("y1").scaledAt(r,n.y);if(Wt(t,[i,o,a,c])){const u={};for(const h of P(e.cols()))h&&h.hasName()&&!(h.name()in u)&&(u[h.name()]=h.valueAt(r));return u}}}function Le(t,e,n){const s=I(t),r=t.data.select(e),i=bt(r.col("v1").min()),o=bt(r.col("v1").range()/15),a=r.col("v2")??T,c=(n==null?void 0:n.reducer)??Z,l={stat1:yt(a,c)},u=ee(r.col("v1"),o,i),h=gt(l).refine(u),d=h.refine(t.marker.factor),p=h.data(),y=d.data(),x=k.Absolute,m=da(s),g={...s,type:x,bars:m,partition1Data:p,partition2Data:y};He(g),g.pushGraphicObject(m),g.scales.y.freezeMin(),g.addKeyAction("KeyN",()=>g.type===k.Absolute?ga(g):He(g)),g.addKeyAction("Minus",()=>o.setValue(A=>A*.9)),g.addKeyAction("Equal",()=>o.setValue(A=>A*1.1111111111111112));const w=r.col("v1").range()/20;g.addKeyAction("Quote",()=>i.setValue(A=>A-w)),g.addKeyAction("Semicolon",()=>i.setValue(A=>A+w)),g.addKeyAction("KeyR",()=>(o.defaultize(),i.defaultize())),p.listen(()=>{g.trainScales(m.boundaryData,A=>({x:A.x0,y:A.y1})),g.scales.x.setName(p.col("binMid").name()),g.scales.y.setMin(0)}),y.listen(g.render.bind(g))}function He(t){const{partition1Data:e,partition2Data:n,bars:s}=t,r=e.select(ya),i=n.select(ba);s.setBoundaryData(r),s.setRenderData(i),t.type=k.Absolute,t.trainScales(r,o=>({x:o.x0,y:o.y1})),t.scales.x.setName(e.col("binMid").name()),t.scales.y.setMin(0).setName("count"),t.render()}function ga(t){const{partition1Data:e,partition2Data:n,bars:s}=t,r=e.select(xa),i=n.select(va);r.col("x0").setName(void 0),r.col("x1").setName(void 0),s.setBoundaryData(r),s.setRenderData(i),t.type=k.Proportion,t.trainScales(r,o=>({x:o.x0,y:o.y1})),t.scales.x.setName("cumulative count"),t.scales.y.setMin(0).setName("proportion"),t.render()}const ya=t=>({x0:t.binStart,y0:V,x1:t.binEnd,y1:t.stat1}),ba=t=>({x0:t.binStart,y0:V,x1:t.binEnd,y1:t.stat1.stack()}),xa=t=>({aux1:t.binStart,aux2:t.binEnd,aux3:t.stat1,x0:t.stat1.stack().shiftLeft(),x1:t.stat1.stack(),y0:V,y1:T}),va=t=>({x0:t.stat1.parent().stack().shiftLeft(),x1:t.stat1.parent().stack(),y0:V,y1:t.stat1.stack().normalizeByParent()});function Be(t,e){const n=I(t),s=t.data.select(e),r=bt(s.col("v1").range()/30),i=bt(s.col("v2").range()/30),o={stat1:yt(T,Z)},a=ee(s.col("v1"),r,s.col("v1").min()),c=ee(s.col("v2"),i,s.col("v2").min()),l=Qt(a,c),u=gt(o).refine(l),h=u.refine(t.marker.factor),d=u.data(),p=h.data(),y=k.Absolute,x=Zt(n).noGap();x.mapEncodingToScale("width","area"),x.mapEncodingToScale("height","area");const m={...n,type:y,squares:x,partition1Data:d,partition2Data:p};Ge(m),m.pushGraphicObject(x);const g=Math.max(a.cardinality,c.cardinality)+1;m.scales.area.codomain.setScale(1/g).setTransform(ae,ce),m.addKeyAction("KeyN",()=>m.type===k.Absolute?wa(m):Ge(m)),m.addKeyAction("Minus",()=>{r.setValue(r.value*.9),i.setValue(i.value*.9)}),m.addKeyAction("Equal",()=>{r.setValue(r.value*1.1111111111111112),i.setValue(i.value*1.1111111111111112)}),m.addKeyAction("KeyR",()=>{r.defaultize(),i.defaultize()}),d.listen(()=>{m.trainScales(x.boundaryData,X);const w=Math.max(a.cardinality,c.cardinality);m.trainScales(x.boundaryData,X),m.scales.area.codomain.setScale(1/w),m.render()}),p.listen(m.render.bind(m)),m.render()}function Ge(t){const{partition1Data:e,partition2Data:n,squares:s}=t,r=e.select(Aa),i=n.select(Ma);s.setBoundaryData(r),s.setRenderData(i),t.type=k.Absolute,t.trainScales(r,X),t.render()}function wa(t){const{partition1Data:e,partition2Data:n,squares:s}=t,r=e.select(ka),i=n.select(Sa);s.setBoundaryData(r),s.setRenderData(i),t.type=k.Proportion,t.trainScales(r,X),t.render()}const Aa=t=>({x:t.binMid,y:t.binMid$,width:t.stat1,height:t.stat1,area:t.stat1}),Ma=t=>({x:t.binMid,y:t.binMid$,width:t.stat1.stack(),height:t.stat1.stack()}),ka=t=>({x:t.binMid,y:t.binMid$,width:T,height:T,area:T}),Sa=t=>({x:t.binMid,y:t.binMid$,width:t.stat1.stack().normalizeByParent(),height:t.stat1.stack().normalizeByParent()});function Ke(t){const e=I(t);for(const s of P(e.contexts))s.canvas.remove();const n=S("textarea").appendTo(e.container).get();return n.value=`
Write notes here....`,e.localKeyActions.KeyP=cn,{...e,textarea:n}}function Da(t,e,n){const{scales:s,contexts:r}=t;return{...{boundaryData:e,renderData:n,scales:s,contexts:r},...{render:za,check:_a,query:$a,setBoundaryData:Pt,setRenderData:Rt,mapEncodingToScale:Ct}}}function za(){const{renderData:t,scales:e,contexts:n}=this,s=t.n(),r=e.x.domain.order;if(r){for(const i of et)n[i].clear();for(let i=0;i<s;i++){const o=t.col(ft).valueAt(i);let a=t.col("x").scaledAt(i,e.x),c=t.col("y").scaledAt(i,e.y);a=F(a,r),c=F(c,r),n[o].line(a,c)}}}function _a(t){const{boundaryData:e,scales:n}=this,s=e.n(),r=new Set,i=n.x.domain.order;if(!i)return r;for(let o=0;o<s;o++){let a=e.col("x").scaledAt(o,n.x),c=e.col("y").scaledAt(o,n.y);a=F(a,i),c=F(c,i);for(let l=1;l<a.length;l++)Ae(t,[a[l-1],c[l-1],a[l],c[l]])&&at(r,e.col(B).valueAt(o))}return r}function $a(t){const{boundaryData:e,scales:n}=this,s=e.n(),r=xn(t,ln,oe),i=n.x.domain.order;if(!i)return{};for(let o=0;o<s;o++){let a=e.col("x").scaledAt(o,n.x),c=e.col("y").scaledAt(o,n.y);a=F(a,i),c=F(c,i);for(let l=1;l<a.length;l++)if(Ae(r,[a[l-1],c[l-1],a[l],c[l]])){const u={};for(const h of P(e.cols()))h&&h.hasName()&&!(h.name()in u)&&(u[h.name()]=h.valueAt(o));return u}}}function Fe(t){const e="ExpanseDiscreteAbsolute",n=it(0,t.length-1);return D({...{[Symbol.toStringTag]:e,order:n,values:t},...{clone:Ea,normalize:Pa,unnormalize:Ra,setValues:Ca,setOrder:Ta,setDefaultOrder:Na,retrain:Oa,breaks:La,widget:Ha}})}function Pa(t){const{order:e,values:n}=this;return e[n.indexOf(t)]/(n.length-1)}function Ra(t){throw new Error("Not implemented yet")}function Ca(t){for(let e=0;e<t.length;e++)this.values[e]=t[e];return this.emit(),this}function Ta(t){for(let e=0;e<t.length;e++)this.order[e]=t[e];return this.emit(),this}function Na(){for(let t=0;t<this.order.length;t++)this.order[t]=t;return this.emit(),this}function Oa(t){const e=Array.from(new Set(t)).sort(Et);return this.values=e,this.emit(),this}function Ea(){const t=Fe(this.values);return t.order=this.order,t.normalize=this.normalize,t}function La(){return this.values}function Ha(){const{values:t}=this,e={values:[...t]},n=ke(e);return n.listen(()=>{const s=Array(t.length);for(let r=0;r<t.length;r++)s[r]=e.values.indexOf(t[r]);this.setOrder(s)}),n}function Ba(t){return _e(t.domain)}function We(t){const e="Tuple",s=it(0,t.length-1),r=L(),a={...{tag:e,variables:t,order:s,domain:r,commonDomain:!1},...{clone:Ga,n:Ka,valueAt:Fa,scaledAt:Wa,setOrder:ja,setCommonDomain:qa,unsetCommonDomain:Ia}};return j(a)}function Ga(){return{...this}}function Ka(){for(const t of this.variables)if(t.n)return t.n();throw new Error("No fixed length variables present")}function Fa(t,e=0){const{variables:n,order:s}=this,r=Array(n.length);for(let i=0;i<n.length;i++){const o=n[i];r[s[i]]=o.valueAt(t,e)}return r}function Wa(t,e){const{variables:n,order:s,domain:r,commonDomain:i}=this,o=Array(n.length),a=e.domain;i&&(e.domain=r);for(let c=0;c<n.length;c++){const l=n[c];i||(e.domain=l.domain),o[s[c]]=l.scaledAt(t,e)}return e.domain=a,o}function ja(t){for(let e=0;e<t.length;e++)this.order[e]=t[e];return this}function qa(){let[t,e]=[1/0,-1/0];for(const n of this.variables){if(!Ba(n)){const s="All variables must be continuous to set a common domain.";throw new Error(s)}t=Math.min(t,n.domain.min),e=Math.max(e,n.domain.max)}return this.domain.setMin(t).setMax(e),this.commonDomain=!0,this}function Ia(){return this.domain.setMin(0).setMax(1),this.commonDomain=!1,this}function je(t,e){const n=t.data.select(e),s=I(t),r=n.select(Va).join(t.marker.data()),i=r,o=r.select(qe).join(Pe),a=i.select(qe).join(t.marker.data()),c=k.Proportion,l=Da(s,o,a);s.pushGraphicObject(l),s.trainScales(o,h=>({x:h.x,y:h.y}));const u={...s,type:c,lines:l,partition1Data:r,partition2Data:i};return u.addKeyAction("KeyN",Xa.bind(u)),u.addKeyAction("KeyR",()=>u.scales.x.setDefaultOrder()),o.listen(s.render.bind(s)),u}const Va=t=>{const e=We(P(t)),n=We(P(t).map(r=>{const i=pt((o,a)=>a.name(),r);return i.setName(r.name()),i})),s=Fe(n.valueAt(0));for(const r of n.variables)r.setDomain(s);return n.domain=s,n.n=()=>e.n(),n.setName("variable"),e.setName("scaled value"),{names:n,values:e}},qe=t=>({x:t.names,y:t.values});function Xa(){this.type===k.Proportion?(this.partition1Data.col("values").setCommonDomain(),this.scales.y.setDomain(this.partition1Data.col("values").domain),this.scales.y.setName("value"),this.type=k.Absolute,this.render()):(this.partition1Data.col("values").unsetCommonDomain(),this.scales.y.setDomain(L()),this.scales.y.setName("scaled value"),this.type=k.Proportion,this.render())}function Ya(t,e,n){const{scales:s,contexts:r}=t,i=bt(1),o={};o.Equal=()=>i.setValue(u=>u*10/9),o.Minus=()=>i.setValue(u=>u*9/10),o.KeyR=()=>i.defaultize();const l={...{boundaryData:e,renderData:n,scales:s,contexts:r,keyActions:o,sizePct:i},...{render:Ua,check:Qa,query:Za,setBoundaryData:Pt,setRenderData:Rt,mapEncodingToScale:Ct}};return i.listen(l.render.bind(l)),l}function Ua(){var i;const{renderData:t,scales:e,contexts:n,sizePct:s}=this,r=t.n();for(const o of et)n[o].clear();for(let o=0;o<r;o++){const a=t.col(ft).valueAt(o),c=t.col("x").scaledAt(o,e.x),l=t.col("y").scaledAt(o,e.y);let u=(i=t.col("size"))==null?void 0:i.scaledAt(o,e.size);u=u?Math.sqrt(u):K.defaultRadius,u=u*s.value,n[a].point(c,l,{radius:u})}}function Qa(t){var i;const{boundaryData:e,scales:n}=this,s=e.n(),r=new Set;for(let o=0;o<s;o++){const a=e.col("x").scaledAt(o,n.x),c=e.col("y").scaledAt(o,n.y);let l=(i=e.col("size"))==null?void 0:i.scaledAt(o,n.size);l=l?Math.sqrt(l):K.defaultRadius;const u=l/Math.sqrt(2);Ft(t,[a-u,c-u,a+u,c+u])&&at(r,e.col(B).valueAt(o))}return r}function Za(t){var r;const{boundaryData:e,scales:n}=this,s=e.n();for(let i=0;i<s;i++){const o=e.col("x").scaledAt(i,n.x),a=e.col("y").scaledAt(i,n.y);let c=(r=e.col("size"))==null?void 0:r.scaledAt(i,n.size);c=c?Math.sqrt(c):K.defaultRadius;const l=c/Math.sqrt(2);if(Wt(t,[o-l,a-l,o+l,a+l])){const u={};for(const h of P(e.cols()))h&&h.hasName()&&!(h.name()in u)&&(u[h.name()]=h.valueAt(i));return u}}}function Ie(t,e){const n=I(t),s=t.data.select(e),r=s.select(Ve).join(Pe),i=s.select(Ve).join(t.marker.data()),o=Ya(n,r,i);return n.pushGraphicObject(o),n.trainScales(r,a=>({x:a.x,y:a.y})),r.listen(n.render.bind(n)),i.listen(n.render.bind(n)),{...n,data:s,points:o,renderData:i,boundaryData:r}}const Ve=t=>({x:t.v1,y:t.v2,size:t.v3}),Ja=`<div>
    <br>
    <h1>Available Interactions</h1>
    <hr>
    <ul>
        <li> <b>Click/click and drag</b> to select objects transiently </li>
        <li>Hold <b>1/2/3</b> while dragging for permanent selection</li>
        <li><b>Right click and drag</b> to pan</li>
        <li>Hold <b>Q</b> and mouse-over objects to query them</li>
        <br>
        <li>Press <b>Z</b> to zoom into current selection</li>
        <li>Press <b>X</b> to pop one level of zoom</li>
        <li>Press <b>O</b> to order by statistic (barplot)</li> 
        <li>Press <b>N</b> to normalize representation</li>
        <li>Press <b>P</b> to bring up parameter menu</li>
        <li>Press and hold <b>S</b> for plot resize mode
           <br>(you can then click and drag bottom right to resize plot)</li>
        <br>
        <li><b>Double-click</b> to reset any selection</li>
        <li>Press <b>R</b> to reset any graphical changes</li>
        <br>
        <li>Press <b>+/-</b> to change object size/width</li>
        <li>Press <b>[/]</b> to change opacity (unselected only)</li>
        <li>Press <b>;/'</b> to change histogram anchor</li>
    </ul>
</div>
`,tc={scatter:Ie,bar:Ce,histo:Le,fluct:Te,histo2d:Be,pcoords:je,note:Ke};function ec(t){return t&-5}function nc(t){return t|4}const sc=[0,1,2,3];function rc(t){const e=H.Transient,n=Array(t).fill(H.Group1),s=Array.from(Array(8),()=>new Set);s[7]=new Set(it(0,t-1));const r=W(it(0,7)),i=W(s),o=$({[ft]:r,[B]:i}),a=mt(8,n,o);return D({...{n:t,group:e,indices:n,positions:s,transientPositions:new Set,factor:a},...{setGroup:ic,update:oc,clearAll:ac,clearTransient:cc,data:lc}})}function ic(t){return this.group=t,this}function oc(t){const{group:e,indices:n,positions:s,transientPositions:r}=this;if(this.clearTransient(),!t.size)return this;for(const i of s)for(const o of t)i.delete(o);if(e===H.Transient)for(const i of t){const o=ec(n[i]);n[i]=o,s[o].add(i),r.add(i)}else for(const i of t){const o=e;n[i]=o,s[o].add(i)}return this.factor.emit(),this.emit(),this}function ac(){const{indices:t,positions:e}=this;for(const n of e)n.clear();for(let n=0;n<this.n;n++)e[H.Group1].add(n);return t.fill(H.Group1),this.factor.emit(),this}function cc(){const{indices:t,positions:e,transientPositions:n}=this;for(const s of sc)e[s].clear();for(const s of n){const r=nc(t[s]);t[s]=r,e[r].add(s)}return n.clear(),this.factor.emit(),this}function lc(){const{n:t,factor:e,indices:n}=this,s=e.data.proxy(n),r=Array.from(Array(t),(i,o)=>new Set([o]));return s.columns[B]=W(r),this.factor.listen(()=>s.emit()),s}const uc=new DOMParser().parseFromString(Ja.replace(/(\r\n|\n|\r)/gm,""),"text/html").body;function hc(t,e){const n=S("div").addClass("ps-scene-container").appendTo(t).get(),s=[],r=Q(),i=document.documentElement;i.style.setProperty("--bmargin",`${r[0]}px`),i.style.setProperty("--lmargin",`${r[1]}px`),i.style.setProperty("--tmargin",`${r[2]}px`),i.style.setProperty("--rmargin",`${r[3]}px`);const o=rc(e.n()),a={},h={...{container:n,data:e,marker:o,hasLayout:!1,plots:s,keyActions:a},...{addPlot:pc,addPlotByKey:mc,setGroup:bc,setLayout:fc,setDimensions:dc,deactivateAll:gc,deactivateAllExcept:yc}};a.Digit1=()=>h.setGroup(H.Group2),a.Digit2=()=>h.setGroup(H.Group3),a.Digit3=()=>h.setGroup(H.Group4),n.addEventListener("mousedown",xc.bind(h)),window.addEventListener("keydown",vc.bind(h)),window.addEventListener("keyup",wc.bind(h));const d=S("dialog").appendTo(n).append(uc).addClass("ps-help-modal").get(),p=S("button").appendTo(n).addClass("ps-help-button").text("?").get();return p.onclick=()=>d.showModal(),d.onclick=()=>d.close(),h}function dc(t,e){document.documentElement.style.setProperty("--ncols",e.toString()),document.documentElement.style.setProperty("--nrows",t.toString());for(const n of this.plots)n.resize();return this}function fc(t){const{container:e,plots:n}=this;let s="";for(const r of t){const i=`"${r.map(o=>`p${o}`).join(" ")}"`;s+=i}for(let r=0;r<n.length;r++)n[r].container.style.gridArea=`p${r+1}`;e.style.gridTemplateRows=wt("1fr",t.length).join(" "),e.style.gridTemplateColumns=wt("1fr",t[0].length).join(" "),e.style.gridTemplateAreas=s;for(const r of this.plots)r.resize();return this.hasLayout=!0,this}function pc(t){this.container.append(t.container),this.plots.push(t),this.hasLayout&&(t.container.style.gridArea=`p${this.plots.length}`);const e=Math.ceil(Math.sqrt(this.plots.length)),n=Math.ceil(this.plots.length/e);return this.setDimensions(n,e),this}function mc(t,e){const n=tc[t];return n(this,e),this}function gc(){for(const t of this.plots)t.deactivate();return this}function yc(t){for(const e of this.plots)e!==t&&e.deactivate();return this}function bc(t){return this.marker.setGroup(t),this}function xc(t){t.target===this.container&&this.deactivateAll()}function vc(t){var e,n;return(n=(e=this.keyActions)[t.code])==null||n.call(e,t),this}function wc(){this.setGroup(H.Transient)}return M.baseLayers=Xt,M.col=Ar,M.countReducer=Tr,M.fetchJSON=gn,M.layers=et,M.maxReducer=Nr,M.newBarplot=Ce,M.newDataframe=$,M.newFluctplot=Te,M.newHistogram=Le,M.newHistogram2D=Be,M.newNoteplot=Ke,M.newPCoordsplot=je,M.newPlot=I,M.newScatter=Ie,M.newScene=hc,M.parseColumns=Mr,M.pasteReducer=Or,M.sumReducer=Z,Object.defineProperty(M,Symbol.toStringTag,{value:"Module"}),M}({});
