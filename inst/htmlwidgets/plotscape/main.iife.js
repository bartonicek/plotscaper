var plotscape=function(b){"use strict";var Be=document.createElement("style");Be.textContent=`html,body{width:100%;height:100%}#app{width:100%;height:100%;padding:2%;box-sizing:border-box}.ps-scene-container{-webkit-user-select:none;user-select:none;display:grid!important;position:relative;overflow:hidden;background-color:#deded9;width:100%;height:100%;grid-template-columns:repeat(var(--ncols),1fr);grid-template-rows:repeat(var(--nrows),1fr);box-sizing:border-box;padding:min(5vmin,50px);grid-gap:20px}.ps-plot-container{z-index:0;position:relative;border:1px solid black;border:2px solid transparent}.ps-plot-container textarea{resize:none;width:100%;height:100%;padding:20px;box-sizing:border-box;background-color:#f5f5f5;color:#3d3d3d;border:none;outline:none}.ps-plot-container.active{border:2px solid #7a7a7a}.ps-plot-context{position:absolute;top:0;right:0;width:100%;height:100%}.ps-plot-context.inner{background-color:#fefffe;top:var(--tmargin);right:var(--rmargin);width:calc(100% - var(--lmargin) - var(--rmargin));height:calc(100% - var(--bmargin) - var(--tmargin));border-bottom:1px solid black;border-left:1px solid black}.ps-help-modal{font-size:min(2.5vmin,14pt);color:#3d3d3d;background-color:#fefffe;border:1px solid #3d3d3d;outline:none;overflow:hidden;padding:2vmin 5vmin}.ps-help-modal h1,h2,h3,hr{margin:0;font-weight:lighter}.ps-help-modal ul{list-style:none;font-family:sans-serif;padding:0}.ps-help-button{position:absolute;top:0;right:0;width:30px;height:30px;font-weight:700;float:right;border:none;font-weight:100;font-size:medium}.ps-query-display{position:absolute;z-index:30;display:none;overflow:auto;white-space:nowrap;width:fit-content;max-width:50%;background-color:#fff;border:1px solid #7a7a7a;padding:1vw;pointer-events:none}.ps-query-display>*{padding-left:3px;padding-right:3px}.ps-widget-modal{margin:0;left:10vmin;top:10vmin;position:absolute;font-size:min(2.5vmin,14pt);color:#3d3d3d;background-color:#fefffe;border:1px solid #3d3d3d;outline:none;padding:0}.ps-widget-display{cursor:move;position:relative;min-width:40vmin;padding-top:2vmin;padding-bottom:2vmin}.ps-widget span{font-family:sans-serif;font-weight:700}.ps-widget button{border:none}.ps-widget-display button{position:absolute;top:10px;right:10px}.ps-widget{background-color:#f5f5f5;margin:2vmin 5vmin;padding:2vmin 3vmin}.ps-widget button{background-color:#deded9;position:relative;top:auto;right:auto;margin-left:1vmin}.ps-widget input{text-align:right}.ps-widget-draglist ul{background-color:#f5f5f5;list-style:none;padding-left:0}.ps-widget-draglist li{cursor:grab;background-color:#fefffe;padding:5px}.ps-widget-draglist li:hover{opacity:.75}.ps-widget-draglist li:nth-child(odd){background-color:#deded9}.ps-widget-draglist li.dragged{opacity:.3;cursor:move}.ps-widget-range input{text-overflow:ellipsis;margin-left:10px}
`,document.head.appendChild(Be);function k(t){return{node:document.createElement(t),get:Bn,append:Fn,appendTo:In,text:Wn,html:Qn,addClass:jn,setAttribute:Kn,setStyles:qn}}var Bn=function(){return this.node},Fn=function(t){return this.node.appendChild(t),this},In=function(t){return t.appendChild(this.node),this},Wn=function(t){return this.node.innerText=t,this},Qn=function(t){return this.node.innerHTML=t,this},jn=function(t){return this.node.classList.add(t),this},Kn=function(t,e){return this.node[t]=e,this},qn=function(t){for(const[e,n]of Object.entries(t))this.node.style[e]=n;return this};function Jt(t){throw new Error(t)}function te(t){return t}function Nt(t,e){return function(n){return e(t(n))}}function Zn(t,e){return function(...n){t(n),e(n)}}function Yn(){}function J(){return this}function Fe(t){return[1,0][t]}function Ie(t){return t+1}function Xn(t){return t-1}function vt(t){return function(e){return t*e}}function xt(t){return t**2}function wt(t){return Math.sqrt(t)}function Vn(t){return parseInt(t,10)}function We(t){return t.charAt(0).toUpperCase()+t.slice(1)}function Un(t){return t.toLocaleLowerCase()}function Jn(t){return t.toLocaleUpperCase()}function tr(t){return t.replace(/\s/g,"")}async function er(t){return await(await fetch(t)).json()}function T(t,e){return t-e}function Qe(t,e){return t+e}function nr(t,e){return t*e}function ee(t,e){return t.localeCompare(e,"en",{numeric:!0})}function rr(t,e,n){return Math.min(Math.max(t,e),n)}function ne(t){return rr(t,0,1)}function re(t,e=0){return Math.round(t*10**e)/10**e}function At(t){return t[t.length-1]}function ct(t,e,n){const r=Math.abs(e-t);n=n??Math.ceil(r)+1;const s=r/(n-1),i=e>=t?1:-1;return Array.from(Array(n),(o,a)=>t+i*s*a)}function Tt(t){let[e,n]=[1/0,-1/0];for(let r=0;r<t.length;r++)e=Math.min(e,t[r]),n=Math.max(n,t[r]);return[e,n]}function Et(t,e){return Array(e).fill(t)}function se(t,e,n=0,r=e.length){const s=Array(r-n);for(let i=0;i<r-n;i++)s[i]=t[e[n+i]];return s}function sr(t,...e){const n=Array(t.length*e.length);for(let r=0;r<e.length;r++){const s=e[r];for(let i=0;i<t.length;i++)n[t.length*r+i]=s(t[i])}return n}function je(t,e){return Math.floor(t+Math.random()*e)}function Ke(t,e,n=e-t){const r=e-t,s=[],i=new Set;for(;s.length<Math.min(n,r);){let o=je(t,e);for(;i.has(o);)o=je(t,e);s.push(o),i.add(o)}return s}function qe(t){const e=Array(t.length);e[0]=t[0];for(let n=1;n<t.length;n++)e[n]=t[n]+e[n-1];return e}function ie(t){return Object.keys(t)}function ut(t){return Object.values(t)}function tt(t){return Object.entries(t)}function Ze(t){return Reflect.ownKeys(t)}function ir(t){const e=[];for(const n of Ze(t))e.push(t[n]);return e}function L(t){const e=[];for(const n of Ze(t))e.push([n,t[n]]);return e}function or(t){for(const[e,n]of tt(t))n===void 0&&delete t[e];return t}function Gt(t,e){let n=0;return(...r)=>{const s=new Date().getTime();s-n<e||(n=s,t(...r))}}function Mt(t,e){for(const n of e)t.add(n);return t}function St(t,e){return 1/(e-t)}function Lt(t,e){const n=St(t,e);return[-t*n,n-t*n]}var ar=function(t){return function(e){return t[e]}};function cr(t){return t.split("").map(ar(lr)).join("")}function ur(t){let[e,n]=t.split("e");return n=cr(n),e+"×10"+n}function Ht(t){for(;t.lastChild;)t.removeChild(t.lastChild);return t}var oe=t=>()=>t,Ye=oe(0),lr={"-":"⁻","+":"",0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹"};function O(t){return{...t,_name:void 0,name:dr,hasName:hr,setName:fr}}function dr(t="[name missing]"){return this._name??t}function hr(){return this._name!=null}function fr(t){return this._name=t,this}function et(t){return{...t,_isQueryable:!1,isQueryable:mr,setQueryable:pr}}function mr(){return this._isQueryable}function pr(t){return this._isQueryable=t,this}function Bt(t){"@babel/helpers - typeof";return Bt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Bt(t)}var gr=/^\s+/,yr=/\s+$/;function g(t,e){if(t=t||"",e=e||{},t instanceof g)return t;if(!(this instanceof g))return new g(t,e);var n=br(t);this._originalInput=t,this._r=n.r,this._g=n.g,this._b=n.b,this._a=n.a,this._roundA=Math.round(100*this._a)/100,this._format=e.format||n.format,this._gradientType=e.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=n.ok}g.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(e.r*299+e.g*587+e.b*114)/1e3},getLuminance:function(){var e=this.toRgb(),n,r,s,i,o,a;return n=e.r/255,r=e.g/255,s=e.b/255,n<=.03928?i=n/12.92:i=Math.pow((n+.055)/1.055,2.4),r<=.03928?o=r/12.92:o=Math.pow((r+.055)/1.055,2.4),s<=.03928?a=s/12.92:a=Math.pow((s+.055)/1.055,2.4),.2126*i+.7152*o+.0722*a},setAlpha:function(e){return this._a=en(e),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var e=Ve(this._r,this._g,this._b);return{h:e.h*360,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=Ve(this._r,this._g,this._b),n=Math.round(e.h*360),r=Math.round(e.s*100),s=Math.round(e.v*100);return this._a==1?"hsv("+n+", "+r+"%, "+s+"%)":"hsva("+n+", "+r+"%, "+s+"%, "+this._roundA+")"},toHsl:function(){var e=Xe(this._r,this._g,this._b);return{h:e.h*360,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=Xe(this._r,this._g,this._b),n=Math.round(e.h*360),r=Math.round(e.s*100),s=Math.round(e.l*100);return this._a==1?"hsl("+n+", "+r+"%, "+s+"%)":"hsla("+n+", "+r+"%, "+s+"%, "+this._roundA+")"},toHex:function(e){return Ue(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(e){return Ar(this._r,this._g,this._b,this._a,e)},toHex8String:function(e){return"#"+this.toHex8(e)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(S(this._r,255)*100)+"%",g:Math.round(S(this._g,255)*100)+"%",b:Math.round(S(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+Math.round(S(this._r,255)*100)+"%, "+Math.round(S(this._g,255)*100)+"%, "+Math.round(S(this._b,255)*100)+"%)":"rgba("+Math.round(S(this._r,255)*100)+"%, "+Math.round(S(this._g,255)*100)+"%, "+Math.round(S(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":this._a<1?!1:Nr[Ue(this._r,this._g,this._b,!0)]||!1},toFilter:function(e){var n="#"+Je(this._r,this._g,this._b,this._a),r=n,s=this._gradientType?"GradientType = 1, ":"";if(e){var i=g(e);r="#"+Je(i._r,i._g,i._b,i._a)}return"progid:DXImageTransform.Microsoft.gradient("+s+"startColorstr="+n+",endColorstr="+r+")"},toString:function(e){var n=!!e;e=e||this._format;var r=!1,s=this._a<1&&this._a>=0,i=!n&&s&&(e==="hex"||e==="hex6"||e==="hex3"||e==="hex4"||e==="hex8"||e==="name");return i?e==="name"&&this._a===0?this.toName():this.toRgbString():(e==="rgb"&&(r=this.toRgbString()),e==="prgb"&&(r=this.toPercentageRgbString()),(e==="hex"||e==="hex6")&&(r=this.toHexString()),e==="hex3"&&(r=this.toHexString(!0)),e==="hex4"&&(r=this.toHex8String(!0)),e==="hex8"&&(r=this.toHex8String()),e==="name"&&(r=this.toName()),e==="hsl"&&(r=this.toHslString()),e==="hsv"&&(r=this.toHsvString()),r||this.toHexString())},clone:function(){return g(this.toString())},_applyModification:function(e,n){var r=e.apply(null,[this].concat([].slice.call(n)));return this._r=r._r,this._g=r._g,this._b=r._b,this.setAlpha(r._a),this},lighten:function(){return this._applyModification(zr,arguments)},brighten:function(){return this._applyModification($r,arguments)},darken:function(){return this._applyModification(Dr,arguments)},desaturate:function(){return this._applyModification(Mr,arguments)},saturate:function(){return this._applyModification(Sr,arguments)},greyscale:function(){return this._applyModification(kr,arguments)},spin:function(){return this._applyModification(_r,arguments)},_applyCombination:function(e,n){return e.apply(null,[this].concat([].slice.call(n)))},analogous:function(){return this._applyCombination(Rr,arguments)},complement:function(){return this._applyCombination(Pr,arguments)},monochromatic:function(){return this._applyCombination(Cr,arguments)},splitcomplement:function(){return this._applyCombination(Or,arguments)},triad:function(){return this._applyCombination(tn,[3])},tetrad:function(){return this._applyCombination(tn,[4])}},g.fromRatio=function(t,e){if(Bt(t)=="object"){var n={};for(var r in t)t.hasOwnProperty(r)&&(r==="a"?n[r]=t[r]:n[r]=kt(t[r]));t=n}return g(t,e)};function br(t){var e={r:0,g:0,b:0},n=1,r=null,s=null,i=null,o=!1,a=!1;return typeof t=="string"&&(t=Lr(t)),Bt(t)=="object"&&(W(t.r)&&W(t.g)&&W(t.b)?(e=vr(t.r,t.g,t.b),o=!0,a=String(t.r).substr(-1)==="%"?"prgb":"rgb"):W(t.h)&&W(t.s)&&W(t.v)?(r=kt(t.s),s=kt(t.v),e=wr(t.h,r,s),o=!0,a="hsv"):W(t.h)&&W(t.s)&&W(t.l)&&(r=kt(t.s),i=kt(t.l),e=xr(t.h,r,i),o=!0,a="hsl"),t.hasOwnProperty("a")&&(n=t.a)),n=en(n),{ok:o,format:t.format||a,r:Math.min(255,Math.max(e.r,0)),g:Math.min(255,Math.max(e.g,0)),b:Math.min(255,Math.max(e.b,0)),a:n}}function vr(t,e,n){return{r:S(t,255)*255,g:S(e,255)*255,b:S(n,255)*255}}function Xe(t,e,n){t=S(t,255),e=S(e,255),n=S(n,255);var r=Math.max(t,e,n),s=Math.min(t,e,n),i,o,a=(r+s)/2;if(r==s)i=o=0;else{var c=r-s;switch(o=a>.5?c/(2-r-s):c/(r+s),r){case t:i=(e-n)/c+(e<n?6:0);break;case e:i=(n-t)/c+2;break;case n:i=(t-e)/c+4;break}i/=6}return{h:i,s:o,l:a}}function xr(t,e,n){var r,s,i;t=S(t,360),e=S(e,100),n=S(n,100);function o(u,l,d){return d<0&&(d+=1),d>1&&(d-=1),d<.16666666666666666?u+(l-u)*6*d:d<.5?l:d<.6666666666666666?u+(l-u)*(.6666666666666666-d)*6:u}if(e===0)r=s=i=n;else{var a=n<.5?n*(1+e):n+e-n*e,c=2*n-a;r=o(c,a,t+.3333333333333333),s=o(c,a,t),i=o(c,a,t-.3333333333333333)}return{r:r*255,g:s*255,b:i*255}}function Ve(t,e,n){t=S(t,255),e=S(e,255),n=S(n,255);var r=Math.max(t,e,n),s=Math.min(t,e,n),i,o,a=r,c=r-s;if(o=r===0?0:c/r,r==s)i=0;else{switch(r){case t:i=(e-n)/c+(e<n?6:0);break;case e:i=(n-t)/c+2;break;case n:i=(t-e)/c+4;break}i/=6}return{h:i,s:o,v:a}}function wr(t,e,n){t=S(t,360)*6,e=S(e,100),n=S(n,100);var r=Math.floor(t),s=t-r,i=n*(1-e),o=n*(1-s*e),a=n*(1-(1-s)*e),c=r%6,u=[n,o,i,i,a,n][c],l=[a,n,n,o,i,i][c],d=[i,i,a,n,n,o][c];return{r:u*255,g:l*255,b:d*255}}function Ue(t,e,n,r){var s=[H(Math.round(t).toString(16)),H(Math.round(e).toString(16)),H(Math.round(n).toString(16))];return r&&s[0].charAt(0)==s[0].charAt(1)&&s[1].charAt(0)==s[1].charAt(1)&&s[2].charAt(0)==s[2].charAt(1)?s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0):s.join("")}function Ar(t,e,n,r,s){var i=[H(Math.round(t).toString(16)),H(Math.round(e).toString(16)),H(Math.round(n).toString(16)),H(nn(r))];return s&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)&&i[3].charAt(0)==i[3].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0)+i[3].charAt(0):i.join("")}function Je(t,e,n,r){var s=[H(nn(r)),H(Math.round(t).toString(16)),H(Math.round(e).toString(16)),H(Math.round(n).toString(16))];return s.join("")}g.equals=function(t,e){return!t||!e?!1:g(t).toRgbString()==g(e).toRgbString()},g.random=function(){return g.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})};function Mr(t,e){e=e===0?0:e||10;var n=g(t).toHsl();return n.s-=e/100,n.s=Ft(n.s),g(n)}function Sr(t,e){e=e===0?0:e||10;var n=g(t).toHsl();return n.s+=e/100,n.s=Ft(n.s),g(n)}function kr(t){return g(t).desaturate(100)}function zr(t,e){e=e===0?0:e||10;var n=g(t).toHsl();return n.l+=e/100,n.l=Ft(n.l),g(n)}function $r(t,e){e=e===0?0:e||10;var n=g(t).toRgb();return n.r=Math.max(0,Math.min(255,n.r-Math.round(255*-(e/100)))),n.g=Math.max(0,Math.min(255,n.g-Math.round(255*-(e/100)))),n.b=Math.max(0,Math.min(255,n.b-Math.round(255*-(e/100)))),g(n)}function Dr(t,e){e=e===0?0:e||10;var n=g(t).toHsl();return n.l-=e/100,n.l=Ft(n.l),g(n)}function _r(t,e){var n=g(t).toHsl(),r=(n.h+e)%360;return n.h=r<0?360+r:r,g(n)}function Pr(t){var e=g(t).toHsl();return e.h=(e.h+180)%360,g(e)}function tn(t,e){if(isNaN(e)||e<=0)throw new Error("Argument to polyad must be a positive number");for(var n=g(t).toHsl(),r=[g(t)],s=360/e,i=1;i<e;i++)r.push(g({h:(n.h+i*s)%360,s:n.s,l:n.l}));return r}function Or(t){var e=g(t).toHsl(),n=e.h;return[g(t),g({h:(n+72)%360,s:e.s,l:e.l}),g({h:(n+216)%360,s:e.s,l:e.l})]}function Rr(t,e,n){e=e||6,n=n||30;var r=g(t).toHsl(),s=360/n,i=[g(t)];for(r.h=(r.h-(s*e>>1)+720)%360;--e;)r.h=(r.h+s)%360,i.push(g(r));return i}function Cr(t,e){e=e||6;for(var n=g(t).toHsv(),r=n.h,s=n.s,i=n.v,o=[],a=1/e;e--;)o.push(g({h:r,s,v:i})),i=(i+a)%1;return o}g.mix=function(t,e,n){n=n===0?0:n||50;var r=g(t).toRgb(),s=g(e).toRgb(),i=n/100,o={r:(s.r-r.r)*i+r.r,g:(s.g-r.g)*i+r.g,b:(s.b-r.b)*i+r.b,a:(s.a-r.a)*i+r.a};return g(o)},g.readability=function(t,e){var n=g(t),r=g(e);return(Math.max(n.getLuminance(),r.getLuminance())+.05)/(Math.min(n.getLuminance(),r.getLuminance())+.05)},g.isReadable=function(t,e,n){var r=g.readability(t,e),s,i;switch(i=!1,s=Hr(n),s.level+s.size){case"AAsmall":case"AAAlarge":i=r>=4.5;break;case"AAlarge":i=r>=3;break;case"AAAsmall":i=r>=7;break}return i},g.mostReadable=function(t,e,n){var r=null,s=0,i,o,a,c;n=n||{},o=n.includeFallbackColors,a=n.level,c=n.size;for(var u=0;u<e.length;u++)i=g.readability(t,e[u]),i>s&&(s=i,r=g(e[u]));return g.isReadable(t,r,{level:a,size:c})||!o?r:(n.includeFallbackColors=!1,g.mostReadable(t,["#fff","#000"],n))};var ae=g.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},Nr=g.hexNames=Tr(ae);function Tr(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[t[n]]=n);return e}function en(t){return t=parseFloat(t),(isNaN(t)||t<0||t>1)&&(t=1),t}function S(t,e){Er(t)&&(t="100%");var n=Gr(t);return t=Math.min(e,Math.max(0,parseFloat(t))),n&&(t=parseInt(t*e,10)/100),Math.abs(t-e)<1e-6?1:t%e/parseFloat(e)}function Ft(t){return Math.min(1,Math.max(0,t))}function E(t){return parseInt(t,16)}function Er(t){return typeof t=="string"&&t.indexOf(".")!=-1&&parseFloat(t)===1}function Gr(t){return typeof t=="string"&&t.indexOf("%")!=-1}function H(t){return t.length==1?"0"+t:""+t}function kt(t){return t<=1&&(t=t*100+"%"),t}function nn(t){return Math.round(parseFloat(t)*255).toString(16)}function rn(t){return E(t)/255}var B=function(){var t="[-\\+]?\\d+%?",e="[-\\+]?\\d*\\.\\d+%?",n="(?:"+e+")|(?:"+t+")",r="[\\s|\\(]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")\\s*\\)?",s="[\\s|\\(]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")\\s*\\)?";return{CSS_UNIT:new RegExp(n),rgb:new RegExp("rgb"+r),rgba:new RegExp("rgba"+s),hsl:new RegExp("hsl"+r),hsla:new RegExp("hsla"+s),hsv:new RegExp("hsv"+r),hsva:new RegExp("hsva"+s),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function W(t){return!!B.CSS_UNIT.exec(t)}function Lr(t){t=t.replace(gr,"").replace(yr,"").toLowerCase();var e=!1;if(ae[t])t=ae[t],e=!0;else if(t=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var n;return(n=B.rgb.exec(t))?{r:n[1],g:n[2],b:n[3]}:(n=B.rgba.exec(t))?{r:n[1],g:n[2],b:n[3],a:n[4]}:(n=B.hsl.exec(t))?{h:n[1],s:n[2],l:n[3]}:(n=B.hsla.exec(t))?{h:n[1],s:n[2],l:n[3],a:n[4]}:(n=B.hsv.exec(t))?{h:n[1],s:n[2],v:n[3]}:(n=B.hsva.exec(t))?{h:n[1],s:n[2],v:n[3],a:n[4]}:(n=B.hex8.exec(t))?{r:E(n[1]),g:E(n[2]),b:E(n[3]),a:rn(n[4]),format:e?"name":"hex8"}:(n=B.hex6.exec(t))?{r:E(n[1]),g:E(n[2]),b:E(n[3]),format:e?"name":"hex"}:(n=B.hex4.exec(t))?{r:E(n[1]+""+n[1]),g:E(n[2]+""+n[2]),b:E(n[3]+""+n[3]),a:rn(n[4]+""+n[4]),format:e?"name":"hex8"}:(n=B.hex3.exec(t))?{r:E(n[1]+""+n[1]),g:E(n[2]+""+n[2]),b:E(n[3]+""+n[3]),format:e?"name":"hex"}:!1}function Hr(t){var e,n;return t=t||{level:"AA",size:"small"},e=(t.level||"AA").toUpperCase(),n=(t.size||"small").toLowerCase(),e!=="AA"&&e!=="AAA"&&(e="AA"),n!=="small"&&n!=="large"&&(n="small"),{level:e,size:n}}const C={defaultGapPct:.8,defaultGapPx:1,defaultNormX:.05,defaultNormY:.05,defaultRadius:5,axisTitleFontsize:18,axisLabelFontsize:14,marginLines:[4,4,1,1],groupColors:["#984ea3","#e41a1c","#4daf4a","#377eb8"]},Br=Symbol("parent"),F=Symbol("positions"),lt=Symbol("childpositions"),nt=Symbol("layer");function Q(t){return{...t,with(e){return Q(e(this))}}}function Fr(t,e,n){const r=Array(t.length);for(let s=0;s<t.length;s++)r[s]=n(t[s],e[s]);return r}function Ir(t,e){return(t+e)/2}function It(){const{marginLines:t,axisTitleFontsize:e}=C;return t.map(vt(e))}function ce(t,e){const[n,r]=[t[0],t[2]].sort(T),[s,i]=[t[1],t[3]].sort(T),[o,a]=[e[0],e[2]].sort(T),[c,u]=[e[1],e[3]].sort(T);return!(r<o||n>a||i<c||s>u)}function sn(t){const[e,n,r,s]=t;return[e,n,r-e,s-n]}function on(t,e,n){return!(t<e)&&!(t>n)}function Wt(t,e){let[n,r,s,i]=sn(t),[o,a,c,u]=sn(e);const l=c*i-s*u,d=((n-o)*i-(r-a)*s)/l,h=-(-(n-o)*u+(r-a)*c)/l;return on(d,0,1)&&on(h,0,1)}function an(t,e){const[n,r,s,i]=t;return Wt([n,r,s,r],e)||Wt([n,r,n,i],e)||Wt([s,r,s,i],e)||Wt([n,i,s,i],e)}function ue(t,e){const[n,r]=t,[s,i,o,a]=e;return!(n<s||n>o||r<i||r>a)}function Wr(t){return typeof t[0]=="number"}function Qt(t){if(typeof t!="number")return t;if(t===0)return t.toString();const e=Math.floor(Math.log10(Math.abs(t)));return e>4?re(t).toString():e<=4&&e>0?re(t,4-e).toString():re(t,Math.abs(e)+2).toString()}function Qr(t,e){if(!Wr(t))return t;const n=(e==null?void 0:e.decimalPlaces)??4,r=o=>o!=0&&Math.abs(Math.log10(o))>n,i=Tt(t).some(r)?jr:Kr;return t.map(i)}function jr(t){return t===0?"0":ur(t.toExponential())}function Kr(t){return t===0?"0":parseFloat(t.toPrecision(12)).toString()}function qr(t){const e=[...t].sort(T),n=Array(t.length),r={};for(let s=0;s<t.length;s++){const i=t[s];r[i]===void 0?r[i]=0:r[i]++,n[s]=e.indexOf(i)+r[i]}return n}function j(t,e,n=0,r=e.length){const s=Array(r-n);for(let i=0;i<r-n;i++)s[e[n+i]]=t[i];return s}function Zr(t,e,n=4){const r=(e-t)/n,s=Math.floor(Math.log10(r)),i=[1,2,4,5,10];let[o,a]=[1/0,0];for(let p=0;p<i.length;p++){const f=(i[p]*10**s-r)**2;f<o&&([o,a]=[f,i[p]])}const c=10**s*a,u=Math.ceil(t/c)*c,l=Math.floor(e/c)*c,d=Math.round((l-u)/c),h=[];for(let p=0;p<d+1;p++){const f=u+p*c;h.push(f)}return h}function Yr(t){return g(t).saturate(30).lighten(30).toHexString()}function jt(t,e,n){var o;const r={};for(const a of e.colsArray())a==null||a.injectQueryInfo(t,r);const s=(o=e.col(lt))==null?void 0:o.valueAt(t);if(!s||!n)return r;const i=[...s.values()].sort((a,c)=>c-a);for(const a of i){const c={},u=n.col(nt).valueAt(a);(s.size>1||u!=7)&&(c.colour=n.col(nt).valueAt(a));for(const l of n.colsArray())l.injectQueryInfo(a,r,c)}return r}function le(t){return{...t,n:Xr,values:Vr,valueAt:Ur,scaledAt:Jr,retrain:ts}}function Xr(){return this.array.length}function Vr(){const t=this.n(),e=[];for(let n=0;n<t;n++)e.push(this.valueAt(n));return e}function Ur(t,e=0){return this.array[t+e]}function Jr(t,e){return e?e.pushforward(this.valueAt(t)):this.domain.normalize(this.valueAt(t))}function ts(t){return this.domain.retrain(t),this}function Kt(t){return{...t,proxy:cn}}function cn(t){return{...this,source:this,indexfn:t,n:es,valueAt:ns,proxy:cn}}function es(){return this.indexfn().length}function ns(t,e=0){return this.source.valueAt(this.indexfn()[t],e)}function qt(t){return{...t,setReducer:rs,stack:ss,normalizeByParent:is,shiftLeft:os,parent:as}}function rs(t){return this.reducer=t,this}function ss(){if(!this.reducer)return this;let e=this.reducer.stack().result;return this.indexfn&&(e=e.proxy(this.indexfn)),e}function is(){if(!this.reducer)return this;const t=this.reducer.normalizeByParent();let e=t.result;return this.indexfn&&(e=e.proxy(this.indexfn)),t.result}function os(){if(!this.reducer)return this;const t=this,e={...this};return e.valueAt=function(n){var r;return n===0?(r=e.reducer)==null?void 0:r.reducer.initialfn():t.valueAt(n,-1)},e}function as(){const{reducer:t}=this;if(!t)return this;const{parent:e,factor:n}=t;if(!e||!n||!n.parent)return this;const s=e.clone().result.proxy(()=>n.parent.levels);return qt(s)}function D(t){return{...t,observers:new Set,listen:us,emit:cs,remove:ls}}function cs(){for(const t of this.observers)t();return this}function us(t){return this.observers.add(t),this}function ls(t){return this.observers.delete(t),this}function zt(t,e){const n=t.emit;t.emit=J,e(),t.emit=n}var z=(t=>(t[t.Absolute=0]="Absolute",t[t.Proportion=1]="Proportion",t))(z||{}),dt=(t=>(t[t.Alphanumeric=0]="Alphanumeric",t[t.Custom=1]="Custom",t))(dt||{}),$t=(t=>(t[t.Middle=.5]="Middle",t[t.Top=1]="Top",t[t.Bottom=0]="Bottom",t))($t||{}),Zt=(t=>(t[t.Center=.5]="Center",t[t.Left=1]="Left",t[t.Right=0]="Right",t))(Zt||{}),q=(t=>(t[t.Forward=0]="Forward",t[t.Backward=1]="Backward",t))(q||{});function ds(t){const e=k("div").addClass("ps-widget").addClass("ps-widget-range").get(),{min:n,max:r}=t,s=q.Forward,i=D(O({container:e,source:t,min:n,max:r,direction:s,render:hs}));return t.listen(i.render.bind(i)),i}function hs(){const{container:t,source:e}=this;Ht(t);const n=k("span").appendTo(t).get(),r=k("span").appendTo(n).get(),s=k("input").appendTo(n).get(),i=k("input").appendTo(n).get(),o=k("button").text("⇆").appendTo(n).get();r.innerText=`Range of ${this.name()}: `,s.size=6,i.size=6,s.onmousedown=c=>c.stopPropagation(),i.onmousedown=c=>c.stopPropagation(),s.value=Qt(e.min),i.value=Qt(e.max);const a=c=>{c.code==="Enter"&&(this.min=parseFloat(s.value),this.max=parseFloat(i.value),this.emit())};return s.addEventListener("keydown",a),i.addEventListener("keydown",a),o.addEventListener("mousedown",()=>{this.direction=Fe(this.direction),this.emit()}),this}var rt=(t=>(t.Continuous="ExpanseContinuous",t.DiscreteAbsolute="ExpanseDiscreteAbsolute",t.DiscreteWeighted="ExpanseDiscreteWeighted",t))(rt||{});function ht(t){return t[Symbol.toStringTag]==="ExpanseDiscreteAbsolute"||t[Symbol.toStringTag]==="ExpanseDiscreteWeighted"}function de(t,e){return this.zero=t,e!=null&&e.default&&(this.defaultZero=t),this.emit(),this}function he(t,e){return this.one=t,e!=null&&e.default&&(this.defaultOne=t),this.emit(),this}function fe(t,e,n){return zt(this,()=>this.setZero(t,n).setOne(e,n)),this.emit(),this}function me(){return this.setZero=J,this}function pe(){return this.setOne=J,this}function ge(){return this.freezeZero().freezeOne()}function ye(t){const e=this.expand.bind(this),n=this.move.bind(this),r=this.defaultize.bind(this);if(this.expand=(s,i)=>(e(s,i),t.expand(s,i),this),this.move=s=>(n(s),t.move(s),this),this.defaultize=s=>(r(s),t.defaultize(s),this),_(this)&&_(t)){const s=this.flip.bind(this);this.flip=()=>(s(),t.flip(),this)}return this}function be(){return this.direction=Fe(this.direction),this}function un(t,e){const n=this.zero+t,r=this.one+t;return zt(this,()=>this.setZeroOne(n,r,e)),this.emit(),this}function ve(t,e,n){const{zero:r,one:s,direction:i}=this,o=s-r;i===q.Backward&&([t,e]=[1-t,1-e]);let[a,c]=[t,e].map(u=>(u-r)/o);return[a,c]=Lt(a,c),i===q.Backward&&([a,c]=[1-a,1-c]),zt(this,()=>this.setZeroOne(a,c,n)),this.emit(),this}function Z(t=0,e=1){const[n,r,s,i]=[t,e,1,1],[o,a,c,u]=[0,1,0,1],l=q.Forward,d={min:!1,max:!1,scale:!1},[h,p]=[te,te],x={...{min:t,max:e,zero:o,one:a,scale:s,defaultMin:n,defaultMax:r,defaultZero:c,defaultOne:u,defaultScale:i,direction:l,frozen:d,[Symbol.toStringTag]:rt.Continuous},...{clone:fs,copyFrom:ms,matches:ps,range:gs,transRange:ys,normalize:bs,unnormalize:vs,defaultize:Ps,trans:h,inv:p,setMin:xs,setMax:ws,setScale:Ms,setMinMax:As,setZero:de,setOne:he,setZeroOne:fe,setTransform:Ss,linkTo:ye,freezeZero:me,freezeOne:pe,freeze:ge,freezeMin:ks,freezeMax:zs,freezeScale:$s,flip:be,expand:ve,move:Ds,retrain:Os,breaks:Rs,widget:Cs}};return Q(x).with(O).with(D)}function fs(){const{defaultMin:t,defaultMax:e,trans:n,inv:r}=this,s=Z(),i={default:!0};return s.setMin(t,i).setMax(e,i),s.setTransform(n,r),s}function ms(t){return this.setMinMax(t.min,t.max,{default:!0}),this}function ps(t){return _(t)}function gs(){return this.max-this.min}function ys(){return this.trans(this.max)-this.trans(this.min)}function bs(t){const{min:e,zero:n,one:r,scale:s,direction:i,trans:o}=this,a=this.transRange();let c=(o(t)-o(e))/a/s;return c=n+c*(r-n),i+(-2*i+1)*c}function vs(t){const{min:e,one:n,zero:r,scale:s,trans:i,inv:o}=this,a=(t-r)/(n-r);return o(i(e)+a*this.transRange())*s}function xs(t,e){return this.min=t,e!=null&&e.default&&(this.defaultMin=t),this.emit(),this}function ws(t,e){return this.max=t,e!=null&&e.default&&(this.defaultMax=t),this.emit(),this}function As(t,e,n){return zt(this,()=>this.setMin(t,n).setMax(e,n)),this.emit(),this}function Ms(t,e){return t=typeof t=="number"?t:t(this.scale),this.scale=t,e!=null&&e.default&&(this.defaultScale=t),this.emit(),this}function Ss(t,e){return this.trans=t,this.inv=e,this}function ks(){return this.setMin=J,this}function zs(){return this.setMax=J,this}function $s(){return this.setScale=J,this}function Ds(t,e){const n=1-2*this.direction,r=this.zero+n*t,s=this.one+n*t;return zt(this,()=>this.setZeroOne(r,s,e)),this.emit(),this}const _s={min:!0,max:!0,scale:!0,zero:!0,one:!0};function Ps(t){const e=Object.assign(_s,t);for(const[n,r]of tt(e))r&&(this[n]=this[`default${We(n)}`]);return this.direction=q.Forward,this.emit(),this}function Os(t){const[e,n]=Tt(t),r={default:!0};return this.setMinMax(e,n,r),this}function Rs(){const[t,e]=[0,1].map(n=>this.unnormalize(n)).sort(T);return Zr(t,e)}function Cs(){const[t,e]=[0,1].map(i=>this.unnormalize(i)),n=D({min:t,max:e}),r=ds(n),s=()=>{const[i,o]=[0,1].map(a=>this.unnormalize(a));n.min=i,n.max=o,n.emit()};return this.listen(s),r.listen(()=>{let{min:i,max:o,direction:a}=r;if(a!=this.direction){this.flip(),this.emit();return}n.min=i,n.max=o,this.zero=0,this.one=1,[i,o]=[i,o].sort(T).map(this.normalize.bind(this)),[i,o]=Lt(i,o),this.setZeroOne(i,o)}),r}function _(t){return t[Symbol.toStringTag]===rt.Continuous}function Ns(t){return _(t.domain)}function Yt(t,e,n){if(!this.hasName()||!this.isQueryable())return;let[r,s]=[this.name(),this.valueAt(t)];if(n!=null&&n.colour){const i=ot[n.colour];r=`<span style="color:${n.colour<4?"white":"black"};background-color:${i}">${r}</span>`}e[r]=s}function Ts(t){const e=k("div").addClass("ps-widget").addClass("ps-widget-draglist").get(),n=D(O({container:e,source:t,render:Es}));return n.render(),t.listen(n.render.bind(n)),n}function Es(){const{container:t,source:e}=this,n=e.values;Ht(t);const r=k("span").appendTo(t).get(),s=k("ul").appendTo(t).get();r.innerText=`Levels of ${this.name()}: `;for(const i of n){const o=k("li").setAttribute("draggable",!0).text(i).appendTo(s).get();o.addEventListener("dragstart",()=>o.classList.add("dragged")),o.addEventListener("dragend",()=>{const a=Array.from(s.childNodes);for(let c=0;c<a.length;c++)n[c]=a[c].innerText;this.emit(),o.classList.remove("dragged")})}return s.addEventListener("mousedown",i=>i.stopPropagation()),s.addEventListener("dragover",i=>Gs(s,i.clientY)),this}function Gs(t,e){const n=Array.from(t.childNodes),r=n.findIndex(o=>o.classList.contains("dragged")),s=n.splice(r,1);let i={element:n[0],distance:1/0};for(const o of n){const a=o.getBoundingClientRect(),c=e-a.top-a.height/2;Math.abs(c)<i.distance&&(i={element:o,distance:c})}i.distance>0?t.insertBefore(i.element,s[0]):t.insertBefore(s[0],i.element)}function ln(t){for(let e=0;e<t.length;e++)this.values[e]=t[e];return this.emit(),this}function dn(){return j(this.values,this.order)}function hn(){const{values:t}=this,e=D({values:[...t]}),n=Ts(e);return this.listen(()=>{e.values=j(t,this.order),e.emit()}),n.listen(()=>{const r=Array(t.length);for(let s=0;s<t.length;s++)r[s]=e.values.indexOf(t[s]);this.setOrder(r)}),n}function xe(t){const e=ct(0,t.length-1),n=Et(1,t.length),r=qe(n),[s,i,o,a]=[0,1,0,1],c=q.Forward,d={...{order:e,values:t,weights:n,zero:s,one:i,defaultZero:o,defaultOne:a,direction:c,cumWeights:r,[Symbol.toStringTag]:rt.DiscreteWeighted},...{clone:Ls,copyFrom:Hs,matches:Bs,normalize:Fs,unnormalize:Is,defaultize:Ws,width:Qs,setZero:de,setOne:he,setZeroOne:fe,setValues:ln,setWeights:Ks,setOrder:qs,freezeZero:me,freezeOne:pe,freeze:ge,linkTo:ye,expand:ve,move:un,flip:be,setDefaultWeights:Zs,setDefaultOrder:Ys,getWidthExpanse:js,retrain:Xs,breaks:dn,widget:hn}};return Q(d).with(O).with(D)}function Ls(){const t=xe(this.values);return t.order=this.order,t.weights=this.weights,t.cumWeights=this.cumWeights,t.normalize=this.normalize,t}function Hs(t){for(let e=0;e<t.values.length;e++)this.values[e]=t.values[e],this.order[e]=t.order[e],this.weights[e]=t.weights[e];return this}function Bs(t){return we(t)}function Fs(t){const{zero:e,one:n,direction:r}=this,[s,i,o]=fn(this,t);let c=(s+(i-s)/2)/o;return c=e+c*(n-e),r+(-2*r+1)*c}function Is(t){throw new Error("Not implemented yet")}function Ws(t){const e=Object.assign({zero:!0,one:!0,order:!0,weights:!0},t);if(e.zero&&(this.zero=this.defaultZero),e.one&&(this.one=this.defaultOne),e.weights&&this.weights.fill(1),e.order)for(let n=0;n<this.order.length;n++)this.order[n]=n;return(e.weights||e.order)&&Dt(this),this.emit(),this}function Qs(t){const{zero:e,one:n}=this,[r,s,i]=fn(this,t);return(s-r)/i*(n-e)}function js(){const t={...this};return t.normalize=this.width,t.clone=J.bind(t),t}function Ks(t){for(let e=0;e<t.length;e++)this.weights[e]=t[e];return Dt(this),this.emit(),this}function qs(t){for(let e=0;e<t.length;e++)this.order[e]=t[e];return Dt(this),this.emit(),this}function Zs(){return this.weights.fill(1),Dt(this),this.emit(),this}function Ys(){for(let t=0;t<this.order.length;t++)this.order[t]=t;return Dt(this),this.emit(),this}function Xs(t){const e=Array.from(new Set(t)).sort(ee),n=Et(1,e.length),r=qe(n);return this.values=e,this.weights=n,this.cumWeights=r,this.emit(),this}function fn(t,e){const{order:n,values:r,cumWeights:s}=t,i=n[r.indexOf(e)];return[s[i-1]??0,s[i],At(s)]}function Dt(t){const{weights:e,cumWeights:n,order:r}=t,s=j(e,r);n[0]=s[0];for(let i=1;i<r.length;i++)n[i]=n[i-1]+s[i]}function we(t){return t[Symbol.toStringTag]===rt.DiscreteWeighted}function ft(t,e){const n=Array.from(new Set(t)).sort(ee),r="Discrete";return e=e??xe(n),Q({...{array:t,domain:e,[Symbol.toStringTag]:r},...{width:Us,clone:Vs,injectQueryInfo:Yt,toDiscrete:Js}}).with(O).with(et).with(le).with(Kt).with(qt)}function Vs(){const t=[...this.array],e=ft(t);return e.domain=this.domain.clone(),this.hasName()&&e.setName(this.name()),e.setQueryable(this.isQueryable()),e}function Us(){const t=this.clone();return t.domain=this.domain.getWidthExpanse(),t}function Js(){return this}function Y(t,e){const n="Continuous";return e=e??Z(...Tt(t)),Q({...{array:t,domain:e,[Symbol.toStringTag]:n},...{range:ri,min:ei,max:ni,clone:ti,injectQueryInfo:Yt,toDiscrete:si}}).with(O).with(et).with(le).with(Kt).with(qt)}function ti(){const t=[...this.array],e=Y(t);return e.domain=this.domain.clone(),this.hasName()&&e.setName(this.name()),e.setQueryable(this.isQueryable()),e}function ei(){return this.domain.min}function ni(){return this.domain.max}function ri(){return this.domain.range()}function si(){return ft(this.array.map(t=>t.toString())).setName(this.name()).setQueryable(this.isQueryable())}function mn(){return et(O({options:{center:!1,scale:!1},parse:ii,center:oi,scale:ai}))}function ii(t){const{center:e,scale:n}=this.options;if(!(e||n))return Y(t);const r=[],s={mean:0,sumSquares:0,sd:0};for(let i=0;i<t.length;i++){const{mean:o,sumSquares:a}=s,c=t[i],u=o,l=(i*o+c)/(i+1),d=a+(c-u)*(c-l);s.mean=l,s.sumSquares=d}s.sd=Math.sqrt(s.sumSquares/t.length);for(let i=0;i<t.length;i++){const o=e?s.mean:0,a=n?s.sd:1;r[i]=(t[i]-o)/a}return Y(r)}function oi(){return this.options.center=!0,this}function ai(){return this.options.scale=!0,this}function pn(){return et(O({options:{case:0,capitalize:!1,stripWS:!1},parse:ci,toLowerCase:ui,toUpperCase:li,capitalize:di,stripWhitespace:hi}))}function ci(t){const{case:e,capitalize:n,stripWS:r}=this.options;if(e===0&&!(n||r))return ft(t.map(String));const s=Array(t.length);let i=te;e===1&&(i=Nt(i,Un)),e===2&&(i=Nt(i,Jn)),r&&(i=Nt(i,tr)),n&&(i=Nt(i,We));for(let o=0;o<t.length;o++)s[o]=i(String(t[o]));return ft(s)}function ui(){return this.options.case=1,this}function li(){return this.options.case=2,this}function di(){return this.options.capitalize=!0,this}function hi(){return this.options.stripWS=!0,this}function fi(){return mn()}function mi(){return pn()}function pi(t){return t==="continuous"?mn():pn()}function R(t){const e="Dataframe",s={...{[Symbol.toStringTag]:e,columns:t},...{clone:gi,n:yi,keys:bi,col:vi,cols:xi,colsArray:wi,row:Ai,rows:Mi,select:ki,join:zi,proxy:$i}};return D(s)}function gi(){const t={};for(const[e,n]of L(this.columns))t[e]=n.clone();return R(t)}function yi(){for(const t of ut(this.columns))if(t.n()!=-1)return t.n();throw new Error("No fixed-length variables present in the data")}function bi(){return Object.keys(this.columns)}function vi(t){return this.columns[t]}function xi(){return this.columns}function wi(){return ir(this.columns)}function Ai(t,e){e=e??{};for(const[n,r]of L(this.columns))e[n]=r.valueAt(t);return e}function Mi(){const t=this.n(),e=Array(t);for(let n=0;n<t;n++)e[n]=this.row(n);return e}const Si={keepSymbols:!0,keepQueryables:!0};function ki(t,e){const{columns:n}=this,r=or(t(n)),s=Object.assign(Si,e);for(const[o,a]of L(n))(s.keepSymbols&&typeof o=="symbol"||s.keepQueryables&&a.isQueryable())&&(r[o]=a);const i=R(r);return this.listen(()=>i.emit()),i}function zi(t){const e={...this.columns,...t.columns},n=R(e);return this.listen(()=>n.emit()),t.listen(()=>n.emit()),n}function $i(t){const e={...this.columns},n=R(e);n.cachedN=()=>t.length;for(const[r,s]of L(n.columns))n.columns[r]=s.proxy(()=>t);return n}function Di(t,e,n){const r={},s=R(r),{maxRows:i,sample:o}=n??{},a=Object.values(t)[0].length,c=Ke(0,a-1,o??1);let u=0;for(const[l,d]of Object.entries(e)){l in t||Jt(`Property ${l} missing from raw data`),Array.isArray(t[l])||Jt(`Property "${l}" is not an array.`);let h=t[l];u===0&&(u=h.length),h.length!=u&&Jt(`Array "${l}" has different length from previously seen columns`),o&&(h=se(h,c)),i&&h.length>i&&(h.length=i),d.hasName()||d.setName(l);const p=d.parse(h);p.setName(d.name()),p.setQueryable(d.isQueryable()),r[l]=p}return s}function _i(t,e,n){if(!t.length)throw new Error("Data should be an array of objects");const r={},s=t.length;let{maxRows:i,sample:o}=n??{};const a=o?Ke(0,s,Math.min(o,s)):ct(0,s);i=i??s;for(const u of ie(e))r[u]=[];for(let u=0;u<a.length&&u<i;u++){const l=t[a[u]];for(const d of ie(e)){const h=l[d];if(h===void 0)throw new Error(`Cannot parse row with missing data: ${l}`);r[d].push(h)}}for(const u of ie(e))r[u]=e[u].parse(r[u]);return R(r)}const mt={name:"sum",initialfn:Ye,reducefn:Qe},Pi={...mt,name:"count"},Oi={name:"max",initialfn:oe(-1/0),reducefn:Math.max},Ri={name:"paste",initialfn:oe(""),reducefn:(t,e)=>t+e.toString()};function gn(t,e){return{plot:t,axis:e,render:Ci}}function Ci(t){const{plot:e,axis:n}=this,r=e.scales[n],s=t[`${n}Axis`],i=r.breaks(),o=Qr(i),[a,c,u,l]=It(),d=r.other.codomain.min-s.fontsize/2,{width:h,height:p}=s;if(s.clear(),n==="x"){let[f,w]=[0,0];for(let x=0;x<o.length;x++){const $=o[x],v=r.pushforward(i[x]),y=s.textWidth($)+1;yn(v,c,h-l)||bn(f,v,w,y)||([f,w]=[v,y],s.text(v,d,$))}}else if(n==="y"){let[f,w]=[0,0];for(let x=0;x<o.length;x++){const $=o[x],v=r.pushforward(i[x]),y=s.textWidth($)+1,P=s.textHeight($)+1;e.margins[1]/2<y&&(e.margins[1]=2*y,e.resize()),!yn(v,a,p-u)&&(bn(f,v,w,P)||([f,w]=[v,P],s.text(d,v,$)))}}}function yn(t,e,n){return t<e||t>n}function bn(t,e,n,r){const[s,i]=[t-n/2,t+n/2],[o,a]=[e-r/2,e+r/2];return s<a&&i>=o}function vn(t,e){return{plot:t,axis:e,render:Ni}}function Ni(){const{plot:t,axis:e}=this;if(!e)return;const n=t.scales[e],r=this.plot.contexts.base,s=n.name(),i=t.margins,o=e==="x"?i[0]:i[1],a=n.codomain.unnormalize(.5),c=n.other.codomain.unnormalize(0)-o*2/3;e==="x"&&r.text(a,c,s),e==="y"&&r.text(c,a,s,{vertical:!0})}var Ae=(t=>(t[t.Nominal=0]="Nominal",t[t.Ordinal=1]="Ordinal",t[t.Interval=2]="Interval",t[t.Ratio=3]="Ratio",t))(Ae||{});function st(t,e){const n="Scale";t=t??Z(),e=e??Z();const o=D(O({...{[Symbol.toStringTag]:n,type:2,domain:t,codomain:e},...{clone:Ti,pushforward:Hi,pullback:Bi,setAes:Ei,setType:Li,setDomain:Fi,setCodomain:Ii,setOther:Gi,setMin:Wi,setMax:Qi,setMinMax:ji,setZeroOne:Ki,setTransform:qi,setOrder:Yi,setWeights:Vi,setDefaultOrder:Xi,setDefaultWeights:Ui,getOrder:Zi,move:Ji,expand:to,freezeZero:ro,freezeOne:so,flip:io,linkTo:eo,breaks:no,ratio:oo,widget:ao}}));return t.listen(()=>o.emit()),e.listen(()=>o.emit()),o}function Ti(){return st(this.domain.clone(),this.codomain.clone())}function Ei(t){return this.aes=t,this}function Gi(t){return this.other=t,this}function Li(t){if(this.type=t,t===3){const{domain:e,codomain:n}=this;if(!_(e)||!_(n))throw new Error("A ratio scale must have a continuous domain and codomain.");e.setMin(0,{default:!0}).freezeMin(),n.setMin(0,{default:!0}).freezeMin()}return this}function Hi(t){const{domain:e,codomain:n}=this;return n.unnormalize(e.normalize(t))}function Bi(t){const{domain:e,codomain:n}=this;return e.unnormalize(n.normalize(t))}function Fi(t){if(this.type===3){if(!_(t))throw new Error("Ratio scale must have continuous domain.");return this.domain=t.setMin(0,{default:!0}),t.listen(()=>this.emit()),this}return this.domain=t,t.listen(()=>this.emit()),this}function Ii(t){return this.codomain=t,this}function Wi(t,e){return _(this.domain)?(this.domain.setMin(t,e),this):this}function Qi(t,e){return _(this.domain)?(this.domain.setMax(t,e),this):this}function ji(t,e,n){return _(this.domain)?(this.domain.setMinMax(t,e,n),this):this}function Ki(t,e,n){return this.domain.setZeroOne(t,e,n),this}function qi(t,e){return _(this.domain)?(this.domain.setTransform(t,e),this):this}function Zi(){return ht(this.domain)?this.domain.order:[]}function Yi(t){return ht(this.domain)?(this.domain.setOrder(t),this):this}function Xi(){return ht(this.domain)?(this.domain.setDefaultOrder(),this):this}function Vi(t){return we(this.domain)?(this.domain.setWeights(t),this):this}function Ui(){return we(this.domain)?(this.domain.setDefaultWeights(),this):this}function Ji(t){return this.domain.move(t),this}function to(t,e,n){return this.domain.expand(t,e,n),this}function eo(t){return this.domain.linkTo(t.domain),this}function no(){return this.domain.breaks()}function ro(){return _(this.domain)?(this.domain.freezeZero(),this):this}function so(){return _(this.domain)?(this.domain.freezeOne(),this):this}function io(){return this.domain.flip(),this}function oo(){if(!Me(this))return-1;const{domain:t,codomain:e}=this;return t.range()/e.range()}function ao(){const t=this.domain.widget();if(t)return t.setName(this.name()),t}function Me(t){return _(t.domain)}const co=`
<div>
    <br>
    <h1>Available Interactions</h1>
    <hr>
    <ul>
        <li> <b>Click/click and drag</b> to select objects transiently </li>
        <li>Hold <b>1/2/3</b> while dragging for permanent selection</li>
        <li>Press <b>C</b> to cycle permanent selection order</li>
        <li><b>Right click and drag</b> to pan</li>
        <li>Hold <b>Q</b> and mouse-over objects to query them</li>
        <br>
        <li>Press <b>Z</b> to zoom into current selection</li>
        <li>Press <b>X</b> to pop one level of zoom</li>
        <li>Press <b>O</b> to order by statistic (barplot)</li> 
        <li>Press <b>N</b> to normalize representation</li>
        <li>Press <b>P</b> to bring up parameter menu</li>
        <li>Press and hold <b>S</b> for plot resize mode
           <br>(you can then click and drag bottom right to resize plot)</li>
        <br>
        <li><b>Double-click</b> to reset any selection</li>
        <li>Press <b>R</b> to reset any graphical changes</li>
        <br>
        <li>Press <b>+/-</b> to change object size/width</li>
        <li>Press <b>[/]</b> to change opacity (unselected only)</li>
        <li>Press <b>;/'</b> to change histogram anchor</li>
    </ul>
</div>
`;function _t(t,e){const n="Derived",r=Z();return Q({...{[Symbol.toStringTag]:n,variable:e,domain:r},...{clone:uo,n:lo,derivefn:t,valueAt:fo,scaledAt:mo,setDomain:ho,injectQueryInfo:Yt}}).with(O).with(et).with(Kt)}function uo(){return this}function lo(){return-1}function ho(t){return this.domain=t,this}function fo(t){return this.derivefn(t,this.variable)}function mo(t,e){return e.pushforward(this.valueAt(t))}const X=_t(()=>0),K=_t(()=>1);_t(t=>t);const po=_t(t=>new Set([t])),xn=R({[F]:po});function go(t){const e=k("div").addClass("ps-widget").get(),n=t.value,r=D(O({source:t,value:n,container:e,render:yo}));return t.listen(r.render.bind(r)),r}function yo(){const{container:t,source:e}=this;Ht(t);const n=k("span").appendTo(t).get(),r=k("input").appendTo(t).get();return n.innerText=`${this.name()}`,r.value=`${Qt(e.value)}`,r.size=6,r.addEventListener("keydown",s=>{s.code=="Enter"&&(this.value=parseFloat(r.value),this.emit())}),r.onmousedown=s=>s.stopPropagation(),this}function it(t){return D(O({value:t,defaultValue:t,defaultize:bo,set:vo,widget:xo}))}function bo(){return this.value=this.defaultValue,this.emit(),this}function vo(t){return this.value=typeof t!="function"?t:t(this.value),this.emit(),this}function xo(){const t=D({value:this.value}),e=go(t).setName(this.name());return this.listen(()=>{t.value=this.value,t.emit()}),e.listen(()=>{this.value=e.value,this.emit()}),e}function Se(t){return t===void 0?!1:t&&typeof t=="object"&&"listen"in t}function wn(t){return t&&Se(t)?()=>t.value:()=>t}function Xt(t){this.boundaryData=t}function Vt(t){this.renderData=t}function Ut(t,e){this.scales[t]=this.scales[e]}function wo(t,e,n){const{scales:r,contexts:s}=t,i=it(1),o={};o.Equal=()=>i.set(l=>l*10/9),o.Minus=()=>i.set(l=>l*9/10),o.KeyR=()=>i.defaultize();const u={...{boundaryData:e,renderData:n,scales:r,contexts:s,keyActions:o,sizePct:i},...{render:Ao,check:Mo,query:So,setBoundaryData:Xt,setRenderData:Vt,remap:Ut}};return i.listen(u.render.bind(u)),u}function Ao(){var i;const{renderData:t,scales:e,contexts:n,sizePct:r}=this,s=t.n();for(const o of gt)n[o].clear();for(let o=0;o<s;o++){const a=t.col(nt).valueAt(o),c=t.col("x").scaledAt(o,e.x),u=t.col("y").scaledAt(o,e.y);let l=(i=t.col("size"))==null?void 0:i.scaledAt(o,e.size);l=l??C.defaultRadius,l=l*r.value,n[a].point(c,u,{radius:l})}}function Mo(t){var o;const{boundaryData:e,scales:n,sizePct:r}=this,s=e.n(),i=new Set;for(let a=0;a<s;a++){const c=e.col("x").scaledAt(a,n.x),u=e.col("y").scaledAt(a,n.y);let l=(o=e.col("size"))==null?void 0:o.scaledAt(a,n.size);l=l??C.defaultRadius,l=l*r.value;const d=l/Math.sqrt(2);ce(t,[c-d,u-d,c+d,u+d])&&Mt(i,e.col(F).valueAt(a))}return i}function So(t){var o;const{boundaryData:e,renderData:n,scales:r,sizePct:s}=this,i=e.n();for(let a=0;a<i;a++){const c=e.col("x").scaledAt(a,r.x),u=e.col("y").scaledAt(a,r.y);let l=(o=e.col("size"))==null?void 0:o.scaledAt(a,r.size);l=l??C.defaultRadius,l=l*s.value;const d=l/Math.sqrt(2);if(ue(t,[c-d,u-d,c+d,u+d]))return jt(a,e,n)}}b.Scatterplot=void 0,(t=>{t.from=ke})(b.Scatterplot||(b.Scatterplot={}));function ke(t,e){const n=V(t),r=t.data.select(e).clone(),s=r.select(An).join(xn),i=r.select(An).join(t.marker.data()),o=wo(n,s,i);return n.addGraphicObject(o),n.trainScales(s,c=>({x:c.x,y:c.y,size:c.size})),i.listen(n.render.bind(n)),{...n,data:r,points:o,renderData:i,boundaryData:s}}const An=t=>{var e;return{x:t.v1.setQueryable(!0),y:t.v2.setQueryable(!0),size:(e=t.v3)==null?void 0:e.setQueryable(!0)}},ko={scatter:ke,bar:Oe,histo:Te,fluct:Ce,histo2d:Ee,pcoords:Le,note:Ge},ze=255,I={Group1:7,Group2:6,Group3:5,Group4:4},zo=ct(0,7),$o=I;function Do(){return{...{layers:zo,groups:$o},...{cycle:_o}}}function _o(){const{Group2:t,Group3:e,Group4:n}=this.groups;I.Group2=n,I.Group3=t,I.Group4=e;const[r,s,i,o,a,c,u,l]=this.layers;return this.layers[0]=i,this.layers[1]=r,this.layers[2]=s,this.layers[4]=u,this.layers[5]=a,this.layers[6]=c,this}function Po(){const e=[0],n=Ye,r=R({});return D({cardinality:1,levels:e,data:r,levelAt:n})}function Pt(t,e,n,r){return r=r??Po(),D({parent:r,cardinality:t,levels:e,data:n,levelAt:Oo})}function Oo(t){return this.levels[t]}function G(t){const e="Reference",n=Z();return Q({...{array:t,domain:n,[Symbol.toStringTag]:e},...{clone:Ro,injectQueryInfo:Yt}}).with(O).with(et).with(le).with(Kt)}function Ro(){const t=[...this.array],e=G(t);return this.hasName()&&e.setName(this.name()),e.setQueryable(this.isQueryable()),e}const Co=[0,1,2,3];function No(t){return t&-5}function To(t){return t|4}function Eo(t,e){const n=ze,r=Array(t).fill(I.Group1),s=Array.from(Array(8),()=>new Set);s[7]=new Set(ct(0,t-1));const i=G(e.layers),o=G(s),a=R({[nt]:i,[F]:o}),c=Pt(8,r,a);return D({...{n:t,group:n,groupOrder:e,indices:r,positions:s,transientPositions:new Set,factor:c},...{setGroup:Go,cycleGroups:Lo,update:Ho,clearAll:Bo,clearTransient:Fo,data:Io}})}function Go(t){return this.group=t,this}function Lo(){const{indices:t,groupOrder:e}=this,{Group2:n,Group3:r,Group4:s}=e.groups;for(let i=0;i<t.length;i++)switch(t[i]){case n:t[i]=s;break;case r:t[i]=n;break;case s:t[i]=r}return this.update(new Set,!0),this}function Ho(t,e){const{group:n,indices:r,positions:s,transientPositions:i}=this;if(this.clearTransient(),!t.size&&!e)return this;for(const o of s)for(const a of t)o.delete(a);if(n===ze)for(const o of t){const a=No(r[o]);r[o]=a,s[a].add(o),i.add(o)}else for(const o of t){const a=n;r[o]=a,s[a].add(o)}return this.factor.emit(),this.emit(),this}function Bo(){const{indices:t,positions:e}=this;for(const n of e)n.clear();for(let n=0;n<this.n;n++)e[I.Group1].add(n);return t.fill(I.Group1),this.factor.emit(),this}function Fo(){const{indices:t,positions:e,transientPositions:n}=this;for(const r of Co)e[r].clear();for(const r of n){const s=To(t[r]);t[r]=s,e[s].add(r)}return n.clear(),this.factor.emit(),this}function Io(){const{n:t,factor:e,indices:n}=this,r=e.data.proxy(n),s=Array.from(Array(t),(i,o)=>new Set([o]));return r.columns[F]=G(s),this.factor.listen(()=>r.emit()),r}const Wo=new DOMParser().parseFromString(co.replace(/(\r\n|\n|\r)/gm,""),"text/html").body;b.Scene=void 0,(t=>{t.from=Mn})(b.Scene||(b.Scene={}));function Mn(t,e,n){const r=k("div").addClass("ps-scene-container").appendTo(t).get(),s=[];if(Sn(),n!=null&&n.pointQueries){Array.isArray(n.pointQueries)||(n.pointQueries=[n.pointQueries]);for(const f of n.pointQueries)e.col(f).setQueryable(!0)}const i=Do(),o=Eo(e.n(),i),a={},d={...{container:r,data:e,groupOrder:i,marker:o,hasLayout:!1,plots:s,keyActions:a},...{addPlot:Ko,addPlotByKey:qo,setGroup:Xo,setLayout:jo,updateMargins:Sn,setDimensions:Qo,deactivateAll:Zo,deactivateAllExcept:Yo}};a.Digit1=()=>d.setGroup(I.Group2),a.Digit2=()=>d.setGroup(I.Group3),a.Digit3=()=>d.setGroup(I.Group4),a.KeyC=()=>{d.groupOrder.cycle(),d.marker.cycleGroups();for(const f of d.plots)f.cycleGroups()},r.addEventListener("mousedown",Vo.bind(d)),window.addEventListener("keydown",Uo.bind(d)),window.addEventListener("keyup",Jo.bind(d));const h=k("dialog").appendTo(r).append(Wo).addClass("ps-help-modal").get(),p=k("button").appendTo(r).addClass("ps-help-button").text("?").get();if(p.onclick=()=>h.showModal(),h.onclick=()=>h.close(),n!=null&&n.websocketURL){const f=new WebSocket(n.websocketURL);f.addEventListener("open",()=>{f.send(JSON.stringify({sender:"figure",type:"connected"}))}),f.addEventListener("message",w=>{if(w=JSON.parse(w.data),(w==null?void 0:w.type)==="mark"){let{indices:x,group:$}=w.data;if(!Array.isArray(x)&&typeof $!="number")throw new Error(`Invalid data for message mark: ${w.data}`);const v=d.marker.group;x=new Set(x),d.marker.setGroup($).update(x).setGroup(v)}else if((w==null?void 0:w.type)==="selected"){const x=w.data.group,{positions:$}=o,v={};for(const y of x)$[y].size&&(v[y]=Array.from($[y]).sort(T));f.send(JSON.stringify({sender:"figure",type:"selected",data:v}))}}),d.socket=f}return d}function Sn(){const t=It(),e=document.documentElement.style;for(const[n,r]of["b","l","t","r"].entries())e.setProperty(`--${r}margin`,`${t[n]}px`)}function Qo(t,e){document.documentElement.style.setProperty("--ncols",e.toString()),document.documentElement.style.setProperty("--nrows",t.toString());for(const n of this.plots)n.resize();return this}function jo(t){const{container:e,plots:n}=this;let r="";for(const s of t){const i=`"${s.map(o=>`p${o}`).join(" ")}"`;r+=i}for(let s=0;s<n.length;s++)n[s].container.style.gridArea=`p${s+1}`;e.style.gridTemplateRows=Et("1fr",t.length).join(" "),e.style.gridTemplateColumns=Et("1fr",t[0].length).join(" "),e.style.gridTemplateAreas=r;for(const s of this.plots)s.resize();return this.hasLayout=!0,this}function Ko(t){this.container.append(t.container),this.plots.push(t),this.hasLayout&&(t.container.style.gridArea=`p${this.plots.length}`);const e=Math.ceil(Math.sqrt(this.plots.length)),n=Math.ceil(this.plots.length/e);return this.setDimensions(n,e),this}function qo(t,e,n){const r=ko[t];return r(this,e,n),this}function Zo(){for(const t of this.plots)t.deactivate();return this}function Yo(t){for(const e of this.plots)e!==t&&e.deactivate();return this}function Xo(t){return this.marker.setGroup(t),this}function Vo(t){t.target===this.container&&this.deactivateAll()}function Uo(t){var e,n;return(n=(e=this.keyActions)[t.code])==null||n.call(e,t),this}function Jo(){this.setGroup(ze)}const{groupColors:ta}=C,ot=ta.slice(),ea=ot.length;for(let t=0;t<ea;t++)ot.push(Yr(ot[t]));function pt(t){const e=k("canvas").appendTo(t),n=e.get(),r=n.getContext("2d"),s={node:n,container:t,canvas:n,canvasWrapper:e,context:r,contextProps:{}},i={clipped:!1,margins:[0,0,0,0],fontsize:C.axisLabelFontsize,width:0,height:0,scalingFactor:2},a=D({...s,...i,...{resize:na,clip:ra,setMargins:sa,addClass:ua,getProp:la,getStyle:oa,setAttribute:ia,setStyles:aa,setProps:da,setBackgroundColor:ca,textWidth:ba,textHeight:va,clear:ha,point:fa,rectangleXY:ma,rectangleWH:pa,line:ga,text:ya}});return a.resize(),window.addEventListener("resize",()=>a.resize()),a}function na(){const{context:t,canvas:e,contextProps:n,scalingFactor:r,clipped:s}=this,{clientWidth:i,clientHeight:o,clientLeft:a,clientTop:c}=e,u=i-a,l=o-c;this.width=u,this.height=l,this.canvas.width=u*r,this.canvas.height=l*r;for(const[d,h]of tt(n))t[d]=h;return t.scale(r,r),s&&this.clip(),this.emit(),this}function ra(){let{context:t,width:e,height:n}=this;const[r,s,i,o]=this.margins;return e=e-s-o,n=n-i-r,t.beginPath(),t.rect(s,i,e,n),t.clip(),this}function sa(t){return this.margins=t,this.clipped=!0,this}function ia(t,e){return this.canvasWrapper.setAttribute(t,e),this}function oa(t){return this.canvas.style[t]}function aa(t){return this.canvasWrapper.setStyles(t),this}function ca(t){return this.setStyles({backgroundColor:t}),this}function ua(t){return this.canvasWrapper.addClass(t),this}function la(t){return this.context[t]}function da(t){for(const[e,n]of tt(t))this.contextProps[e]=n,this.context[e]=n;return this}function ha(){return this.context.clearRect(0,0,this.width,this.height),this}function fa(t,e,n){const{height:r}=this,s=(n==null?void 0:n.radius)??C.defaultRadius,i=(n==null?void 0:n.hAnchor)??Zt.Center,o=(n==null?void 0:n.vAnchor)??$t.Middle;return t=t+2*(i-.5)*s,e=r-e+2*(.5-o)*s,this.context.beginPath(),this.context.arc(t,e,s,0,Math.PI*2),this.context.fill(),this}function ma(t,e,n,r){const{context:s,height:i}=this;return s.fillRect(t,i-e,n-t,e-r),this}function pa(t,e,n,r,s){const{height:i}=this,o=(s==null?void 0:s.hAnchor)??Zt.Center,a=(s==null?void 0:s.vAnchor)??$t.Middle;return t=t-o*n,e=i-e+a*r,this.context.fillRect(t,e,n,-r),this}function ga(t,e){const{context:n,height:r}=this;n.beginPath(),n.moveTo(t[0],r-e[0]);for(let s=1;s<t.length;s++)n.lineTo(t[s],r-e[s]);return n.stroke(),this}function ya(t,e,n,r){const{context:s,height:i}=this;return s.save(),s.translate(t,i-e),r!=null&&r.vertical&&s.rotate(-Math.PI/2),s.fillText(n,0,0),s.translate(-t,-(i-e)),s.restore(),this}function ba(t){return this.context.measureText(t).width}function va(t){const e=this.context.measureText(t);return e.actualBoundingBoxAscent+e.actualBoundingBoxDescent}function xa(t){const e=k("div").appendTo(t).addClass("ps-query-display").get();return{parentContainer:t,container:e,clear:wa,renderQuery:Aa}}function wa(){this.container.style.display="none"}function Aa(t,e){if(!e)return;let n="";for(const[d,h]of Object.entries(e))n+=`${d}: ${Qt(h)}<br>`;const{container:r,parentContainer:s}=this,{clientWidth:i,clientHeight:o}=s;r.innerHTML=n,r.style.display="inline-block";const a=getComputedStyle(r),c=parseFloat(a.width.slice(0,-2)),[u,l]=t;u+c>i?(r.style.left="auto",r.style.right=`${i-u+5}px`):(r.style.left=`${u+5}px`,r.style.right="auto"),r.style.top=`${o-l}px`}function Ma(){return D({coords:[0,0,0,0],setCoords:Sa,clear:ka,render:za})}function Sa(t){this.coords=t,this.emit()}function ka(){this.setCoords([0,0,0,0])}function za(t){const[e,n,r,s]=this.coords;t.user.clear(),t.user.rectangleXY(e,n,r,s)}function $a(t){const e=k("dialog").addClass("ps-widget-modal").appendTo(t).get(),n=k("div").addClass("ps-widget-display").appendTo(e).get(),r=0,s=!1,[i,o]=[0,0],u={...{mode:r,initialized:s,container:n,modal:e,lastX:i,lastY:o},...{show:Pa,addWidget:Ra,clear:Oa,isInitialized:Da,setInitialized:_a}};return n.addEventListener("mousedown",Ca.bind(u)),n.addEventListener("mouseup",Na.bind(u)),n.addEventListener("mousemove",Ta.bind(u)),e.addEventListener("mousedown",()=>{u.mode=0,e.close()}),u}function Da(){return this.initialized}function _a(t){return this.initialized=t,this}function Pa(){return this.container.childNodes.length?(this.modal.showModal(),this):this}function Oa(){const{container:t}=this;return Ht(t),this}function Ra(t){return t&&(t.render(),this.container.appendChild(t.container)),this}function Ca(t){return t.stopPropagation(),t.button!=0?this:(this.lastX=t.clientX,this.lastY=t.clientY,this.mode=1,this)}function Na(t){return t.stopPropagation(),this.mode=0,this}function Ta(t){if(this.mode!=1)return this;const{modal:e}=this,n=t.clientX-this.lastX,r=t.clientY-this.lastY,{left:s,top:i}=getComputedStyle(e);e.style.left=`${parseFloat(s.slice(0,-2))+n}px`,e.style.top=`${parseFloat(i.slice(0,-2))+r}px`,this.lastX=t.clientX,this.lastY=t.clientY}function Ea(){const{defaultNormX:t,defaultNormY:e}=C;return{...{coords:[[t,e,1-t,1-e]]},...{push:Ga,pop:Ba,clear:La,isEmpty:Ha,current:Fa,currentStretch:Ia}}}function Ga(t){return this.coords.push(t),this}function La(){return this.coords.length=1,this}function Ha(){return this.coords.length===1}function Ba(){return this.coords.length>1&&this.coords.pop(),At(this.coords)}function Fa(){return At(this.coords)}function Ia(){if(this.coords.length===1)return[1,1,1];const[t,e,n,r]=At(this.coords),s=n-t,i=r-e,o=Math.max(s,i);return[s,i,o]}const gt=[0,1,2,3,4,5,6,7],$e=[4,5,6,7];function V(t){const e=k("div").addClass("ps-plot-container").get(),n={},{axisTitleFontsize:r,axisLabelFontsize:s}=C,i=It();for(const N of gt)n[N]=pt(e).setAttribute("id",`data-layer${N}`).addClass("ps-plot-context").setStyles({zIndex:`${7-N+1}`}).setProps({fillStyle:ot[N],strokeStyle:ot[N],font:`${s}px sans`}).setMargins(i);n.base=pt(e).addClass("ps-plot-context").addClass("base").setStyles({backgroundColor:"whitesmoke"}).setProps({textAlign:"center",textBaseline:"middle",font:`${r}px sans`}),n.under=pt(e).addClass("ps-plot-context").addClass("inner"),n.user=pt(e).addClass("ps-plot-context").addClass("user").setStyles({zIndex:"10"}).setProps({fillStyle:"#99999933",strokeStyle:"#00000000"}).setMargins(i),n.xAxis=pt(e).addClass("ps-plot-context").setProps({textBaseline:"top",textAlign:"center",font:`${s}px serif`,fillStyle:"#3B4854"}),n.yAxis=pt(e).addClass("ps-plot-context").setProps({textBaseline:"middle",textAlign:"right",font:`${s}px serif`,fillStyle:"#3B4854"});const o={x:st(),y:st(),size:st(),width:st(),height:st(),area:st()},{defaultNormX:a,defaultNormY:c}=C,u={default:!0};o.x.setOther(o.y).setAes("x"),o.y.setOther(o.x).setAes("y"),o.size.codomain.setMax(10,u).setTransform(xt,wt),o.size.setType(Ae.Ratio),o.area.codomain.setTransform(xt,wt),o.area.setType(Ae.Ratio),o.width.setMax(1-2*a,u),o.height.setMax(1-2*c,u),o.width.freezeZero(),o.height.freezeZero();const l=[],d=!1,h=!1,p=0,f=0,w=0,x=0,$="",v=void 0,y=Ma(),P=Ea(),A=xa(e),yt=$a(t.container),m={pars:{active:d,mousedown:h,mousebutton:p,mode:f,lastX:w,lastY:x,lastKey:$,aspectRatio:v},...{scene:t,container:e,contexts:n,margins:i,scales:o,graphicObjects:l,selectionRect:y,zoomStack:P,queryDisplay:A,widgetDisplay:yt,widgetSources:[],localKeyActions:{},globalKeyActions:{}},...{activate:Wa,deactivate:Qa,cycleGroups:ja,render:qa,resize:De,reset:Za,setAlpha:Ua,scaleAlpha:Ja,setAspectRatio:tc,trainScales:Ka,addGraphicObject:Ya,addWidgetSource:Xa,addKeyAction:Va}};window.addEventListener("resize",Gt(De.bind(m),10)),window.addEventListener("keydown",fc.bind(m)),window.addEventListener("keyup",mc.bind(m)),e.addEventListener("mousedown",ic.bind(m)),e.addEventListener("mouseup",oc.bind(m)),e.addEventListener("mousemove",Gt(ac.bind(m),20)),e.addEventListener("dblclick",hc.bind(m)),e.addEventListener("contextmenu",dc.bind(m)),e.addEventListener("wheel",N=>{m.pars.mode===2&&(N.preventDefault(),m.queryDisplay.container.scrollBy({left:N.deltaY}))},{passive:!1}),new ResizeObserver(Gt(De.bind(m),10)).observe(e),m.addKeyAction("BracketRight",()=>m.scaleAlpha(1.1111111111111112)),m.addKeyAction("BracketLeft",()=>m.scaleAlpha(.9)),m.addKeyAction("KeyR",()=>(m.reset(),m.render())),m.addKeyAction("KeyP",ec.bind(m)),m.addKeyAction("KeyZ",rc.bind(m)),m.addKeyAction("KeyX",sc.bind(m)),m.addKeyAction("KeyS",()=>{e.style.resize="both",e.style.overflow="hidden"}),m.addKeyAction("KeyQ",()=>{for(const N of t.plots)N.pars.mode=2}),y.listen(Gt(nc.bind(m),20)),m.addGraphicObject(gn(m,"x")),m.addGraphicObject(gn(m,"y")),m.addGraphicObject(vn(m,"x")),m.addGraphicObject(vn(m,"y")),m.addGraphicObject(y),t.addPlot(m),m.addWidgetSource(m.scales.x),m.addWidgetSource(m.scales.y);for(const N of ut(m.scales))N.listen(()=>m.render());return m}function De(){const{contexts:t,scales:e,container:n,margins:r}=this;for(const h of Object.values(t))h.resize();const{clientWidth:s,clientHeight:i}=n,[o,a,c,u]=r,l=s-a-u,d=i-c-o;return t.under.canvas.style.width=`${l}px`,t.under.canvas.style.height=`${d}px`,e.x.codomain.setMin(a).setMax(Math.max(a,s-u)),e.y.codomain.setMin(o).setMax(Math.max(o,i-c)),e.width.codomain.setMax(l),e.height.codomain.setMax(d),e.area.codomain.setMax(Math.min(l,d)),this.scene.marker.clearTransient(),this.selectionRect.clear(),this.render(),this}function Wa(){return this.pars.active=!0,this.container.classList.add("active"),this}function Qa(){return this.pars.active=!1,this.container.classList.remove("active"),this.selectionRect.clear(),this}function ja(){const{contexts:t}=this,n=[0,1,2,4,5,6].map(r=>t[r].getStyle("zIndex"));t[0].setStyles({zIndex:n[1]}),t[1].setStyles({zIndex:n[2]}),t[2].setStyles({zIndex:n[0]}),t[4].setStyles({zIndex:n[4]}),t[5].setStyles({zIndex:n[5]}),t[6].setStyles({zIndex:n[3]})}function Ka(t,e){const n=e(t.columns),{scales:r,widgetDisplay:s}=this,{defaultNormX:i,defaultNormY:o}=C;s.setInitialized(!1);const a={default:!0};for(const[c,u]of tt(n)){const l=r[c];!l||!u||(u.domain&&(l.domain.matches(u.domain)?l.domain.copyFrom(u.domain):l.setDomain(u.domain.clone())),u.hasName()&&l.setName(u.name()))}for(const c of["height","width","area"])r[c].setMin(0);return r.x.setZeroOne(i,1-i,a),r.y.setZeroOne(o,1-o,a),r.width.setZeroOne(0,1-2*i).freezeZero(),r.height.setZeroOne(0,1-2*o).freezeZero(),this}function qa(){for(const t of Object.values(this.contexts))t.clear();for(const t of this.graphicObjects)t.render&&t.render(this.contexts);return this}function Za(){const{container:t,scales:e,contexts:n,selectionRect:r,zoomStack:s}=this,{clientWidth:i,clientHeight:o}=t,[a,c,u,l]=It(),d=i-c-l,h=o-u-a;for(const f of ut(e))f.domain.defaultize();const p={default:!0};e.width.codomain.setMax(d,p).defaultize(),e.height.codomain.setMax(h,p).defaultize(),e.area.codomain.setMax(Math.min(d,h),p).defaultize(),r.clear(),s.clear();for(const f of ut(n))f.setProps({globalAlpha:1});return this.render(),this}function Ya(t){if(this.graphicObjects.push(t),t.keyActions)for(const[e,n]of tt(t.keyActions))this.addKeyAction(e,n);return this.render(),this}function Xa(t){return this.widgetSources.push(t),this}function Va(t,e){const{localKeyActions:n}=this;return n[t]?n[t]=Zn(n[t],e):n[t]=e,this}function Ua(t){const{contexts:e}=this;for(const n of $e)e[n].setProps({globalAlpha:t});return this.render(),this}function Ja(t){const{contexts:e}=this;for(const n of $e){const r=e[n],s=r.getProp("globalAlpha");r.setProps({globalAlpha:ne(s*t)})}return this.render(),this}function tc(t){const{x:e,y:n}=this.scales;return!Me(e)||!Me(n)?this:(this.pars.aspectRatio=t,this.resize(),this)}function ec(t){t.preventDefault();const{widgetDisplay:e,widgetSources:n}=this;if(e.isInitialized())e.show();else{e.clear();for(const r of n){const s=r.widget();s&&e.addWidget(s.render())}e.setInitialized(!0).show()}return this}function nc(){const{scene:t,graphicObjects:e,selectionRect:n}=this,{coords:r}=n,s=new Set;if(r.every(i=>i===0)){t.marker.update(s);return}for(const i of e)i.check&&Mt(s,i.check(r));return this.scene.marker.update(s),this}function rc(){const{scales:t,selectionRect:e,zoomStack:n}=this;let[r,s,i,o]=e.coords;if(Math.abs(i-r)<10||Math.abs(o-s)<10)return;const{x:a,y:c}=t;[r,i]=[r,i].map(d=>ne(a.codomain.normalize(d))).sort(T),[s,o]=[s,o].map(d=>ne(c.codomain.normalize(d))).sort(T);const u=St(r,i),l=St(s,o);return t.x.expand(r,i),t.y.expand(s,o),t.width!=t.area&&t.width.codomain.setScale(d=>d*u),t.height!=t.area&&t.height.codomain.setScale(d=>d*l),t.area.codomain.setScale(d=>{const h=Math.sqrt(Math.max(u,l));return d*h}),n.push([r,s,i,o]),e.clear(),this.render(),this}function sc(){const{zoomStack:t,scales:e,selectionRect:n}=this;if(t.isEmpty())return;const[r,s,i,o]=t.current(),[a,c]=Lt(r,i),[u,l]=Lt(s,o),d=St(a,c),h=St(u,l);return e.x.expand(a,c),e.y.expand(u,l),e.width!=e.area&&e.width.codomain.setScale(p=>p*d),e.height!=e.area&&e.height.codomain.setScale(p=>p*h),e.area.codomain.setScale(p=>{const f=Math.sqrt(Math.max(1/d,1/h));return p/f}),t.pop(),n.clear(),this.render(),this}function ic(t){const{scene:e,container:n,selectionRect:r}=this;if(e.deactivateAllExcept(this),this.activate(),this.pars.mousedown=!0,this.pars.mousebutton=t.button,t.button===0&&(this.pars.mode=0),t.button===2&&(this.pars.mode=1),this.pars.mode===0){const{clientHeight:s}=n,i=t.offsetX,o=s-t.offsetY;r.setCoords([i,o,i,o])}}function oc(){this.pars.mousedown=!1}function ac(t){switch(this.pars.mode){case 0:cc(this,t);break;case 1:uc(this,t);break;case 2:lc(this,t)}}function cc(t,e){if(!t.pars.active||!t.pars.mousedown)return t;const{container:n,selectionRect:r}=t,{clientHeight:s}=n,i=e.offsetX,o=s-e.offsetY,{coords:a}=r;return r.setCoords([a[0],a[1],i,o]),t}function uc(t,e){if(!t.pars.active||!t.pars.mousedown)return t;const{scales:n}=t,{lastX:r,lastY:s}=t.pars,{clientWidth:i,clientHeight:o}=t.container,a=e.offsetX,c=o-e.offsetY,u=(a-r)/i,l=(c-s)/o;return n.x.move(u),n.y.move(l),t.pars.lastX=a,t.pars.lastY=c,t}function lc(t,e){var c;const{offsetX:n,offsetY:r}=e,{clientHeight:s}=t.container,i=n,o=s-r;let a;for(const u of t.graphicObjects)if(a=(c=u.query)==null?void 0:c.call(u,[i,o]),a)break;return a?t.queryDisplay.renderQuery([i,o],a):t.queryDisplay.clear(),t}function dc(t){t.preventDefault(),this.selectionRect.clear(),this.pars.mousebutton=2,this.pars.lastX=t.offsetX,this.pars.lastY=this.container.clientHeight-t.offsetY}function hc(){this.deactivate(),this.scene.marker.clearAll()}function fc(t){var e,n,r,s;t.code==="KeyQ"&&t.code===this.pars.lastKey||(this.queryDisplay.clear(),(n=(e=this.globalKeyActions)[t.code])==null||n.call(e,t),this.pars.active&&((s=(r=this.localKeyActions)[t.code])==null||s.call(r,t)),this.pars.lastKey=t.code)}function mc(){this.container.style.resize="none",this.container.style.overflow="visible",this.pars.mode=0,this.pars.lastKey="",this.queryDisplay.clear()}var Ot=(t=>(t[t.Pct=0]="Pct",t[t.Px=1]="Px",t))(Ot||{}),kn=(t=>(t[t.Width=0]="Width",t[t.Both=1]="Both",t[t.Height=2]="Height",t))(kn||{});function pc(){const[r,s]=[.8,1];return D({...{type:0,dimension:1,amount:.8,defaultGapPct:r,defaultGapPx:s},...{setGapType:gc,setGapDimension:yc,setDefaultGap:bc,defaultize:vc,decreaseGap:wc,increaseGap:xc,applyGap:Ac}})}function gc(t){const{defaultGapPct:e,defaultGapPx:n}=this;return this.amount=t===0?e:n,this.type=t,this.emit(),this}function yc(t){return this.dimension=t,this.emit(),this}function bc(t,e){const{type:n}=this;return this.amount=n===0?t:e,this.defaultGapPct=t,this.defaultGapPx=e,this}function vc(){const{type:t,defaultGapPct:e,defaultGapPx:n}=this;return this.amount=t===0?e:n,this.emit(),this}function xc(){return this.type===0?this.amount=this.amount*9/10:this.amount++,this.emit(),this}function wc(){return this.type===0?this.amount=this.amount*10/9:this.amount=Math.max(this.amount-1,0),this.emit(),this}function Ac(t,e){const{type:n,dimension:r,amount:s}=this,i=n===0?nr:T;return r<=1&&(t=Math.max(i(t,s),1)),r>=1&&(e=Math.max(i(e,s),1)),[t,e]}function _e(t,e){const n=t.toDiscrete(),r=n.values();e=e??n.domain.values;const s=[],i={};for(let l=0;l<r.length;l++){const d=e.indexOf(r[l].toString());i[d]||(i[d]=new Set),i[d].add(l),s.push(d)}const o=xe(e),a={label:ft(e,o),[F]:G(Object.values(i)),[lt]:G([])};a.label.setName(n.name());const c=R(a);return Pt(e.length,s,c)}function Pe(t,e){const n=zn(t,e),r=()=>{const s=zn(t,e);n.parent=s.parent,n.cardinality=s.cardinality,n.levels=s.levels;const i=n.data.cols(),o=s.data.cols();for(const[a,c]of L(o))i[a].domain=c.domain,i[a].array=c.array,i[a].source=c.source,i[a].indexfn=c.indexfn;n.emit()};return t.listen(r),e.listen(r),n}function zn(t,e){const n=Math.max(t.cardinality,e.cardinality)+1,r=[],s=new Set,i={},o={},a={},c={};for(let v=0;v<t.levels.length;v++){const[y,P]=[t.levelAt(v),e.levelAt(v)],A=n*y+P;A in i||(i[A]=y,o[A]=P,a[A]=new Set),r.push(A),s.add(A),a[A].add(v)}const u=r,l=Array.from(s).sort(T);for(let v=0;v<u.length;v++){u[v]=l.indexOf(u[v]);const y=t.levelAt(v);c[y]||(c[y]=new Set),c[y].add(u[v])}const d=Object.values(i),h=Object.values(o),p={};for(const[v,y]of L(t.data.cols()))v!==lt&&(p[v]=y.proxy(()=>d),p[v].setName(y.name()));for(let[v,y]of L(e.data.cols())){if(typeof v=="string")for(;v in p;)v+="$";p[v]=y.proxy(()=>h),p[v].setName(y.name())}p[F]=G(Object.values(a)),p[Br]=G(Object.values(i)),p[lt]=G([]),t.data.columns[lt].array=Object.values(c);const f=Pt(t.cardinality,d,R({})),w=s.size,x=R(p);return Pt(w,u,x,f)}function Mc(t,e){const n={};for(const[a,c]of L(e))n[a]=c.clone().setFactor(t);const r={};for(const[a,c]of L(t.data.cols()))r[a]=c;for(const[a,c]of L(n))c.setFactor(t),r[a]=c.result;const s=R(r),o=D({...s,...{factor:t,reducers:n,update:Sc}});return o.update(),t.listen(o.update.bind(o)),o}function Sc(){const{reducers:t}=this;for(const e of ut(t))e.recompute();this.cachedN=void 0,this.emit()}function Rt(t,e){return{reducers:t,factor:e,refine:kc,data:zc}}function kc(t){const{factor:e,reducers:n}=this,r=e?Pe(e,t):t,s=Rt(n,r);if(s._data=Mc(r,n),this._data)for(const[i,o]of tt(this._data.reducers))s._data.reducers[i].setParent(o);return s}function zc(){const{_data:t}=this;if(!t)throw new Error("No factor to reduce data by");return t}function Ct(t,e){var l;const n=Tc(e.initialfn());let r;(l=t.hasName)!=null&&l.call(t)?r=`${e.name} of ${t.name()}`:r="count";const s=qt(n([]));s.setName(r);const[i,o]=[!1,!1],u=D({...{name:r,reducer:e,source:t,result:s,stacked:i,normalized:o},...{clone:_c,setParent:Dc,setFactor:$c,recompute:Pc,stack:Oc,normalizeByParent:Rc}});return u.result.setReducer(u),u}function $c(t){return this.factor=t,this}function Dc(t){return this.parent=t,this}function _c(){const{source:t,reducer:e,factor:n,parent:r}=this,s=Ct(t,e);return s.result.array=[...this.result.array],s.stacked=this.stacked,s.normalized=this.normalized,r&&s.setParent(r),n&&s.setFactor(n),this.listen(()=>s.recompute()),s}function Pc(){const{factor:t,source:e,result:n,reducer:r,stacked:s,normalized:i}=this;if(t===void 0)throw new Error("Factor has not been registered");const{cardinality:o}=t,a=n.array;a.length=o;for(let c=0;c<o;c++)a[c]=r.initialfn();for(let c=0;c<t.levels.length;c++){const u=t.levelAt(c);a[u]=r.reducefn(a[u],e.valueAt(c))}if(r.afterfn)for(let c=0;c<o;c++)a[c]=r.afterfn(a[c]);return s&&Cc(this),i&&Nc(this),n.domain.retrain(a),this.emit(),this}function Oc(){const{factor:t}=this;if(!t||!t.parent)return this;const e=this.clone();return e.stacked=!0,e.recompute(),e}function Rc(){const{parent:t,factor:e}=this;if(!t||!e||!e.parent)return this;const n=this.clone();return n.normalized=!0,n.recompute(),n}function Cc(t){const{factor:e,reducer:n}=t;if(!e||!e.parent)return t;const r=e.parent,s=Array(r.cardinality);for(let o=0;o<r.cardinality;o++)s[o]=n.initialfn();const i=t.result.array;for(let o=0;o<i.length;o++){const a=r.levelAt(o);s[a]=n.reducefn(s[a],i[o]),i[o]=s[a]}}function Nc(t){const{parent:e,factor:n}=t;if(!e||!n||!n.parent)return t;const r=n.parent,s=t.result.array,i=e.result.array;for(let o=0;o<r.levels.length;o++){const a=s[o],c=i[r.levelAt(o)];s[o]=a/c}}function Tc(t){const e=typeof t;return e==="number"?Y:e==="string"?ft:G}function $n(t){const{scales:e,contexts:n}=t,[r,s]=[Zt.Center,$t.Middle],i=pc(),o={};o.Equal=()=>i.decreaseGap(),o.Minus=()=>i.increaseGap(),o.KeyR=()=>i.defaultize();const u={...{scales:e,contexts:n,keyActions:o,hAnchor:r,vAnchor:s,gapHandler:i},...{setBoundaryData:Xt,setRenderData:Vt,render:Ec,check:Gc,query:Lc,setHAnchor:Hc,setVAnchor:Bc,setGapType:Fc,setGapDimension:Ic,setDefaultGap:Wc,noGap:Qc,remap:Ut}};return i.listen(u.render.bind(u)),u}function Ec(){if(!this.renderData)return;const{renderData:t,scales:e,contexts:n}=this,{hAnchor:r,vAnchor:s,gapHandler:i}=this,o=t.n();for(const a of gt)n[a].clear();for(let a=0;a<o;a++){const c=t.col(nt).valueAt(a),u=t.col("x").scaledAt(a,e.x),l=t.col("y").scaledAt(a,e.y);let d=t.col("width").scaledAt(a,e.width),h=t.col("height").scaledAt(a,e.height);[d,h]=i.applyGap(d,h),n[c].rectangleWH(u,l,d,h,{vAnchor:s,hAnchor:r})}}function Gc(t){if(!this.boundaryData)return new Set;const{boundaryData:e,scales:n,vAnchor:r,hAnchor:s}=this,i=e.n(),o=new Set;for(let a=0;a<i;a++){const c=e.col("x").scaledAt(a,n.x),u=e.col("y").scaledAt(a,n.y);let l=e.col("width").scaledAt(a,n.width),d=e.col("height").scaledAt(a,n.height);const h=[c-l*s,u-r*d,c+l*s,u+(1-r)*d];ce(t,h)&&Mt(o,e.col(F).valueAt(a))}return o}function Lc(t){if(!this.boundaryData)return;const{boundaryData:e,renderData:n,scales:r,vAnchor:s,hAnchor:i}=this,o=e.n();for(let a=0;a<o;a++){const c=e.col("x").scaledAt(a,r.x),u=e.col("y").scaledAt(a,r.y);let l=e.col("width").scaledAt(a,r.width),d=e.col("height").scaledAt(a,r.height);const h=[c-l*i,u-s*d,c+l*i,u+(1-s)*d];if(ue(t,h))return jt(a,e,n)}}function Hc(t){return this.hAnchor=t,this}function Bc(t){return this.vAnchor=t,this}function Fc(t){return this.gapHandler.setGapType(t),this}function Ic(t){return this.gapHandler.setGapDimension(t),this}function Wc(t,e){return this.gapHandler.setDefaultGap(t,e),this}function Qc(){return this.gapHandler.applyGap=(t,e)=>[t,e],this}b.Barplot=void 0,(t=>{t.from=Oe})(b.Barplot||(b.Barplot={}));function Oe(t,e,n){const r=V(t),s=t.data.select(e),i=s.col("v2")??K,o=(n==null?void 0:n.reducer)??mt,a={stat1:Ct(i,o)},c=_e(s.col("v1")),u=Rt(a).refine(c),l=u.refine(t.marker.factor),d=u.data(),h=l.data(),[p,f]=[z.Absolute,dt.Alphanumeric],w=$n(r);w.setVAnchor($t.Bottom).setGapDimension(kn.Width);const x={...r,bars:w,type:p,order:f,partition1Data:d,partition2Data:h};return Re(x),x.addGraphicObject(x.bars),x.addKeyAction("KeyR",jc.bind(x)),x.addKeyAction("KeyO",qc.bind(x)),x.addKeyAction("KeyN",Kc.bind(x)),h.listen(x.render.bind(x)),x}function jc(){this.scales.x.setDefaultOrder(),this.order=dt.Alphanumeric,Re(this)}function Kc(){this.type===z.Absolute?Zc(this):Re(this)}function qc(){if(this.order===dt.Alphanumeric){const t=qr(this.partition1Data.col("stat1").values());this.scales.x.setOrder(t),this.order=dt.Custom}else this.scales.x.setDefaultOrder(),this.order=dt.Alphanumeric;this.render()}function Re(t){const{partition1Data:e,partition2Data:n,bars:r}=t,s=e.select(Yc),i=n.select(Xc);r.setBoundaryData(s),r.setRenderData(i),r.setGapType(Ot.Pct),t.type=z.Absolute,t.trainScales(s,c=>({...c,y:c.height,width:c.x.width()}));const{scales:o}=t,a=o.x.getOrder();o.x.setDefaultWeights(),a&&o.x.setOrder(a),o.y.setMin(0).linkTo(o.height).freezeZero(),o.height.codomain.freezeScale(),t.render()}function Zc(t){const{partition1Data:e,partition2Data:n,bars:r}=t,s=e.select(Vc),i=n.select(Uc);r.setBoundaryData(s),r.setRenderData(i),r.setGapType(Ot.Px),t.type=z.Proportion,t.trainScales(s,d=>({...d,y:d.height,width:d.x.width()}));const{scales:o}=t,a=o.x.getOrder(),c=e.col("stat1").values();o.x.setWeights(c),a&&o.x.setOrder(a);const u=t.scales.y.name();let l="proportion";u!="count"&&(l+=`of ${u}`),o.y.setMin(0).linkTo(o.height).freezeZero().setName(l),o.height.codomain.freezeScale(),o.width.setMax(c.reduce(Qe)),t.render()}const Yc=t=>({x:t.label.setQueryable(!0),y:X,width:t.label,height:t.stat1}),Xc=t=>({x:t.label,y:X,width:t.label,height:t.stat1.stack(),q1:t.stat1.setQueryable(!0)}),Vc=t=>({x:t.label.setQueryable(!0),y:X,width:t.label,height:K}),Uc=t=>({x:t.label,y:X,width:t.label,height:t.stat1.stack().normalizeByParent(),q1:t.stat1.setQueryable(!0)});b.Fluctplot=void 0,(t=>{t.from=Ce})(b.Fluctplot||(b.Fluctplot={}));function Ce(t,e){const n=V(t),r=t.data.select(e),s={stat1:Ct(K,mt)},i=_e(r.col("v1")),o=_e(r.col("v2")),a=Pe(i,o),c=Rt(s).refine(a),u=c.refine(t.marker.factor),l=c.data(),d=u.data(),h=z.Absolute,p=$n(n).setDefaultGap(1,0);p.remap("width","area"),p.remap("height","area");const f={...n,squares:p,type:h,partition1Data:l,partition2Data:d};Dn(f),n.addGraphicObject(p);const w=Math.max(i.cardinality,o.cardinality)+1;return f.scales.area.codomain.setScale(1/w,{default:!0}),f.partition1Data.listen(f.render.bind(f)),f.partition2Data.listen(f.render.bind(f)),f.addKeyAction("KeyR",()=>{f.scales.x.setDefaultOrder(),f.scales.y.setDefaultOrder()}),f.addKeyAction("KeyN",()=>f.type===z.Absolute?Jc(f):Dn(f)),f.render(),f}function Dn(t){const{partition1Data:e,partition2Data:n,squares:r}=t,s=e.select(tu),i=n.select(eu);r.setBoundaryData(s),r.setRenderData(i),r.setGapType(Ot.Pct),t.type=z.Absolute,t.trainScales(s,o=>({x:o.x,y:o.y,area:o.width})),t.render()}function Jc(t){const{partition1Data:e,partition2Data:n,squares:r}=t,s=e.select(nu),i=n.select(ru);r.setBoundaryData(s),r.setRenderData(i),r.setGapType(Ot.Px),t.type=z.Proportion,t.trainScales(s,o=>({x:o.x,y:o.y,area:o.width})),t.render()}const tu=t=>({x:t.label.setQueryable(!0),y:t.label$.setQueryable(!0),width:t.stat1,height:t.stat1}),eu=t=>({x:t.label,y:t.label$,width:t.stat1.stack(),height:t.stat1.stack(),q1:t.stat1.setQueryable(!0)}),nu=t=>({x:t.label.setQueryable(!0),y:t.label$.setQueryable(!0),width:K,height:K}),ru=t=>({x:t.label,y:t.label$,width:t.stat1.stack().normalizeByParent(),height:t.stat1.stack().normalizeByParent(),q1:t.stat1.setQueryable(!0)});function Ne(t,e,n){const r=wn(e),s=wn(n),i=_n(t,r(),s()),o=()=>{const a=_n(t,r(),s());i.parent=a.parent,i.cardinality=a.cardinality,i.levels=a.levels;for(const[c,u]of L(a.data.columns))i.data.columns[c].domain=u.domain,i.data.columns[c].array=u.array,i.data.columns[c].source=u.source,i.data.columns[c].indexfn=u.indexfn;i.emit()};return Se(e)&&e.listen(o),Se(n)&&n.listen(o),i}function _n(t,e,n){const r=t.array,{min:s,max:i}=t.domain,o=t.domain.range(),a=e?Math.ceil(o/e)+1:10;e=e??o/(a-1),n=n??s;const c=s-e+(n-s)%e,u=i+e-(i-n)%e,l=Array(a+2);l[0]=c,l[l.length-1]=u;for(let m=1;m<l.length-1;m++)l[m]=c+m*e;const d=new Set,h=[],p={};for(let m=0;m<r.length;m++){const U=l.findIndex(N=>N>=r[m])-1;p[U]||(p[U]=new Set),p[U].add(m),d.add(U),h.push(U)}const f=Array.from(d).sort(T),w={};for(const[m,U]of Object.entries(f))w[U]=Vn(m);const x=h;for(let m=0;m<x.length;m++)x[m]=w[x[m]];const[$,v]=[l[f[0]],l[At(f)+1]],y=Z($,v);Y(l,y).setName(t.name());const A=se(l,f),yt=se(l,f.map(Ie)),bt=Fr(A,yt,Ir),M=Y(A,y),at=Y(yt,y),He=Y(bt,y);t.hasName()&&(M.setName(`lower ${t.name()}`),at.setName(`upper ${t.name()}`),He.setName(t.name()));const Ln={binStart:M,binMid:He,binEnd:at,[F]:G(Object.values(p)),[lt]:G([])},Hn=R(Ln);return Pt(f.length,x,Hn)}function Pn(t){const{scales:e,contexts:n}=t;return{...{scales:e,contexts:n},...{setBoundaryData:Xt,setRenderData:Vt,render:su,check:iu,query:ou,remap:Ut}}}function su(t){if(!this.renderData)return;const{renderData:e,scales:n}=this,r=e.n();for(const s of gt)t[s].clear();for(let s=0;s<r;s++){const i=e.col(nt).valueAt(s);let o=e.col("x0").scaledAt(s,n.x),a=e.col("y0").scaledAt(s,n.y),c=e.col("x1").scaledAt(s,n.x),u=e.col("y1").scaledAt(s,n.y);if(e.col("area")){const l=e.col("area").scaledAt(s,n.area);o=o+(1-l)/2*(c-o),c=c-(1-l)/2*(c-o),a=a+(1-l)/2*(u-a),u=u-(1-l)/2*(u-a)}t[i].rectangleXY(o,a,c,u)}}function iu(t){if(!this.boundaryData)return new Set;const{boundaryData:e,scales:n}=this,r=e.n(),s=new Set;for(let i=0;i<r;i++){let o=e.col("x0").scaledAt(i,n.x),a=e.col("y0").scaledAt(i,n.y),c=e.col("x1").scaledAt(i,n.x),u=e.col("y1").scaledAt(i,n.y);if(e.col("area")){const d=e.col("area").scaledAt(i,n.area);o=o+(1-d)/2*(c-o),c=c-(1-d)/2*(c-o),a=a+(1-d)/2*(u-a),u=u-(1-d)/2*(u-a)}ce(t,[o,a,c,u])&&Mt(s,e.col(F).valueAt(i))}return s}function ou(t){if(!this.boundaryData)return;const{boundaryData:e,renderData:n,scales:r}=this,s=e.n();for(let i=0;i<s;i++){let o=e.col("x0").scaledAt(i,r.x),a=e.col("y0").scaledAt(i,r.y),c=e.col("x1").scaledAt(i,r.x),u=e.col("y1").scaledAt(i,r.y);if(e.col("area")){const d=e.col("area").scaledAt(i,r.area);o=o+(1-d)/2*(c-o),c=c-(1-d)/2*(c-o),a=a+(1-d)/2*(u-a),u=u-(1-d)/2*(u-a)}if(ue(t,[o,a,c,u]))return jt(i,e,n)}}b.Histogram=void 0,(t=>{t.from=Te})(b.Histogram||(b.Histogram={}));function Te(t,e,n){const r=V(t),s=t.data.select(e),[i,o]=[s.col("v1").min(),s.col("v1").range()],a=it(i).setName("Anchor: "),c=it(o/15).setName("Binwidth: "),u=s.col("v2")??K,l=(n==null?void 0:n.reducer)??mt,d={stat1:Ct(u,l)},h=Ne(s.col("v1"),c,a),p=Rt(d).refine(h),f=p.refine(t.marker.factor),w=p.data(),x=f.data(),$=z.Absolute,v=Pn(r),y={...r,type:$,bars:v,partition1Data:w,partition2Data:x};On(y),y.addGraphicObject(v),y.addKeyAction("KeyN",()=>y.type===z.Absolute?au(y):On(y)),y.addKeyAction("Minus",()=>c.set(A=>A*.9)),y.addKeyAction("Equal",()=>c.set(A=>A*1.1111111111111112));const P=s.col("v1").range()/20;return y.addKeyAction("Quote",()=>a.set(A=>A-P)),y.addKeyAction("Semicolon",()=>a.set(A=>A+P)),y.addKeyAction("KeyR",()=>(c.defaultize(),a.defaultize())),y.addWidgetSource(c),y.addWidgetSource(a),w.listen(()=>{y.trainScales(v.boundaryData,A=>({x:A.x0,y:A.y1})),y.scales.x.setName(w.col("binMid").name()),y.scales.y.setMin(0).freezeZero()}),x.listen(y.render.bind(y)),y.render(),y}function On(t){const{partition1Data:e,partition2Data:n,bars:r}=t,s=e.select(cu),i=n.select(uu);r.setBoundaryData(s),r.setRenderData(i),t.type=z.Absolute,t.trainScales(s,o=>({x:o.x0,y:o.y1})),t.scales.x.setName(e.col("binMid").name()),t.scales.y.setMin(0).freezeZero(),t.render()}function au(t){const{partition1Data:e,partition2Data:n,bars:r}=t,s=e.select(lu),i=n.select(du);s.col("x0").setName(void 0),s.col("x1").setName(void 0),r.setBoundaryData(s),r.setRenderData(i),t.type=z.Proportion,t.trainScales(s,c=>({x:c.x0,y:c.y1})),t.scales.x.setName("cumulative count");const o=t.scales.y.name();let a="proportion";o!="count"&&(a+=`of ${o}`),t.scales.y.setMin(0).freezeZero().setName(a),t.render()}const cu=t=>({x0:t.binStart.setQueryable(!0),x1:t.binEnd.setQueryable(!0),y0:X,y1:t.stat1}),uu=t=>({x0:t.binStart,x1:t.binEnd,y0:X,y1:t.stat1.stack(),q1:t.stat1.setQueryable(!0)}),lu=t=>({x0:t.stat1.stack().shiftLeft(),x1:t.stat1.stack(),y0:X,y1:K,q1:t.binStart.setQueryable(!0),q2:t.binEnd.setQueryable(!0)}),du=t=>({x0:t.stat1.parent().stack().shiftLeft(),x1:t.stat1.parent().stack(),y0:X,y1:t.stat1.stack().normalizeByParent(),q1:t.stat1.setQueryable(!0)});b.Histogram2D=void 0,(t=>{t.from=Ee})(b.Histogram2D||(b.Histogram2D={}));function Ee(t,e){const n=V(t),r=t.data.select(e),[s,i]=[r.col("v1"),r.col("v2")],[o,a]=[s.range(),i.range()],[c,u]=[s.min(),i.min()],l=it(o/30).setName(Cn(s.name())),d=it(a/30).setName(Cn(s.name())),h=it(c).setName(Nn(s.name())),p=it(u).setName(Nn(i.name())),f={stat1:Ct(K,mt)},w=Ne(s,l,h),x=Ne(i,d,p),$=Pe(w,x),v=Rt(f).refine($),y=v.refine(t.marker.factor),P=v.data(),A=y.data(),yt=z.Absolute,bt=Pn(n),M={...n,type:yt,squares:bt,partition1Data:P,partition2Data:A};return Rn(M),M.addGraphicObject(bt),M.addKeyAction("KeyN",()=>M.type===z.Absolute?hu(M):Rn(M)),M.addKeyAction("Minus",()=>{l.set(vt(.9)),d.set(vt(.9))}),M.addKeyAction("Equal",()=>{l.set(vt(1.1111111111111112)),d.set(vt(1.1111111111111112))}),M.addKeyAction("KeyR",()=>{l.defaultize(),d.defaultize()}),M.addWidgetSource(l),M.addWidgetSource(d),M.addWidgetSource(h),M.addWidgetSource(p),P.listen(()=>{M.trainScales(bt.boundaryData,at=>({x:at.x0,y:at.y0,area:at.area})),M.scales.x.setName(P.col("binMid").name()),M.scales.y.setName(P.col("binMid$").name()),M.scales.area.codomain.setMinMax(0,1,{default:!0}).setTransform(xt,wt).freezeMax().freezeScale(),M.render()}),A.listen(M.render.bind(M)),M.render(),M}function Rn(t){const{partition1Data:e,partition2Data:n,squares:r}=t,s=e.select(fu),i=n.select(mu);r.setBoundaryData(s),r.setRenderData(i),t.trainScales(s,a=>({x:a.x0,y:a.y1,area:a.area}));const{scales:o}=t;o.x.setName(e.col("binMid").name()),o.y.setName(e.col("binMid$").name()),o.area.codomain.setMinMax(0,1,{default:!0}).setTransform(xt,wt).freezeMax().freezeScale(),t.type=z.Absolute,t.render()}function hu(t){const{partition1Data:e,partition2Data:n,squares:r}=t,s=e.select(pu),i=n.select(gu);r.setBoundaryData(s),r.setRenderData(i),t.trainScales(s,a=>({x:a.x0,y:a.y1,area:a.area}));const{scales:o}=t;o.x.setName(e.col("binMid").name()),o.y.setName(e.col("binMid$").name()),o.area.codomain.setMinMax(0,1,{default:!0}).setTransform(xt,wt).freezeMax().freezeScale(),t.type=z.Proportion,t.render()}const fu=t=>({x0:t.binStart.setQueryable(!0),x1:t.binEnd.setQueryable(!0),y0:t.binStart$.setQueryable(!0),y1:t.binEnd$.setQueryable(!0),area:t.stat1}),mu=t=>({x0:t.binStart,x1:t.binEnd,y0:t.binStart$,y1:t.binEnd$,area:t.stat1.stack(),q1:t.stat1.setQueryable(!0)}),pu=t=>({x0:t.binStart.setQueryable(!0),x1:t.binEnd.setQueryable(!0),y0:t.binStart$.setQueryable(!0),y1:t.binEnd$.setQueryable(!0),area:K}),gu=t=>({x0:t.binStart,x1:t.binEnd,y0:t.binStart$,y1:t.binEnd$,area:t.stat1.stack().normalizeByParent(),q1:t.stat1.setQueryable(!0)});function Cn(t){return`Binwidth of ${t}: `}function Nn(t){return`Anchor of ${t}: `}b.Noteplot=void 0,(t=>{t.from=Ge})(b.Noteplot||(b.Noteplot={}));function Ge(t){const e=V(t);for(const r of ut(e.contexts))r.canvas.remove();const n=k("textarea").appendTo(e.container).get();return n.value=`
Write notes here....`,e.localKeyActions.KeyP=Yn,{...e,textarea:n}}function yu(t,e,n){const{scales:r,contexts:s}=t;return{...{boundaryData:e,renderData:n,scales:r,contexts:s},...{render:bu,check:vu,query:xu,setBoundaryData:Xt,setRenderData:Vt,remap:Ut}}}function bu(){const{renderData:t,scales:e,contexts:n}=this,r=t.n();for(const s of gt)n[s].clear();for(let s=0;s<r;s++){const i=t.col(nt).valueAt(s);let o=t.col("x").scaledAt(s,e.x),a=t.col("y").scaledAt(s,e.y);if(ht(e.x.domain)){const c=e.x.domain.order;o=j(o,c),a=j(a,c)}n[i].line(o,a)}}function vu(t){const{boundaryData:e,scales:n}=this,r=new Set;if(!ht(n.x.domain))return r;const s=e.n(),i=n.x.domain.order;for(let o=0;o<s;o++){let a=e.col("x").scaledAt(o,n.x),c=e.col("y").scaledAt(o,n.y);a=j(a,i),c=j(c,i);for(let u=1;u<a.length;u++)an(t,[a[u-1],c[u-1],a[u],c[u]])&&Mt(r,e.col(F).valueAt(o))}return r}function xu(t){const{boundaryData:e,scales:n}=this;if(!ht(n.x.domain))return{};const r=e.n(),s=sr(t,Xn,Ie),i=n.x.domain.order;for(let o=0;o<r;o++){let a=e.col("x").scaledAt(o,n.x),c=e.col("y").scaledAt(o,n.y);a=j(a,i),c=j(c,i);for(let u=1;u<a.length;u++)if(an(s,[a[u-1],c[u-1],a[u],c[u]]))return jt(o,e.select(l=>({y:l.y})))}}function Tn(t){const e=ct(0,t.length-1),[n,r,s,i]=[0,1,0,1],o=q.Forward,u={...{order:e,values:t,zero:n,one:r,defaultZero:s,defaultOne:i,direction:o,[Symbol.toStringTag]:rt.DiscreteAbsolute},...{clone:wu,copyFrom:Au,matches:Mu,normalize:Su,unnormalize:ku,defaultize:zu,setZero:de,setOne:he,setZeroOne:fe,setValues:ln,setOrder:$u,setDefaultOrder:Du,linkTo:ye,freezeZero:me,freezeOne:pe,freeze:ge,expand:ve,move:un,flip:be,retrain:_u,breaks:dn,widget:hn}};return Q(u).with(O).with(D)}function wu(){const t=Tn(this.values);return t.order=this.order,t.normalize=this.normalize,t}function Au(t){for(let e=0;e<t.values.length;e++)this.values[e]=t.values[e],this.order[e]=t.order[e];return this}function Mu(t){return Pu(t)}function Su(t){const{order:e,values:n,zero:r,one:s,direction:i}=this;let o=e[n.indexOf(t)]/(n.length-1);return o=r+o*(s-r),i+(-2*i+1)*o}function ku(t){throw new Error("Not implemented yet")}function zu(t){const e=Object.assign({zero:!0,one:!0,order:!0},t);if(e.zero&&(this.zero=this.defaultZero),e.one&&(this.one=this.defaultOne),e.order)for(let n=0;n<this.order.length;n++)this.order[n]=n;return this.emit(),this}function $u(t){for(let e=0;e<t.length;e++)this.order[e]=t[e];return this.emit(),this}function Du(){for(let t=0;t<this.order.length;t++)this.order[t]=t;return this.emit(),this}function _u(t){const e=Array.from(new Set(t)).sort(ee);return this.values=e,this.emit(),this}function Pu(t){return t[Symbol.toStringTag]===rt.DiscreteWeighted}function En(t){const e="Tuple",r=ct(0,t.length-1),s=Z();return Q({...{tag:e,variables:t,order:r,domain:s,commonDomain:!1},...{clone:Ou,n:Ru,valueAt:Cu,scaledAt:Nu,setOrder:Tu,setCommonDomain:Eu,unsetCommonDomain:Gu,injectQueryInfo:Lu}}).with(O).with(et)}function Ou(){return{...this}}function Ru(){for(const t of this.variables)if(t.n()!=-1)return t.n();throw new Error("No fixed length variables present")}function Cu(t,e=0){const{variables:n,order:r}=this,s=Array(n.length);for(let i=0;i<n.length;i++){const o=n[i];s[r[i]]=o.valueAt(t,e)}return s}function Nu(t,e){const{variables:n,order:r,domain:s,commonDomain:i}=this,o=Array(n.length),a=e.domain;for(let c=0;c<n.length;c++){const u=n[c];e.domain=i?s:u.domain,o[r[c]]=u.scaledAt(t,e)}return e.domain=a,o}function Tu(t){for(let e=0;e<t.length;e++)this.order[e]=t[e];return this}function Eu(){if(!_(this.domain))throw new Error("Only continuous domain can be shared.");let[t,e]=[1/0,-1/0];for(const n of this.variables){if(!Ns(n))throw new Error("All variables must be continuous for common domain.");const[r,s]=Tt(n.array);t=Math.min(t,r),e=Math.max(e,s)}return this.domain.setMinMax(t,e),this.commonDomain=!0,this.domain}function Gu(){if(!_(this.domain))throw new Error("Only continuous domain can be shared.");return this.domain.setMinMax(0,1),this.commonDomain=!1,this.domain}function Lu(t,e){for(const n of this.variables)n.hasName()&&n.injectQueryInfo(t,e)}b.PCoordsplot=void 0,(t=>{t.from=Le})(b.PCoordsplot||(b.PCoordsplot={}));function Le(t,e){const n=t.data.select(e).clone(),r=V(t),s=n.select(Hu).join(t.marker.data()),i=s,o=s.select(Gn).join(xn),a=i.select(Gn).join(t.marker.data()),c=z.Proportion,u=yu(r,o,a);r.addGraphicObject(u),r.trainScales(o,d=>({x:d.x,y:d.y})),r.scales.x.domain.linkTo(o.col("x").domain),r.scales.y.domain.linkTo(o.col("y").domain);for(const d of o.col("y").variables)r.scales.y.domain.linkTo(d.domain);const l={...r,type:c,lines:u,partition1Data:s,partition2Data:i};return l.addKeyAction("KeyN",Bu.bind(l)),l.addKeyAction("KeyR",()=>l.scales.x.setDefaultOrder()),a.listen(r.render.bind(r)),l}const Hu=t=>{const{defaultNormX:e,defaultNormY:n}=C,r=[];for(const[a,c]of Object.entries(t))/^v\d+$/g.test(a)&&(r.push(c.setQueryable(!0)),c.domain.expand(-e,1+e,{default:!0}));const s=En(r),i=En(r.map(a=>_t((c,u)=>u.name(),a).setName(a.name()))),o=Tn(i.valueAt(0));o.expand(-n,1+n,{default:!0});for(const a of i.variables)a.setDomain(o);return i.domain=o,i.n=()=>s.n(),i.setName("variable"),s.setName("scaled value"),{names:i,values:s}},Gn=t=>({x:t.names,y:t.values});function Bu(){if(this.type===z.Proportion){const{defaultNormY:t}=C,e=this.partition1Data.col("values").setCommonDomain(),{min:n,max:r}=e.expand(-t,1+t);this.scales.y.setMinMax(n,r),this.scales.y.setName("value"),this.type=z.Absolute,this.render()}else{const{defaultNormY:t}=C;this.partition1Data.col("values").unsetCommonDomain(),this.scales.y.setMinMax(-t,1+t).setName("scaled value"),this.type=z.Proportion,this.render()}}return b.baseLayers=$e,b.col=pi,b.colors=ot,b.continuous=fi,b.countReducer=Pi,b.discrete=mi,b.fetchJSON=er,b.layers=gt,b.maxReducer=Oi,b.newBarplot=Oe,b.newDataframe=R,b.newFluctplot=Ce,b.newHistogram=Te,b.newHistogram2D=Ee,b.newNoteplot=Ge,b.newPCoordsplot=Le,b.newPlot=V,b.newScatter=ke,b.newScene=Mn,b.parseColumns=Di,b.parseRows=_i,b.pasteReducer=Ri,b.sumReducer=mt,Object.defineProperty(b,Symbol.toStringTag,{value:"Module"}),b}({});
