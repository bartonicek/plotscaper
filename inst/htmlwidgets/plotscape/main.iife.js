var plotscape=function(exports){"use strict";var __vite_style__=document.createElement("style");__vite_style__.textContent=`*:where(.tailwind,.tailwind *),:before:where(.tailwind,.tailwind *),:after:where(.tailwind,.tailwind *){box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}:before:where(.tailwind,.tailwind *),:after:where(.tailwind,.tailwind *){--tw-content: ""}.tailwind{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;-o-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}.tailwind{margin:0;line-height:inherit}hr:where(.tailwind,.tailwind *){height:0;color:inherit;border-top-width:1px}abbr:where([title]):where(.tailwind,.tailwind *){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1:where(.tailwind,.tailwind *),h2:where(.tailwind,.tailwind *),h3:where(.tailwind,.tailwind *),h4:where(.tailwind,.tailwind *),h5:where(.tailwind,.tailwind *),h6:where(.tailwind,.tailwind *){font-size:inherit;font-weight:inherit}a:where(.tailwind,.tailwind *){color:inherit;text-decoration:inherit}b:where(.tailwind,.tailwind *),strong:where(.tailwind,.tailwind *){font-weight:bolder}code:where(.tailwind,.tailwind *),kbd:where(.tailwind,.tailwind *),samp:where(.tailwind,.tailwind *),pre:where(.tailwind,.tailwind *){font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small:where(.tailwind,.tailwind *){font-size:80%}sub:where(.tailwind,.tailwind *),sup:where(.tailwind,.tailwind *){font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub:where(.tailwind,.tailwind *){bottom:-.25em}sup:where(.tailwind,.tailwind *){top:-.5em}table:where(.tailwind,.tailwind *){text-indent:0;border-color:inherit;border-collapse:collapse}button:where(.tailwind,.tailwind *),input:where(.tailwind,.tailwind *),optgroup:where(.tailwind,.tailwind *),select:where(.tailwind,.tailwind *),textarea:where(.tailwind,.tailwind *){font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button:where(.tailwind,.tailwind *),select:where(.tailwind,.tailwind *){text-transform:none}button:where(.tailwind,.tailwind *),input:where([type=button]):where(.tailwind,.tailwind *),input:where([type=reset]):where(.tailwind,.tailwind *),input:where([type=submit]):where(.tailwind,.tailwind *){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring:where(.tailwind,.tailwind *){outline:auto}:-moz-ui-invalid:where(.tailwind,.tailwind *){box-shadow:none}progress:where(.tailwind,.tailwind *){vertical-align:baseline}::-webkit-inner-spin-button:where(.tailwind,.tailwind *),::-webkit-outer-spin-button:where(.tailwind,.tailwind *){height:auto}[type=search]:where(.tailwind,.tailwind *){-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration:where(.tailwind,.tailwind *){-webkit-appearance:none}::-webkit-file-upload-button:where(.tailwind,.tailwind *){-webkit-appearance:button;font:inherit}summary:where(.tailwind,.tailwind *){display:list-item}blockquote:where(.tailwind,.tailwind *),dl:where(.tailwind,.tailwind *),dd:where(.tailwind,.tailwind *),h1:where(.tailwind,.tailwind *),h2:where(.tailwind,.tailwind *),h3:where(.tailwind,.tailwind *),h4:where(.tailwind,.tailwind *),h5:where(.tailwind,.tailwind *),h6:where(.tailwind,.tailwind *),hr:where(.tailwind,.tailwind *),figure:where(.tailwind,.tailwind *),p:where(.tailwind,.tailwind *),pre:where(.tailwind,.tailwind *){margin:0}fieldset:where(.tailwind,.tailwind *){margin:0;padding:0}legend:where(.tailwind,.tailwind *){padding:0}ol:where(.tailwind,.tailwind *),ul:where(.tailwind,.tailwind *),menu:where(.tailwind,.tailwind *){list-style:none;margin:0;padding:0}dialog:where(.tailwind,.tailwind *){padding:0}textarea:where(.tailwind,.tailwind *){resize:vertical}input::-moz-placeholder:where(.tailwind,.tailwind *),textarea::-moz-placeholder:where(.tailwind,.tailwind *){opacity:1;color:#9ca3af}input::placeholder:where(.tailwind,.tailwind *),textarea::placeholder:where(.tailwind,.tailwind *){opacity:1;color:#9ca3af}button:where(.tailwind,.tailwind *),[role=button]:where(.tailwind,.tailwind *){cursor:pointer}:disabled:where(.tailwind,.tailwind *){cursor:default}img:where(.tailwind,.tailwind *),svg:where(.tailwind,.tailwind *),video:where(.tailwind,.tailwind *),canvas:where(.tailwind,.tailwind *),audio:where(.tailwind,.tailwind *),iframe:where(.tailwind,.tailwind *),embed:where(.tailwind,.tailwind *),object:where(.tailwind,.tailwind *){display:block;vertical-align:middle}img:where(.tailwind,.tailwind *),video:where(.tailwind,.tailwind *){max-width:100%;height:auto}[hidden]:where(.tailwind,.tailwind *){display:none}*,:before,:after{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }.container{width:100%}@media (min-width: 640px){.container{max-width:640px}}@media (min-width: 768px){.container{max-width:768px}}@media (min-width: 1024px){.container{max-width:1024px}}@media (min-width: 1280px){.container{max-width:1280px}}@media (min-width: 1536px){.container{max-width:1536px}}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.left-0{left:0}.right-0{right:0}.top-0{top:0}.z-0{z-index:0}.z-10{z-index:10}.z-30{z-index:30}.z-50{z-index:50}.m-1{margin:.25rem}.inline-block{display:inline-block}.flex{display:flex}.table{display:table}.grid{display:grid}.hidden{display:none}.size-full{width:100%;height:100%}.h-5\\/6{height:83.333333%}.h-full{height:100%}.h-screen{height:100vh}.w-5\\/6{width:83.333333%}.w-8{width:2rem}.w-fit{width:-moz-fit-content;width:fit-content}.w-full{width:100%}.shrink{flex-shrink:1}.grow{flex-grow:1}.select-none{-webkit-user-select:none;-moz-user-select:none;user-select:none}.resize{resize:both}.grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.grid-rows-1{grid-template-rows:repeat(1,minmax(0,1fr))}.flex-row{flex-direction:row}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.content-center{align-content:center}.items-center{align-items:center}.justify-start{justify-content:flex-start}.justify-center{justify-content:center}.gap-5{gap:1.25rem}.rounded{border-radius:.25rem}.rounded-md{border-radius:.375rem}.rounded-bl-md{border-bottom-left-radius:.375rem}.border{border-width:1px}.border-gray-400{--tw-border-opacity: 1;border-color:rgb(156 163 175 / var(--tw-border-opacity))}.border-b-black{--tw-border-opacity: 1;border-bottom-color:rgb(0 0 0 / var(--tw-border-opacity))}.border-l-black{--tw-border-opacity: 1;border-left-color:rgb(0 0 0 / var(--tw-border-opacity))}.bg-\\[\\#deded9\\]{--tw-bg-opacity: 1;background-color:rgb(222 222 217 / var(--tw-bg-opacity))}.bg-gray-100{--tw-bg-opacity: 1;background-color:rgb(243 244 246 / var(--tw-bg-opacity))}.bg-gray-300{--tw-bg-opacity: 1;background-color:rgb(209 213 219 / var(--tw-bg-opacity))}.bg-gray-400{--tw-bg-opacity: 1;background-color:rgb(156 163 175 / var(--tw-bg-opacity))}.bg-gray-50{--tw-bg-opacity: 1;background-color:rgb(249 250 251 / var(--tw-bg-opacity))}.bg-slate-200{--tw-bg-opacity: 1;background-color:rgb(226 232 240 / var(--tw-bg-opacity))}.bg-slate-800{--tw-bg-opacity: 1;background-color:rgb(30 41 59 / var(--tw-bg-opacity))}.bg-white{--tw-bg-opacity: 1;background-color:rgb(255 255 255 / var(--tw-bg-opacity))}.bg-opacity-80{--tw-bg-opacity: .8}.p-1{padding:.25rem}.p-10{padding:2.5rem}.px-2{padding-left:.5rem;padding-right:.5rem}.px-3{padding-left:.75rem;padding-right:.75rem}.py-10{padding-top:2.5rem;padding-bottom:2.5rem}.text-center{text-align:center}.font-mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}.text-sm{font-size:.875rem;line-height:1.25rem}.uppercase{text-transform:uppercase}.lowercase{text-transform:lowercase}.capitalize{text-transform:capitalize}.text-black{--tw-text-opacity: 1;color:rgb(0 0 0 / var(--tw-text-opacity))}.text-white{--tw-text-opacity: 1;color:rgb(255 255 255 / var(--tw-text-opacity))}.shadow-md{--tw-shadow: 0 4px 6px -1px rgb(0 0 0 / .1), 0 2px 4px -2px rgb(0 0 0 / .1);--tw-shadow-colored: 0 4px 6px -1px var(--tw-shadow-color), 0 2px 4px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.outline-none{outline:2px solid transparent;outline-offset:2px}.outline{outline-style:solid}.outline-2{outline-width:2px}.outline-slate-600{outline-color:#475569}.drop-shadow-md{--tw-drop-shadow: drop-shadow(0 4px 3px rgb(0 0 0 / .07)) drop-shadow(0 2px 2px rgb(0 0 0 / .06));filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.hover\\:bg-gray-400:hover{--tw-bg-opacity: 1;background-color:rgb(156 163 175 / var(--tw-bg-opacity))}.hover\\:bg-gray-500:hover{--tw-bg-opacity: 1;background-color:rgb(107 114 128 / var(--tw-bg-opacity))}.hover\\:bg-slate-200:hover{--tw-bg-opacity: 1;background-color:rgb(226 232 240 / var(--tw-bg-opacity))}
`,document.head.appendChild(__vite_style__);const NAME=Symbol("name"),LENGTH=Symbol("length"),MIN=Symbol("min"),MAX=Symbol("max"),QUERYABLE=Symbol("queryable"),PARENTVALUES=Symbol("parentValues"),metaProps={name:NAME,length:LENGTH,min:MIN,max:MAX,queryable:QUERYABLE,parent:PARENTVALUES};var Meta;(e=>{function t(p,d,u){const x=u??Object.keys(metaProps);for(const b of x)d[metaProps[b]]=p[metaProps[b]]}e.copy=t;function n(p,d){return!!p[metaProps[d]]}e.has=n;function o(p){return!!p[NAME]}e.hasName=o;function c(p){return p[NAME]??"unknown"}e.getName=c;function r(p,d){p[NAME]=d}e.setName=r;function h(p,d){d[NAME]=p[NAME]}e.copyName=h;function s(p){return isArray(p)?p.length:p[LENGTH]}e.getLength=s;function m(p,d){p[LENGTH]=d}e.setLength=m;function i(p){return!!p[MIN]&&!!p[MAX]}e.hasMinMax=i;function f(p){return i(p)?[p[MIN],p[MAX]]:void 0}e.getMinMax=f;function l(p,d,u){p[MIN]=d,p[MAX]=u}e.setMinMax=l;function a(p){return p[QUERYABLE]}e.isQueryable=a;function y(p,d){p[QUERYABLE]=d}e.setQueryable=y})(Meta||(Meta={}));var Getter;(e=>{function t(r){if(typeof r=="function")return r;if(isArray(r)){const h=s=>r[s];return Meta.setLength(h,r.length),h}else return()=>r}e.of=t;function n(r){return()=>r}e.constant=n;function o(r,h){const s=e.of(r),m=i=>s(h[i]);return Meta.copy(r,m),Meta.setLength(m,h.length),m}e.proxy=o;function c(r){const h=r.map(e.of),s=m=>h.map(i=>i(m));return Meta.setLength(s,Meta.getLength(r[0])),s}e.multi=c})(Getter||(Getter={}));function identity(e){return e}const just=e=>()=>e,zero=just(0),one=just(1);function inc(e){return e+1}function dec(e){return e-1}function call(e){return e()}function square(e){return e**2}const sqrt=Math.sqrt,log10=Math.log10;function exp10(e){return 10**e}const max=Math.max;function diff(e,t){return e-t}function sum(e,t){return e+t}function prod(e,t){return e*t}function trunc(e,t=0,n=1){return Math.min(Math.max(e,t),n)}function rangeInverse(e,t){return 1/(t-e)}function invertRange(e,t){const n=rangeInverse(e,t);return[-e*n,n-e*n]}function round(e,t=0){return Math.round(e*10**t)/10**t}function compareAlphaNumeric(e,t){return e.localeCompare(t,"en",{numeric:!0})}function capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}function toLowerCase(e){return e.toLocaleLowerCase()}function toUpperCase(e){return e.toLocaleUpperCase()}function stripWS(e){return e.replace(/\s/g,"")}function last(e){return e[e.length-1]}function rep(e,t){return Array(t).fill(e)}function seq(e,t,n){const o=Math.abs(t-e);n=n??Math.ceil(o)+1;const c=o/(n-1),r=t>=e?1:-1;return Array.from(Array(n),(h,s)=>e+r*c*s)}function subset(e,t){const n=Array(t.length);for(let o=0;o<t.length;o++)n[o]=e[t[o]];return n}function remove(e,t){e.splice(e.indexOf(t),1)}function ordered(e,t){const n=Array(t.length);for(let o=0;o<t.length;o++)n[t[o]]=e[o];return n}function orderIndices(e){const t=e.toSorted(diff),n={},o={};for(let c=0;c<t.length;c++){const r=e[c];o[r]=o[r]+1||0,n[c]=t.indexOf(r)+o[r]}return Object.values(n)}function orderBy(e,t){const n=Array(e.length);for(let o=0;o<e.length;o++)n[o]=e[t[o]];for(let o=0;o<e.length;o++)e[o]=n[o]}function orderIndicesByTable(e,t){const n=Array(e.length);for(let o=0;o<e.length;o++)n[o]=t.indexOf(e[o]);return n}function minmax(e){let[t,n]=[1/0,-1/0];for(let o=0;o<e.length;o++)t=Math.min(t,e[o]),n=Math.max(n,e[o]);return[t,n]}function cumsum(e){const t=Array(e.length);t[0]=e[0];for(let n=1;n<e.length;n++)t[n]=e[n]+t[n-1];return t}function randomInteger(e,t){return Math.floor(e+Math.random()*t)}function uniqueIntegers(e,t,n=t-e){const o=t-e,c=[],r=new Set;for(;c.length<Math.min(n,o);){let h=randomInteger(e,t);for(;r.has(h);)h=randomInteger(e,t);c.push(h),r.add(h)}return c}async function fetchJSON(e){return await(await fetch(e)).json()}function merge(e,t){return{...e,...t}}function copyValues(e,t){if(e!==t){t.length=0;for(let n=0;n<e.length;n++)t.push(e[n])}}function copyProps(e,t){for(const[n,o]of Object.entries(e))isArray(o)&&isArray(e[n])?copyValues(o,e[n]):t[n]=o}function applyDirection(e,t){return .5*(1-t)+t*e}function prettyBreaks(e,t,n=4){const o=(t-e)/n,c=Math.floor(Math.log10(o)),r=[1,2,4,5,10];let[h,s]=[1/0,0];for(let y=0;y<r.length;y++){const p=(r[y]*10**c-o)**2;p<h&&([h,s]=[p,r[y]])}const m=10**c*s,i=Math.ceil(e/m)*m,f=Math.floor(t/m)*m,l=Math.round((f-i)/m),a=[];for(let y=0;y<l+1;y++){const p=i+y*m;a.push(p)}return a}function binBreaks(e,t){let{width:n,anchor:o,nBins:c}=t||{};const[r,h]=minmax(e),s=h-r;c=c??(n?Math.ceil(s/n)+1:10),n=n??s/(c-1),o=o??r;const m=r-n+(o-r)%n,i=h+n-(h-o)%n,f=Array(c+2);f[0]=m,f[f.length-1]=i;for(let l=1;l<f.length-1;l++)f[l]=m+l*n;return f}function addTailwind(e,t){for(const n of t.split(" "))e.classList.add(n)}function removeTailwind(e,t){for(const n of t.split(" "))e.classList.remove(n)}function throttle(e,t){let n=0;return function(...o){const c=new Date().getTime();c-n<t||(n=c,e(...o))}}function timeExecution(e){const t=performance.now();return e(),performance.now()-t}function makeGetter(e){return typeof e=="function"?e:isArray(e)?t=>e[t]:()=>e}function segmentToPointVec(e){const[t,n,o,c]=e;return[t,n,o-t,c-n]}function inRange(e,t,n){return!(e<t)&&!(e>n)}function segmentsIntersect(e,t){let[n,o,c,r]=segmentToPointVec(e),[h,s,m,i]=segmentToPointVec(t);const f=m*r-c*i,l=((n-h)*r-(o-s)*c)/f,a=-(-(n-h)*i+(o-s)*m)/f;return inRange(l,0,1)&&inRange(a,0,1)}function rectSegmentIntersect(e,t){const[n,o,c,r]=e;return segmentsIntersect([n,o,c,o],t)||segmentsIntersect([n,o,n,r],t)||segmentsIntersect([c,o,c,r],t)||segmentsIntersect([n,r,c,r],t)}function pointInRect(e,t){const[n,o]=e,[c,r,h,s]=t;return!(n<c||n>h||o<r||o>s)}function rectsIntersect(e,t){const[n,o]=[e[0],e[2]].sort(diff),[c,r]=[e[1],e[3]].sort(diff),[h,s]=[t[0],t[2]].sort(diff),[m,i]=[t[1],t[3]].sort(diff);return!(o<h||n>s||r<m||c>i)}function addIndexed(e,t,n){const c=Object.keys(e).filter(s=>s.replace(/[0-9]*$/,"")===t);if(c.length===0){e[`${t}1`]=n;return}const r=c.map(s=>parseInt(s.match(/[0-9]*$/)[0],10)),h=Math.max(...r);e[`${t}${h+1}`]=n}function minDecimal(e){let t=1/0;for(let n=0;n<e.length;n++)e[n]!==0&&(t=Math.min(t,Math.log10(Math.abs(e[n]))));return t>3?0:Math.floor(Math.abs(t))+2}function formatText(e,t={lowercase:!0,capitalize:!0,split:!0}){return t!=null&&t.split&&(e=e.replace(/_/g," ")),t!=null&&t.lowercase&&(e=e.toLocaleLowerCase()),t!=null&&t.capitalize&&(e=capitalize(e)),e}function formatLabel(e){if(typeof e=="string")return e;if(e===0)return e.toString();const t=Math.floor(Math.log10(Math.abs(e)));return t>=3?round(e).toString():t<=-3?round(e,-t+1).toString():round(e,2).toString()}function formatAxisLabels(e,t){if(!isNumberArray(e))return e;const n=(t==null?void 0:t.tens)??4,o=s=>s!=0&&Math.abs(Math.log10(s))>n,c=(t==null?void 0:t.decimals)??minDecimal(e);e=e.map(s=>round(s,c));const h=minmax(e).some(o)?superscriptFn:noSuperscriptFn;return e.map(h)}function superscriptFn(e){return e===0?"0":exponentialToSuperscript(e.toExponential())}function noSuperscriptFn(e){return e===0?"0":parseFloat(e.toPrecision(12)).toString()}function exponentialToSuperscript(e){let[t,n]=e.split("e");return n=convertToSuperscript(n),t+"×10"+n}const sups={"-":"⁻","+":"",0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹"};function convertToSuperscript(e){return e.split("").map(t=>sups[t]).join("")}const primitives=["string","number","boolean","undefined"];function isPrimitive(e){return e===null||primitives.includes(typeof e)}const isArray=Array.isArray;function isNumber(e){return typeof e=="number"}function isIntegerString(e){return/^[0-9]+/.test(e)}function isNumberArray(e){return typeof e[0]=="number"&&typeof last(e)=="number"}function isStringArray(e){return typeof e[0]=="string"&&typeof last(e)=="string"}function findLength(e){for(const n of e){if(!n)continue;const o=Meta.getLength(n);if(o)return o}const t="At least one variable needs to be of fixed length";throw new Error(t)}function applyWith(...e){return function(t){return t(...e)}}function row(e,t){const n={};for(const[o,c]of Object.entries(e))n[o]=Getter.of(c)(t);return n}function selector(e){return function(t){return t[e]}}function keysToSelectors(e){return function(t){return e.map(n=>t[n])}}function splitNumericSuffix(e){let t=e.length-1;for(;t>0&&/[0-9]/.test(e[t]);)t--;return t+=1,[e.substring(0,t),e.substring(t,e.length)]}function filterIndices(e,t){const n=[];for(let o=0;o<e.length;o++)t(e[o])&&n.push(o);return n}function stringArraysMatch(e,t){if(e.length!==t.length)return!1;const n=e.toSorted(compareAlphaNumeric).join(""),o=t.toSorted(compareAlphaNumeric).join("");return n===o}function clearNodeChildren(e){e.innerHTML=""}var Direction=(e=>(e[e.Forwards=1]="Forwards",e[e.Backwards=-1]="Backwards",e))(Direction||{}),VAnchor=(e=>(e[e.Middle=.5]="Middle",e[e.Top=1]="Top",e[e.Bottom=0]="Bottom",e))(VAnchor||{}),HAnchor=(e=>(e[e.Center=.5]="Center",e[e.Left=1]="Left",e[e.Right=0]="Right",e))(HAnchor||{}),MouseButton=(e=>(e[e.Left=0]="Left",e[e.Right=2]="Right",e))(MouseButton||{});const dataLayers=[0,1,2,3,4,5,6,7],baseLayers=[4,5,6,7];var Frame;(e=>{function t(u,x){if(!isCanvas(u))throw new Error("Node must be a HTML5 canvas element");const b=u.getContext("2d"),{clientWidth:v,clientHeight:S,clientLeft:M,clientTop:R}=u,g=v-M,w=S-R;return{canvas:u,context:b,width:g,height:w,margins:[0,0,0,0],scalingFactor:2,contextProps:{},options:x}}e.of=t;function n(u,x){x.appendChild(u.canvas),u.parent=x}e.append=n;function o(u,x){for(const[b,v]of Object.entries(x))u.contextProps[b]=v,u.context[b]=v}e.setContext=o;function c(u){const{context:x,canvas:b,scalingFactor:v}=u,{clientWidth:S,clientHeight:M,clientLeft:R,clientTop:g}=b,w=S-R,A=M-g;u.width=w,u.height=A,u.canvas.width=w*v,u.canvas.height=A*v;for(const[P,z]of Object.entries(u.contextProps))u.context[P]=z;x.scale(v,v),e.clip(u)}e.resize=c;function r(u){const{context:x}=u;let{width:b,height:v}=u;const[S,M,R,g]=u.margins;b=Math.max(b-M-g,0),v=Math.max(v-R-S,0),x.beginPath(),x.rect(M,R,b,v),x.clip()}e.clip=r;function h(u){u.context.clearRect(0,0,u.width,u.height)}e.clear=h;function s(u,x){u.context.globalAlpha=x(u.context.globalAlpha)}e.setAlpha=s;function m(u){u.context.globalAlpha=1}e.resetAlpha=m;function i(u,x){return u.context.measureText(x).width}e.textWidth=i;function f(u,x){const b=u.context.measureText(x);return b.actualBoundingBoxAscent+b.actualBoundingBoxDescent}e.textHeight=f;function l(u,x,b,v){const{context:S}=u,M=u.canvas.clientHeight,R=(v==null?void 0:v.radius)??u.options.size,g=(v==null?void 0:v.hAnchor)??HAnchor.Center,w=(v==null?void 0:v.vAnchor)??VAnchor.Middle;x=x+2*(g-.5)*R,b=M-b+2*(.5-w)*R,S.beginPath(),S.arc(x,b,R,0,Math.PI*2),S.fill()}e.point=l;function a(u,x,b,v,S){const{context:M,height:R}=u;M.fillRect(x,R-b,v-x,b-S)}e.rectangleXY=a;function y(u,x,b,v,S,M){const{context:R,height:g}=u,w=(M==null?void 0:M.hAnchor)??HAnchor.Center,A=(M==null?void 0:M.vAnchor)??VAnchor.Middle;x=x-w*v,b=g-b+A*S,R.fillRect(x,b,v,-S)}e.rectangleWH=y;function p(u,x,b){const{context:v,height:S}=u;v.beginPath(),v.moveTo(x[0],S-b[0]);for(let M=0;M<x.length;M++)v.lineTo(x[M],S-b[M]);v.stroke()}e.line=p;function d(u,x,b,v,S){const{context:M,height:R}=u;M.save(),M.translate(x,R-b),S!=null&&S.vertical&&M.rotate(-Math.PI/2),M.fillText(v,0,0),M.translate(-x,-(R-b)),M.restore()}e.text=d})(Frame||(Frame={}));function isCanvas(e){return e.nodeName==="CANVAS"}const LISTENERS=Symbol("listeners"),DEFERRED=Symbol("deferred");var Reactive;(e=>{function t(a){const y={},p={};return{...a,[LISTENERS]:y,[DEFERRED]:p}}e.of=t,e.listen=f(),e.dispatch=l();function n(a){return a[LISTENERS]}e.getListeners=n;function o(a){return a[DEFERRED]}e.getDeferred=o;function c(a,y,p){const d=()=>e.dispatch(y,"changed");e.listen(a,"changed",d,p)}e.propagateChange=c;function r(a){return a[LISTENERS]!==void 0}e.isReactive=r;function h(a,y){y(a),e.dispatch(a,"changed")}e.set=h;function s(a,y,p){if(!r(a))return;const[d,u]=[n(a)[y],o(a)[y]];remove(d,p),remove(u,p)}e.removeListener=s;function m(a,y){if(!r(a))return;const[p,d]=[n(a)[y],o(a)[y]];if(p)for(const u of p)remove(p,u);if(d)for(const u of d)remove(d,u)}e.removeListeners=m;function i(a){if(!r(a))return;const[y,p]=[n(a),o(a)];if(y)for(const d of Object.values(y))d.length=0;if(p)for(const d of Object.values(p))d.length=0}e.removeAllListeners=i;function f(){return function(a,y,p,d){if(!r(a))return;d!=null&&d.throttle&&(p=throttle(p,d.throttle));const x=!!(d!=null&&d.deferred)?o(a):n(a);x[y]||(x[y]=[]),x[y].includes(p)||x[y].push(p)}}e.makeListenFn=f;function l(){return function(a,y,p){if(!r(a))return;const[d,u]=[n(a)[y],o(a)[y]];if(d)for(const x of d)x(p);if(u)for(const x of u)x(p)}}e.makeDispatchFn=l})(Reactive||(Reactive={}));var ExpanseBand;(e=>{function t(l=[],a){const y="",p="band",d=exports.Expanse.base(a),{zero:u,one:x,direction:b}=d,v=Array.from(Array(l.length),(w,A)=>A),S=(a==null?void 0:a.weights)??Array(l.length).fill(1),M=cumsum(S),R=!1,g={ordered:R,labels:[...l],order:[...v],weights:[...S],cumulativeWeights:[...M],zero:u,one:x,direction:b};return{value:y,type:p,ordered:R,labels:l,order:v,weights:S,cumulativeWeights:M,...d,defaults:g}}e.of=t;function n(l,a){const{order:y,cumulativeWeights:p}=l;a=y[a];const d=p[a-1]??0,u=p[a],x=last(p);return(d+u)/2/x}function o(l,a){if(a=a??Array(l.labels.length).fill(1),a.length!=l.labels.length){const d="The length of the weights must match the length of labels";throw new Error(d)}const{order:y}=l,p=cumsum(ordered(a,y));copyValues(a,l.weights),copyValues(a,l.defaults.weights),copyValues(p,l.cumulativeWeights),copyValues(p,l.defaults.cumulativeWeights),exports.Expanse.dispatch(l,"changed")}e.setWeights=o;function c(l,a){const{labels:y,zero:p,one:d,direction:u}=l,x=y.indexOf(a);if(x===-1)throw new Error(`Label ${a} not found in: ${y}`);const b=n(l,x),v=p+b*(d-p);return applyDirection(v,u)}e.normalize=c;function r(l,a){const{labels:y,zero:p,one:d,direction:u}=l;a=applyDirection(a,u);const x=(a-p)/(d-p),b=Math.round((2*x*y.length-1)/2);return y[b]}e.unnormalize=r;function h(l,a,y){const{order:p}=l,d=Array.from(new Set(a)).sort(compareAlphaNumeric);if(!p.length){for(let v=0;v<d.length;v++)p[v]=v;l.defaults.order=[...p],l.ordered=!1}const u=Array(d.length).fill(1),x=cumsum(ordered(u,p)),b={labels:d,weights:u,cumulativeWeights:x};for(const[v,S]of Object.entries(b))isArray(l[v])&&copyValues(S,l[v]),y!=null&&y.default&&copyValues(S,l.defaults[v])}e.train=h;function s(l,a){const{order:y,weights:p,cumulativeWeights:d,defaults:u}=l;if(!a){copyValues(u.order,y),copyValues(cumsum(ordered(p,y)),d),l.ordered=!1,exports.Expanse.dispatch(l,"changed");return}copyValues(a,y),copyValues(cumsum(ordered(p,a)),d),l.ordered=!0,exports.Expanse.dispatch(l,"changed")}e.reorder=s;function m(l){return ordered(l.labels,l.order)}e.breaks=m;function i(){return!1}e.isContinuous=i;function f(){return!0}e.isDiscrete=f})(ExpanseBand||(ExpanseBand={}));var ExpanseContinuous;(e=>{function t(s=0,m=1,i){const l="continuous",a=exports.Expanse.base(i),[y,p]=[identity,identity],d=(i==null?void 0:i.scale)??1,u=(i==null?void 0:i.mult)??1,x=(i==null?void 0:i.offset)??0,b=(i==null?void 0:i.ratio)??!1,v={min:s,max:m,scale:d,mult:u,...a,offset:x,trans:y,inv:p};return{value:0,type:l,min:s,max:m,scale:d,mult:u,offset:x,ratio:b,...a,trans:y,inv:p,defaults:v}}e.of=t;function n(s,m){const{min:i,max:f,zero:l,one:a}=s,{direction:y,scale:p,mult:d,offset:u,trans:x}=s;m=m/(p*d)-u;const b=x(f)-x(i);let v=(x(m-u)-x(i))/b;return v=l+v*(a-l),applyDirection(v,y)}e.normalize=n;function o(s,m){const{min:i,max:f,zero:l,one:a}=s,{scale:y,mult:p,offset:d,trans:u,inv:x}=s,b=(m-l)/(a-l),v=u(f)-u(i);return x(u(i)+b*v)*(y*p)+d}e.unnormalize=o;function c(s){const{min:m,max:i}=s;return i-m}e.range=c;function r(s,m,i){let[f,l]=Meta.getMinMax(m)??minmax(m);f=s.ratio||i!=null&&i.ratio?0:f,exports.Expanse.set(s,a=>(a.min=f,a.max=l),i)}e.train=r;function h(s,m=4){const[i,f]=[0,1].map(a=>e.unnormalize(s,a)).sort(diff);return prettyBreaks(i,f,m)}e.breaks=h})(ExpanseContinuous||(ExpanseContinuous={}));var ExpanseCompound;(e=>{function t(s=[],m){const i=[],f="compound",l=exports.Expanse.continuous(0,1,m),{zero:a,one:y,direction:p}=l,d={zero:a,one:y,direction:p};for(const x of s)Object.assign(x,{zero:a,one:y,direction:p}),Object.assign(x.defaults,{zero:a,one:y,direction:p});const u={expanses:s,...l,value:i,type:f,defaults:d};return exports.Expanse.listen(u,"changed",()=>{const{zero:x,one:b,direction:v}=u;for(const S of s)Object.assign(S,{zero:x,one:b,direction:v}),Object.assign(S.defaults,{zero:x,one:b,direction:v})}),u}e.of=t;function n(s,m){const{expanses:i}=s;return m.map((f,l)=>exports.Expanse.normalize(i[l],f))}e.normalize=n;function o(s,m){const{expanses:i}=s;return m.map((f,l)=>exports.Expanse.unnormalize(i[l],f))}e.unnormalize=o;function c(s,m){const{expanses:i}=s;if(m.length!=i.length){const f="The number of arrays does not match the number of expanses.";throw new Error(f)}for(let f=0;f<m.length;f++)exports.Expanse.train(i[f],m[f])}e.train=c;function r(s){return ExpanseContinuous.breaks(s)}e.breaks=r;function h(s){for(const m of s.expanses)exports.Expanse.restoreDefaults(m)}e.restoreDefaults=h})(ExpanseCompound||(ExpanseCompound={}));var ExpansePoint;(e=>{function t(s=[],m){const i="",f="point",l=exports.Expanse.base(m),{zero:a,one:y,direction:p}=l,d=Array.from(Array(s.length),(b,v)=>v),u=!1,x={ordered:u,labels:[...s],order:[...d],zero:a,one:y,direction:p};return{value:i,type:f,ordered:u,labels:s,order:d,...l,defaults:x}}e.of=t;function n(s,m){const{labels:i,order:f,zero:l,one:a,direction:y}=s,p=f[i.indexOf(m)];if(p===-1)return p;const d=l+p/(i.length-1)*(a-l);return applyDirection(d,y)}e.normalize=n;function o(s,m){const{labels:i,order:f,zero:l,one:a,direction:y}=s;m=applyDirection(m,y);const p=(m-l)/(a-l),d=Math.round(p*(i.length-1));return i[f[d]]}e.unnormalize=o;function c(s,m,i){const{order:f}=s,l=Array.from(new Set(m)).sort(compareAlphaNumeric);if(!f.length){for(let a=0;a<l.length;a++)f[a]=a;s.defaults.order=[...f],s.ordered=!1}copyValues(l,s.labels),i!=null&&i.default&&copyValues(l,s.defaults.labels)}e.train=c;function r(s,m){const{order:i,defaults:f}=s;if(!m){copyValues(f.order,i),s.ordered=!1,exports.Expanse.dispatch(s,"changed");return}copyValues(m,i),s.ordered=!0,exports.Expanse.dispatch(s,"changed")}e.reorder=r;function h(s){return ordered(s.labels,s.order)}e.breaks=h})(ExpansePoint||(ExpansePoint={}));var ExpanseSplit;(e=>{function t(h){const s=[],m="split",i=h.type;return{...h,value:s,type:m,innerType:i}}e.of=t;function n(h,s){return isArray(s)?s.map(m=>exports.Expanse.methods[h.innerType].normalize(h,m)):exports.Expanse.methods[h.innerType].normalize(h,s)}e.normalize=n;function o(h,s){return isArray(s)?s.map(m=>exports.Expanse.methods[h.innerType].unnormalize(h,m)):exports.Expanse.methods[h.innerType].unnormalize(h,s)}e.unnormalize=o;function c(h,s){exports.Expanse.methods[h.innerType].train(h,s)}e.train=c;function r(h){return exports.Expanse.methods[h.innerType].breaks(h)}e.breaks=r})(ExpanseSplit||(ExpanseSplit={})),exports.Expanse=void 0,(e=>{e.methods={continuous:ExpanseContinuous,point:ExpansePoint,band:ExpanseBand,compound:ExpanseCompound,split:ExpanseSplit},e.continuous=ExpanseContinuous.of,e.point=ExpansePoint.of,e.band=ExpanseBand.of,e.compound=ExpanseCompound.of,e.split=ExpanseSplit.of;function t(g){const w=(g==null?void 0:g.zero)??0,A=(g==null?void 0:g.one)??1,P=(g==null?void 0:g.direction)??Direction.Forwards,z=[],T=[];return Reactive.of({zero:w,one:A,direction:P,frozen:z,linked:T})}e.base=t;function n(g,w,A){const{linked:P,frozen:z}=g,T={...g};w(T);for(const L of z)delete T[L];for(const L of Object.keys(T))T[L]===g[L]&&delete T[L];copyProps(T,g);for(const L of P)e.set(L,w);A!=null&&A.default&&copyProps(T,g.defaults),A!=null&&A.silent||e.dispatch(g,"changed")}e.set=n;function o(g,w={train:!0}){const A=isNumberArray(g)?e.continuous():e.point();return w.train&&e.train(A,g),A}e.infer=o;function c(g,w){for(const A of w)g.frozen.includes(A)||g.frozen.push(A)}e.freeze=c;function r(g,w){g.linked.includes(w)||g.linked.push(w)}e.linkTo=r;function h(g){const{defaults:w}=g;for(const[A,P]of Object.entries(w))isArray(P)&&isArray(g[A])?copyValues(P,g[A]):g[A]=P;e.dispatch(g,"changed")}e.restoreDefaults=h,e.dispatch=Reactive.makeDispatchFn(),e.listen=Reactive.makeListenFn();function s(g,w){return e.methods[g.type].normalize(g,w)}e.normalize=s;function m(g,w){return e.methods[g.type].unnormalize(g,w)}e.unnormalize=m;function i(g,w,A){return e.methods[g.type].train(g,w,A)}e.train=i;function f(g){return e.methods[g.type].breaks(g)}e.breaks=f;function l(g,w){const{direction:A}=g,P=w;e.set(g,z=>(z.zero+=A*P,z.one+=A*P))}e.move=l;function a(g,w,A,P){const{zero:z,one:T,direction:L}=g,O=T-z;L===Direction.Backwards&&([w,A]=[1-w,1-A]);let[G,k]=[w,A].map(E=>(E-z)/O);[G,k]=invertRange(G,k),L===Direction.Backwards&&([G,k]=[1-G,1-k]),e.set(g,E=>(E.zero=G,E.one=k),P)}e.expand=a;function y(g){e.set(g,w=>w.direction*=-1)}e.flip=y;function p(g,w){if(!v(g))throw new Error("Expanse must be discrete");e.methods[g.type].reorder(g,w)}e.reorder=p;function d(g){return g.one-g.zero}e.unitRange=d;function u(g){if(!x(g))throw new Error("Can only compute range on a continuous expanse");return ExpanseContinuous.range(g)}e.range=u;function x(g){return g.type==="continuous"||g.type==="split"}e.isContinuous=x;function b(g){return g.type==="point"}e.isPoint=b;function v(g){return g.type==="point"||g.type==="band"}e.isDiscrete=v;function S(g){return g.type==="band"}e.isBand=S;function M(g){return g.type==="compound"}e.isCompound=M;function R(g){return g.type==="split"}e.isSplit=R})(exports.Expanse||(exports.Expanse={})),exports.Scale=void 0,(e=>{function t(d,u){const x=Reactive.of({domain:d,codomain:u});return exports.Expanse.listen(d,"changed",()=>e.dispatch(x,"changed")),exports.Expanse.listen(u,"changed",()=>e.dispatch(x,"changed")),x}e.of=t,e.dispatch=Reactive.makeDispatchFn(),e.listen=Reactive.makeListenFn();function n(d,u){d.domain=u,exports.Expanse.listen(u,"changed",()=>e.dispatch(d,"changed"))}e.setDomain=n;function o(d,u){d.codomain=u,exports.Expanse.listen(u,"changed",()=>e.dispatch(d,"changed"))}e.setCoomain=o;function c(d,u){const{domain:x,codomain:b}=d;return exports.Expanse.unnormalize(b,exports.Expanse.normalize(x,u))}e.pushforward=c;function r(d,u){const{domain:x,codomain:b}=d;return exports.Expanse.unnormalize(x,exports.Expanse.normalize(b,u))}e.pullback=r;function h(d,u,x,b){exports.Expanse.expand(d.domain,u,x,b)}e.expand=h;function s(d,u,x){if(((x==null?void 0:x.name)??!0)&&Meta.hasName(u)&&Meta.copy(u,d),typeof u[0]=="string"&&exports.Expanse.isContinuous(d.domain)){const v=Array.from(new Set(u));d.domain=exports.Expanse.band(v)}exports.Expanse.train(d.domain,u,x)}e.train=s;function m(d){exports.Expanse.restoreDefaults(d.domain),exports.Expanse.restoreDefaults(d.codomain)}e.restoreDefaults=m;function i(d){const u=exports.Expanse.breaks(d.domain);let x=formatAxisLabels(u);if(exports.Expanse.isCompound(d.domain)){x=formatAxisLabels(u,{decimals:1});const v=u.map(S=>exports.Expanse.unnormalize(d.codomain,ExpanseContinuous.normalize(d.domain,S)));return{labels:x,positions:v}}else if(exports.Expanse.isSplit(d.codomain)){const v=e.pushforward(d,u);return{labels:x,positions:v}}const b=u.map(v=>e.pushforward(d,v));return{labels:x,positions:b}}e.breaks=i;function f(d,u){exports.Expanse.move(d.domain,u)}e.move=f;function l(d,u){u.codomain=d.codomain}e.shareCodomain=l;function a(d){return exports.Expanse.range(d.domain)/exports.Expanse.unitRange(d.domain)}e.domainRange=a;function y(d){return exports.Expanse.range(d.codomain)*exports.Expanse.unitRange(d.codomain)}e.codomainRange=y;function p(d){const{domain:u,codomain:x}=d;if([u,x].map(exports.Expanse.isContinuous).includes(!1))throw new Error("Both domain and codomain need to be continuous");const b=exports.Expanse.range(u);return exports.Expanse.range(x)*exports.Expanse.unitRange(x)/b}e.unitRatio=p})(exports.Scale||(exports.Scale={}));const POSITIONS=Symbol("positions");exports.Factor=void 0,(e=>{(i=>{i[i.Constant=0]="Constant",i[i.Bijection=1]="Bijection",i[i.Surjection=2]="Surjection"})(e.Type||(e.Type={}));function t(i,f,l,a){return Reactive.of({type:i,cardinality:f,indices:l,data:a})}e.of=t,e.listen=Reactive.makeListenFn(),e.dispatch=Reactive.makeDispatchFn();function n(i,f){f.cardinality=i.cardinality,copyValues(i.indices,f.indices);for(const l of Reflect.ownKeys(i.data))isArray(i.data[l])&&isArray(f.data[l])?(copyValues(i.data[l],f.data[l]),Meta.copy(i.data[l],f.data[l])):f.data[l]=i.data[l]}e.copyFrom=n;function o(i){const l=[],a=d=>[d],p={...i,[POSITIONS]:a};return t(1,1/0,l,p)}e.bijection=o;function c(i){const l=Array(i).fill(0),a=()=>l,y=0,p={[POSITIONS]:a};return t(y,1,l,p)}e.mono=c;function r(i,f){const l=i.map(u=>u.toString());f=f??Array.from(new Set(l)).sort(compareAlphaNumeric),Meta.hasName(i)&&Meta.copy(i,f);const a=[],y={};for(let u=0;u<l.length;u++){const x=f.indexOf(l[u]);y[x]||(y[x]=[]),a.push(x),y[x].push(u)}const p=2,d={label:f,[POSITIONS]:Object.values(y)};return t(p,f.length,a,d)}e.from=r;function h(i,f){function l(){const y=(f==null?void 0:f.breaks)??binBreaks(i,f),p=new Set,d=[],u={};for(let w=0;w<i.length;w++){const A=y.findIndex(P=>P>=i[w])-1;u[A]||(u[A]=[]),d.push(A),u[A].push(w),p.add(A)}const x=Array.from(p).sort(diff);for(let w=0;w<d.length;w++)d[w]=x.indexOf(d[w]);const[b,v]=[[],[]];for(let w=0;w<x.length;w++)b.push(y[x[w]]),v.push(y[x[w]+1]);const[S,M]=[y[x[0]],y[last(x)+1]];Meta.setMinMax(b,S,M),Meta.setMinMax(v,S,M),Meta.setName(b,`min of ${Meta.getName(i)}`),Meta.setName(v,`max of ${Meta.getName(i)}`),Meta.setName(y,Meta.getName(i));const R=2,g={binMin:b,binMax:v,breaks:y,[POSITIONS]:Object.values(u)};return t(R,x.length,d,g)}const a=l();return f&&Reactive.isReactive(f)&&Reactive.listen(f,"changed",()=>{const y=l();e.copyFrom(y,a),e.dispatch(a,"changed")}),a}e.bin=h;function s(i,f){function l(){if(i.type===1){const z={};for(const k of Reflect.ownKeys(i.data))z[k]=Getter.of(i.data[k]);for(const k of Reflect.ownKeys(f.data))z[k]=Getter.proxy(f.data[k],f.indices);const T=1,L=f.indices.length,G=t(T,L,[],z);return G.parent=i,G}if(i.type===0){const{type:z,data:T,cardinality:L,indices:O}=f,G=t(z,L,O,T);return G.parent=i,G}const y=Math.max(i.cardinality,f.cardinality)+1,p=new Set,d=[],u={},x={},b={},v=makeGetter(i.indices),S=makeGetter(f.indices);for(let z=0;z<i.indices.length;z++){const[T,L]=[v(z),S(z)],O=y*T+L;O in x||(x[O]=T,b[O]=L,u[O]=[]),d.push(O),u[O].push(z),p.add(O)}const M=Array.from(p).sort(diff);for(let z=0;z<d.length;z++)d[z]=M.indexOf(d[z]);const R=Object.values(x),g=Object.values(b),w={};for(let z of Reflect.ownKeys(i.data)){let T=z;if(typeof z=="string")for(;T in w;)z+="$";const[L,O]=[i.data[z],R],G=isArray(L)?subset(L,O):Getter.proxy(L,O);Meta.copy(L,G),w[T]=G}for(let z of Reflect.ownKeys(f.data)){let T=z;if(typeof z=="string")for(;T in w;)T+="$";const[L,O]=[f.data[z],g],G=isArray(L)?subset(L,O):Getter.proxy(L,O);Meta.copy(L,G),w[T]=G}const A=2;w[POSITIONS]=Object.values(u);const P=t(A,M.length,d,w);return P.parent=i,P}const a=l();return e.listen(i,"changed",()=>{const y=l();e.copyFrom(y,a)}),e.listen(f,"changed",()=>{const y=l();e.copyFrom(y,a)}),Reactive.propagateChange(i,a,{deferred:!0}),Reactive.propagateChange(f,a,{deferred:!0}),a}e.product=s;function m(i,f){const l={};for(let a=0;a<f.indices.length&&(l[f.indices[a]]=i.indices[a],!(Object.keys(l).length>=f.cardinality));a++);return Object.values(l)}e.parentIndices=m})(exports.Factor||(exports.Factor={}));const Transient=255;var Group=(e=>(e[e.Base=7]="Base",e[e.First=6]="First",e[e.Second=5]="Second",e[e.Third=4]="Third",e[e.BaseTransient=3]="BaseTransient",e[e.FirstTransient=2]="FirstTransient",e[e.SecondTransient=1]="SecondTransient",e[e.ThirdTransient=0]="ThirdTransient",e))(Group||{}),Marker;(e=>{function t(f){const l=Transient,a=Array(f).fill(7),y=[],p=exports.Factor.Type.Surjection,d=exports.Factor.of(p,8,a,{[LAYER]:[0,1,2,3,4,5,6,7]}),u=Reactive.of({group:l,indices:a,transientIndices:y,factor:d});return e.listen(u,"updated",()=>exports.Factor.dispatch(d,"changed")),e.listen(u,"cleared",()=>exports.Factor.dispatch(d,"changed")),u}e.of=t,e.listen=Reactive.makeListenFn(),e.dispatch=Reactive.makeDispatchFn();function n(f,l){f.group=l}e.setGroup=n;function o(f,l,a){const y=(a==null?void 0:a.group)??f.group;if(r(f,{silent:!0}),y===Transient){for(let p=0;p<l.length;p++){const d=l[p];f.indices[d]=m(f.indices[d])}f.transientIndices=l}else for(let p=0;p<l.length;p++){const d=l[p];f.indices[d]=y}a!=null&&a.silent||e.dispatch(f,"updated")}e.update=o;function c(f,l){for(let a=0;a<f.indices.length;a++)f.indices[a]=7;l!=null&&l.silent||e.dispatch(f,"cleared")}e.clearAll=c;function r(f,l){for(let a=0;a<f.transientIndices.length;a++){const y=f.transientIndices[a];f.indices[y]=i(f.indices[y])}l!=null&&l.silent||e.dispatch(f,"cleared")}e.clearTransient=r;function h(f){const{factor:l,indices:a}=f;return y=>l.data[LAYER][a[y]]}e.getLayer=h;function s(f){return!(f&4)}e.isTransient=s;function m(f){return f&-5}function i(f){return f|4}})(Marker||(Marker={}));const LAYER=Symbol("layer");var Bars;(e=>{function t(r){const h={},s=[],m=Geom.Type.Bars,i=(r==null?void 0:r.vAnchor)??VAnchor.Bottom,f=(r==null?void 0:r.hAnchor)??HAnchor.Center,l=(r==null?void 0:r.postfn)??identity;return{type:m,data:s,scales:h,postfn:l,vAnchor:i,hAnchor:f}}e.of=t;function n(r,h){const{scales:s,postfn:m,hAnchor:i,vAnchor:f}=r,l=Geom.groupedData(r),a=findLength(Object.values(l)),y=["x","y","width","height",LAYER],[p,d,u,x,b]=Geom.getters(l,y);for(let v=0;v<a;v++){let S=exports.Scale.pushforward(s.x,p(v)),M=exports.Scale.pushforward(s.y,d(v)),R=exports.Scale.pushforward(s.width,u(v)),g=exports.Scale.pushforward(s.height,x(v));const w=h[b(v)],A=[S,M,R,g];m(A),Frame.rectangleWH(w,...A,{hAnchor:i,vAnchor:f})}}e.render=n;function o(r,h){const{scales:s,postfn:m,hAnchor:i,vAnchor:f}=r,l=Geom.flatData(r),a=findLength(Object.values(l)),y=["x","y","width","height",POSITIONS],[p,d,u,x,b]=Geom.getters(l,y),v=[];for(let S=0;S<a;S++){let M=exports.Scale.pushforward(s.x,p(S)),R=exports.Scale.pushforward(s.y,d(S)),g=exports.Scale.pushforward(s.width,u(S)),w=exports.Scale.pushforward(s.height,x(S));const A=[M,R,g,w];m(A),[M,R,g,w]=A;const P=[M-g*i,R-w*f,M+g*i,R+w*(1-f)];if(rectsIntersect(h,P)){const z=b(S);for(let T=0;T<z.length;T++)v.push(z[T])}}return v}e.check=o;function c(r,h){const{scales:s,postfn:m,hAnchor:i,vAnchor:f}=r,l=Geom.flatData(r),a=findLength(Object.values(l)),y=["x","y","width","height"],[p,d,u,x]=Geom.getters(l,y);for(let b=0;b<a;b++){let v=exports.Scale.pushforward(s.x,p(b)),S=exports.Scale.pushforward(s.y,d(b)),M=exports.Scale.pushforward(s.width,u(b)),R=exports.Scale.pushforward(s.height,x(b));const g=[v,S,M,R];m(g),[v,S,M,R]=g;const w=[v-M*i,S-R*f,v+M*i,S+R*(1-f)];if(pointInRect(h,w)){const A={};Meta.hasName(l.x)&&(A[Meta.getName(l.x)]=p(b)),Meta.hasName(l.y)&&(A[Meta.getName(l.y)]=d(b)),Meta.hasName(l.height)&&(A[Meta.getName(l.height)]=x(b));for(const[P,z]of Object.entries(l))["x","y","width","height"].includes(P)||z&&Meta.hasName(z)&&(A[Meta.getName(z)]=Geom.getter(z)(b));return A}}}e.query=c})(Bars||(Bars={}));var Lines;(e=>{function t(){const r={},h=[];return{type:Geom.Type.Lines,data:h,scales:r}}e.of=t;function n(r,h){const{scales:s}=r,m=Geom.groupedData(r),i=findLength(Object.values(m)),f=["x","y",LAYER],[l,a,y]=Geom.getters(m,f);for(let p=0;p<i;p++){const d=exports.Scale.pushforward(s.x,l(p)),u=exports.Scale.pushforward(s.y,a(p)),x=h[y(p)];Frame.line(x,d,u)}}e.render=n;function o(r,h){const{scales:s}=r,m=Geom.flatData(r),i=findLength(Object.values(m)),f=["x","y",POSITIONS],[l,a,y]=Geom.getters(m,f),p=[];for(let d=0;d<i;d++){const u=exports.Scale.pushforward(s.x,l(d)),x=exports.Scale.pushforward(s.y,a(d));for(let b=1;b<u.length;b++){const v=[u[b-1],x[b-1],u[b],x[b]];if(rectSegmentIntersect(h,v)){const S=y(d);for(let M=0;M<S.length;M++)p.push(S[M])}}}return p}e.check=o;function c(r,h){let{scales:s}=r;const m=Geom.flatData(r),i=findLength(Object.values(m)),f=["x","y",POSITIONS],[l,a]=Geom.getters(m,f),y=[h[0]-1,h[1]-1,h[0]+1,h[1]+1];for(let p=0;p<i;p++){const d=exports.Scale.pushforward(s.x,l(p)),u=exports.Scale.pushforward(s.y,a(p));for(let x=1;x<d.length;x++){const b=[d[x-1],u[x-1],d[x],u[x]];if(rectSegmentIntersect(y,b)){const v={},[S,M]=[l(p),a(p)];for(let R=0;R<S.length;R++)v[S[R]]=M[R];for(const[R,g]of Object.entries(m))R==="x"||R==="y"||g&&Meta.hasName(g)&&(v[Meta.getName(g)]=Geom.getter(g)(p));return v}}}}e.query=c})(Lines||(Lines={}));var Points;(e=>{function t(){const r={},h=[];return{type:Geom.Type.Points,data:h,scales:r}}e.of=t;function n(r,h){const{scales:s}=r,m=Geom.groupedData(r),i=findLength(Object.values(m)),f=["x","y","size",LAYER],[l,a,y,p]=Geom.getters(m,f);for(let d=0;d<i;d++){const u=exports.Scale.pushforward(s.x,l(d)),x=exports.Scale.pushforward(s.y,a(d)),b=exports.Scale.pushforward(s.size,y(d)),v=h[p(d)];Frame.point(v,u,x,{radius:b})}}e.render=n;function o(r,h){const{scales:s}=r,m=Geom.flatData(r),i=findLength(Object.values(m)),f=["x","y","size",POSITIONS],[l,a,y,p]=Geom.getters(m,f),d=[];for(let u=0;u<i;u++){const x=exports.Scale.pushforward(s.x,l(u)),b=exports.Scale.pushforward(s.y,a(u));let v=exports.Scale.pushforward(s.size,y(u));v=v/Math.sqrt(2);const S=[x-v,b-v,x+v,b+v];if(rectsIntersect(h,S)){const M=p(u);for(let R=0;R<M.length;R++)d.push(M[R])}}return d}e.check=o;function c(r,h){const{scales:s}=r,m=Geom.flatData(r),i=findLength(Object.values(m)),f=["x","y","size"],[l,a,y]=Geom.getters(m,f);for(let p=0;p<i;p++){const d=exports.Scale.pushforward(s.x,l(p)),u=exports.Scale.pushforward(s.y,a(p));let x=exports.Scale.pushforward(s.size,y(p));x=x/Math.sqrt(2);const b=[d-x,u-x,d+x,u+x];if(pointInRect(h,b)){const v={};v[Meta.getName(m.x)]=l(p),v[Meta.getName(m.y)]=a(p);for(const[S,M]of Object.entries(m))S==="x"||S==="y"||M&&Meta.hasName(M)&&(v[Meta.getName(M)]=Geom.getter(M)(p));return v}}}e.query=c})(Points||(Points={}));var Rectangles;(e=>{function t(){const r={},h=[];return{type:Geom.Type.Rectangles,data:h,scales:r}}e.of=t;function n(r,h){const{scales:s}=r,m=Geom.groupedData(r),i=findLength(Object.values(m)),f=["x0","y0","x1","y1","area",LAYER],[l,a,y,p,d,u]=Geom.getters(m,f);for(let x=0;x<i;x++){let b=exports.Scale.pushforward(s.x,l(x)),v=exports.Scale.pushforward(s.y,a(x)),S=exports.Scale.pushforward(s.x,y(x)),M=exports.Scale.pushforward(s.y,p(x));const R=h[u(x)];if(m.area){const g=exports.Scale.pushforward(s.area,d(x)),w=S-b,A=M-v;b=b+(1-g)/2*w,S=S-(1-g)/2*w,v=v+(1-g)/2*A,M=M-(1-g)/2*A}Frame.rectangleXY(R,b,v,S,M)}}e.render=n;function o(r,h){const{scales:s}=r,m=Geom.flatData(r),i=findLength(Object.values(m)),f=["x0","y0","x1","y1","area",POSITIONS],[l,a,y,p,d,u]=Geom.getters(m,f),x=[];for(let b=0;b<i;b++){let v=exports.Scale.pushforward(s.x,l(b)),S=exports.Scale.pushforward(s.y,a(b)),M=exports.Scale.pushforward(s.x,y(b)),R=exports.Scale.pushforward(s.y,p(b));if(m.area){const g=exports.Scale.pushforward(s.area,d(b)),w=M-v,A=R-S;v=v+(1-g)/2*w,M=M-(1-g)/2*w,S=S+(1-g)/2*A,R=R-(1-g)/2*A}if(rectsIntersect(h,[v,S,M,R])){const g=u(b);for(let w=0;w<g.length;w++)x.push(g[w])}}return x}e.check=o;function c(r,h){const{scales:s}=r,m=Geom.flatData(r),i=findLength(Object.values(m)),f=["x0","y0","x1","y1","area"],[l,a,y,p,d]=Geom.getters(m,f);for(let u=0;u<i;u++){let x=exports.Scale.pushforward(s.x,l(u)),b=exports.Scale.pushforward(s.y,a(u)),v=exports.Scale.pushforward(s.x,y(u)),S=exports.Scale.pushforward(s.y,p(u));if(m.area){const M=exports.Scale.pushforward(s.area,d(u)),R=v-x,g=S-b;x=x+(1-M)/2*R,v=v-(1-M)/2*R,b=b+(1-M)/2*g,S=S-(1-M)/2*g}if(pointInRect(h,[x,b,v,S])){const M={};for(const R of Object.values(m))R&&Meta.hasName(R)&&(M[Meta.getName(R)]=Geom.getter(R)(u));return M}}}e.query=c})(Rectangles||(Rectangles={}));var Geom;(e=>{(i=>{i[i.Points=0]="Points",i[i.Bars=1]="Bars",i[i.Rectangles=2]="Rectangles",i[i.Lines=3]="Lines"})(e.Type||(e.Type={}));const t={0:Points,1:Bars,2:Rectangles,3:Lines};function n(i){return i.data[i.data.length-2]}e.flatData=n;function o(i){return i.data[i.data.length-1]}e.groupedData=o;function c(i,f=()=>.5){return makeGetter(i??f)}e.getter=c;function r(i,f,l=()=>.5){return f.map(a=>e.getter(i[a],l))}e.getters=r;function h(i,f){t[i.type].render(i,f)}e.render=h;function s(i,f){return t[i.type].check(i,f)}e.check=s;function m(i,f){return t[i.type].query(i,f)}e.query=m})(Geom||(Geom={}));const PARENT=Symbol("parent"),VALUES=Symbol("values"),INDICES=Symbol("indices"),FACTOR=Symbol("factor"),REDUCER=Symbol("reducer");var Reduced;(e=>{function t(a,y,p,d){const u=a;return u[VALUES]=a,u[FACTOR]=y,u[REDUCER]=p,d&&n(u,d),u}e.of=t,e.listen=Reactive.makeListenFn(),e.dispatch=Reactive.makeDispatchFn();function n(a,y){a[PARENT]=y}e.setParent=n;function o(a){const[,y,p,d]=l(a);if(!d)throw new Error("Parent missing");const u=exports.Factor.parentIndices(s(d),y),x=subset(d,u),b=t(x,s(d),p,m(d));return i(b,d),f(b,u),Meta.copyName(a,b),b}e.parent=o;function c(a){const[y,p,d,u,x]=l(a);if(!u)throw new Error("Cannot stack a without a parent");const b=exports.Factor.parentIndices(s(u),p),{reducefn:v,initialfn:S}=d,[M,R]=[y.length,[]],g=Array.from(Array(M),()=>S()),w=Getter.of(b);for(let z=0;z<y.length;z++){const T=w(z);R[T]===void 0&&(R[T]=S()),R[T]=v(R[T],y[z]),g[z]=R[T]}const A=x?subset(g,x):g,P=e.of(A,p,d,u);return i(P,g),x&&f(P,x),Meta.copyName(a,P),P}e.stack=c;function r(a,y){const[p,d,u,x,b]=l(a);if(!x)throw new Error("Cannot normalize a without a parent");const v=exports.Factor.parentIndices(s(x),d),S=subset(x,v),M=[...p];for(let w=0;w<a.length;w++)M[w]=y(M[w],S[w]);const R=b?subset(M,b):M,g=e.of(R,d,u,x);return i(g,M),b&&f(g,b),Meta.copyName(a,g),g}e.normalize=r;function h(a){const[y,p,d,u,x]=l(a),b=[];b.push(d.initialfn());for(let M=0;M<y.length-1;M++)b.push(y[M]);const v=x?subset(b,x):b,S=e.of(v,p,d,u);return i(S,b),x&&f(S,x),Meta.copyName(a,S),S}e.shiftLeft=h;function s(a){return a[FACTOR]}function m(a){return a[PARENT]}e.getParent=m;function i(a,y){a[VALUES]=y}function f(a,y){a[INDICES]=y}function l(a){return[a[VALUES],a[FACTOR],a[REDUCER],a[PARENT],a[INDICES]]}})(Reduced||(Reduced={})),exports.Reducer=void 0,(Reducer=>{Reducer.sum={name:"sum",fallback:"count",initialfn:()=>0,reducefn:(e,t)=>e+t},Reducer.max={name:"max",initialfn:()=>-1/0,reducefn:(e,t)=>Math.max(e,t)},Reducer.product={name:"product",initialfn:()=>1,reducefn:(e,t)=>e*t},Reducer.table={name:"table",initialfn:()=>({}),reducefn:(e,t)=>(e[t]=e[t]+1||0,e)};function parse(value){if(typeof value=="string")return Reducer[value];if(typeof value.initialfn=="string"&&typeof value.reducefn=="string"){const parsed={name:value.name};return parsed.initialfn=eval(value.initialfn),parsed.reducefn=eval(value.reducefn),parsed}return value}Reducer.parse=parse;function reduce(e,t,n){const{indices:o,cardinality:c}=t,{initialfn:r,reducefn:h}=n,s=Array.from(Array(c),()=>r()),m=makeGetter(o),i=makeGetter(e);for(let l=0;l<o.length;l++)s[m(l)]=h(s[m(l)],i(l));const f=Reduced.of(s,t,n);return Meta.copy(e,f),Meta.setName(f,getName(s,n)??"[unknown summary]"),f}Reducer.reduce=reduce;function getName(e,t){return Meta.hasName(e)?`${t.name} of ${Meta.getName(e)}`:t.fallback}Reducer.getName=getName})(exports.Reducer||(exports.Reducer={}));var Summaries;(e=>{function t(r,h){const s=[];for(let m=0;m<h.length;m++){const i=h[m],f=n(r,i),l=Reactive.of(merge(f,i.data));if(s.push(l),m>0)for(const a of Object.keys(f)){const y=s[m-1][a];Reduced.setParent(f[a],y)}exports.Factor.listen(i,"changed",()=>{const a=n(r,i);for(const y of Object.keys(a))copyValues(a[y],f[y])}),Reactive.propagateChange(i,l,{deferred:!0})}return s}e.of=t;function n(r,h){const s={};for(const[m,i]of Object.entries(r)){const[f,l]=i;s[m]=exports.Reducer.reduce(f,h,l)}return s}function o(r,h){const s=[];for(let m=0;m<r.length;m++){let i=function(l){const a=h[m](l),y=Reflect.ownKeys(l);for(const p of y)(typeof p=="symbol"||isIntegerString(p))&&(a[p]=l[p]);return a};const f=Reactive.of(i(r[m]));s.push(f),Reactive.listen(r[m],"changed",()=>{const l=i(r[m]);for(const a of Reflect.ownKeys(l))isArray(l[a])&&isArray(f[a])&&copyValues(l[a],f[a]);Reactive.dispatch(f,"changed")})}return s}e.translate=o;function c(r,h){const s={};let m=0;for(const[i,f]of r)s[`q${m++}`]=[i(h),f];return s}e.formatQueries=c})(Summaries||(Summaries={}));function Barplot(e,t,n){const{data:o,marker:c}=e;let[r,h]=t(o);const s=h&&(n!=null&&n.reducer)?n.reducer:exports.Reducer.sum,m=h||(()=>1),i=exports.Factor.from(r),f=exports.Factor.product(i,c.factor),l=[i,f],a=n!=null&&n.queries?n.queries(o):{},y=Summaries.of({stat:[m,s],...a},l),p=[],d=0,u={type:"bar",scales:{x:"band"}},x={representation:d,...exports.Plot.of(u),summaries:y,coordinates:p};return exports.Plot.listen(x,"normalize",()=>switchRepresentation$3(x)),barplot(x),exports.Plot.addGeom(x,Bars.of()),x}function sortAxis(e,t){if(e.ordered)ExpanseBand.reorder(e);else{const n=orderIndices(t);ExpanseBand.reorder(e,n)}}function switchRepresentation$3(e){e.representation===0?spineplot(e):barplot(e)}function barplot(e){const{summaries:t,scales:n}=e,o=Summaries.translate(t,[s=>({x:s.label,y:zero,height:s.stat,width:one}),s=>({x:s.label,y:zero,height:Reduced.stack(s.stat),width:one})]),[c]=o,r={default:!0,ratio:!0};exports.Scale.train(n.x,c.x,r),exports.Scale.train(n.y,c.height,r),exports.Scale.train(n.width,[0,1],r),exports.Scale.train(n.height,c.height,r),exports.Expanse.freeze(n.y.domain,["zero"]),exports.Expanse.freeze(n.height.domain,["zero"]),ExpanseBand.setWeights(n.x.domain);const h=1/new Set(c.x).size;exports.Expanse.linkTo(n.y.domain,n.height.domain),exports.Expanse.set(n.width.codomain,s=>{s.scale=h,s.mult=.9,s.offset=0},{default:!0}),Meta.setName(n.y,Meta.getName(c.height)),Reactive.removeListeners(e,"reorder"),exports.Plot.listen(e,"reorder",()=>sortAxis(n.x.domain,c.height)),e.representation=0,exports.Plot.setData(e,o),exports.Plot.render(e),exports.Plot.renderAxes(e)}function spineplot(e){const{summaries:t,scales:n}=e,o=Summaries.translate(t,[h=>({x:h.label,y:zero,height:one,width:h.stat}),h=>({x:h.label,y:zero,height:Reduced.normalize(Reduced.stack(h.stat),(s,m)=>s/m),width:Reduced.parent(h.stat)})]),[c]=o,r={default:!0,ratio:!0};exports.Scale.train(n.x,c.x,r),exports.Scale.train(n.y,[0,1],r),exports.Scale.train(n.width,cumsum(c.width),r),exports.Scale.train(n.height,[0,1],r),exports.Expanse.freeze(n.y.domain,["zero"]),exports.Expanse.freeze(n.height.domain,["zero"]),ExpanseBand.setWeights(n.x.domain,c.width),exports.Expanse.linkTo(n.y.domain,n.height.domain),exports.Expanse.set(n.width.codomain,h=>{h.scale=1,h.mult=1,h.offset=-1},{default:!0}),Meta.setName(n.y,"proportion"),Reactive.removeListeners(e,"reorder"),exports.Plot.listen(e,"reorder",()=>sortAxis(n.x.domain,c.width)),e.representation=1,exports.Plot.setData(e,o),exports.Plot.render(e),exports.Plot.renderAxes(e)}function Fluctuationplot(e,t,n){const{data:o,marker:c}=e;let[r,h,s]=t(o);const m=s&&(n!=null&&n.reducer)?n.reducer:exports.Reducer.sum,i=s?[...s]:()=>1,f=exports.Factor.product(exports.Factor.from(r),exports.Factor.from(h)),l=exports.Factor.product(f,c.factor),a=[f,l],y=Summaries.formatQueries((n==null?void 0:n.queries)??[],o),p=Summaries.of({stat:[i,m],...y},a),d=[],u=0,x={type:"fluct",scales:{x:"band",y:"band"}},b={representation:u,...exports.Plot.of(x),summaries:p,coordinates:d};return exports.Scale.shareCodomain(b.scales.area,b.scales.width),exports.Scale.shareCodomain(b.scales.area,b.scales.height),exports.Plot.listen(b,"normalize",()=>switchRepresentation$2(b)),fluctplot(b),exports.Plot.addGeom(b,Bars.of({vAnchor:VAnchor.Middle})),b}function switchRepresentation$2(e){e.representation===0?pctfluctplot(e):fluctplot(e)}function fluctplot(e){const{summaries:t,scales:n}=e,o=Summaries.translate(t,[s=>({x:s.label,y:s.label$,height:s.stat,width:s.stat}),s=>({x:s.label,y:s.label$,height:Reduced.stack(s.stat),width:Reduced.stack(s.stat)})]),[c]=o,r={default:!0,ratio:!0};exports.Scale.train(n.x,c.x,r),exports.Scale.train(n.y,c.y,r),exports.Scale.train(n.width,c.width,r),exports.Scale.train(n.height,c.height,r);const h=max(new Set(c.x).size,new Set(c.y).size);exports.Expanse.set(n.area.codomain,s=>{s.scale=1/h,s.mult=.9,s.offset=0},{default:!0}),exports.Plot.setData(e,o),e.representation=0,exports.Plot.render(e)}function pctfluctplot(e){const{summaries:t,scales:n}=e,o=Summaries.translate(t,[s=>({x:s.label,y:s.label$,height:one,width:one}),s=>({x:s.label,y:s.label$,height:Reduced.normalize(Reduced.stack(s.stat),(m,i)=>m/i),width:Reduced.normalize(Reduced.stack(s.stat),(m,i)=>m/i)})]),[c]=o,r={default:!0,ratio:!0};exports.Scale.train(n.x,c.x,r),exports.Scale.train(n.y,c.y,r),exports.Scale.train(n.width,[0,1],r),exports.Scale.train(n.height,[0,1],r);const h=max(new Set(c.x).size,new Set(c.y).size);exports.Expanse.set(n.area.codomain,s=>{s.scale=1/h,s.mult=.9,s.offset=-1},{default:!0}),exports.Plot.setData(e,o),e.representation=1,exports.Plot.render(e)}function Histogram(e,t,n){const{data:o,marker:c}=e;let[r,h]=t(o);const s=h&&(n!=null&&n.reducer)?n.reducer:exports.Reducer.sum,m=h||(()=>1),[i,f]=minmax(r),l=f-i,a=Reactive.of({anchor:i,width:l/15}),y=exports.Factor.mono(r.length),p=exports.Factor.product(y,exports.Factor.bin(r,a)),d=exports.Factor.product(p,c.factor),u=[y,p,d],x=n!=null&&n.queries?n.queries(o):{},b=Summaries.of({stat:[m,s],...x},u),v=0,S=[],M={type:"histo"},R={representation:v,...exports.Plot.of(M),summaries:b,coordinates:S};exports.Plot.listen(R,"normalize",()=>switchRepresentation$1(R));const g=l/10;return exports.Plot.listen(R,"grow",()=>Reactive.set(a,w=>w.width*=1.1111111111111112)),exports.Plot.listen(R,"shrink",()=>Reactive.set(a,w=>w.width*=.9)),exports.Plot.listen(R,"increment-anchor",()=>Reactive.set(a,w=>w.anchor+=g)),exports.Plot.listen(R,"decrement-anchor",()=>Reactive.set(a,w=>w.anchor-=g)),exports.Plot.listen(R,"reset",()=>{Reactive.set(a,w=>(w.anchor=i,w.width=l/15))}),histogram(R),exports.Plot.addGeom(R,Rectangles.of()),R}function switchRepresentation$1(e){e.representation===0?spinogram(e):histogram(e)}function histogram(e){const{summaries:t}=e,n=Summaries.translate(t,[r=>r,r=>({x0:r.binMin,y0:zero,x1:r.binMax,y1:r.stat}),r=>({x0:r.binMin,y0:zero,x1:r.binMax,y1:Reduced.stack(r.stat)})]),{scales:o}=e,[,c]=n;exports.Scale.train(o.x,c.x1,{default:!0,name:!1}),exports.Scale.train(o.y,c.y1,{default:!0,ratio:!0});for(const r of e.data)Reactive.removeListeners(r,"changed");Reactive.listen(c,"changed",()=>{exports.Scale.train(o.x,c.x1,{default:!0,name:!1}),exports.Scale.train(o.y,c.y1,{default:!0,ratio:!0})}),exports.Expanse.freeze(o.y.domain,["zero"]),Meta.setName(o.x,Meta.getName(t[1].breaks)),Meta.setName(o.y,Meta.getName(c.y1)),e.representation=0,exports.Plot.setData(e,n),exports.Plot.render(e),exports.Plot.renderAxes(e)}function spinogram(e){const{summaries:t}=e,n=Summaries.translate(t,[r=>r,r=>({x0:Reduced.shiftLeft(Reduced.stack(r.stat)),y0:zero,x1:Reduced.stack(r.stat),y1:one,query1:r.binMin,query2:r.binMax}),r=>({x0:Reduced.shiftLeft(Reduced.stack(Reduced.parent(r.stat))),y0:zero,x1:Reduced.stack(Reduced.parent(r.stat)),y1:Reduced.normalize(Reduced.stack(r.stat),(h,s)=>h/s)})]),{scales:o}=e,[,c]=n;exports.Scale.train(o.x,[0,...c.x1],{default:!0,name:!1}),exports.Scale.train(o.y,[0,1],{default:!0,ratio:!0}),Reactive.listen(c,"changed",()=>{exports.Scale.train(o.x,[0,...c.x1],{default:!0,name:!1})}),exports.Expanse.freeze(o.y.domain,["zero"]),Meta.setName(o.x,"cumulative count"),Meta.setName(o.y,"proportion"),exports.Plot.setData(e,n),e.representation=1,exports.Plot.render(e),exports.Plot.renderAxes(e)}function Histogram2d(e,t,n){const{data:o,marker:c}=e;let[r,h,s]=t(o);const m=s&&(n!=null&&n.reducer)?n.reducer:exports.Reducer.sum,i=s||(()=>1),[f,l]=minmax(r),[a,y]=minmax(h),[p,d]=[l-f,y-a],u=Reactive.of({anchor:f,width:p/15}),x=Reactive.of({anchor:a,width:d/15}),b=exports.Factor.bin(r,u),v=exports.Factor.bin(h,x),S=exports.Factor.product(b,v),M=exports.Factor.product(S,c.factor),R=[S,M],g=n!=null&&n.queries?n.queries(o):{},w=Summaries.of({stat:[i,m],...g},R),A=0,P=[],z={type:"histo2d",ratio:n==null?void 0:n.ratio},T={representation:A,...exports.Plot.of(z),summaries:w,coordinates:P};return exports.Plot.listen(T,"normalize",()=>switchRepresentation(T)),exports.Plot.listen(T,"grow",()=>{Reactive.set(u,L=>L.width*=1.1111111111111112),Reactive.set(x,L=>L.width*=1.1111111111111112)}),exports.Plot.listen(T,"shrink",()=>{Reactive.set(u,L=>L.width*=.9),Reactive.set(x,L=>L.width*=.9)}),exports.Plot.listen(T,"reset",()=>{Reactive.set(u,L=>(L.anchor=f,L.width=p/15)),Reactive.set(x,L=>(L.anchor=a,L.width=d/15))}),histogram2d(T),exports.Plot.addGeom(T,Rectangles.of()),T}function switchRepresentation(e){e.representation===0?spinogram2d(e):histogram2d(e)}function histogram2d(e){const{summaries:t}=e,n=Summaries.translate(t,[r=>({x0:r.binMin,y0:r.binMin$,x1:r.binMax,y1:r.binMax$,area:r.stat}),r=>({x0:r.binMin,y0:r.binMin$,x1:r.binMax,y1:r.binMax$,area:Reduced.stack(r.stat)})]),{scales:o}=e,[,c]=n;exports.Scale.train(o.x,c.x1,{default:!0}),exports.Scale.train(o.y,c.y1,{default:!0}),exports.Scale.train(o.area,c.area,{default:!0}),exports.Expanse.set(o.area.codomain,r=>(r.min=0,r.max=1),{default:!0}),exports.Expanse.freeze(o.area.codomain,["min","max"]);for(const r of e.data)Reactive.removeListeners(r,"changed");Reactive.listen(c,"changed",()=>{exports.Scale.train(o.x,c.x1,{default:!0,name:!1}),exports.Scale.train(o.y,c.y1,{default:!0,name:!1}),exports.Scale.train(o.area,c.area,{default:!0})}),e.representation=0,exports.Plot.setData(e,n),Meta.setName(o.x,Meta.getName(t[1].breaks)),Meta.setName(o.y,Meta.getName(t[1].breaks$)),exports.Plot.render(e),exports.Plot.renderAxes(e)}function spinogram2d(e){const{summaries:t}=e,n=Summaries.translate(t,[r=>({x0:r.binMin,y0:r.binMin$,x1:r.binMax,y1:r.binMax$,area:one}),r=>({x0:r.binMin,y0:r.binMin$,x1:r.binMax,y1:r.binMax$,area:Reduced.normalize(Reduced.stack(r.stat),(h,s)=>h/s)})]),{scales:o}=e,[,c]=n;exports.Scale.train(o.x,c.x1,{default:!0}),exports.Scale.train(o.y,c.y1,{default:!0}),exports.Scale.train(o.area,[0,1],{default:!0}),exports.Expanse.set(o.area.codomain,r=>(r.min=0,r.max=1),{default:!0}),exports.Expanse.freeze(o.area.codomain,["min","max"]);for(const r of e.data)Reactive.removeListeners(r,"changed");Reactive.listen(c,"changed",()=>{exports.Scale.train(o.x,c.x1,{default:!0,name:!1}),exports.Scale.train(o.y,c.y1,{default:!0,name:!1})}),e.representation=1,exports.Plot.setData(e,n),Meta.setName(o.x,Meta.getName(t[1].breaks)),Meta.setName(o.y,Meta.getName(t[1].breaks$)),exports.Plot.render(e),exports.Plot.renderAxes(e)}function Pcoordsplot(e,t,n){const{data:o,marker:c}=e,r=t(o),h=r.map(Meta.getName),s=Getter.constant(h),m=Getter.multi(r),i=n!=null&&n.queries?n.queries(o):{},f=exports.Factor.bijection({x:s,y:m,...i}),l=exports.Factor.product(f,c.factor),a=Summaries.of({},[f,l]),y=Summaries.translate(a,[M=>M,M=>M]),p=exports.Plot.of({type:"pcoords"}),{scales:d}=p,{expandX:u,expandY:x}=e.options,b={zero:u,one:1-u},v={zero:x,one:1-x};exports.Scale.setDomain(d.x,exports.Expanse.split(exports.Expanse.point(h,b))),exports.Scale.setCoomain(d.x,exports.Expanse.split(d.x.codomain));const S=r.map(M=>exports.Expanse.infer(M));return exports.Scale.setDomain(d.y,exports.Expanse.compound(S,v)),exports.Scale.setCoomain(d.y,exports.Expanse.split(d.y.codomain)),Meta.setName(d.x,"variable"),Meta.setName(d.y,"value"),exports.Plot.setData(p,y),exports.Plot.addGeom(p,Lines.of()),p}function Scatterplot(e,t,n){const{data:o,marker:c}=e,[r,h,s]=t(o),m=n!=null&&n.queries?n==null?void 0:n.queries(o):{},i={x:r,y:h,size:s??(()=>.5),...m},f=exports.Factor.bijection(i),l=exports.Factor.product(f,c.factor),a=Summaries.of({},[f,l]),y=Summaries.translate(a,[u=>u,u=>u]),p=exports.Plot.of({type:"scatter",ratio:n==null?void 0:n.ratio}),{scales:d}=p;return exports.Scale.train(d.x,r,{default:!0}),exports.Scale.train(d.y,h,{default:!0}),s&&exports.Scale.train(d.size,s,{default:!0}),exports.Plot.setData(p,y),exports.Plot.addGeom(p,Points.of()),{...p,summaries:a}}function _typeof(e){"@babel/helpers - typeof";return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(e)}var trimLeft=/^\s+/,trimRight=/\s+$/;function tinycolor(e,t){if(e=e||"",t=t||{},e instanceof tinycolor)return e;if(!(this instanceof tinycolor))return new tinycolor(e,t);var n=inputToRGB(e);this._originalInput=e,this._r=n.r,this._g=n.g,this._b=n.b,this._a=n.a,this._roundA=Math.round(100*this._a)/100,this._format=t.format||n.format,this._gradientType=t.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=n.ok}tinycolor.prototype={isDark:function e(){return this.getBrightness()<128},isLight:function e(){return!this.isDark()},isValid:function e(){return this._ok},getOriginalInput:function e(){return this._originalInput},getFormat:function e(){return this._format},getAlpha:function e(){return this._a},getBrightness:function e(){var t=this.toRgb();return(t.r*299+t.g*587+t.b*114)/1e3},getLuminance:function e(){var t=this.toRgb(),n,o,c,r,h,s;return n=t.r/255,o=t.g/255,c=t.b/255,n<=.03928?r=n/12.92:r=Math.pow((n+.055)/1.055,2.4),o<=.03928?h=o/12.92:h=Math.pow((o+.055)/1.055,2.4),c<=.03928?s=c/12.92:s=Math.pow((c+.055)/1.055,2.4),.2126*r+.7152*h+.0722*s},setAlpha:function e(t){return this._a=boundAlpha(t),this._roundA=Math.round(100*this._a)/100,this},toHsv:function e(){var t=rgbToHsv(this._r,this._g,this._b);return{h:t.h*360,s:t.s,v:t.v,a:this._a}},toHsvString:function e(){var t=rgbToHsv(this._r,this._g,this._b),n=Math.round(t.h*360),o=Math.round(t.s*100),c=Math.round(t.v*100);return this._a==1?"hsv("+n+", "+o+"%, "+c+"%)":"hsva("+n+", "+o+"%, "+c+"%, "+this._roundA+")"},toHsl:function e(){var t=rgbToHsl(this._r,this._g,this._b);return{h:t.h*360,s:t.s,l:t.l,a:this._a}},toHslString:function e(){var t=rgbToHsl(this._r,this._g,this._b),n=Math.round(t.h*360),o=Math.round(t.s*100),c=Math.round(t.l*100);return this._a==1?"hsl("+n+", "+o+"%, "+c+"%)":"hsla("+n+", "+o+"%, "+c+"%, "+this._roundA+")"},toHex:function e(t){return rgbToHex(this._r,this._g,this._b,t)},toHexString:function e(t){return"#"+this.toHex(t)},toHex8:function e(t){return rgbaToHex(this._r,this._g,this._b,this._a,t)},toHex8String:function e(t){return"#"+this.toHex8(t)},toRgb:function e(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function e(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function e(){return{r:Math.round(bound01(this._r,255)*100)+"%",g:Math.round(bound01(this._g,255)*100)+"%",b:Math.round(bound01(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function e(){return this._a==1?"rgb("+Math.round(bound01(this._r,255)*100)+"%, "+Math.round(bound01(this._g,255)*100)+"%, "+Math.round(bound01(this._b,255)*100)+"%)":"rgba("+Math.round(bound01(this._r,255)*100)+"%, "+Math.round(bound01(this._g,255)*100)+"%, "+Math.round(bound01(this._b,255)*100)+"%, "+this._roundA+")"},toName:function e(){return this._a===0?"transparent":this._a<1?!1:hexNames[rgbToHex(this._r,this._g,this._b,!0)]||!1},toFilter:function e(t){var n="#"+rgbaToArgbHex(this._r,this._g,this._b,this._a),o=n,c=this._gradientType?"GradientType = 1, ":"";if(t){var r=tinycolor(t);o="#"+rgbaToArgbHex(r._r,r._g,r._b,r._a)}return"progid:DXImageTransform.Microsoft.gradient("+c+"startColorstr="+n+",endColorstr="+o+")"},toString:function e(t){var n=!!t;t=t||this._format;var o=!1,c=this._a<1&&this._a>=0,r=!n&&c&&(t==="hex"||t==="hex6"||t==="hex3"||t==="hex4"||t==="hex8"||t==="name");return r?t==="name"&&this._a===0?this.toName():this.toRgbString():(t==="rgb"&&(o=this.toRgbString()),t==="prgb"&&(o=this.toPercentageRgbString()),(t==="hex"||t==="hex6")&&(o=this.toHexString()),t==="hex3"&&(o=this.toHexString(!0)),t==="hex4"&&(o=this.toHex8String(!0)),t==="hex8"&&(o=this.toHex8String()),t==="name"&&(o=this.toName()),t==="hsl"&&(o=this.toHslString()),t==="hsv"&&(o=this.toHsvString()),o||this.toHexString())},clone:function e(){return tinycolor(this.toString())},_applyModification:function e(t,n){var o=t.apply(null,[this].concat([].slice.call(n)));return this._r=o._r,this._g=o._g,this._b=o._b,this.setAlpha(o._a),this},lighten:function e(){return this._applyModification(_lighten,arguments)},brighten:function e(){return this._applyModification(_brighten,arguments)},darken:function e(){return this._applyModification(_darken,arguments)},desaturate:function e(){return this._applyModification(_desaturate,arguments)},saturate:function e(){return this._applyModification(_saturate,arguments)},greyscale:function e(){return this._applyModification(_greyscale,arguments)},spin:function e(){return this._applyModification(_spin,arguments)},_applyCombination:function e(t,n){return t.apply(null,[this].concat([].slice.call(n)))},analogous:function e(){return this._applyCombination(_analogous,arguments)},complement:function e(){return this._applyCombination(_complement,arguments)},monochromatic:function e(){return this._applyCombination(_monochromatic,arguments)},splitcomplement:function e(){return this._applyCombination(_splitcomplement,arguments)},triad:function e(){return this._applyCombination(polyad,[3])},tetrad:function e(){return this._applyCombination(polyad,[4])}},tinycolor.fromRatio=function(e,t){if(_typeof(e)=="object"){var n={};for(var o in e)e.hasOwnProperty(o)&&(o==="a"?n[o]=e[o]:n[o]=convertToPercentage(e[o]));e=n}return tinycolor(e,t)};function inputToRGB(e){var t={r:0,g:0,b:0},n=1,o=null,c=null,r=null,h=!1,s=!1;return typeof e=="string"&&(e=stringInputToObject(e)),_typeof(e)=="object"&&(isValidCSSUnit(e.r)&&isValidCSSUnit(e.g)&&isValidCSSUnit(e.b)?(t=rgbToRgb(e.r,e.g,e.b),h=!0,s=String(e.r).substr(-1)==="%"?"prgb":"rgb"):isValidCSSUnit(e.h)&&isValidCSSUnit(e.s)&&isValidCSSUnit(e.v)?(o=convertToPercentage(e.s),c=convertToPercentage(e.v),t=hsvToRgb(e.h,o,c),h=!0,s="hsv"):isValidCSSUnit(e.h)&&isValidCSSUnit(e.s)&&isValidCSSUnit(e.l)&&(o=convertToPercentage(e.s),r=convertToPercentage(e.l),t=hslToRgb(e.h,o,r),h=!0,s="hsl"),e.hasOwnProperty("a")&&(n=e.a)),n=boundAlpha(n),{ok:h,format:e.format||s,r:Math.min(255,Math.max(t.r,0)),g:Math.min(255,Math.max(t.g,0)),b:Math.min(255,Math.max(t.b,0)),a:n}}function rgbToRgb(e,t,n){return{r:bound01(e,255)*255,g:bound01(t,255)*255,b:bound01(n,255)*255}}function rgbToHsl(e,t,n){e=bound01(e,255),t=bound01(t,255),n=bound01(n,255);var o=Math.max(e,t,n),c=Math.min(e,t,n),r,h,s=(o+c)/2;if(o==c)r=h=0;else{var m=o-c;switch(h=s>.5?m/(2-o-c):m/(o+c),o){case e:r=(t-n)/m+(t<n?6:0);break;case t:r=(n-e)/m+2;break;case n:r=(e-t)/m+4;break}r/=6}return{h:r,s:h,l:s}}function hslToRgb(e,t,n){var o,c,r;e=bound01(e,360),t=bound01(t,100),n=bound01(n,100);function h(i,f,l){return l<0&&(l+=1),l>1&&(l-=1),l<.16666666666666666?i+(f-i)*6*l:l<.5?f:l<.6666666666666666?i+(f-i)*(.6666666666666666-l)*6:i}if(t===0)o=c=r=n;else{var s=n<.5?n*(1+t):n+t-n*t,m=2*n-s;o=h(m,s,e+.3333333333333333),c=h(m,s,e),r=h(m,s,e-.3333333333333333)}return{r:o*255,g:c*255,b:r*255}}function rgbToHsv(e,t,n){e=bound01(e,255),t=bound01(t,255),n=bound01(n,255);var o=Math.max(e,t,n),c=Math.min(e,t,n),r,h,s=o,m=o-c;if(h=o===0?0:m/o,o==c)r=0;else{switch(o){case e:r=(t-n)/m+(t<n?6:0);break;case t:r=(n-e)/m+2;break;case n:r=(e-t)/m+4;break}r/=6}return{h:r,s:h,v:s}}function hsvToRgb(e,t,n){e=bound01(e,360)*6,t=bound01(t,100),n=bound01(n,100);var o=Math.floor(e),c=e-o,r=n*(1-t),h=n*(1-c*t),s=n*(1-(1-c)*t),m=o%6,i=[n,h,r,r,s,n][m],f=[s,n,n,h,r,r][m],l=[r,r,s,n,n,h][m];return{r:i*255,g:f*255,b:l*255}}function rgbToHex(e,t,n,o){var c=[pad2(Math.round(e).toString(16)),pad2(Math.round(t).toString(16)),pad2(Math.round(n).toString(16))];return o&&c[0].charAt(0)==c[0].charAt(1)&&c[1].charAt(0)==c[1].charAt(1)&&c[2].charAt(0)==c[2].charAt(1)?c[0].charAt(0)+c[1].charAt(0)+c[2].charAt(0):c.join("")}function rgbaToHex(e,t,n,o,c){var r=[pad2(Math.round(e).toString(16)),pad2(Math.round(t).toString(16)),pad2(Math.round(n).toString(16)),pad2(convertDecimalToHex(o))];return c&&r[0].charAt(0)==r[0].charAt(1)&&r[1].charAt(0)==r[1].charAt(1)&&r[2].charAt(0)==r[2].charAt(1)&&r[3].charAt(0)==r[3].charAt(1)?r[0].charAt(0)+r[1].charAt(0)+r[2].charAt(0)+r[3].charAt(0):r.join("")}function rgbaToArgbHex(e,t,n,o){var c=[pad2(convertDecimalToHex(o)),pad2(Math.round(e).toString(16)),pad2(Math.round(t).toString(16)),pad2(Math.round(n).toString(16))];return c.join("")}tinycolor.equals=function(e,t){return!e||!t?!1:tinycolor(e).toRgbString()==tinycolor(t).toRgbString()},tinycolor.random=function(){return tinycolor.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})};function _desaturate(e,t){t=t===0?0:t||10;var n=tinycolor(e).toHsl();return n.s-=t/100,n.s=clamp01(n.s),tinycolor(n)}function _saturate(e,t){t=t===0?0:t||10;var n=tinycolor(e).toHsl();return n.s+=t/100,n.s=clamp01(n.s),tinycolor(n)}function _greyscale(e){return tinycolor(e).desaturate(100)}function _lighten(e,t){t=t===0?0:t||10;var n=tinycolor(e).toHsl();return n.l+=t/100,n.l=clamp01(n.l),tinycolor(n)}function _brighten(e,t){t=t===0?0:t||10;var n=tinycolor(e).toRgb();return n.r=Math.max(0,Math.min(255,n.r-Math.round(255*-(t/100)))),n.g=Math.max(0,Math.min(255,n.g-Math.round(255*-(t/100)))),n.b=Math.max(0,Math.min(255,n.b-Math.round(255*-(t/100)))),tinycolor(n)}function _darken(e,t){t=t===0?0:t||10;var n=tinycolor(e).toHsl();return n.l-=t/100,n.l=clamp01(n.l),tinycolor(n)}function _spin(e,t){var n=tinycolor(e).toHsl(),o=(n.h+t)%360;return n.h=o<0?360+o:o,tinycolor(n)}function _complement(e){var t=tinycolor(e).toHsl();return t.h=(t.h+180)%360,tinycolor(t)}function polyad(e,t){if(isNaN(t)||t<=0)throw new Error("Argument to polyad must be a positive number");for(var n=tinycolor(e).toHsl(),o=[tinycolor(e)],c=360/t,r=1;r<t;r++)o.push(tinycolor({h:(n.h+r*c)%360,s:n.s,l:n.l}));return o}function _splitcomplement(e){var t=tinycolor(e).toHsl(),n=t.h;return[tinycolor(e),tinycolor({h:(n+72)%360,s:t.s,l:t.l}),tinycolor({h:(n+216)%360,s:t.s,l:t.l})]}function _analogous(e,t,n){t=t||6,n=n||30;var o=tinycolor(e).toHsl(),c=360/n,r=[tinycolor(e)];for(o.h=(o.h-(c*t>>1)+720)%360;--t;)o.h=(o.h+c)%360,r.push(tinycolor(o));return r}function _monochromatic(e,t){t=t||6;for(var n=tinycolor(e).toHsv(),o=n.h,c=n.s,r=n.v,h=[],s=1/t;t--;)h.push(tinycolor({h:o,s:c,v:r})),r=(r+s)%1;return h}tinycolor.mix=function(e,t,n){n=n===0?0:n||50;var o=tinycolor(e).toRgb(),c=tinycolor(t).toRgb(),r=n/100,h={r:(c.r-o.r)*r+o.r,g:(c.g-o.g)*r+o.g,b:(c.b-o.b)*r+o.b,a:(c.a-o.a)*r+o.a};return tinycolor(h)},tinycolor.readability=function(e,t){var n=tinycolor(e),o=tinycolor(t);return(Math.max(n.getLuminance(),o.getLuminance())+.05)/(Math.min(n.getLuminance(),o.getLuminance())+.05)},tinycolor.isReadable=function(e,t,n){var o=tinycolor.readability(e,t),c,r;switch(r=!1,c=validateWCAG2Parms(n),c.level+c.size){case"AAsmall":case"AAAlarge":r=o>=4.5;break;case"AAlarge":r=o>=3;break;case"AAAsmall":r=o>=7;break}return r},tinycolor.mostReadable=function(e,t,n){var o=null,c=0,r,h,s,m;n=n||{},h=n.includeFallbackColors,s=n.level,m=n.size;for(var i=0;i<t.length;i++)r=tinycolor.readability(e,t[i]),r>c&&(c=r,o=tinycolor(t[i]));return tinycolor.isReadable(e,o,{level:s,size:m})||!h?o:(n.includeFallbackColors=!1,tinycolor.mostReadable(e,["#fff","#000"],n))};var names=tinycolor.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},hexNames=tinycolor.hexNames=flip(names);function flip(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[e[n]]=n);return t}function boundAlpha(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function bound01(e,t){isOnePointZero(e)&&(e="100%");var n=isPercentage(e);return e=Math.min(t,Math.max(0,parseFloat(e))),n&&(e=parseInt(e*t,10)/100),Math.abs(e-t)<1e-6?1:e%t/parseFloat(t)}function clamp01(e){return Math.min(1,Math.max(0,e))}function parseIntFromHex(e){return parseInt(e,16)}function isOnePointZero(e){return typeof e=="string"&&e.indexOf(".")!=-1&&parseFloat(e)===1}function isPercentage(e){return typeof e=="string"&&e.indexOf("%")!=-1}function pad2(e){return e.length==1?"0"+e:""+e}function convertToPercentage(e){return e<=1&&(e=e*100+"%"),e}function convertDecimalToHex(e){return Math.round(parseFloat(e)*255).toString(16)}function convertHexToDecimal(e){return parseIntFromHex(e)/255}var matchers=function(){var e="[-\\+]?\\d+%?",t="[-\\+]?\\d*\\.\\d+%?",n="(?:"+t+")|(?:"+e+")",o="[\\s|\\(]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")\\s*\\)?",c="[\\s|\\(]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")\\s*\\)?";return{CSS_UNIT:new RegExp(n),rgb:new RegExp("rgb"+o),rgba:new RegExp("rgba"+c),hsl:new RegExp("hsl"+o),hsla:new RegExp("hsla"+c),hsv:new RegExp("hsv"+o),hsva:new RegExp("hsva"+c),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function isValidCSSUnit(e){return!!matchers.CSS_UNIT.exec(e)}function stringInputToObject(e){e=e.replace(trimLeft,"").replace(trimRight,"").toLowerCase();var t=!1;if(names[e])e=names[e],t=!0;else if(e=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var n;return(n=matchers.rgb.exec(e))?{r:n[1],g:n[2],b:n[3]}:(n=matchers.rgba.exec(e))?{r:n[1],g:n[2],b:n[3],a:n[4]}:(n=matchers.hsl.exec(e))?{h:n[1],s:n[2],l:n[3]}:(n=matchers.hsla.exec(e))?{h:n[1],s:n[2],l:n[3],a:n[4]}:(n=matchers.hsv.exec(e))?{h:n[1],s:n[2],v:n[3]}:(n=matchers.hsva.exec(e))?{h:n[1],s:n[2],v:n[3],a:n[4]}:(n=matchers.hex8.exec(e))?{r:parseIntFromHex(n[1]),g:parseIntFromHex(n[2]),b:parseIntFromHex(n[3]),a:convertHexToDecimal(n[4]),format:t?"name":"hex8"}:(n=matchers.hex6.exec(e))?{r:parseIntFromHex(n[1]),g:parseIntFromHex(n[2]),b:parseIntFromHex(n[3]),format:t?"name":"hex"}:(n=matchers.hex4.exec(e))?{r:parseIntFromHex(n[1]+""+n[1]),g:parseIntFromHex(n[2]+""+n[2]),b:parseIntFromHex(n[3]+""+n[3]),a:convertHexToDecimal(n[4]+""+n[4]),format:t?"name":"hex8"}:(n=matchers.hex3.exec(e))?{r:parseIntFromHex(n[1]+""+n[1]),g:parseIntFromHex(n[2]+""+n[2]),b:parseIntFromHex(n[3]+""+n[3]),format:t?"name":"hex"}:!1}function validateWCAG2Parms(e){var t,n;return e=e||{level:"AA",size:"small"},t=(e.level||"AA").toUpperCase(),n=(e.size||"small").toLowerCase(),t!=="AA"&&t!=="AAA"&&(t="AA"),n!=="small"&&n!=="large"&&(n="small"),{level:t,size:n}}const defaultOptions={size:10,expandX:.1,expandY:.1,gapPct:.8,gapPx:1,axisLabelSize:1,axisTitleSize:1.25,margins:[0,0,0,0],colors:[],marginLines:[3.5,3.5,1,1],groupColors:["#984ea3","#e41a1c","#4daf4a","#377eb8"],plotBackground:"#fefffe"};updateOptions(defaultOptions);function updateOptions(e){const t=e.groupColors.length;e.colors.length=2*t;for(let r=0;r<t;r++){const h=e.groupColors[r];e.colors[r]=tinycolor(h).darken(10).saturate(20).toString(),e.colors[t+r]=tinycolor(h).lighten(20).saturate(20).toString()}const{marginLines:n,axisTitleSize:o}=e,c=parseFloat(getComputedStyle(document.documentElement).fontSize);e.margins=n.map(r=>r*c*o)}const React={createElement(e,t,...n){const o=document.createElement(e);for(const[c,r]of Object.entries(t||{}))c.startsWith("on")&&c.toLowerCase()in window?o.addEventListener(c.toLowerCase().slice(2),r):o.setAttribute(c,r);return appendChildren(o,...n),o}};function appendChildren(e,...t){if(t.length===0)return;if(t.length>1){for(const c of t)appendChildren(e,c);return}const n=t[0],o=isNode(n)?n:document.createTextNode(n);e.appendChild(o)}function isNode(e){return e.nodeType!=null}function renderAxisLabels(e){renderSingleAxisLabels(e,"x"),renderSingleAxisLabels(e,"y")}function renderSingleAxisLabels(e,t){const{frames:n,scales:o,options:c}=e,{margins:r}=c,h=o[t],s=t==="x"?o.y:o.x,m=n[`${t}Axis`],{context:i}=m,{labels:f,positions:l}=exports.Scale.breaks(h),[a,y,p,d]=r,u=parseInt(i.font.match(/^[0-9]*/)[0],10),x=s.codomain.min-u/2,{width:b,height:v}=m;if(Frame.clear(m),t==="x"){let[S,M]=[0,0];for(let R=0;R<f.length;R++){const g=f[R],w=l[R],A=Frame.textWidth(m,g)+1;outside(w,y,b-d)||overlap(S,w,M,A)||([S,M]=[w,A],Frame.text(m,w,x,g))}}else if(t==="y"){let[S,M]=[0,0];for(let R=0;R<f.length;R++){const g=f[R],w=l[R],A=Frame.textWidth(m,g)+1,P=Frame.textHeight(m,g)+1;r[1]/2<A+P&&(r[1]*=1.05,exports.Plot.resize(e)),!outside(w,a,v-p)&&(overlap(S,w,M,P)||([S,M]=[w,P],Frame.text(m,x,w,g)))}}}function renderAxisTitles(e){renderSingleAxisTitle(e,"x"),renderSingleAxisTitle(e,"y")}function renderSingleAxisTitle(e,t){const{scales:n,frames:o,options:c}=e,{margins:r}=c,h=n[t],s=t==="x"?e.scales.y:e.scales.x,m=o.base,i=Meta.getName(h),f=t==="x"?r[0]:r[1],l=exports.Expanse.unnormalize(h.codomain,.5),a=exports.Expanse.unnormalize(s.codomain,0)-f*2/3;t==="x"&&Frame.text(m,l,a,i),t==="y"&&Frame.text(m,a,l,i,{vertical:!0})}function outside(e,t,n){return e<t||e>n}function overlap(e,t,n,o){const[c,r]=[e-n/2,e+n/2],[h,s]=[t-o/2,t+o/2];return c<s&&r>=h}exports.Plot=void 0,(e=>{(k=>{k.Select="select",k.Pan="pan",k.Query="query"})(e.Mode||(e.Mode={}));function t(k){const E=(k==null?void 0:k.type)??"unknown",N=React.createElement("div",{id:"plot",class:"relative h-full w-full drop-shadow-md"}),I=React.createElement("table",{class:"relative z-30 hidden bg-gray-50 shadow-md"});N.appendChild(I);const _=[],F={},q={},D=[],C=[],B=[],j=structuredClone({...defaultOptions,...k}),{expandX:H,expandY:W}=j,$=[[H,W,1-H,1-W]],V={active:!1,locked:!1,mousedown:!1,mousebutton:MouseButton.Left,mode:"select",mousecoords:[0,0,0,0],lastkey:"",ratio:(k==null?void 0:k.ratio)??void 0},Y=Reactive.of({type:E,data:_,container:N,queryTable:I,frames:F,scales:q,renderables:D,selectables:C,queryables:B,zoomStack:$,parameters:V,options:j});return setupFrames(Y,j),setupScales(Y,j),setupEvents$1(Y),Y}e.of=t,e.listen=Reactive.makeListenFn(),e.dispatch=Reactive.makeDispatchFn(),e.scatter=Scatterplot,e.bar=Barplot,e.fluct=Fluctuationplot,e.histo=Histogram,e.histo2d=Histogram2d,e.pcoords=Pcoordsplot;function n(k,E){k.appendChild(E.container),e.resize(E)}e.append=n;function o(k,E){for(const N of k.data)Reactive.removeListeners(N,"changed");k.data.length=0;for(let N=0;N<E.length;N++)k.data.push(E[N]);Reactive.listen(last(E),"changed",()=>e.render(k))}e.setData=o;function c(k,E){E.scales=k.scales,E.data=k.data;const{renderables:N,selectables:I,queryables:_}=k;for(const F of[N,I,_])F.push(E)}e.addGeom=c;function r(k,E){const{renderables:N,selectables:I,queryables:_}=k;for(const F of[N,I,_])remove(F,E)}e.deleteGeom=r;function h(k){addTailwind(k.container,"outline outline-2 outline-slate-600"),k.parameters.active=!0,e.dispatch(k,"activated")}e.activate=h;function s(k){removeTailwind(k.container,"outline outline-2 outline-slate-600"),k.parameters.active=!1,e.dispatch(k,"deactivated")}e.deactivate=s;function m(k){k.parameters.locked=!0}e.lock=m;function i(k){k.parameters.locked=!1}e.unlock=i;function f(k){for(const E of dataLayers)Frame.clear(k.frames[E]);for(const E of k.renderables)Geom.render(E,k.frames)}e.render=f;function l(k){for(const E of["base","xAxis","yAxis"])Frame.clear(k.frames[E]);renderAxisLabels(k),renderAxisTitles(k)}e.renderAxes=l;function a(k){Frame.clear(k.frames.user)}e.clearUserFrame=a;function y(k){for(const U of Object.values(k.frames))Frame.resize(U);const{container:E,scales:N,frames:I,parameters:_,options:F}=k,{clientWidth:q,clientHeight:D}=E,{x:C,y:B,width:j,height:H,area:W}=N,{margins:$}=F,[V,Y]=[$[0],$[1]],[X,Q]=[D-$[2],q-$[3]],K={default:!0};I.under.canvas.style.width=`calc(100% - ${Y}px - ${$[3]}px)`,I.under.canvas.style.height=`calc(100% - ${V}px - ${$[2]}px)`,I.over.canvas.style.width=`calc(100% - ${Y}px - ${$[3]}px)`,I.over.canvas.style.height=`calc(100% - ${V}px - ${$[2]}px)`;for(const U of Object.values(I))Frame.clip(U);exports.Expanse.set(C.codomain,U=>(U.min=Y,U.max=Q),K),exports.Expanse.set(B.codomain,U=>(U.min=V,U.max=X),K);const[Z,ee]=[Q-Y,X-V];if(exports.Expanse.set(j.codomain,U=>U.max=Z,K),exports.Expanse.set(H.codomain,U=>U.max=ee,K),exports.Expanse.set(W.codomain,U=>U.max=Math.min(Z,ee),K),_.ratio){const{expandX:U,expandY:te}=defaultOptions;exports.Expanse.set(C.domain,J=>(J.zero=U,J.one=1-U),K),exports.Expanse.set(B.domain,J=>(J.zero=te,J.one=1-te),K),e.applyRatio(k,_.ratio)}}e.resize=y;function p(k){const{selectables:E,parameters:N,frames:I}=k,_=new Set;for(const F of E){const q=Geom.check(F,N.mousecoords);for(let D=0;D<q.length;D++)_.add(q[D])}e.dispatch(k,"set-selected",{cases:Array.from(_)}),e.dispatch(k,"lock-others"),Frame.clear(I.user),Frame.rectangleXY(I.user,...N.mousecoords)}e.checkSelection=p;function d(k,E){k.parameters.mode=E}e.setMode=d;function u(k,E){k.parameters.mousedown=E}e.setMousedown=u;function x(k,E){k.parameters.mousebutton=E}e.setMouseButton=x,e.mousemoveHandlers={select:b,pan:v,query:S};function b(k,E){const{container:N,parameters:I}=k;if(!I.active||!I.mousedown)return;e.dispatch(k,"clear-transient");const{mousecoords:_}=I,{clientHeight:F}=N,q=E.offsetX,D=F-E.offsetY;_[2]=q,_[3]=D,e.checkSelection(k)}function v(k,E){const{container:N,scales:I,parameters:_}=k;if(!_.active||!_.mousedown)return;const{mousecoords:F}=_,{clientWidth:q,clientHeight:D}=N,[C,B]=F,j=E.offsetX,H=D-E.offsetY,W=(j-C)/q,$=(H-B)/D;exports.Scale.move(I.x,W),exports.Scale.move(I.y,$),F[0]=j,F[1]=H,e.clearUserFrame(k)}function S(k,E){const{offsetX:N,offsetY:I}=E,{container:_,queryTable:F,queryables:q}=k,{clientWidth:D,clientHeight:C}=_;F.style.display="none";const B=N,j=C-I;let H;for(const Y of q)if(H=Geom.query(Y,[B,j]),H)break;if(!H)return;clearNodeChildren(F);for(const[Y,X]of Object.entries(H)){const Q=React.createElement("tr",null,React.createElement("td",{class:"border border-gray-400 px-3"},Y),React.createElement("td",{class:"border border-gray-400 px-3 font-mono"},formatLabel(X)));F.appendChild(Q)}F.style.display="inline-block";const W=getComputedStyle(F),$=parseFloat(W.width.slice(0,-2)),{clientWidth:V}=F;B+$>D?(F.style.left="auto",F.style.right=`${V-N+5}px`):(F.style.left=`${B+5}px`,F.style.right="auto"),F.style.top=I+"px"}e.keybindings={"=":"grow","-":"shrink","]":"unfade","[":"fade",z:"zoom",x:"pop-zoom",o:"reorder",";":"decrement-anchor","'":"increment-anchor",n:"normalize"};function M(k){const{area:E,size:N,width:I}=k.scales;exports.Expanse.set(E.codomain,_=>(_.min*=1.1111111111111112,_.max*=1.1111111111111112)),exports.Expanse.set(N.codomain,_=>(_.min*=1.1111111111111112,_.max*=1.1111111111111112)),exports.Expanse.set(I.codomain,_=>_.mult<1?_.mult*=1.1111111111111112:null)}e.grow=M;function R(k){const{area:E,width:N,size:I}=k.scales;exports.Expanse.set(E.codomain,_=>(_.min*=.9,_.max*=.9)),exports.Expanse.set(I.codomain,_=>(_.min*=.9,_.max*=.9)),exports.Expanse.set(N.codomain,_=>_.mult*=.9)}e.shrink=R;function g(k){const{frames:E}=k;for(const N of baseLayers)Frame.setAlpha(E[N],I=>I*9/10);e.render(k)}e.fade=g;function w(k){const{frames:E}=k;for(const N of baseLayers)Frame.setAlpha(E[N],I=>I*10/9);e.render(k)}e.unfade=w;function A(k){const{frames:E,scales:N}=k;for(const I of baseLayers)Frame.resetAlpha(E[I]);for(const I of Object.values(N))exports.Scale.restoreDefaults(I);k.zoomStack.length=1,e.clearUserFrame(k)}e.reset=A;function P(k){e.setMode(k,"query")}e.setQueryMode=P;function z(k,E){const{scales:N,parameters:I,zoomStack:_}=k;let{coords:F,units:q}=E??{};q=q??"screen";let[D,C,B,j]=F??I.mousecoords;const{x:H,y:W}=N;if(q==="data"){const X={silent:!0};exports.Expanse.set(H.domain,Q=>(Q.zero=0,Q.one=1),X),exports.Expanse.set(W.domain,Q=>(Q.zero=0,Q.one=1),X),D=exports.Expanse.normalize(H.domain,D),B=exports.Expanse.normalize(H.domain,B),C=exports.Expanse.normalize(W.domain,C),j=exports.Expanse.normalize(W.domain,j)}if(q==="screen"){if(Math.abs(B-D)<10||Math.abs(j-C)<10)return;D=trunc(exports.Expanse.normalize(H.codomain,D)),B=trunc(exports.Expanse.normalize(H.codomain,B)),C=trunc(exports.Expanse.normalize(W.codomain,C)),j=trunc(exports.Expanse.normalize(W.codomain,j))}[D,B]=[D,B].sort(diff),[C,j]=[C,j].sort(diff),exports.Scale.expand(N.x,D,B),exports.Scale.expand(N.y,C,j);const $=rangeInverse(D,B),V=rangeInverse(C,j),Y=sqrt(max($,V));exports.Expanse.set(N.width.codomain,X=>X.max*=$),exports.Expanse.set(N.height.codomain,X=>X.max*=V),exports.Expanse.set(N.area.codomain,X=>X.max*=Y),exports.Expanse.set(N.size.codomain,X=>X.max*=Y),_.push([D,C,B,j]),e.dispatch(k,"clear-transient"),e.render(k)}e.zoom=z;function T(k){const{scales:E,zoomStack:N}=k;if(N.length===1)return;const[I,_,F,q]=N[N.length-1],[D,C]=invertRange(I,F),[B,j]=invertRange(_,q);exports.Scale.expand(E.x,D,C),exports.Scale.expand(E.y,B,j);const H=rangeInverse(D,C),W=rangeInverse(B,j),$=1/sqrt(max(1/H,1/W));exports.Expanse.set(E.width.codomain,V=>V.max*=H),exports.Expanse.set(E.height.codomain,V=>V.max*=W),exports.Expanse.set(E.area.codomain,V=>V.max*=$),exports.Expanse.set(E.size.codomain,V=>V.max*=$),N.pop(),e.clearUserFrame(k),e.render(k)}e.popZoom=T;function L(k,E){const{x:N,y:I}=k.scales;if(!exports.Expanse.isContinuous(N.domain)||!exports.Expanse.isContinuous(I.domain))throw new Error("Both axes need to be continuous to set a ratio");k.parameters.ratio=E,e.resize(k)}e.setRatio=L;function O(k,E){const{scales:N}=k,{x:I,y:_}=N,F=exports.Scale.unitRatio(I),q=exports.Scale.unitRatio(_)*E;if(F>q){const D=q/F*exports.Expanse.unitRange(_.domain);exports.Expanse.set(I.domain,C=>(C.zero=(1-D)/2,C.one=(1+D)/2),{default:!0})}else{const D=F/q*exports.Expanse.unitRange(I.domain);exports.Expanse.set(_.domain,C=>(C.zero=(1-D)/2,C.one=(1+D)/2),{default:!0})}}e.applyRatio=O;function G(k,E){let{scale:N,min:I,max:_,mult:F,labels:q,direction:D}=E;const C=k.scales[N].domain,B=k.scales[N].codomain;if(!["x","y","area","size"].includes(N))throw new Error(`Unrecognized scale '${N}'`);const j={default:E.default??!1};if(I!==void 0||_!==void 0){if(!exports.Expanse.isContinuous(C))throw new Error("Limits can only be set with a continuous scale");I=I??C.min,_=_??C.max,exports.Expanse.set(C,H=>(H.min=I,H.max=_),j),k.parameters.ratio=void 0}if(q){if(!exports.Expanse.isDiscrete(C))throw new Error("Labels can be ordered with a discrete scale only");if(!stringArraysMatch(C.labels,q))throw new Error("Labels must match the scale's labels");const H=orderIndicesByTable(C.labels,q);exports.Expanse.reorder(C,H)}D&&exports.Expanse.set(C,H=>H.direction=D,j),F&&exports.Expanse.set(B,H=>H.mult=F,j)}e.setScale=G})(exports.Plot||(exports.Plot={}));function setupFrames(e,t){const{container:n,frames:o}=e,{margins:c,colors:r,axisTitleSize:h}=t,[s,m,i,f]=c,l=[7,6,5,4,3,2,1,0],a="absolute top-0 right-0 w-full h-full";for(const y of l){const p=React.createElement("canvas",{class:a});p.style.zIndex=`${7-y+2}`;const d=Frame.of(p,t),u=r[y];Frame.setContext(d,{fillStyle:u,strokeStyle:u}),d.margins=c,o[y]=d}o.base=Frame.of(React.createElement("canvas",{class:a+" z-0 bg-gray-100"}),t),Frame.setContext(o.base,{font:`${h}rem sans-serif`,textBaseline:"middle",textAlign:"center"}),o.under=Frame.of(React.createElement("canvas",{class:a+" z-1 bg-white"}),t),o.under.canvas.style.width=`calc(100% - ${m}px - ${f}px)`,o.under.canvas.style.height=`calc(100% - ${s}px - ${i}px)`,o.under.canvas.style.top=i+"px",o.under.canvas.style.right=f+"px",o.over=Frame.of(React.createElement("canvas",{class:a+"relative z-10 border border-b-black border-l-black"}),t),o.over.canvas.style.width=`calc(100% - ${m}px - ${f}px)`,o.over.canvas.style.height=`calc(100% - ${s}px - ${i}px)`,o.over.canvas.style.top=i+"px",o.over.canvas.style.right=f+"px",o.user=Frame.of(React.createElement("canvas",{class:a+" z-10"}),t),o.user.margins=c,Frame.setContext(o.user,{globalAlpha:.06666666666666667}),o.xAxis=Frame.of(React.createElement("canvas",{class:a}),t),Frame.setContext(o.xAxis,{fillStyle:"#3B4854",textBaseline:"top",textAlign:"center",font:`${defaultOptions.axisLabelSize}rem serif`}),o.yAxis=Frame.of(React.createElement("canvas",{class:a}),t),Frame.setContext(o.yAxis,{fillStyle:"#3B4854",textBaseline:"middle",textAlign:"right",font:`${defaultOptions.axisLabelSize}rem serif`});for(let[y,p]of Object.entries(o))isNaN(parseFloat(y))||(y="data-"+y),p.canvas.id=`frame-${y}`,Frame.append(p,n)}function setupEvents$1(e){const{container:t,parameters:n,frames:o}=e,{mousecoords:c}=n;for(const[r,h]of Object.entries(exports.Plot.keybindings))exports.Plot.listen(e,r,()=>exports.Plot.dispatch(e,h));t.addEventListener("mousedown",r=>{r.stopPropagation();const{locked:h}=n;exports.Plot.activate(e),exports.Plot.setMousedown(e,!0),exports.Plot.setMouseButton(e,r.button),r.button===MouseButton.Left?exports.Plot.setMode(e,"select"):r.button===MouseButton.Right&&exports.Plot.setMode(e,"pan");const s=r.offsetX,m=t.clientHeight-r.offsetY;copyValues([s,m,s,m],c),!h&&n.mode==="select"&&(exports.Plot.dispatch(e,"clear-transient"),exports.Plot.checkSelection(e)),exports.Plot.unlock(e)}),t.addEventListener("contextmenu",r=>{r.preventDefault(),exports.Plot.setMousedown(e,!0),exports.Plot.setMouseButton(e,MouseButton.Right),exports.Plot.setMode(e,"pan"),n.mousecoords[0]=r.offsetX,n.mousecoords[1]=t.clientHeight-r.offsetY,Frame.clear(o.user)}),t.addEventListener("mouseup",()=>exports.Plot.setMousedown(e,!1)),t.addEventListener("mousemove",throttle(r=>{exports.Plot.mousemoveHandlers[n.mode](e,r)},10)),exports.Plot.listen(e,"reset",()=>exports.Plot.reset(e)),exports.Plot.listen(e,"resize",()=>exports.Plot.resize(e)),exports.Plot.listen(e,"activate",()=>exports.Plot.activate(e)),exports.Plot.listen(e,"deactivate",()=>exports.Plot.deactivate(e)),exports.Plot.listen(e,"render",()=>exports.Plot.render(e)),exports.Plot.listen(e,"lock",()=>exports.Plot.lock(e)),exports.Plot.listen(e,"unlock",()=>exports.Plot.unlock(e)),exports.Plot.listen(e,"query-mode",()=>exports.Plot.setMode(e,"query")),exports.Plot.listen(e,"render-axes",()=>exports.Plot.renderAxes(e)),exports.Plot.listen(e,"clear-transient",()=>exports.Plot.clearUserFrame(e)),exports.Plot.listen(e,"set-scale",r=>exports.Plot.setScale(e,r)),exports.Plot.listen(e,"grow",()=>exports.Plot.grow(e)),exports.Plot.listen(e,"shrink",()=>exports.Plot.shrink(e)),exports.Plot.listen(e,"fade",()=>exports.Plot.fade(e)),exports.Plot.listen(e,"unfade",()=>exports.Plot.unfade(e)),exports.Plot.listen(e,"zoom",r=>exports.Plot.zoom(e,r)),exports.Plot.listen(e,"pop-zoom",()=>exports.Plot.popZoom(e));for(const r of Object.values(e.scales))exports.Scale.listen(r,"changed",()=>{exports.Plot.render(e),exports.Plot.renderAxes(e)})}function setupScales(e,t){var b,v;const{scales:n,container:o}=e,{clientWidth:c,clientHeight:r}=o,h=exports.Expanse[((b=t==null?void 0:t.scales)==null?void 0:b.x)??"continuous"](),s=exports.Expanse[((v=t==null?void 0:t.scales)==null?void 0:v.y)??"continuous"]();n.x=exports.Scale.of(h,exports.Expanse.continuous(0,c)),n.y=exports.Scale.of(s,exports.Expanse.continuous(0,r)),n.height=exports.Scale.of(exports.Expanse.continuous(),exports.Expanse.continuous(0,r)),n.width=exports.Scale.of(exports.Expanse.continuous(),exports.Expanse.continuous(0,c)),n.area=exports.Scale.of(exports.Expanse.continuous(),exports.Expanse.continuous()),n.size=exports.Scale.of(exports.Expanse.continuous(),exports.Expanse.continuous(0,t.size));const{x:m,y:i,width:f,height:l,size:a,area:y}=n,p={default:!0,silent:!0},{expandX:d,expandY:u}=defaultOptions;exports.Expanse.set(y.domain,S=>S.ratio=!0,p),exports.Expanse.set(a.domain,S=>S.ratio=!0,p),exports.Expanse.set(y.codomain,S=>(S.trans=square,S.inv=sqrt),p),exports.Expanse.set(a.codomain,S=>(S.trans=square,S.inv=sqrt),p),exports.Expanse.set(m.domain,S=>(S.zero=d,S.one=1-d),p),exports.Expanse.set(i.domain,S=>(S.zero=u,S.one=1-u),p),exports.Expanse.set(f.domain,S=>S.one=1-2*d,p),exports.Expanse.set(l.domain,S=>S.one=1-2*u,p),exports.Expanse.set(y.domain,S=>S.one=1-2*Math.max(d,u),p);const x=S=>Math.max(S,0);exports.Expanse.set(f.codomain,S=>S.inv=x,p),exports.Expanse.set(l.codomain,S=>S.inv=x,p)}function keybindingsMenu(e){const t=React.createElement("div",null,React.createElement("div",null,React.createElement("div",{id:"modal",class:"tailwind absolute left-0 top-0 z-50 hidden size-full flex-col bg-slate-800 bg-opacity-80 p-10"},React.createElement("div",{id:"bindings",class:"relative flex h-full w-fit flex-col flex-wrap justify-start py-10"})),React.createElement("button",{class:"absolute right-0 top-0 z-30 select-none rounded-bl-md bg-gray-300 p-1 px-2 text-sm text-white hover:bg-gray-400"},"keybindings"))),n=t.querySelector("#modal"),o=t.querySelector("#bindings");o.style.columnFill="auto";const c=t.querySelector("button");let r=!1;function h(){n.style.display="flex"}function s(){r||(n.style.display="none")}c.addEventListener("click",h),n.addEventListener("click",s);const m=e.keybindings;for(const[i,f]of Object.entries(m)){const l=React.createElement("span",{class:"m-1 flex flex-row"},React.createElement("button",{class:"m-1 w-8 rounded-md bg-gray-400 p-1 px-2 text-center text-white outline-none hover:bg-gray-500"},i),React.createElement("div",{class:"m-1 p-1 px-2 text-white"},capitalize(f.replaceAll("-"," ")))),a=l.querySelector("div"),y=l.querySelector("button");a.addEventListener("click",d=>d.stopPropagation()),y.addEventListener("click",d=>{r||(d.stopPropagation(),addTailwind(y,"text-black bg-slate-200 hover:bg-slate-200"),window.addEventListener("keydown",p),r=!0)});const p=d=>{const{key:u}=d,x=y.innerText;u in m&&u!==x||(exports.Scene.setKeyBinding(e,u,f),y.innerText=d.key,removeTailwind(y,"text-black bg-slate-200 hover:bg-slate-200"),window.removeEventListener("keydown",p),r=!1)};o.appendChild(l)}return t}exports.Scene=void 0,(e=>{function t(g,w){const A=React.createElement("div",{id:"scene-container",class:"tailwind pr-15 relative flex h-full w-full content-center items-center justify-center bg-[#deded9] p-10"},React.createElement("div",{id:"plot-container",class:"grid h-full w-full grid-cols-1 grid-rows-1 gap-5"})),P=A.querySelector("#plot-container"),[z,T]=[1,1],L=Marker.of(Object.values(g)[0].length),O=[],G={},k=Object.assign(defaultOptions,w);updateOptions(k);for(const[_,F]of Object.entries(g))Meta.hasName(F)||Meta.setName(F,_);const E={...e.keybindings,...exports.Plot.keybindings},N={send:console.log},I=Reactive.of({data:g,container:A,plotContainer:P,rows:z,cols:T,marker:L,client:N,plots:O,plotsByType:G,options:k,keybindings:E});if(w!=null&&w.websocketURL){const _=new WebSocket(w.websocketURL),F={sender:"scene",target:"session",type:"connected"};_.addEventListener("open",()=>_.send(JSON.stringify(F))),_.addEventListener("message",q=>{p(I,JSON.parse(q.data))}),window.addEventListener("beforeunload",()=>_.close()),I.client=_}return A.appendChild(keybindingsMenu(I)),setupEvents(I),I}e.of=t;async function n(g,w){const A=await fetchJSON(g);return e.of(A,w)}e.ofAsync=n,e.listen=Reactive.makeListenFn(),e.dispatch=Reactive.makeDispatchFn();function o(g,w){g.appendChild(w.container),e.resize(w)}e.append=o;function c(g,w){const{plotContainer:A,marker:P,plots:z,plotsByType:T}=g;exports.Plot.listen(w,"activated",()=>{for(const O of z)O!=w&&exports.Plot.dispatch(O,"deactivate");g.activePlot=w}),exports.Plot.listen(w,"lock-others",()=>{for(const O of z)O!==w&&exports.Plot.dispatch(O,"lock")}),exports.Plot.listen(w,"set-selected",O=>{Marker.update(P,O.cases)}),exports.Plot.listen(w,"clear-transient",()=>{for(const O of z)exports.Plot.clearUserFrame(O);Marker.clearTransient(P)}),z.push(w);const{type:L}=w;T[L]||(T[L]=[]),T[L].push(w),exports.Plot.append(A,w),s(g),h(g),e.resize(g)}e.addPlot=c;function r(g,w){const{type:A,variables:P,reducer:z,queries:T}=w??{};if(!A||A==="unknown"||!P)return;for(const k of P)if(!Object.keys(g.data).includes(k))throw new Error(`Variable '${k}' is not present in the data`);const L=keysToSelectors(P),O={};if(z&&(O.reducer=exports.Reducer.parse(z)),T)if(isStringArray(T))O.queries=keysToSelectors(T);else{const k=E=>T.map(([N,I])=>[E[N],exports.Reducer.parse(I)]);O.queries=k}const G=exports.Plot[A](g,L,O);e.addPlot(g,G)}e.addPlotBySpec=r;function h(g){const{plots:w}=g;if(w.length===0)return;const A=Math.ceil(Math.sqrt(w.length)),P=Math.ceil(w.length/A);e.setDimensions(g,P,A)}function s(g){for(let w=0;w<g.plots.length;w++)g.plots[w].container.id=`plot${w+1}`}function m(g){const w=last(g.plots);w&&f(g,w)}e.popPlot=m;function i(g,w){const A=y(g,w);A&&f(g,A)}e.removePlot=i;function f(g,w){remove(g.plots,w),remove(g.plotsByType[w.type],w),g.plotContainer.removeChild(w.container),Reactive.removeAllListeners(w),s(g),h(g),e.resize(g)}function l(g,w,A){const{plotContainer:P}=g;g.rows=w,g.cols=A,P.style.gridTemplateRows=Array(w).fill("1fr").join(" "),P.style.gridTemplateColumns=Array(A).fill("1fr").join(" "),e.resize(g)}e.setDimensions=l;function a(g,w){return w==="scene"?g:y(g,w)}e.getTarget=a;function y(g,w){const{plots:A,plotsByType:P}=g;let[z,T]=splitNumericSuffix(w);const L=parseInt(T,10)-1;if(z==="plot"||z==="p")return A[L];if(z=z.replace("plot","").replace("gram",""),z in Object.keys(plotIdShortDict)&&(z=plotIdShortDict[z]),z in P)return P[z][L]}e.getPlot=y;function p(g,w){const{client:A}=g;if(!A)return;const{type:P,target:z,data:T}=w,L=a(g,z);L&&Reactive.dispatch(L,P,T)}e.handleMessage=p;function d(g,w,A){const[P,z]=["scene","session"],T=JSON.stringify({sender:P,target:z,type:w,data:A});g.client.send(T)}e.sendMessage=d;function u(g){for(const w of g.plots)exports.Plot.dispatch(w,"resize")}e.resize=u;function x(g){for(const w of g.plots)exports.Plot.dispatch(w,"reset");Marker.clearTransient(g.marker)}e.reset=x;function b(g){for(const w of g.plots)exports.Plot.dispatch(w,"query-mode")}e.setQueryMode=b;function v(g){Marker.setGroup(g.marker,Group.First)}e.setGroupFirst=v;function S(g){Marker.setGroup(g.marker,Group.Second)}e.setGroupSecond=S;function M(g){Marker.setGroup(g.marker,Group.Third)}e.setGroupThird=M;function R(g,w,A){let P;for(const[z,T]of Object.entries(g.keybindings))if(T===A){P=z;break}P&&delete g.keybindings[P],g.keybindings[w]=A}e.setKeyBinding=R,e.keybindings={r:"reset",q:"query-mode",1:"group-1",2:"group-2",3:"group-3"}})(exports.Scene||(exports.Scene={}));function setupEvents(e){const{marker:t,plots:n,container:o,keybindings:c}=e;o.addEventListener("mousedown",()=>{for(const r of n)exports.Plot.dispatch(r,"deactivate")}),o.addEventListener("dblclick",()=>{for(const r of n)exports.Plot.dispatch(r,"deactivate"),Frame.clear(r.frames.user);Marker.clearAll(e.marker),e.activePlot=void 0}),window.addEventListener("keydown",r=>{const h=c[r.key];h&&(e.activePlot&&exports.Plot.dispatch(e.activePlot,h),exports.Scene.dispatch(e,h))}),window.addEventListener("keyup",()=>{Marker.setGroup(t,Transient);for(const r of e.plots)r.parameters.mode=exports.Plot.Mode.Select,r.queryTable.style.display="none"}),window.addEventListener("resize",()=>exports.Scene.resize(e)),Marker.listen(t,"cleared",()=>{for(const r of n)exports.Plot.dispatch(r,"unlock")}),exports.Scene.listen(e,"resize",()=>exports.Scene.resize(e)),exports.Scene.listen(e,"reset",()=>exports.Scene.reset(e)),exports.Scene.listen(e,"query-mode",()=>exports.Scene.setQueryMode(e)),exports.Scene.listen(e,"group-1",()=>exports.Scene.setGroupFirst(e)),exports.Scene.listen(e,"group-2",()=>exports.Scene.setGroupSecond(e)),exports.Scene.listen(e,"group-3",()=>exports.Scene.setGroupThird(e)),exports.Scene.listen(e,"connected",()=>{var r;return console.log(`Connected to Websocket server on: ${(r=e.client)==null?void 0:r.url}`)}),exports.Scene.listen(e,"set-dims",r=>{exports.Scene.setDimensions(e,r.rows,r.cols)}),exports.Scene.listen(e,"add-plot",r=>exports.Scene.addPlotBySpec(e,r)),exports.Scene.listen(e,"pop-plot",()=>exports.Scene.popPlot(e)),exports.Scene.listen(e,"remove-plot",r=>{exports.Scene.removePlot(e,r.id)}),exports.Scene.listen(e,"set-selected",r=>Marker.update(t,r.cases)),exports.Scene.listen(e,"set-assigned",r=>{const h=7-Math.min(r.group,3);Marker.update(t,r.cases,{group:h})}),exports.Scene.listen(e,"get-selected",()=>{const r=filterIndices(t.indices,Marker.isTransient);exports.Scene.sendMessage(e,"get-selected",{cases:r})}),exports.Scene.listen(e,"get-assigned",r=>{const h=m=>(m|4)===7-Math.min(r.group,3),s=filterIndices(t.indices,h);exports.Scene.sendMessage(e,"get-assigned",{cases:s,group:r.group})}),exports.Scene.listen(e,"clear-selection",()=>Marker.clearAll(t)),exports.Scene.listen(e,"set-scale",r=>{if(!r||!r.id)return;const h=exports.Scene.getPlot(e,r.id);h&&exports.Plot.dispatch(h,"set-scale",r)}),exports.Scene.listen(e,"zoom",r=>{if(!r||!r.id)return;const h=exports.Scene.getPlot(e,r.id);h&&exports.Plot.dispatch(h,"zoom",r)})}const plotIdShortDict={s:"scatter",b:"bar",h:"histo",f:"fluct",hh:"histo2d",pc:"pcoords"};return exports.POSITIONS=POSITIONS,exports.addIndexed=addIndexed,exports.addTailwind=addTailwind,exports.applyDirection=applyDirection,exports.applyWith=applyWith,exports.binBreaks=binBreaks,exports.call=call,exports.capitalize=capitalize,exports.clearNodeChildren=clearNodeChildren,exports.compareAlphaNumeric=compareAlphaNumeric,exports.convertToSuperscript=convertToSuperscript,exports.copyProps=copyProps,exports.copyValues=copyValues,exports.cumsum=cumsum,exports.dec=dec,exports.diff=diff,exports.exp10=exp10,exports.exponentialToSuperscript=exponentialToSuperscript,exports.fetchJSON=fetchJSON,exports.filterIndices=filterIndices,exports.findLength=findLength,exports.formatAxisLabels=formatAxisLabels,exports.formatLabel=formatLabel,exports.formatText=formatText,exports.identity=identity,exports.inc=inc,exports.invertRange=invertRange,exports.isArray=isArray,exports.isIntegerString=isIntegerString,exports.isNumber=isNumber,exports.isNumberArray=isNumberArray,exports.isPrimitive=isPrimitive,exports.isStringArray=isStringArray,exports.just=just,exports.keysToSelectors=keysToSelectors,exports.last=last,exports.log10=log10,exports.makeGetter=makeGetter,exports.max=max,exports.merge=merge,exports.minDecimal=minDecimal,exports.minmax=minmax,exports.one=one,exports.orderBy=orderBy,exports.orderIndices=orderIndices,exports.orderIndicesByTable=orderIndicesByTable,exports.ordered=ordered,exports.pointInRect=pointInRect,exports.prettyBreaks=prettyBreaks,exports.prod=prod,exports.randomInteger=randomInteger,exports.rangeInverse=rangeInverse,exports.rectSegmentIntersect=rectSegmentIntersect,exports.rectsIntersect=rectsIntersect,exports.remove=remove,exports.removeTailwind=removeTailwind,exports.rep=rep,exports.round=round,exports.row=row,exports.segmentsIntersect=segmentsIntersect,exports.selector=selector,exports.seq=seq,exports.splitNumericSuffix=splitNumericSuffix,exports.sqrt=sqrt,exports.square=square,exports.stringArraysMatch=stringArraysMatch,exports.stripWS=stripWS,exports.subset=subset,exports.sum=sum,exports.throttle=throttle,exports.timeExecution=timeExecution,exports.toLowerCase=toLowerCase,exports.toUpperCase=toUpperCase,exports.trunc=trunc,exports.uniqueIntegers=uniqueIntegers,exports.zero=zero,Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),exports}({});
