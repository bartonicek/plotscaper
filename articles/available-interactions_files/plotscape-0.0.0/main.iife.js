var plotscape=function(exports){"use strict";var __vite_style__=document.createElement("style");__vite_style__.textContent=`*:where(.tailwind,.tailwind *),:before:where(.tailwind,.tailwind *),:after:where(.tailwind,.tailwind *){box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}:before:where(.tailwind,.tailwind *),:after:where(.tailwind,.tailwind *){--tw-content: ""}.tailwind{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;-o-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}.tailwind{margin:0;line-height:inherit}hr:where(.tailwind,.tailwind *){height:0;color:inherit;border-top-width:1px}abbr:where([title]):where(.tailwind,.tailwind *){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1:where(.tailwind,.tailwind *),h2:where(.tailwind,.tailwind *),h3:where(.tailwind,.tailwind *),h4:where(.tailwind,.tailwind *),h5:where(.tailwind,.tailwind *),h6:where(.tailwind,.tailwind *){font-size:inherit;font-weight:inherit}a:where(.tailwind,.tailwind *){color:inherit;text-decoration:inherit}b:where(.tailwind,.tailwind *),strong:where(.tailwind,.tailwind *){font-weight:bolder}code:where(.tailwind,.tailwind *),kbd:where(.tailwind,.tailwind *),samp:where(.tailwind,.tailwind *),pre:where(.tailwind,.tailwind *){font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small:where(.tailwind,.tailwind *){font-size:80%}sub:where(.tailwind,.tailwind *),sup:where(.tailwind,.tailwind *){font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub:where(.tailwind,.tailwind *){bottom:-.25em}sup:where(.tailwind,.tailwind *){top:-.5em}table:where(.tailwind,.tailwind *){text-indent:0;border-color:inherit;border-collapse:collapse}button:where(.tailwind,.tailwind *),input:where(.tailwind,.tailwind *),optgroup:where(.tailwind,.tailwind *),select:where(.tailwind,.tailwind *),textarea:where(.tailwind,.tailwind *){font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button:where(.tailwind,.tailwind *),select:where(.tailwind,.tailwind *){text-transform:none}button:where(.tailwind,.tailwind *),input:where([type=button]):where(.tailwind,.tailwind *),input:where([type=reset]):where(.tailwind,.tailwind *),input:where([type=submit]):where(.tailwind,.tailwind *){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring:where(.tailwind,.tailwind *){outline:auto}:-moz-ui-invalid:where(.tailwind,.tailwind *){box-shadow:none}progress:where(.tailwind,.tailwind *){vertical-align:baseline}::-webkit-inner-spin-button:where(.tailwind,.tailwind *),::-webkit-outer-spin-button:where(.tailwind,.tailwind *){height:auto}[type=search]:where(.tailwind,.tailwind *){-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration:where(.tailwind,.tailwind *){-webkit-appearance:none}::-webkit-file-upload-button:where(.tailwind,.tailwind *){-webkit-appearance:button;font:inherit}summary:where(.tailwind,.tailwind *){display:list-item}blockquote:where(.tailwind,.tailwind *),dl:where(.tailwind,.tailwind *),dd:where(.tailwind,.tailwind *),h1:where(.tailwind,.tailwind *),h2:where(.tailwind,.tailwind *),h3:where(.tailwind,.tailwind *),h4:where(.tailwind,.tailwind *),h5:where(.tailwind,.tailwind *),h6:where(.tailwind,.tailwind *),hr:where(.tailwind,.tailwind *),figure:where(.tailwind,.tailwind *),p:where(.tailwind,.tailwind *),pre:where(.tailwind,.tailwind *){margin:0}fieldset:where(.tailwind,.tailwind *){margin:0;padding:0}legend:where(.tailwind,.tailwind *){padding:0}ol:where(.tailwind,.tailwind *),ul:where(.tailwind,.tailwind *),menu:where(.tailwind,.tailwind *){list-style:none;margin:0;padding:0}dialog:where(.tailwind,.tailwind *){padding:0}textarea:where(.tailwind,.tailwind *){resize:vertical}input::-moz-placeholder:where(.tailwind,.tailwind *),textarea::-moz-placeholder:where(.tailwind,.tailwind *){opacity:1;color:#9ca3af}input::placeholder:where(.tailwind,.tailwind *),textarea::placeholder:where(.tailwind,.tailwind *){opacity:1;color:#9ca3af}button:where(.tailwind,.tailwind *),[role=button]:where(.tailwind,.tailwind *){cursor:pointer}:disabled:where(.tailwind,.tailwind *){cursor:default}img:where(.tailwind,.tailwind *),svg:where(.tailwind,.tailwind *),video:where(.tailwind,.tailwind *),canvas:where(.tailwind,.tailwind *),audio:where(.tailwind,.tailwind *),iframe:where(.tailwind,.tailwind *),embed:where(.tailwind,.tailwind *),object:where(.tailwind,.tailwind *){display:block;vertical-align:middle}img:where(.tailwind,.tailwind *),video:where(.tailwind,.tailwind *){max-width:100%;height:auto}[hidden]:where(.tailwind,.tailwind *){display:none}*,:before,:after{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }.tw-absolute{position:absolute}.tw-relative{position:relative}.tw-left-0{left:0}.tw-right-0{right:0}.tw-top-0{top:0}.tw-z-10{z-index:10}.tw-z-30{z-index:30}.tw-z-50{z-index:50}.tw-m-1{margin:.25rem}.tw-flex{display:flex}.tw-grid{display:grid}.tw-size-full{width:100%;height:100%}.tw-h-5\\/6{height:83.333333%}.tw-h-full{height:100%}.tw-h-screen{height:100vh}.tw-w-5\\/6{width:83.333333%}.tw-w-8{width:2rem}.tw-w-fit{width:-moz-fit-content;width:fit-content}.tw-w-full{width:100%}.tw-select-none{-webkit-user-select:none;-moz-user-select:none;user-select:none}.tw-grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.tw-grid-rows-1{grid-template-rows:repeat(1,minmax(0,1fr))}.tw-flex-row{flex-direction:row}.tw-flex-col{flex-direction:column}.tw-flex-wrap{flex-wrap:wrap}.tw-content-center{align-content:center}.tw-items-center{align-items:center}.tw-justify-start{justify-content:flex-start}.tw-justify-center{justify-content:center}.tw-gap-\\[1em\\]{gap:1em}.tw-rounded-md{border-radius:.375rem}.tw-rounded-bl-md{border-bottom-left-radius:.375rem}.tw-border{border-width:1px}.tw-border-black{--tw-border-opacity: 1;border-color:rgb(0 0 0 / var(--tw-border-opacity))}.tw-border-b-black{--tw-border-opacity: 1;border-bottom-color:rgb(0 0 0 / var(--tw-border-opacity))}.tw-border-l-black{--tw-border-opacity: 1;border-left-color:rgb(0 0 0 / var(--tw-border-opacity))}.tw-bg-\\[\\#deded9\\]{--tw-bg-opacity: 1;background-color:rgb(222 222 217 / var(--tw-bg-opacity))}.tw-bg-gray-100{--tw-bg-opacity: 1;background-color:rgb(243 244 246 / var(--tw-bg-opacity))}.tw-bg-gray-300{--tw-bg-opacity: 1;background-color:rgb(209 213 219 / var(--tw-bg-opacity))}.tw-bg-gray-400{--tw-bg-opacity: 1;background-color:rgb(156 163 175 / var(--tw-bg-opacity))}.tw-bg-slate-200{--tw-bg-opacity: 1;background-color:rgb(226 232 240 / var(--tw-bg-opacity))}.tw-bg-slate-800{--tw-bg-opacity: 1;background-color:rgb(30 41 59 / var(--tw-bg-opacity))}.tw-bg-white{--tw-bg-opacity: 1;background-color:rgb(255 255 255 / var(--tw-bg-opacity))}.tw-bg-opacity-80{--tw-bg-opacity: .8}.tw-p-1{padding:.25rem}.tw-p-10{padding:2.5rem}.tw-px-2{padding-left:.5rem;padding-right:.5rem}.tw-px-3{padding-left:.75rem;padding-right:.75rem}.tw-py-1{padding-top:.25rem;padding-bottom:.25rem}.tw-py-10{padding-top:2.5rem;padding-bottom:2.5rem}.tw-text-center{text-align:center}.tw-font-mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}.tw-text-sm{font-size:.875rem;line-height:1.25rem}.tw-text-black{--tw-text-opacity: 1;color:rgb(0 0 0 / var(--tw-text-opacity))}.tw-text-white{--tw-text-opacity: 1;color:rgb(255 255 255 / var(--tw-text-opacity))}.tw-shadow-md{--tw-shadow: 0 4px 6px -1px rgb(0 0 0 / .1), 0 2px 4px -2px rgb(0 0 0 / .1);--tw-shadow-colored: 0 4px 6px -1px var(--tw-shadow-color), 0 2px 4px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.tw-outline-none{outline:2px solid transparent;outline-offset:2px}.tw-outline{outline-style:solid}.tw-outline-2{outline-width:2px}.tw-outline-slate-600{outline-color:#475569}.tw-drop-shadow-md{--tw-drop-shadow: drop-shadow(0 4px 3px rgb(0 0 0 / .07)) drop-shadow(0 2px 2px rgb(0 0 0 / .06));filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.hover\\:tw-bg-gray-400:hover{--tw-bg-opacity: 1;background-color:rgb(156 163 175 / var(--tw-bg-opacity))}.hover\\:tw-bg-gray-500:hover{--tw-bg-opacity: 1;background-color:rgb(107 114 128 / var(--tw-bg-opacity))}.hover\\:tw-bg-slate-200:hover{--tw-bg-opacity: 1;background-color:rgb(226 232 240 / var(--tw-bg-opacity))}
`,document.head.appendChild(__vite_style__);const METADATA=Symbol("metadata");var Meta;(e=>{function t(a){return a[METADATA]={},a}e.of=t;function n(a){return!!a[METADATA]}e.hasMetadata=n;function s(a,l){var r;return!!((r=a[METADATA])!=null&&r[l])}e.has=s;function u(a,l){return Array.isArray(l)?l.map(r=>o(a,r)):o(a,l)}e.get=u;function d(a,l){n(a)||(a[METADATA]={});for(const[r,i]of Object.entries(l))a[METADATA][r]=i}e.set=d;function f(a,l,r){if(!n(a))return;n(l)||(l[METADATA]={});const i=r??Object.keys(a[METADATA]);for(const c of i)l[METADATA][c]=u(a,c)}e.copy=f;function o(a,l){var r;return l==="length"&&Array.isArray(a)?a.length:(r=a[METADATA])==null?void 0:r[l]}})(Meta||(Meta={}));var Getter;(e=>{function t(o){if(typeof o=="function")return o;if(Array.isArray(o)){const a=l=>o[l];return Meta.set(a,{length:o.length}),a}if(isTypedArray(o)){const a=l=>o[l];return Meta.set(a,{length:o.length}),a}return()=>o}e.of=t;function n(o){return()=>o}e.constant=n;function s(o,a){const l=e.of(o),r=i=>l(a[i]);return isObject(o)&&Meta.copy(o,r),Meta.set(r,{length:a.length}),r}e.proxy=s;function u(o){const a=o.map(e.of),l=r=>a.map(i=>i(r));return Meta.copy(o[0],l,["length"]),l}e.multi=u;function d(o){const a={};for(const l of Reflect.ownKeys(o))a[l]=e.of(o[l]);return a}e.mapObject=d;function f(o,a){const l=e.of(a),r=Array(o);for(let i=0;i<o;i++)r[i]=l(i);return r}e.array=f})(Getter||(Getter={}));function identity(e){return e}const just=e=>()=>e,zero=just(0),one=just(1);function inc(e){return e+1}function dec(e){return e-1}function call(e){return e()}function bimap(e,t,n){if(e.length!==t.length)throw new Error("Arrays must be of the same length");const s=Array(e.length);for(let u=0;u<e.length;u++)s[u]=n(e[u],t[u]);return s}function square(e){return e**2}const sqrt=Math.sqrt,log10=Math.log10;function exp10(e){return 10**e}const max=Math.max;function diff(e,t){return e-t}function sum(e,t){return e+t}function prod(e,t){return e*t}function trunc(e,t=0,n=1){return Math.min(Math.max(e,t),n)}function rangeInverse(e,t){return 1/(t-e)}function invertRange(e,t){const n=rangeInverse(e,t);return[-e*n,n-e*n]}function round(e,t=0){return Math.round(e*10**t)/10**t}function compareAlphaNumeric(e,t){return e.localeCompare(t,"en",{numeric:!0})}function capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}function toLowerCase(e){return e.toLocaleLowerCase()}function toUpperCase(e){return e.toLocaleUpperCase()}function stripWS(e){return e.replace(/\s/g,"")}function last(e){return e[e.length-1]}function rep(e,t){return Array(t).fill(e)}function seq(e,t,n){const s=Math.abs(t-e);n=n??Math.ceil(s)+1;const u=s/(n-1),d=t>=e?1:-1;return Array.from(Array(n),(f,o)=>e+d*u*o)}function seqLength(e,t){return Array.from(Array(t),(n,s)=>e+s)}function subset(e,t){const n=Array(t.length);for(let s=0;s<t.length;s++)n[s]=e[t[s]];return n}function remove(e,t){const n=e.indexOf(t);n!==-1&&e.splice(n,1)}function ordered(e,t){const n=Array(t.length);for(let s=0;s<t.length;s++)n[t[s]]=e[s];return n}function orderIndices(e){const t=e.toSorted(diff),n={},s={};for(let u=0;u<t.length;u++){const d=e[u];s[d]=s[d]+1||0,n[u]=t.indexOf(d)+s[d]}return Object.values(n)}function orderBy(e,t){const n=Array(e.length);for(let s=0;s<e.length;s++)n[s]=e[t[s]];for(let s=0;s<e.length;s++)e[s]=n[s]}function orderIndicesByTable(e,t){const n=Array(e.length);for(let s=0;s<e.length;s++)n[s]=t.indexOf(e[s]);return n}function minmax(e){let[t,n]=[1/0,-1/0];for(let s=0;s<e.length;s++)t=Math.min(t,e[s]),n=Math.max(n,e[s]);return[t,n]}function cumsum(e){const t=Array(e.length);t[0]=e[0];for(let n=1;n<e.length;n++)t[n]=e[n]+t[n-1];return t}function randomInteger(e,t){return Math.floor(e+Math.random()*t)}function uniqueIntegers(e,t,n=t-e){const s=t-e,u=[],d=new Set;for(;u.length<Math.min(n,s);){let f=randomInteger(e,t);for(;d.has(f);)f=randomInteger(e,t);u.push(f),d.add(f)}return u}async function fetchJSON(e){return await(await fetch(e)).json()}function merge(e,t){return{...e,...t}}function copyValues(e,t){if(e!==t){if(isTypedArray(e)&&isTypedArray(t))t.set(e);else if(Array.isArray(e)&&Array.isArray(t)){t.length=e.length;for(let n=0;n<e.length;n++)t[n]=e[n]}}}function copyProps(e,t){for(const[n,s]of Object.entries(e))Array.isArray(s)&&Array.isArray(e[n])?copyValues(s,e[n]):t[n]=s}function applyDirection(e,t){return .5*(1-t)+t*e}function prettyBreaks(e,t,n=4){const s=(t-e)/n,u=Math.floor(Math.log10(s)),d=[1,2,4,5,10];let[f,o]=[1/0,0];for(let p=0;p<d.length;p++){const m=(d[p]*10**u-s)**2;m<f&&([f,o]=[m,d[p]])}const a=10**u*o,l=Math.ceil(e/a)*a,r=Math.floor(t/a)*a,i=Math.round((r-l)/a),c=[];for(let p=0;p<i+1;p++){const m=l+p*a;c.push(m)}return c}function binBreaks(e,t){let{width:n,anchor:s,nBins:u}=t||{};const[d,f]=minmax(e),o=f-d;u=u??(n?Math.ceil(o/n)+1:10),n=n??o/(u-1),s=s??d;const a=d-n+(s-d)%n,l=f+n-(f-s)%n,r=Array(u+2);r[0]=a,r[r.length-1]=l;for(let i=1;i<r.length-1;i++)r[i]=a+i*n;return r}function tw(e){return e.trim().split(/\s+/)}function addTailwind(e,t){for(const n of t.trim().split(/\s+/))e.classList.add(n)}function removeTailwind(e,t){for(const n of t.trim().split(/\s+/))e.classList.remove(n)}function throttle(e,t){let n=0;return function(...s){const u=new Date().getTime();u-n<t||(n=u,e(...s))}}function timeExecution(e){const t=performance.now();return e(),performance.now()-t}function segmentToPointVec(e){const[t,n,s,u]=e;return[t,n,s-t,u-n]}function inRange(e,t,n){return!(e<t)&&!(e>n)}function segmentsIntersect(e,t){let[n,s,u,d]=segmentToPointVec(e),[f,o,a,l]=segmentToPointVec(t);const r=a*d-u*l,i=((n-f)*d-(s-o)*u)/r,c=-(-(n-f)*l+(s-o)*a)/r;return inRange(i,0,1)&&inRange(c,0,1)}function rectSegmentIntersect(e,t){const[n,s,u,d]=e;return segmentsIntersect([n,s,u,s],t)||segmentsIntersect([n,s,n,d],t)||segmentsIntersect([u,s,u,d],t)||segmentsIntersect([n,d,u,d],t)}function pointInRect(e,t){const[n,s]=e;let[u,d,f,o]=t;return[u,f]=[u,f].sort(diff),[d,o]=[d,o].sort(diff),!(n<u||n>f||s<d||s>o)}function rectsIntersect(e,t){const[n,s]=[e[0],e[2]].sort(diff),[u,d]=[e[1],e[3]].sort(diff),[f,o]=[t[0],t[2]].sort(diff),[a,l]=[t[1],t[3]].sort(diff);return!(s<f||n>o||d<a||u>l)}function addIndexed(e,t,n){const u=Object.keys(e).filter(o=>o.replace(/[0-9]*$/,"")===t);if(u.length===0){e[`${t}1`]=n;return}const d=u.map(o=>parseInt(o.match(/[0-9]*$/)[0],10)),f=Math.max(...d);e[`${t}${f+1}`]=n}function minDecimal(e){let t=1/0;for(let n=0;n<e.length;n++)e[n]!==0&&(t=Math.min(t,Math.log10(Math.abs(e[n]))));return t>3?0:Math.floor(Math.abs(t))+2}function formatText(e,t={lowercase:!0,capitalize:!0,split:!0}){return t!=null&&t.split&&(e=e.replace(/_/g," ")),t!=null&&t.lowercase&&(e=e.toLocaleLowerCase()),t!=null&&t.capitalize&&(e=capitalize(e)),e}function formatLabel(e){if(typeof e=="string")return e;if(e===0)return e.toString();const t=Math.floor(Math.log10(Math.abs(e)));return t>=3?round(e).toString():t<=-3?round(e,-t+1).toString():round(e,2).toString()}function formatAxisLabels(e,t){if(!isNumberArray(e))return e;const n=(t==null?void 0:t.tens)??4,s=o=>o!=0&&Math.abs(Math.log10(o))>n,u=(t==null?void 0:t.decimals)??minDecimal(e);e=e.map(o=>round(o,u));const f=minmax(e).some(s)?superscriptFn:noSuperscriptFn;return e.map(f)}function superscriptFn(e){return e===0?"0":exponentialToSuperscript(e.toExponential())}function noSuperscriptFn(e){return e===0?"0":parseFloat(e.toPrecision(12)).toString()}function exponentialToSuperscript(e){let[t,n]=e.split("e");return n=convertToSuperscript(n),t+"×10"+n}const sups={"-":"⁻","+":"",0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹"};function convertToSuperscript(e){return e.split("").map(t=>sups[t]).join("")}function isDefined(e){return e!=null}const primitives=["string","number","boolean","undefined"];function isPrimitive(e){return e===null||primitives.includes(typeof e)}function isObject(e){return typeof e=="object"&&e!==null}function isTypedArray(e){return ArrayBuffer.isView(e)}function isNumber(e){return typeof e=="number"}function isIntegerString(e){return/^[0-9]+/.test(e)}function isNumberArray(e){return Array.isArray(e)&&typeof e[0]=="number"&&typeof last(e)=="number"}function isStringArray(e){return typeof e[0]=="string"&&typeof last(e)=="string"}function isEventTarget(e){return"addEventListener"in e}function findLength(e){for(const n of e){if(!n)continue;const s=Meta.get(n,"length");if(s)return s}const t="At least one variable needs to be of fixed length";throw new Error(t)}function applyWith(...e){return function(t){return t(...e)}}function row(e,t){const n={};for(const[s,u]of Object.entries(e))n[s]=Getter.of(u)(t);return n}function selector(e){return function(t){return t[e]}}function keysToSelectors(e){return function(t){return e.map(n=>t[n])}}function splitNumericSuffix(e){let t=e.length-1;for(;t>0&&/[0-9]/.test(e[t]);)t--;return t+=1,[e.substring(0,t),e.substring(t,e.length)]}function filterIndices(e,t){const n=[];for(let s=0;s<e.length;s++)t(e[s])&&n.push(s);return n}function stringArraysMatch(e,t){if(e.length!==t.length)return!1;const n=e.toSorted(compareAlphaNumeric).join(""),s=t.toSorted(compareAlphaNumeric).join("");return n===s}const LISTENERS=Symbol("listeners");var Reactive;(e=>{function t(){return function(r){return{...r,[LISTENERS]:{}}}}e.of=t;function n(r){return(r==null?void 0:r[LISTENERS])!==void 0}e.isReactive=n;function s(r,i,c,p){if(!e.isReactive(r))return;p!=null&&p.throttle&&(c=throttle(c,p.throttle));const m=(p==null?void 0:p.priority)??1,y=r[LISTENERS],b={priority:m,callback:c};y[i]||(y[i]=[]),y[i].includes(b)||y[i].push(b),y[i].sort((x,A)=>x.priority-A.priority)}e.listen=s;function u(r,i,c){if(!n(r))return;const p=r[LISTENERS][i];if(p)for(const{callback:m}of p)m(c)}e.dispatch=u;function d(r,i,c,p,m){if(!n(r)||!n(i))return;s(r,c,()=>u(i,p??c),m)}e.propagate=d;function f(r,i){n(r)&&(Object.assign(r,i(r)),u(r,"changed"))}e.set=f;function o(r,i,c){if(!n(r))return;const p=r[LISTENERS][i]??[];for(let m=0;m<p.length;m++)p[m].callback===c&&p.splice(m,1)}e.remove=o;function a(r,i){n(r)&&r[LISTENERS][i]&&(r[LISTENERS][i].length=0)}e.removeAll=a;function l(r){if(!n(r))return;const i=r[LISTENERS];if(i)for(const c of Object.values(i))c.length=0}e.removeAllListeners=l})(Reactive||(Reactive={}));const METHODS=Symbol("methods");exports.Poly=void 0,(e=>{function t(u){const d=function(...f){return n(d,u,f[0].type)(...f)};return d[METHODS]={},d}e.of=t;function n(u,d,f){return u[METHODS][f]??d}e.dispatch=n;function s(u,d,f){u[METHODS][d]=f}e.set=s})(exports.Poly||(exports.Poly={})),exports.Expanse=void 0,(e=>{e.normalize=exports.Poly.of(t),e.unnormalize=exports.Poly.of(n),e.train=exports.Poly.of(s),e.breaks=exports.Poly.of(u),e.reorder=exports.Poly.of(f),e.reset=exports.Poly.of(d);function t(x,A){throw new Error(`Method 'normalize' not implemented for expanse of type '${x.type}'`)}function n(x,A){throw new Error(`Method 'unnormalize' not implemented for expanse of type '${x.type}'`)}function s(x,A,S){throw new Error(`Method 'train' not implemented for expanse of type '${x.type}'`)}e.trainDefault=s;function u(x,A,S){throw new Error(`Method 'breaks' not implemented for expanse of type '${x.type}'`)}function d(x,A){const{defaults:S}=x;for(const[M,v]of Object.entries(S))Array.isArray(v)&&Array.isArray(x.props[M])?copyValues(v,x.props[M]):x.props[M]=v;A!=null&&A.silent||Reactive.dispatch(x,"changed")}e.resetDefault=d;function f(x,A){throw new Error(`Method 'reorder' not implemented for expanse of type '${x.type}'`)}function o(){return Reactive.of()({})}e.base=o;function a(x,A,S){const{frozen:M,props:v}=x,z=A({...v});if(!(S!=null&&S.unfreeze))for(const k of M)delete z[k];for(const k of Object.keys(z))z[k]===x.props[k]&&delete z[k];copyProps(z,x.props),S!=null&&S.default&&copyProps(z,x.defaults),S!=null&&S.silent||Reactive.dispatch(x,"changed")}e.set=a;function l(x,A){for(const S of A)x.frozen.includes(S)||x.frozen.push(S)}e.freeze=l;function r(x){return x.type==="continuous"||x.type==="split"}e.isContinuous=r;function i(x){return x.type==="point"}e.isPoint=i;function c(x){return x.type==="point"||x.type==="band"}e.isDiscrete=c;function p(x){return x.type==="band"}e.isBand=p;function m(x){return x.type==="compound"}e.isCompound=m;function y(x){return x.type==="split"}e.isSplit=y;function b(x){return!m(x)&&!y(x)}e.isUnivariate=b})(exports.Expanse||(exports.Expanse={}));var ExpanseBand;(e=>{const t="band";function n(r=[]){const i=exports.Expanse.base(),[c,p]=[!1,seqLength(0,r.length)],m=Array(r.length).fill(1),y=cumsum(m),b={labels:r,ordered:c,order:p,weights:m,cumulativeWeights:y},x=structuredClone(b);return{...i,type:t,props:b,defaults:x,frozen:[]}}e.of=n,exports.Poly.set(exports.Expanse.normalize,t,s),exports.Poly.set(exports.Expanse.unnormalize,t,u),exports.Poly.set(exports.Expanse.train,t,d),exports.Poly.set(exports.Expanse.breaks,t,o),exports.Poly.set(exports.Expanse.reorder,t,f);function s(r,i){const{labels:c}=r.props,p=c.indexOf(i);if(p===-1)throw new Error(`Label ${i} not found in: ${c}`);return l(r,p)}e.normalize=s;function u(r,i){const{labels:c}=r.props,p=Math.round((2*i*c.length-1)/2);return c[p]}e.unnormalize=u;function d(r,i,c){const{props:p}=r,{order:m}=p,y=Array.from(new Set(i)).sort(compareAlphaNumeric);if(!m.length){for(let S=0;S<y.length;S++)m[S]=S;r.defaults.order=[...m],p.ordered=!1}const b=Array(y.length).fill(1),x=cumsum(ordered(b,m)),A={labels:y,weights:b,cumulativeWeights:x};for(const[S,M]of Object.entries(A))copyValues(M,r.props[S]),c!=null&&c.default&&copyValues(M,r.defaults[S]);exports.Expanse.set(r,()=>({}),c)}e.train=d;function f(r,i){const{props:c,defaults:p}=r,{order:m,weights:y,cumulativeWeights:b}=r.props;if(!i){copyValues(p.order,m),copyValues(cumsum(ordered(y,m)),b),c.ordered=!1,Reactive.dispatch(r,"changed");return}copyValues(i,m),copyValues(cumsum(ordered(y,i)),b),c.ordered=!0,Reactive.dispatch(r,"changed")}e.reorder=f;function o(r){const{labels:i,order:c}=r.props;return ordered(i,c)}e.breaks=o;function a(r,i){const{props:c,defaults:p}=r;if(i=i??Array(c.labels.length).fill(1),i.length!=c.labels.length){const b="The length of the weights must match the length of labels";throw new Error(b)}const{order:m}=c,y=cumsum(ordered(i,m));copyValues(i,c.weights),copyValues(i,p.weights),copyValues(y,c.cumulativeWeights),copyValues(y,p.cumulativeWeights),Reactive.dispatch(r,"changed")}e.setWeights=a;function l(r,i){const{order:c,cumulativeWeights:p}=r.props;i=c[i];const m=p[i-1]??0,y=p[i],b=last(p);return(m+y)/2/b}})(ExpanseBand||(ExpanseBand={}));var ExpanseContinuous;(e=>{const t="continuous";function n(a=0,l=1){const r=exports.Expanse.base(),[i,c,p,m]=[identity,identity,0,!1],y={min:a,max:l,offset:p,ratio:m,trans:i,inv:c},b={...y,trans:i,inv:c};return{...r,type:t,props:y,defaults:b,frozen:[]}}e.of=n,exports.Poly.set(exports.Expanse.normalize,t,s),exports.Poly.set(exports.Expanse.unnormalize,t,u),exports.Poly.set(exports.Expanse.train,t,d),exports.Poly.set(exports.Expanse.breaks,t,f);function s(a,l){const{min:r,max:i,offset:c,trans:p}=a.props;return(p(l-c)-p(r))/(p(i)-p(r))}e.normalize=s;function u(a,l){const{min:r,max:i,offset:c,trans:p,inv:m}=a.props;return m(p(r)+l*(p(i)-p(r)))+c}e.unnormalize=u;function d(a,l,r){const{ratio:i}=a.props;let[c,p]=Meta.get(l,["min","max"]);(!c||!p)&&([c,p]=minmax(l)),c=i||r!=null&&r.ratio?0:c,exports.Expanse.set(a,()=>({min:c,max:p}),r)}e.train=d;function f(a,l=0,r=1){let[i,c]=[l,r].map(m=>u(a,m));return[i,c]=[i,c].sort(diff),prettyBreaks(i,c,4)}e.breaks=f;function o(a){const{min:l,max:r}=a.props;return r-l}e.range=o})(ExpanseContinuous||(ExpanseContinuous={})),exports.Scale=void 0,(e=>{function t(h,w){const[E,I,D]=[0,1,1],[O,_]=[1,1],R={zero:E,one:I,direction:D,scale:O,mult:_},T={...R},[L,G]=[[],[]],P=Reactive.of()({domain:h,codomain:w,props:R,defaults:T,frozen:G,linked:L});return Reactive.propagate(h,P,"changed"),Reactive.propagate(w,P,"changed"),P}e.of=t;function n(){return e.of(ExpanseContinuous.of(),ExpanseContinuous.of())}e.linear=n;function s(h,w){const{domain:E,codomain:I,props:D}=h;let O=exports.Expanse.normalize(E,w);return Array.isArray(O)?O=O.map(_=>d(_,D)):O=d(O,D),exports.Expanse.unnormalize(I,O)}e.pushforward=s;function u(h,w){const{domain:E,codomain:I,props:D}=h;let O=exports.Expanse.normalize(I,w);return Array.isArray(O)?O=O.map(_=>f(_,D)):O=f(O,D),exports.Expanse.unnormalize(E,O)}e.pullback=u;function d(h,w){const{zero:E,one:I,direction:D,scale:O,mult:_}=w;return h=h*O*_,h=E+h*(I-E),o(h,D)}function f(h,w){const{zero:E,one:I,scale:D,mult:O}=w;return h=(h-E)/(I-E),h/(D*O)}function o(h,w){return .5*(1-w)+w*h}function a(h,w,E){const{linked:I,frozen:D,props:O}=h,_=w({...O});if(!(E!=null&&E.unfreeze))for(const R of D)delete _[R];Object.assign(O,_),E!=null&&E.default&&Object.assign(h.defaults,_),E!=null&&E.silent||Reactive.dispatch(h,"changed");for(const R of I)e.set(R,w,E)}e.set=a;function l(h,w){Reactive.removeAll(h.domain,"changed"),h.domain=w,Reactive.propagate(h.domain,h,"changed")}e.setDomain=l;function r(h,w){Reactive.removeAll(h.codomain,"changed"),h.codomain=w,Reactive.propagate(h.codomain,h,"changed")}e.setCodomain=r;function i(h,w){for(const E of w)h.frozen.includes(E)||h.frozen.push(E)}e.freeze=i;function c(h){e.set(h,w=>({direction:-1*w.direction}))}e.flip=c;function p(h,w){let{direction:E,zero:I,one:D}=h.props;I+=E*w,D+=E*w,e.set(h,()=>({zero:I,one:D}))}e.move=p;function m(h,w,E,I){const{zero:D,one:O,direction:_}=h.props,R=O-D;_===-1&&([w,E]=[1-w,1-E]),[w,E]=[w,E].map(T=>(T-D)/R),[w,E]=invertRange(w,E),_===-1&&([w,E]=[1-w,1-E]),e.set(h,()=>({zero:w,one:E}),I)}e.expand=m;function y(h,w,E){if(((E==null?void 0:E.name)??!0)&&Meta.has(w,"name")&&Meta.copy(w,h,["name"]),typeof w[0]=="string"&&exports.Expanse.isContinuous(h.domain)){const D=Array.from(new Set(w));h.domain=ExpanseBand.of(D)}exports.Expanse.train(h.domain,w,E)}e.train=y;function b(h,w){Object.assign(h.props,h.defaults),w!=null&&w.silent||Reactive.dispatch(h,"changed")}e.reset=b;function x(h){exports.Expanse.reset(h.domain,{silent:!0}),exports.Expanse.reset(h.codomain,{silent:!0}),e.reset(h)}e.restore=x;function A(h){const{domain:w,codomain:E,props:I}=h;let{zero:D,one:O}=I;[D,O]=invertRange(D,O);let _=exports.Expanse.breaks(w,D,O),R=formatAxisLabels(_),T;return exports.Expanse.isCompound(w)?(R=formatAxisLabels(_,{decimals:1}),w.commonScale&&(_=exports.Expanse.normalize(w,_)),_=_.map(L=>d(L,I)),T=exports.Expanse.unnormalize(h.codomain,_)):exports.Expanse.isSplit(E)?T=e.pushforward(h,_):T=_.map(L=>e.pushforward(h,L)),{labels:R,positions:T}}e.breaks=A;function S(h,w){for(const E of w)h.linked.includes(E)||h.linked.push(E)}e.link=S;function M(h,w){for(const E of w)E.codomain=h.codomain}e.shareCodomain=M;function v(h){return h.props.one-h.props.zero}e.unitRange=v;function z(h){const{domain:w}=h;if(exports.Expanse.isContinuous(w))return ExpanseContinuous.range(w)/v(h)}e.domainRange=z;function k(h){const{codomain:w}=h;if(exports.Expanse.isContinuous(w))return ExpanseContinuous.range(w)*v(h)}e.codomainRange=k;function C(h){if(!g(h))throw new Error("Both domain and codomain need to be continuous");const{domain:w,codomain:E}=h,I=ExpanseContinuous.range(w);return ExpanseContinuous.range(E)*v(h)/I}e.unitRatio=C;function g(h){const{domain:w,codomain:E}=h;return exports.Expanse.isContinuous(w)&&exports.Expanse.isContinuous(E)}e.isContinuous=g})(exports.Scale||(exports.Scale={})),exports.Factor=void 0,(e=>{e.POSITIONS=Symbol("positions"),e.DIMENSION=Symbol("dimension"),e.CHILD_INDICES=Symbol("child-indices");function t(r,i,c,p){return Reactive.of()({type:r,cardinality:i,indices:c,data:p})}e.of=t;function n(r,i){i.cardinality=r.cardinality,copyValues(r.indices,i.indices);for(const c of Reflect.ownKeys(r.data))Array.isArray(r.data[c])&&Array.isArray(i.data[c])?(copyValues(r.data[c],i.data[c]),Meta.copy(r.data[c],i.data[c])):i.data[c]=r.data[c]}e.copyFrom=n;function s(r,i){if([r,i].some(c=>c.type==="bijection"))return!0;if(r.indices.length!==i.indices.length)throw new Error("Factors do not have matching length")}function u(r,i){const p=new Uint32Array(seq(0,r)),m=x=>[x];i=i??{};for(const x of Object.values(i))Meta.set(x,{queryable:!0});const y="bijection",b={...i,[e.POSITIONS]:m};return t(y,1/0,p,b)}e.bijection=u;function d(r){const c=new Uint32Array(r).fill(0),p=()=>Array.from(c),m="constant",y={[e.POSITIONS]:p};return t(m,1,c,y)}e.mono=d;function f(r,i){const c=r.map(A=>A.toString());i=i??Array.from(new Set(c)).sort(compareAlphaNumeric),Meta.has(r,"name")&&Meta.copy(r,i,["name"]);const p=new Uint32Array(r.length),m={};for(let A=0;A<c.length;A++){const S=i.indexOf(c[A]);m[S]||(m[S]=[]),p[A]=S,m[S].push(A)}Meta.set(i,{queryable:!0,isDimension:!0});const y=Object.values(m),b="surjection",x={label:i,[e.POSITIONS]:y};return t(b,i.length,p,x)}e.from=f;function o(r,i){function c(){const m=(i==null?void 0:i.breaks)??binBreaks(r,i),y=new Set,b=new Uint32Array(r.length),x={};for(let I=0;I<r.length;I++){const D=m.findIndex(O=>O>=r[I])-1;x[D]||(x[D]=[]),b[I]=D,x[D].push(I),y.add(D)}const A=Array.from(y).sort(diff);for(let I=0;I<b.length;I++)b[I]=A.indexOf(b[I]);const[S,M]=[[],[]];for(let I=0;I<A.length;I++)S.push(m[A[I]]),M.push(m[A[I]+1]);const[v,z]=[m[A[0]],m[last(A)+1]],k=`min of ${Meta.get(r,"name")}`,C=`max of ${Meta.get(r,"name")}`,g={queryable:!0,isDimension:!0};Meta.set(S,{min:v,max:z,name:k,...g}),Meta.set(M,{min:v,max:z,name:C,...g}),Meta.copy(r,m,["name"]);const h=Object.values(x),w="surjection",E={binMin:S,binMax:M,breaks:m,[e.POSITIONS]:h};return t(w,A.length,b,E)}const p=c();return i&&Reactive.isReactive(i)&&Reactive.listen(i,"changed",()=>{const m=c();e.copyFrom(m,p),Reactive.dispatch(p,"changed")}),p}e.bin=o;function a(r,i){s(r,i),r.data[e.CHILD_INDICES]=[];function c(){if(r.type==="bijection"){const O={};for(const P of Reflect.ownKeys(r.data))O[P]=Getter.of(r.data[P]),Meta.copy(r.data[P],O[P]);for(const P of Reflect.ownKeys(i.data))O[P]=Getter.proxy(i.data[P],i.indices),Meta.copy(i.data[P],O[P]);const _="bijection",R=i.indices.length,T=new Uint32Array(i.indices.length),L=t(_,R,T,O);L.parent=r;const G=Array.from(Array(T.length),(P,H)=>[H]);return copyValues(G,r.data[e.CHILD_INDICES]),L}if(r.type==="constant"){const{type:O,data:_,cardinality:R,indices:T}=i,L=t(O,R,T,_);return L.parent=r,L}const m=Math.max(r.cardinality,i.cardinality)+1,y=new Set,b=new Uint32Array(r.indices.length),x={},A={},S={},M=Getter.of(r.indices),v=Getter.of(i.indices);for(let O=0;O<r.indices.length;O++){const[_,R]=[M(O),v(O)],T=m*_+R;T in A||(A[T]=_,S[T]=R,x[T]=[]),b[O]=T,x[T].push(O),y.add(T)}const z=Array.from(y).sort(diff),k={};for(const O of Object.keys(A))k[parseInt(O)]=z.indexOf(parseInt(O));for(let O=0;O<b.length;O++)b[O]=k[b[O]];const C={};for(const[O,_]of Object.entries(A))_ in C||(C[_]=[]),C[_].push(k[parseInt(O)]);const g=Object.values(A),h=Object.values(S),w={};for(let O of Reflect.ownKeys(r.data)){let _=O;if(typeof O=="string")for(;_ in w;)O+="$";const[R,T]=[r.data[O],g],L=Array.isArray(R)?subset(R,T):Getter.proxy(R,T);Meta.copy(R,L),w[_]=L}for(let O of Reflect.ownKeys(i.data)){let _=O;if(typeof O=="string")for(;_ in w;)_+="$";const[R,T]=[i.data[O],h],L=Array.isArray(R)?subset(R,T):Getter.proxy(R,T);Meta.copy(R,L),w[_]=L}const E="surjection";w[e.POSITIONS]=Object.values(x);const I=t(E,z.length,b,w);I.parent=r;const D=Object.values(C);return copyValues(D,r.data[e.CHILD_INDICES]),I}const p=c();return Reactive.listen(r,"changed",()=>{const m=c();e.copyFrom(m,p),Reactive.dispatch(p,"changed")},{priority:2}),Reactive.listen(i,"changed",()=>{const m=c();e.copyFrom(m,p),Reactive.dispatch(p,"changed")},{priority:2}),p}e.product=a;function l(r,i){const c={};for(let p=0;p<i.indices.length&&(c[i.indices[p]]=r.indices[p],!(Object.keys(c).length>=i.cardinality));p++);return Object.values(c)}e.parentIndices=l})(exports.Factor||(exports.Factor={}));const Transient=255,Group={Base:7,First:6,Second:5,Third:4,BaseTransient:3,FirstTransient:2,SecondTransient:1,ThirdTransient:0},LAYER=Symbol("layer");var Marker;(e=>{function t(r){const i=Transient,c=new Uint32Array(r).fill(Group.Base),p=[],m="surjection",y=[0,1,2,3,4,5,6,7],b=exports.Factor.of(m,8,c,{[LAYER]:y});Meta.set(y,{queryable:!0});const x=Reactive.of()({group:i,indices:c,transientIndices:p,factor:b});return Reactive.propagate(x,b,"changed"),x}e.of=t;function n(r,i){r.group=i}e.setGroup=n;function s(r,i,c){const p=(c==null?void 0:c.group)??r.group;if(d(r,{silent:!0}),p===Transient){for(let m=0;m<i.length;m++){const y=i[m];r.indices[y]=a(r.indices[y])}r.transientIndices=i}else for(let m=0;m<i.length;m++){const y=i[m];r.indices[y]=p}c!=null&&c.silent||Reactive.dispatch(r,"changed")}e.update=s;function u(r,i){for(let c=0;c<r.indices.length;c++)r.indices[c]=Group.Base;i!=null&&i.silent||(Reactive.dispatch(r,"changed"),Reactive.dispatch(r,"cleared"))}e.clearAll=u;function d(r,i){for(let c=0;c<r.transientIndices.length;c++){const p=r.transientIndices[c];r.indices[p]=l(r.indices[p])}i!=null&&i.silent||(Reactive.dispatch(r,"changed"),Reactive.dispatch(r,"cleared"))}e.clearTransient=d;function f(r){const{factor:i,indices:c}=r;return p=>i.data[LAYER][c[p]]}e.getLayer=f;function o(r){return!(r&4)}e.isTransient=o;function a(r){return r&-5}function l(r){return r|4}})(Marker||(Marker={}));var Reduced;(e=>{e.PARENT=Symbol("parent"),e.VALUES=Symbol("values"),e.INDICES=Symbol("indices"),e.FACTOR=Symbol("factor"),e.REDUCER=Symbol("reducer"),e.ORIGINAL_VALUES=Symbol("original-values");function t(c,p,m,y){const b=c;return b[e.VALUES]=c,b[e.FACTOR]=p,b[e.REDUCER]=m,b[e.ORIGINAL_VALUES]=c,y&&n(b,y),b}e.of=t;function n(c,p){c[e.PARENT]=p}e.setParent=n;function s(c){const[,p,m,y]=i(c);if(!y)throw new Error("Parent missing");const b=exports.Factor.parentIndices(o(y),p),x=subset(y,b),A=t(x,o(y),m,a(y));return l(A,y),r(A,b),A[e.ORIGINAL_VALUES]=c[e.ORIGINAL_VALUES],Meta.copy(c,A,["name","queryable","reduced"]),A}e.parent=s;function u(c){const[p,m,y,b,x]=i(c);if(!b)throw new Error("Cannot stack a without a parent");const A=exports.Factor.parentIndices(o(b),m),{reducefn:S,initialfn:M}=y,[v,z]=[p.length,[]],k=Array.from(Array(v),()=>M()),C=Getter.of(A);for(let w=0;w<p.length;w++){const E=C(w);z[E]===void 0&&(z[E]=M()),z[E]=S(z[E],p[w]),k[w]=z[E]}const g=x?subset(k,x):k,h=e.of(g,m,y,b);return l(h,k),x&&r(h,x),h[e.ORIGINAL_VALUES]=c[e.ORIGINAL_VALUES],Meta.copy(c,h,["name","queryable","reduced"]),h}e.stack=u;function d(c,p){const[m,y,b,x,A]=i(c);if(!x)throw new Error("Cannot normalize a without a parent");const S=exports.Factor.parentIndices(o(x),y),M=subset(x,S),v=[...m];for(let C=0;C<c.length;C++)v[C]=p(v[C],M[C]);const z=A?subset(v,A):v,k=e.of(z,y,b,x);return l(k,v),A&&r(k,A),k[e.ORIGINAL_VALUES]=c[e.ORIGINAL_VALUES],Meta.copy(c,k,["name","queryable","reduced"]),k}e.normalize=d;function f(c){const[p,m,y,b,x]=i(c),A=[];A.push(y.initialfn());for(let v=0;v<p.length-1;v++)A.push(p[v]);const S=x?subset(A,x):A,M=e.of(S,m,y,b);return l(M,A),x&&r(M,x),M[e.ORIGINAL_VALUES]=c[e.ORIGINAL_VALUES],Meta.copy(c,M,["name","queryable"]),M}e.shiftLeft=f;function o(c){return c[e.FACTOR]}function a(c){return c[e.PARENT]}e.getParent=a;function l(c,p){c[e.VALUES]=p}function r(c,p){c[e.INDICES]=p}function i(c){return[c[e.VALUES],c[e.FACTOR],c[e.REDUCER],c[e.PARENT],c[e.INDICES]]}})(Reduced||(Reduced={}));var Geom;(e=>{function t(c){const p=Reactive.of()(c),m=last(c.coordinates)??Reactive.of()({});return Reactive.listen(m,"changed",()=>Reactive.dispatch(p,"coords-changed")),p}e.of=t,e.render=exports.Poly.of(n),e.check=exports.Poly.of(s),e.query=exports.Poly.of(u);function n(c,p){throw new Error(`Method 'render' not implemented for geom of type '${c.type}'`)}function s(c,p){throw new Error(`Method 'check' not implemented for geom of type '${c.type}'`)}function u(c,p){throw new Error(`Method 'render' not implemented for geom of type '${c.type}'`)}function d(c,p){const m=last(c.coordinates)??Reactive.of()({});Reactive.removeAllListeners(m),c.coordinates=p;const y=last(p)??{};Reactive.listen(y,"changed",()=>Reactive.dispatch(c,"coords-changed")),Reactive.dispatch(c,"coords-swapped")}e.setCoordinates=d;function f(c){return c.coordinates[c.coordinates.length-2]}e.flatData=f;function o(c){return c.coordinates[c.coordinates.length-1]}e.groupedData=o;function a(c,p,m){const[y,b]=[Array(c),Getter.of(p)];for(let x=0;x<c;x++)y[x]=m[b(x)];return y}e.frames=a;function l(c,p){const m=[];for(const[y,b]of p){const x=Array(c),A=Getter.of(y??1);for(let S=0;S<c;S++)x[S]=exports.Scale.pushforward(b,A(S));m.push(x)}return m}e.scaledArrays=l;function r(c,p){const m=p[0],b=[i(c,m,{dimension:"only"})];for(let x=0;x<p.length;x++){const A=p[x],S=i(c,A,{dimension:"exclude"});S[LAYER]=Getter.of(c[LAYER])(A),b.push(S)}return b}e.getQueryInfo=r;function i(c,p,m){const y={},b=m==null?void 0:m.dimension;for(const x of Object.values(c)){if(b==="exclude"&&Meta.get(x,"isDimension")||b==="only"&&!Meta.get(x,"isDimension"))continue;const[A,S,M]=Meta.get(x,["name","queryable","reduced"]);if(!A||!S)continue;const v=M?x[Reduced.ORIGINAL_VALUES]:x,z=Getter.of(v);y[A]=z(p)}return y}})(Geom||(Geom={}));var DOM;(e=>{function t(a,l){const r=document.createElement(a);return l!=null&&l.id&&(r.id=l.id),l!=null&&l.classes&&d(r,l.classes),l!=null&&l.textContent&&(r.textContent=l.textContent),r}e.element=t;function n(a,l){a.appendChild(l)}e.append=n;function s(a,l){return a.querySelector(l)}e.select=s;function u(a,l){for(const[r,i]of Object.entries(l))a.style[r]=i}e.setStyles=u;function d(a,l){for(const r of l)a.classList.add(r)}e.addClasses=d;function f(a,l){for(const r of l)a.classList.remove(r)}e.removeClasses=f;function o(a){a.innerHTML=""}e.clearChildren=o})(DOM||(DOM={}));const VAnchor={Top:1,Middle:1/2,Bottom:0},HAnchor={Left:1,Center:1/2,Right:0},MouseButton={Left:0,Right:2},dataLayers=[0,1,2,3,4,5,6,7],baseLayers=[4,5,6,7];var Frame;(e=>{function t(M){const v=DOM.element("canvas"),z=v.getContext("2d");DOM.addClasses(v,tw(M.classes??""));for(const[_,R]of Object.entries(M.canvasStyles??{}))v.style[_]=R;const{clientWidth:k,clientHeight:C,clientLeft:g,clientTop:h}=v,w=k-g,E=C-h,I=2,{margins:D=[0,0,0,0],contextProps:O={}}=M;return{canvas:v,context:z,width:w,height:E,margins:D,scalingFactor:I,contextProps:O}}e.of=t;function n(M,v){v.appendChild(M.canvas),M.parent=v,e.resize(M)}e.append=n;function s(M,v){for(const[z,k]of Object.entries(v))M.contextProps[z]=k,M.context[z]=k}e.setContext=s;function u(M){const{context:v,canvas:z,scalingFactor:k}=M,{clientWidth:C,clientHeight:g,clientLeft:h,clientTop:w}=z,E=C-h,I=g-w;M.width=E,M.height=I,M.canvas.width=E*k,M.canvas.height=I*k;for(const[D,O]of Object.entries(M.contextProps))M.context[D]=O;v.scale(k,k),e.clip(M)}e.resize=u;function d(M){const{context:v}=M;let{width:z,height:k}=M;const[C,g,h,w]=M.margins;z=Math.max(z-g-w,0),k=Math.max(k-h-C,0),v.beginPath(),v.rect(g,h,z,k),v.clip()}e.clip=d;function f(M){M.context.clearRect(0,0,M.width,M.height)}e.clear=f;function o(M,v){M.context.globalAlpha=v(M.context.globalAlpha)}e.setAlpha=o;function a(M){M.context.globalAlpha=1}e.resetAlpha=a;function l(M,v){return M.context.measureText(v).width}e.textWidth=l;function r(M,v){const z=M.context.measureText(v);return z.actualBoundingBoxAscent+z.actualBoundingBoxDescent}e.textHeight=r;function i(M,v,z,k,C){const{context:g}=M,h=M.canvas.clientHeight,w=(C==null?void 0:C.hAnchor)??HAnchor.Center,E=(C==null?void 0:C.vAnchor)??VAnchor.Middle;v=v+2*(w-.5)*k,z=h-z+2*(.5-E)*k,g.beginPath(),g.arc(v,z,k,0,Math.PI*2),g.fill()}e.point=i;function c(M,v,z,k,C){for(let g=0;g<v.length;g++)i(M[g],v[g],z[g],k[g],C)}e.points=c;function p(M,v,z,k,C,g){const{context:h,height:w}=M,E=k-v,I=C-z;v=v+(1-g)/2*E,k=k-(1-g)/2*E,z=z+(1-g)/2*I,C=C-(1-g)/2*I,h.fillRect(v,w-z,k-v,z-C)}e.rectangleXY=p;function m(M,v,z,k,C,g){for(let h=0;h<v.length;h++)p(M[h],v[h],z[h],k[h],C[h],g[h])}e.rectanglesXY=m;function y(M,v,z,k,C,g){const{context:h,height:w}=M,E=(g==null?void 0:g.hAnchor)??HAnchor.Center,I=(g==null?void 0:g.vAnchor)??VAnchor.Middle;v=v-E*k,z=w-z+I*C,h.fillRect(v,z,k,-C)}e.rectangleWH=y;function b(M,v,z,k,C,g){for(let h=0;h<v.length;h++)y(M[h],v[h],z[h],k[h],C[h],g)}e.rectanglesWH=b;function x(M,v,z){const{context:k,height:C}=M;k.beginPath(),k.moveTo(v[0],C-z[0]);for(let g=0;g<v.length;g++)k.lineTo(v[g],C-z[g]);k.stroke()}e.line=x;function A(M,v,z){for(let k=0;k<v.length;k++)x(M[k],v[k],z[k])}e.lines=A;function S(M,v,z,k,C){const{context:g,height:h}=M;g.save(),g.translate(v,h-z),C!=null&&C.vertical&&g.rotate(-Math.PI/2),g.fillText(k,0,0),g.translate(-v,-(h-z)),g.restore()}e.text=S})(Frame||(Frame={}));var Bars;(e=>{const t="bars";function n(f,o,a){const l=(a==null?void 0:a.vAnchor)??VAnchor.Bottom,r=(a==null?void 0:a.hAnchor)??HAnchor.Center;return Geom.of({type:t,coordinates:f,scales:o,vAnchor:l,hAnchor:r})}e.of=n,exports.Poly.set(Geom.render,t,s),exports.Poly.set(Geom.check,t,u),exports.Poly.set(Geom.query,t,d);function s(f,o){const{scales:a,hAnchor:l,vAnchor:r}=f,i=Geom.groupedData(f),c=findLength(Object.values(i)),[p,m,y,b]=Geom.scaledArrays(c,[[i.x,a.x],[i.y,a.y],[i.width,a.width],[i.height,a.height]]),x=Geom.frames(c,i[LAYER],o);Frame.rectanglesWH(x,p,m,y,b,{hAnchor:l,vAnchor:r})}function u(f,o){const{scales:a,hAnchor:l,vAnchor:r}=f,i=Geom.flatData(f),c=findLength(Object.values(i)),{x:p,y:m,width:y,height:b}=Getter.mapObject(i),x=Getter.of(i[exports.Factor.POSITIONS]),A=[];for(let S=0;S<c;S++){let M=exports.Scale.pushforward(a.x,p(S)),v=exports.Scale.pushforward(a.y,m(S)),z=exports.Scale.pushforward(a.width,y(S)),k=exports.Scale.pushforward(a.height,b(S));const C=[M-z*l,v-k*r,M+z*l,v+k*(1-r)];if(rectsIntersect(o,C)){const g=x(S);for(let h=0;h<g.length;h++)A.push(g[h])}}return A}function d(f,o){var A;const{scales:a,hAnchor:l,vAnchor:r}=f,i=Geom.flatData(f),c=Geom.groupedData(f),p=findLength(Object.values(i)),{x:m,y,width:b,height:x}=Getter.mapObject(i);for(let S=0;S<p;S++){let M=exports.Scale.pushforward(a.x,m(S)),v=exports.Scale.pushforward(a.y,y(S)),z=exports.Scale.pushforward(a.width,b(S)),k=exports.Scale.pushforward(a.height,x(S));const C=[M-z*l,v-k*r,M+z*l,v+k*(1-r)];if(pointInRect(o,C)){const g=(A=i[exports.Factor.CHILD_INDICES])==null?void 0:A[S];return Geom.getQueryInfo(c,g??[])}}}})(Bars||(Bars={}));var ExpanseCompound;(e=>{const t="compound";function n(l){const r=exports.Expanse.base(),i=ExpanseContinuous.of();return{...r,continuous:i,type:t,commonScale:!1,expanses:l}}e.of=n,exports.Poly.set(exports.Expanse.normalize,t,s),exports.Poly.set(exports.Expanse.unnormalize,t,u),exports.Poly.set(exports.Expanse.train,t,d),exports.Poly.set(exports.Expanse.breaks,t,f),exports.Poly.set(exports.Expanse.reset,t,o);function s(l,r){const{expanses:i}=l;return l.commonScale===!0?r.map(c=>exports.Expanse.normalize(l.continuous,c)):r.map((c,p)=>exports.Expanse.normalize(i[p],c))}e.normalize=s;function u(l,r){const{expanses:i}=l;return l.commonScale===!0?r.map(c=>exports.Expanse.normalize(l.continuous,c)):r.map((c,p)=>exports.Expanse.unnormalize(i[p],c))}e.unnormalize=u;function d(l,r){const{expanses:i}=l;if(r.length!=i.length)throw new Error("The number of arrays does not match the number of expanses.");for(let c=0;c<r.length;c++)exports.Expanse.train(i[c],r[c],{default:!0})}e.train=d;function f(l,r,i){return ExpanseContinuous.breaks(l.continuous,r,i)}e.breaks=f;function o(l){for(const r of l.expanses)exports.Expanse.reset(r);exports.Expanse.reset(l.continuous)}e.reset=o;function a(l,r){const{expanses:i,continuous:c}=l;if(!r){l.commonScale=!1,Object.assign(c.props,{min:0,max:1}),Object.assign(c.defaults,{min:0,max:1}),Reactive.dispatch(l,"changed");return}if(i.some(y=>!exports.Expanse.isContinuous(y)))throw new Error("Common scale can only be set if all expanses are continuous.");let[p,m]=[1/0,-1/0];for(const y of i)p=Math.min(p,y.props.min),m=Math.max(m,y.props.max);Object.assign(c.props,{min:p,max:m}),Object.assign(c.defaults,{min:p,max:m}),l.commonScale=!0,Reactive.dispatch(l,"changed")}e.setCommonScale=a})(ExpanseCompound||(ExpanseCompound={}));var ExpansePoint;(e=>{const t="point";function n(a=[]){const l=exports.Expanse.base(),[r,i]=[!1,seqLength(0,a.length)],c={labels:a,ordered:r,order:i},p=structuredClone(c);return{...l,type:t,props:c,defaults:p,frozen:[]}}e.of=n,exports.Poly.set(exports.Expanse.normalize,t,s),exports.Poly.set(exports.Expanse.unnormalize,t,u),exports.Poly.set(exports.Expanse.train,t,d),exports.Poly.set(exports.Expanse.breaks,t,o),exports.Poly.set(exports.Expanse.reorder,t,f);function s(a,l){const{labels:r,order:i}=a.props,c=i[r.indexOf(l)];return c===-1?c:c/(r.length-1)}e.normalize=s;function u(a,l){const{labels:r,order:i}=a.props;return l=Math.round(l*(r.length-1)),r[i[l]]}e.unnormalize=u;function d(a,l,r){const{props:i,defaults:c}=a,{order:p}=i,m=Array.from(new Set(l)).sort(compareAlphaNumeric);if(!p.length){for(let y=0;y<m.length;y++)p[y]=y;c.order=[...p],i.ordered=!1}copyValues(m,i.labels),r!=null&&r.default&&copyValues(m,a.defaults.labels),exports.Expanse.set(a,()=>({}),r)}e.train=d;function f(a,l){const{props:r,defaults:i}=a,{order:c}=r;if(!l){copyValues(i.order,c),r.ordered=!1,Reactive.dispatch(a,"changed");return}copyValues(l,c),r.ordered=!0,Reactive.dispatch(a,"changed")}e.reorder=f;function o(a){const{labels:l,order:r}=a.props;return ordered(l,r)}e.breaks=o})(ExpansePoint||(ExpansePoint={}));var ExpanseSplit;(e=>{const t="split";function n(o){const a=o??ExpanseContinuous.of(),l={...a.props,innerType:a.type};return{...a,type:t,props:l}}e.of=n,exports.Poly.set(exports.Expanse.normalize,t,s),exports.Poly.set(exports.Expanse.unnormalize,t,u),exports.Poly.set(exports.Expanse.train,t,d),exports.Poly.set(exports.Expanse.breaks,t,f);function s(o,a){const{innerType:l}=o.props,r=exports.Poly.dispatch(exports.Expanse.normalize,identity,l);return Array.isArray(a)?a.map(i=>r(o,i)):r(o,a)}e.normalize=s;function u(o,a){const{innerType:l}=o.props,r=exports.Poly.dispatch(exports.Expanse.unnormalize,identity,l);return Array.isArray(a)?a.map(i=>r(o,i)):r(o,a)}e.unnormalize=u;function d(o,a){const{innerType:l}=o.props;exports.Poly.dispatch(exports.Expanse.train,identity,l)(o,a)}e.train=d;function f(o){const{innerType:a}=o.props;return exports.Poly.dispatch(exports.Expanse.breaks,identity,a)(o)}e.breaks=f})(ExpanseSplit||(ExpanseSplit={}));const expanseMap={continuous:ExpanseContinuous,point:ExpansePoint,band:ExpanseBand,split:ExpanseSplit,compound:ExpanseCompound},scaleNames=["x","y","size","area","areaPct","width","height"];exports.Scales=void 0,(e=>{function t(s){const u={};for(const d of scaleNames)u[d]=exports.Scale.linear();for(const[d,[f,o]]of Object.entries(s??{}))u[d]=exports.Scale.of(expanseMap[f].of(),expanseMap[o].of());return u}e.of=t;function n(s,u,d){return{...s,[u]:d}}e.set=n})(exports.Scales||(exports.Scales={})),exports.Reducer=void 0,(Reducer=>{Reducer.sum={name:"sum",fallback:"count",initialfn:()=>0,reducefn:(e,t)=>e+t},Reducer.max={name:"max",initialfn:()=>-1/0,reducefn:(e,t)=>Math.max(e,t)},Reducer.product={name:"product",initialfn:()=>1,reducefn:(e,t)=>e*t},Reducer.table={name:"table",initialfn:()=>({}),reducefn:(e,t)=>(e[t]=e[t]+1||0,e)};function parse(value){if(typeof value=="string")return Reducer[value];if(typeof value.initialfn=="string"&&typeof value.reducefn=="string"){const parsed={name:value.name};return parsed.initialfn=eval(value.initialfn),parsed.reducefn=eval(value.reducefn),parsed}return value}Reducer.parse=parse;function reduce(e,t,n){const{indices:s,cardinality:u}=t,{initialfn:d,reducefn:f}=n,o=Array.from(Array(u),()=>d()),a=Getter.of(s),l=Getter.of(e);for(let c=0;c<s.length;c++){const p=a(c);o[p]=f(o[p],l(c))}const r=Reduced.of(o,t,n);isObject(e)&&Meta.copy(e,r);const i=getName(o,n)??"[unknown summary]";return Meta.set(r,{name:i,queryable:!0,reduced:!0}),r}Reducer.reduce=reduce;function getName(e,t){return Meta.has(e,"name")?`${t.name} of ${Meta.get(e,"name")}`:t.fallback}Reducer.getName=getName})(exports.Reducer||(exports.Reducer={}));var Summaries;(e=>{function t(d,f){const o=[];for(let a=0;a<f.length;a++){const l=f[a],r=n(d,l),i=Reactive.of()(merge(r,l.data));if(o.push(i),a>0)for(const c of Object.keys(r)){const p=o[a-1][c];Reduced.setParent(r[c],p)}Reactive.listen(l,"changed",()=>{const c=n(d,l);for(const p of Object.keys(c))copyValues(c[p],r[p]);for(const p of Reflect.ownKeys(l.data))copyValues(l.data[p],i[p])}),Reactive.propagate(l,i,"changed")}return o}e.of=t;function n(d,f){const o={};for(const[a,l]of Object.entries(d)){const[r,i]=l;o[a]=exports.Reducer.reduce(r,f,i)}return o}function s(d,f){const o=[];for(let a=0;a<d.length;a++){let l=function(i){const c=f[a](i),p=Reflect.ownKeys(i);for(const m of p)(typeof m=="symbol"||isIntegerString(m))&&(c[m]=i[m]);return c};const r=Reactive.of()(l(d[a]));o.push(r),Reactive.listen(d[a],"changed",()=>{const i=l(d[a]);for(const c of Reflect.ownKeys(i))Array.isArray(i[c])&&Array.isArray(r[c])&&copyValues(i[c],r[c]);Reactive.dispatch(r,"changed")})}return o}e.translate=s;function u(d,f){const o={};let a=0;for(const[l,r]of d)o[`q${a++}`]=[l(f),r];return o}e.formatQueries=u})(Summaries||(Summaries={}));function Barplot(e,t,n){const{data:s,marker:u}=e;let[d,f]=t(s);const o=f&&(n!=null&&n.reducer)?n.reducer:exports.Reducer.sum,a=f||(()=>1),l=exports.Factor.from(d),r=exports.Factor.product(l,u.factor),i=[l,r],c=n!=null&&n.queries?n.queries(s):{},p=[a,o],m=Summaries.of({stat:p,...c},i),y=exports.Scales.of({x:["band","continuous"]}),[b,x]=["bar","absolute"],A={...n,type:b,representation:x},S=Bars.of([],y),M=Object.assign(exports.Plot.of(m,y,A),{bars:S});return barplot(M),exports.Plot.addGeom(M,S),exports.Scale.link(y.y,[y.height]),exports.Scale.freeze(y.y,["zero"]),exports.Scale.freeze(y.height,["zero"]),Reactive.listen(M,"normalize",()=>switchRepresentation$5(M)),M}function sortAxis$1(e,t){if(e.props.ordered)ExpanseBand.reorder(e);else{const n=orderIndices(t);ExpanseBand.reorder(e,n)}}function switchRepresentation$5(e){e.representation==="absolute"?spineplot(e):barplot(e)}function barplot(e){const{data:t,scales:n,bars:s}=e,u=Summaries.translate(t,[l=>({x:l.label,y:zero,height:l.stat,width:one}),l=>({x:l.label,y:zero,height:Reduced.stack(l.stat),width:one})]),[d]=u,f={default:!0,ratio:!0};exports.Scale.train(n.x,d.x,f),exports.Scale.train(n.y,d.height,f),exports.Scale.train(n.width,[0,1],f),exports.Scale.train(n.height,d.height,f),ExpanseBand.setWeights(n.x.domain);const a={scale:1/new Set(d.x).size,mult:.9};return exports.Scale.set(n.width,()=>a,{default:!0}),exports.Expanse.set(n.width.codomain,()=>({offset:0}),{default:!0}),Meta.copy(d.height,n.y,["name"]),Reactive.removeAll(e,"reorder"),Reactive.listen(e,"reorder",()=>sortAxis$1(n.x.domain,d.height)),Geom.setCoordinates(s,u),e.representation="absolute",exports.Plot.render(e),exports.Plot.renderAxes(e),e}function spineplot(e){const{data:t,scales:n,bars:s}=e,u=Summaries.translate(t,[a=>({x:a.label,y:zero,height:one,width:a.stat}),a=>({x:a.label,y:zero,height:Reduced.normalize(Reduced.stack(a.stat),(l,r)=>l/r),width:Reduced.parent(a.stat)})]),[d]=u,f={default:!0,ratio:!0};exports.Scale.train(n.x,d.x,f),exports.Scale.train(n.y,[0,1],f),exports.Scale.train(n.width,cumsum(d.width),f),exports.Scale.train(n.height,[0,1],f),ExpanseBand.setWeights(n.x.domain,d.width);const o={scale:1,mult:1};exports.Scale.set(n.width,()=>o,{default:!0}),exports.Expanse.set(n.width.codomain,()=>({offset:-1}),{default:!0}),Meta.set(n.y,{name:"proportion"}),Reactive.removeAll(e,"reorder"),Reactive.listen(e,"reorder",()=>sortAxis$1(n.x.domain,d.width)),Geom.setCoordinates(s,u),e.representation="proportion",exports.Plot.render(e),exports.Plot.renderAxes(e)}function Bibarplot(e,t,n){const{data:s,marker:u}=e;let[d,f,o]=t(s);const a=exports.Reducer.sum,l=exports.Reducer.sum,r=o?f:()=>1,i=o||f,c=exports.Factor.from(d),p=exports.Factor.product(c,u.factor),m=[c,p],y=n!=null&&n.queries?n.queries(s):{},b=[r,a],x=[i,l],A=Summaries.of({stat1:b,stat2:x,...y},m),S=exports.Scales.of({x:["band","continuous"],heightUp:["continuous","continuous"],heightDown:["continuous","continuous"]}),M={type:"bar",representation:"absolute"},v={...S,height:S.heightUp},z={...S,height:S.heightDown},k=Bars.of([],v),C=Bars.of([],z),g={bars1:k,bars2:C},h=Object.assign(exports.Plot.of(A,S,M),g);bibarplot(h),exports.Plot.addGeom(h,k),exports.Plot.addGeom(h,C);const w={default:!0};return exports.Scale.shareCodomain(S.height,[S.heightUp,S.heightDown]),exports.Scale.set(S.heightUp,()=>({one:.4}),w),exports.Scale.set(S.heightDown,()=>({one:-.4}),w),exports.Expanse.set(S.height.codomain,()=>({inv:identity}),w),Reactive.listen(h,"normalize",()=>switchRepresentation$4(h)),h}function sortAxis(e,t){if(e.props.ordered)ExpanseBand.reorder(e);else{const n=orderIndices(t);ExpanseBand.reorder(e,n)}}function switchRepresentation$4(e){e.representation==="absolute"?normalizedbibarplot(e):bibarplot(e)}function bibarplot(e){const{data:t,scales:n,bars1:s,bars2:u}=e,d=Summaries.translate(t,[x=>({x:x.label,y:zero,height:x.stat1,width:one}),x=>({x:x.label,y:zero,height:Reduced.stack(x.stat1),width:one})]),f=Summaries.translate(t,[x=>({x:x.label,y:zero,height:x.stat2,width:one}),x=>({x:x.label,y:zero,height:Reduced.stack(x.stat2),width:one})]),[o]=d,a={default:!0,ratio:!0},{stat1:l,stat2:r}=t[0],i=Math.max(...l),c=Math.max(...r);exports.Scale.train(n.x,o.x,a),exports.Scale.train(n.y,[-1,1],{default:!0,ratio:!1}),exports.Scale.train(n.width,[0,1],a),exports.Scale.train(n.heightUp,[0,i],a),exports.Scale.train(n.heightDown,[0,c],a),ExpanseBand.setWeights(n.x.domain);const[p,m]=[l,r].map(x=>Meta.get(x,"name"));Meta.set(n.y,{name:`${m} / ${p}`});const b={scale:1/new Set(o.x).size,mult:.9,offset:0};return exports.Scale.set(n.width,()=>b,{default:!0}),Reactive.removeAll(e,"reorder"),Reactive.listen(e,"reorder",()=>sortAxis(n.x.domain,o.height)),Geom.setCoordinates(s,d),Geom.setCoordinates(u,f),e.representation="absolute",exports.Plot.render(e),exports.Plot.renderAxes(e),e}function normalizedbibarplot(e){const{data:t,scales:n,bars1:s,bars2:u}=e,d=Summaries.translate(t,[i=>({x:i.label,y:zero,height:one,width:one}),i=>({x:i.label,y:zero,height:Reduced.normalize(Reduced.stack(i.stat1),(c,p)=>c/p),width:one})]),f=Summaries.translate(t,[i=>({x:i.label,y:zero,height:one,width:one}),i=>({x:i.label,y:zero,height:Reduced.normalize(Reduced.stack(i.stat2),(c,p)=>c/p),width:one})]),[o]=d,a={default:!0,ratio:!0};exports.Scale.train(n.x,o.x,a),exports.Scale.train(n.y,[-1,1],{default:!0,ratio:!1}),exports.Scale.train(n.width,[0,1],a),exports.Scale.train(n.heightUp,[0,1],a),exports.Scale.train(n.heightDown,[0,1],a),ExpanseBand.setWeights(n.x.domain),Meta.set(n.y,{name:"proportion"});const r={scale:1/new Set(o.x).size,mult:.9,offset:0};return exports.Scale.set(n.width,()=>r,{default:!0}),Reactive.removeAll(e,"reorder"),Geom.setCoordinates(s,d),Geom.setCoordinates(u,f),e.representation="proportion",exports.Plot.render(e),exports.Plot.renderAxes(e),e}function Fluctuationplot(e,t,n){const{data:s,marker:u}=e;let[d,f,o]=t(s);const a=o&&(n!=null&&n.reducer)?n.reducer:exports.Reducer.sum,l=o?[...o]:()=>1,r=exports.Factor.product(exports.Factor.from(d),exports.Factor.from(f)),i=exports.Factor.product(r,u.factor),c=[r,i],p=n!=null&&n.queries?n.queries(s):{},m=[l,a],y=Summaries.of({stat:m,...p},c),b=exports.Scales.of({x:["band","continuous"],y:["band","continuous"]}),[x,A]=["fluct","absolute"],S={...n,type:x,representation:A},M=Bars.of([],b,{vAnchor:VAnchor.Middle}),v=Object.assign(exports.Plot.of(y,b,S),{bars:M});return exports.Scale.link(b.area,[b.width,b.height]),exports.Scale.shareCodomain(b.area,[b.width,b.height]),fluctplot(v),exports.Plot.addGeom(v,M),Reactive.listen(v,"normalize",()=>switchRepresentation$3(v)),v}function switchRepresentation$3(e){e.representation==="absolute"?pctfluctplot(e):fluctplot(e)}function fluctplot(e){const{data:t,scales:n,bars:s}=e,u=Summaries.translate(t,[l=>({x:l.label,y:l.label$,height:l.stat,width:l.stat}),l=>({x:l.label,y:l.label$,height:Reduced.stack(l.stat),width:Reduced.stack(l.stat)})]),[d]=u,f={default:!0,ratio:!0};exports.Scale.train(n.x,d.x,f),exports.Scale.train(n.y,d.y,f),exports.Scale.train(n.width,d.width,f),exports.Scale.train(n.height,d.height,f);const a={scale:1/max(new Set(d.x).size,new Set(d.y).size)**2,mult:.9};exports.Scale.set(n.area,()=>a,{default:!0}),exports.Expanse.set(n.area.codomain,()=>({offset:0})),Geom.setCoordinates(s,u),e.representation="absolute",exports.Plot.render(e)}function pctfluctplot(e){const{data:t,scales:n,bars:s}=e,u=Summaries.translate(t,[l=>({x:l.label,y:l.label$,height:one,width:one}),l=>({x:l.label,y:l.label$,height:Reduced.normalize(Reduced.stack(l.stat),(r,i)=>r/i),width:Reduced.normalize(Reduced.stack(l.stat),(r,i)=>r/i)})]),[d]=u,f={default:!0,ratio:!0};exports.Scale.train(n.x,d.x,f),exports.Scale.train(n.y,d.y,f),exports.Scale.train(n.width,[0,1],f),exports.Scale.train(n.height,[0,1],f);const a={scale:1/max(new Set(d.x).size,new Set(d.y).size)**2,mult:.9};exports.Scale.set(n.area,()=>a,{default:!0}),exports.Expanse.set(n.area.codomain,()=>({offset:-2})),Geom.setCoordinates(s,u),e.representation="proportion",exports.Plot.render(e)}var Rectangles;(e=>{const t="rectangles";function n(f,o){return Geom.of({type:t,coordinates:f,scales:o})}e.of=n,exports.Poly.set(Geom.render,t,s),exports.Poly.set(Geom.check,t,u),exports.Poly.set(Geom.query,t,d);function s(f,o){const{scales:a}=f,l=Geom.groupedData(f),r=findLength(Object.values(l)),[i,c,p,m,y]=Geom.scaledArrays(r,[[l.x0,a.x],[l.y0,a.y],[l.x1,a.x],[l.y1,a.y],[l.area,a.areaPct]]),b=Geom.frames(r,l[LAYER],o);Frame.rectanglesXY(b,i,c,p,m,y)}e.render=s;function u(f,o){const{scales:a}=f,l=Geom.flatData(f),r=findLength(Object.values(l)),{x0:i,y0:c,x1:p,y1:m,area:y}=Getter.mapObject(l),b=Getter.of(l[exports.Factor.POSITIONS]),x=[];for(let A=0;A<r;A++){let S=exports.Scale.pushforward(a.x,i(A)),M=exports.Scale.pushforward(a.y,c(A)),v=exports.Scale.pushforward(a.x,p(A)),z=exports.Scale.pushforward(a.y,m(A));if(l.area){const k=exports.Scale.pushforward(a.areaPct,y(A)),C=v-S,g=z-M;S=S+(1-k)/2*C,v=v-(1-k)/2*C,M=M+(1-k)/2*g,z=z-(1-k)/2*g}if(rectsIntersect(o,[S,M,v,z])){const k=b(A);for(let C=0;C<k.length;C++)x.push(k[C])}}return x}e.check=u;function d(f,o){var x;const{scales:a}=f,l=Geom.flatData(f),r=Geom.groupedData(f),i=findLength(Object.values(l)),{x0:c,y0:p,x1:m,y1:y,area:b}=Getter.mapObject(l);for(let A=0;A<i;A++){let S=exports.Scale.pushforward(a.x,c(A)),M=exports.Scale.pushforward(a.y,p(A)),v=exports.Scale.pushforward(a.x,m(A)),z=exports.Scale.pushforward(a.y,y(A));if(l.area){const k=exports.Scale.pushforward(a.areaPct,b(A)),C=v-S,g=z-M;S=S+(1-k)/2*C,v=v-(1-k)/2*C,M=M+(1-k)/2*g,z=z-(1-k)/2*g}if(pointInRect(o,[S,M,v,z])){const k=(x=l[exports.Factor.CHILD_INDICES])==null?void 0:x[A];return Geom.getQueryInfo(r,k)}}}e.query=d})(Rectangles||(Rectangles={}));function Histogram(e,t,n){const{data:s,marker:u}=e;let[d,f]=t(s);const o=f&&(n!=null&&n.reducer)?n.reducer:exports.Reducer.sum,a=f||(()=>1),[l,r]=minmax(d),i=r-l,c=Reactive.of()({anchor:l,width:i/15}),p=exports.Factor.mono(d.length),m=exports.Factor.product(p,exports.Factor.bin(d,c)),y=exports.Factor.product(m,u.factor),b=[p,m,y],x=n!=null&&n.queries?n.queries(s):{},A=[a,o],S=Summaries.of({stat:A,...x},b),M=exports.Scales.of(),[v,z]=["histo","absolute"],k={...n,type:v,representation:z},C=Rectangles.of([],M),g=Object.assign(exports.Plot.of(S,M,k),{rectangles:C});histogram(g),exports.Plot.addGeom(g,C),Reactive.listen(g,"normalize",()=>switchRepresentation$2(g));const h=i/10;return Reactive.listen(g,"set-parameters",w=>{w&&(w.width&&Reactive.set(c,()=>({width:w.width})),w.anchor&&Reactive.set(c,()=>({anchor:w.anchor})))}),Reactive.listen(g,"grow",()=>Reactive.set(c,w=>({width:w.width*10/9}))),Reactive.listen(g,"shrink",()=>Reactive.set(c,w=>({width:w.width*9/10}))),Reactive.listen(g,"increment-anchor",()=>Reactive.set(c,w=>({anchor:w.anchor+h}))),Reactive.listen(g,"decrement-anchor",()=>Reactive.set(c,w=>({anchor:w.anchor-h}))),Reactive.listen(g,"reset",()=>{Reactive.set(c,()=>({anchor:l,width:i/15}))}),g}function switchRepresentation$2(e){e.representation==="absolute"?spinogram(e):histogram(e)}function histogram(e){const{data:t,rectangles:n}=e,s=Summaries.translate(t,[f=>f,f=>({x0:f.binMin,y0:zero,x1:f.binMax,y1:f.stat}),f=>({x0:f.binMin,y0:zero,x1:f.binMax,y1:Reduced.stack(f.stat)})]),{scales:u}=e,[,d]=s;exports.Scale.train(u.x,d.x1,{default:!0,name:!1}),exports.Scale.train(u.y,d.y1,{default:!0,ratio:!0}),exports.Scale.freeze(u.y,["zero"]),Reactive.removeAll(n.coordinates[1],"changed"),Reactive.listen(s[1],"changed",()=>{exports.Scale.train(u.x,d.x1,{default:!0,name:!1}),exports.Scale.train(u.y,d.y1,{default:!0,ratio:!0})}),Meta.copy(t[1].breaks,u.x,["name"]),Meta.copy(d.y1,u.y,["name"]),Geom.setCoordinates(n,s),e.representation="absolute",exports.Plot.render(e),exports.Plot.renderAxes(e)}function spinogram(e){const{data:t,rectangles:n}=e,s=Summaries.translate(t,[f=>f,f=>({x0:Reduced.shiftLeft(Reduced.stack(f.stat)),y0:zero,x1:Reduced.stack(f.stat),y1:one}),f=>({x0:Reduced.shiftLeft(Reduced.stack(Reduced.parent(f.stat))),y0:zero,x1:Reduced.stack(Reduced.parent(f.stat)),y1:Reduced.normalize(Reduced.stack(f.stat),(o,a)=>o/a),query1:f.binMin,query2:f.binMax})]),{scales:u}=e,[,d]=s;exports.Scale.train(u.x,[0,...d.x1],{default:!0,name:!1}),exports.Scale.train(u.y,[0,1],{default:!0,ratio:!0}),exports.Scale.freeze(u.y,["zero"]),Reactive.removeAll(n.coordinates[1],"changed"),Reactive.listen(s[1],"changed",()=>{exports.Scale.train(u.x,[0,...d.x1],{default:!0,name:!1})}),Meta.set(u.x,{name:"cumulative count"}),Meta.set(u.y,{name:"proportion"}),Geom.setCoordinates(n,s),e.representation="proportion",exports.Plot.render(e),exports.Plot.renderAxes(e)}function Histogram2d(e,t,n){const{data:s,marker:u}=e;let[d,f,o]=t(s);const a=o&&(n!=null&&n.reducer)?n.reducer:exports.Reducer.sum,l=o||(()=>1),[r,i]=minmax(d),[c,p]=minmax(f),[m,y]=[i-r,p-c],b=Reactive.of()({anchor:r,width:m/15}),x=Reactive.of()({anchor:c,width:y/15}),A=exports.Factor.bin(d,b),S=exports.Factor.bin(f,x),M=exports.Factor.product(A,S),v=exports.Factor.product(M,u.factor),z=[M,v],k=n!=null&&n.queries?n.queries(s):{},C=[l,a],g=Summaries.of({stat:C,...k},z),h=exports.Scales.of(),[w,E]=["histo2d","absolute"],I={...n,type:w,representation:E},D=Rectangles.of([],h),O=Object.assign(exports.Plot.of(g,h,I),{rectangles:D});return histogram2d(O),exports.Plot.addGeom(O,D),Reactive.listen(O,"normalize",()=>switchRepresentation$1(O)),Reactive.listen(O,"set-parameters",_=>{_&&(_.width1&&Reactive.set(b,()=>({width:_.width1})),_.anchor1&&Reactive.set(b,()=>({anchor:_.anchor1})),_.width2&&Reactive.set(x,()=>({width:_.width2})),_.anchor2&&Reactive.set(x,()=>({anchor:_.anchor2})))}),Reactive.listen(O,"grow",()=>{Reactive.set(b,_=>({width:_.width*10/9})),Reactive.set(x,_=>({width:_.width*10/9}))}),Reactive.listen(O,"shrink",()=>{Reactive.set(b,_=>({width:_.width*9/10})),Reactive.set(x,_=>({width:_.width*9/10}))}),Reactive.listen(O,"reset",()=>{Reactive.set(b,()=>({anchor:r,width:m/15})),Reactive.set(x,()=>({anchor:c,width:y/15}))}),O}function switchRepresentation$1(e){e.representation==="absolute"?spinogram2d(e):histogram2d(e)}function histogram2d(e){const{data:t,rectangles:n}=e,s=Summaries.translate(t,[o=>({x0:o.binMin,y0:o.binMin$,x1:o.binMax,y1:o.binMax$,area:o.stat}),o=>({x0:o.binMin,y0:o.binMin$,x1:o.binMax,y1:o.binMax$,area:Reduced.stack(o.stat)})]),{scales:u}=e,[,d]=s,f={default:!0};exports.Scale.train(u.x,d.x1,f),exports.Scale.train(u.y,d.y1,f),exports.Scale.train(u.areaPct,d.area,f),exports.Expanse.set(u.area.codomain,()=>({min:0,max:1}),f),exports.Expanse.freeze(u.area.codomain,["min","max"]),Reactive.removeAll(n.coordinates[0],"changed"),Reactive.listen(s[0],"changed",()=>{exports.Scale.train(u.x,d.x1,{default:!0,name:!1}),exports.Scale.train(u.y,d.y1,{default:!0,name:!1}),exports.Scale.train(u.areaPct,d.area,f)}),e.representation="absolute",Geom.setCoordinates(n,s),Meta.copy(t[1].breaks,u.x,["name"]),Meta.copy(t[1].breaks$,u.y,["name"]),exports.Plot.render(e),exports.Plot.renderAxes(e)}function spinogram2d(e){const{data:t,rectangles:n}=e,s=Summaries.translate(t,[o=>({x0:o.binMin,y0:o.binMin$,x1:o.binMax,y1:o.binMax$,area:one}),o=>({x0:o.binMin,y0:o.binMin$,x1:o.binMax,y1:o.binMax$,area:Reduced.normalize(Reduced.stack(o.stat),(a,l)=>a/l)})]),{scales:u}=e,[,d]=s,f={default:!0};exports.Scale.train(u.x,d.x1,f),exports.Scale.train(u.y,d.y1,f),exports.Scale.train(u.areaPct,[0,1],f),exports.Expanse.set(u.area.codomain,()=>({min:0,max:1}),f),exports.Expanse.freeze(u.area.codomain,["min","max"]),Reactive.removeAll(n.coordinates[0],"changed"),Reactive.listen(s[0],"changed",()=>{exports.Scale.train(u.x,d.x1,{default:!0,name:!1}),exports.Scale.train(u.y,d.y1,{default:!0,name:!1})}),e.representation="proportion",Geom.setCoordinates(n,s),Meta.copy(t[1].breaks,u.x,["name"]),Meta.copy(t[1].breaks$,u.y,["name"]),exports.Plot.render(e),exports.Plot.renderAxes(e)}var Lines;(e=>{const t="lines";function n(f,o){return Geom.of({type:t,coordinates:f,scales:o})}e.of=n,exports.Poly.set(Geom.render,t,s),exports.Poly.set(Geom.check,t,u),exports.Poly.set(Geom.query,t,d);function s(f,o){const{scales:a}=f,l=Geom.groupedData(f),r=findLength(Object.values(l)),[i,c]=Geom.scaledArrays(r,[[l.x,a.x],[l.y,a.y]]),p=Geom.frames(r,l[LAYER],o);Frame.lines(p,i,c)}e.render=s;function u(f,o){const{scales:a}=f,l=Geom.flatData(f),r=findLength(Object.values(l)),{x:i,y:c}=Getter.mapObject(l),p=Getter.of(l[exports.Factor.POSITIONS]),m=[];for(let y=0;y<r;y++){const b=exports.Scale.pushforward(a.x,i(y)),x=exports.Scale.pushforward(a.y,c(y));for(let A=1;A<b.length;A++){const S=[b[A-1],x[A-1],b[A],x[A]];if(rectSegmentIntersect(o,S)){const M=p(y);for(let v=0;v<M.length;v++)m.push(M[v])}}}return m}e.check=u;function d(f,o){var y;let{scales:a}=f;const l=Geom.flatData(f),r=Geom.groupedData(f),i=findLength(Object.values(l)),{x:c,y:p}=Getter.mapObject(l),m=bimap([...o,...o],[-1,-1,1,1],sum);for(let b=0;b<i;b++){const x=exports.Scale.pushforward(a.x,c(b)),A=exports.Scale.pushforward(a.y,p(b));for(let S=1;S<x.length;S++){const M=[x[S-1],A[S-1],x[S],A[S]];if(rectSegmentIntersect(m,M)){const v=(y=l[exports.Factor.CHILD_INDICES])==null?void 0:y[b],z=c(b),k=p(b),C={};for(let h=0;h<z.length;h++)C[z[h]]=k[h];const g=v[0];return C[LAYER]=Getter.of(r[LAYER])(g),[C]}}}}e.query=d})(Lines||(Lines={}));function inferExpanse(e,t={train:!0}){const s=isNumberArray(e)?ExpanseContinuous.of():ExpansePoint.of();return t.train&&exports.Expanse.train(s,e,{default:!0}),s}function Pcoordsplot(e,t,n){const{data:s,marker:u}=e,d=t(s),f=d.map(v=>Meta.get(v,"name")),o=Getter.constant(f),a=Getter.multi(d),l=n!=null&&n.queries?n.queries(s):{},r=exports.Factor.bijection(d[0].length,{x:o,y:a,...l}),i=exports.Factor.product(r,u.factor),c=Summaries.of({},[r,i]),p=exports.Scales.of({x:["split","split"],y:["compound","split"]}),m=Summaries.translate(c,[v=>v,v=>v]),y=Lines.of(m,p),[b,x]=["pcoords","proportion"],A={...n,type:b,representation:x},S=Object.assign(exports.Plot.of(c,p,A),{lines:y});exports.Plot.addGeom(S,y);const M=d.map(v=>inferExpanse(v));return exports.Scale.setDomain(p.x,ExpanseSplit.of(ExpansePoint.of(f))),exports.Scale.setDomain(p.y,ExpanseCompound.of(M)),Meta.set(p.x,{name:"variable"}),Meta.set(p.y,{name:"value"}),Reactive.listen(S,"normalize",()=>switchRepresentation(S)),S}function switchRepresentation(e){e.representation==="proportion"?(ExpanseCompound.setCommonScale(e.scales.y.domain,!0),e.representation="absolute"):(ExpanseCompound.setCommonScale(e.scales.y.domain,!1),e.representation="proportion"),exports.Plot.renderAxes(e)}var Points;(e=>{const t="points";function n(f,o){return Geom.of({type:t,coordinates:f,scales:o})}e.of=n,exports.Poly.set(Geom.render,t,s),exports.Poly.set(Geom.check,t,u),exports.Poly.set(Geom.query,t,d);function s(f,o){const{scales:a}=f,l=Geom.groupedData(f),r=findLength(Object.values(l)),[i,c,p]=Geom.scaledArrays(r,[[l.x,a.x],[l.y,a.y],[l.size,a.size]]),m=Geom.frames(r,l[LAYER],o);Frame.points(m,i,c,p)}e.render=s;function u(f,o){const{scales:a}=f,l=Geom.flatData(f),r=findLength(Object.values(l)),{x:i,y:c,size:p}=Getter.mapObject(l),m=Getter.of(l[exports.Factor.POSITIONS]),y=[];for(let b=0;b<r;b++){const x=exports.Scale.pushforward(a.x,i(b)),A=exports.Scale.pushforward(a.y,c(b));let S=exports.Scale.pushforward(a.size,p(b));S=S/Math.sqrt(2);const M=[x-S,A-S,x+S,A+S];if(rectsIntersect(o,M)){const v=m(b);for(let z=0;z<v.length;z++)y.push(v[z])}}return y}e.check=u;function d(f,o){var y;const{scales:a}=f,l=Geom.flatData(f),r=Geom.groupedData(f),i=findLength(Object.values(l)),{x:c,y:p,size:m}=Getter.mapObject(l);for(let b=0;b<i;b++){const x=exports.Scale.pushforward(a.x,c(b)),A=exports.Scale.pushforward(a.y,p(b));let S=exports.Scale.pushforward(a.size,m(b));S=S/Math.sqrt(2);const M=[x-S,A-S,x+S,A+S];if(pointInRect(o,M)){const v=(y=l[exports.Factor.CHILD_INDICES])==null?void 0:y[b];return Geom.getQueryInfo(r,v)}}}e.query=d})(Points||(Points={}));function Scatterplot(e,t,n){const{data:s,marker:u}=e,[d,f,o]=t(s),a=n!=null&&n.queries?n==null?void 0:n.queries(s):{},l={x:d,y:f,size:o??(()=>.5),...a},r=exports.Factor.bijection(d.length,l),i=exports.Factor.product(r,u.factor),c=Summaries.of({},[r,i]),p=Summaries.translate(c,[S=>S,S=>S]),m=exports.Scales.of(),y={...n,type:"scatter"},b=exports.Plot.of(c,m,y);exports.Scale.train(m.x,d,{default:!0}),exports.Scale.train(m.y,f,{default:!0}),o&&exports.Scale.train(m.size,o,{default:!0});const x=30/Math.log(d.length+2);exports.Expanse.set(m.size.codomain,()=>({max:x}),{default:!0});const A=Points.of(p,m);return exports.Plot.addGeom(b,A),b}const defaultOptions={size:10,expandX:.1,expandY:.1,gapPct:.8,gapPx:1,axisLabelSize:1,axisTitleSize:1.25,margins:[0,0,0,0],marginLines:[3.5,3.5,1,1],colors:["#FF7F00","#E31A1C","#33A02C","#1F78B4","#FDBF6F","#FB9A99","#B2DF8A","#A6CEE3"],plotBackground:"#fefffe"};function renderAxisLabels(e){renderSingleAxisLabels(e,"x"),renderSingleAxisLabels(e,"y")}function renderSingleAxisLabels(e,t){const{frames:n,scales:s,options:u}=e,{margins:d,marginLines:f}=u,o=s[t],a=t==="x"?s.y:s.x,l=n[`${t}Axis`],{context:r}=l,{labels:i,positions:c}=exports.Scale.breaks(o),[p,m,y,b]=d,x=parseInt(r.font.match(/^[0-9]*/)[0],10),A=a.codomain.props.min-x/2,{width:S,height:M}=l;if(Frame.clear(l),t==="x"){let[v,z]=[0,0];for(let k=0;k<i.length;k++){const C=i[k],g=c[k],h=Frame.textWidth(l,C)+1;outside(g,m,S-b)||overlap(v,g,z,h)||([v,z]=[g,h],Frame.text(l,g,A,C))}}else if(t==="y"){let[v,z]=[0,0];for(let k=0;k<i.length;k++){const C=i[k],g=c[k],h=Frame.textWidth(l,C)+1,w=Frame.textHeight(l,C)+1;if(!outside(g,p,M-y)&&!overlap(v,g,z,w)){for(;d[1]/2<h+w;)f[1]*=1.05,exports.Plot.resize(e);[v,z]=[g,w],Frame.text(l,A,g,C)}}}}function renderAxisTitles(e){renderSingleAxisTitle(e,"x"),renderSingleAxisTitle(e,"y")}function renderSingleAxisTitle(e,t){const{scales:n,frames:s,options:u}=e,{margins:d}=u,f=n[t],o=t==="x"?e.scales.y:e.scales.x,a=s.base,l=Meta.get(f,"name"),r=t==="x"?d[0]:d[1],i=exports.Expanse.unnormalize(f.codomain,.5),c=exports.Expanse.unnormalize(o.codomain,0)-r*2/3;t==="x"&&Frame.text(a,i,c,l),t==="y"&&Frame.text(a,c,i,l,{vertical:!0})}function outside(e,t,n){return e<t||e>n}function overlap(e,t,n,s){const[u,d]=[e-n/2,e+n/2],[f,o]=[t-s/2,t+s/2];return u<o&&d>=f}function _typeof(e){"@babel/helpers - typeof";return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(e)}var trimLeft=/^\s+/,trimRight=/\s+$/;function tinycolor(e,t){if(e=e||"",t=t||{},e instanceof tinycolor)return e;if(!(this instanceof tinycolor))return new tinycolor(e,t);var n=inputToRGB(e);this._originalInput=e,this._r=n.r,this._g=n.g,this._b=n.b,this._a=n.a,this._roundA=Math.round(100*this._a)/100,this._format=t.format||n.format,this._gradientType=t.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=n.ok}tinycolor.prototype={isDark:function e(){return this.getBrightness()<128},isLight:function e(){return!this.isDark()},isValid:function e(){return this._ok},getOriginalInput:function e(){return this._originalInput},getFormat:function e(){return this._format},getAlpha:function e(){return this._a},getBrightness:function e(){var t=this.toRgb();return(t.r*299+t.g*587+t.b*114)/1e3},getLuminance:function e(){var t=this.toRgb(),n,s,u,d,f,o;return n=t.r/255,s=t.g/255,u=t.b/255,n<=.03928?d=n/12.92:d=Math.pow((n+.055)/1.055,2.4),s<=.03928?f=s/12.92:f=Math.pow((s+.055)/1.055,2.4),u<=.03928?o=u/12.92:o=Math.pow((u+.055)/1.055,2.4),.2126*d+.7152*f+.0722*o},setAlpha:function e(t){return this._a=boundAlpha(t),this._roundA=Math.round(100*this._a)/100,this},toHsv:function e(){var t=rgbToHsv(this._r,this._g,this._b);return{h:t.h*360,s:t.s,v:t.v,a:this._a}},toHsvString:function e(){var t=rgbToHsv(this._r,this._g,this._b),n=Math.round(t.h*360),s=Math.round(t.s*100),u=Math.round(t.v*100);return this._a==1?"hsv("+n+", "+s+"%, "+u+"%)":"hsva("+n+", "+s+"%, "+u+"%, "+this._roundA+")"},toHsl:function e(){var t=rgbToHsl(this._r,this._g,this._b);return{h:t.h*360,s:t.s,l:t.l,a:this._a}},toHslString:function e(){var t=rgbToHsl(this._r,this._g,this._b),n=Math.round(t.h*360),s=Math.round(t.s*100),u=Math.round(t.l*100);return this._a==1?"hsl("+n+", "+s+"%, "+u+"%)":"hsla("+n+", "+s+"%, "+u+"%, "+this._roundA+")"},toHex:function e(t){return rgbToHex(this._r,this._g,this._b,t)},toHexString:function e(t){return"#"+this.toHex(t)},toHex8:function e(t){return rgbaToHex(this._r,this._g,this._b,this._a,t)},toHex8String:function e(t){return"#"+this.toHex8(t)},toRgb:function e(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function e(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function e(){return{r:Math.round(bound01(this._r,255)*100)+"%",g:Math.round(bound01(this._g,255)*100)+"%",b:Math.round(bound01(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function e(){return this._a==1?"rgb("+Math.round(bound01(this._r,255)*100)+"%, "+Math.round(bound01(this._g,255)*100)+"%, "+Math.round(bound01(this._b,255)*100)+"%)":"rgba("+Math.round(bound01(this._r,255)*100)+"%, "+Math.round(bound01(this._g,255)*100)+"%, "+Math.round(bound01(this._b,255)*100)+"%, "+this._roundA+")"},toName:function e(){return this._a===0?"transparent":this._a<1?!1:hexNames[rgbToHex(this._r,this._g,this._b,!0)]||!1},toFilter:function e(t){var n="#"+rgbaToArgbHex(this._r,this._g,this._b,this._a),s=n,u=this._gradientType?"GradientType = 1, ":"";if(t){var d=tinycolor(t);s="#"+rgbaToArgbHex(d._r,d._g,d._b,d._a)}return"progid:DXImageTransform.Microsoft.gradient("+u+"startColorstr="+n+",endColorstr="+s+")"},toString:function e(t){var n=!!t;t=t||this._format;var s=!1,u=this._a<1&&this._a>=0,d=!n&&u&&(t==="hex"||t==="hex6"||t==="hex3"||t==="hex4"||t==="hex8"||t==="name");return d?t==="name"&&this._a===0?this.toName():this.toRgbString():(t==="rgb"&&(s=this.toRgbString()),t==="prgb"&&(s=this.toPercentageRgbString()),(t==="hex"||t==="hex6")&&(s=this.toHexString()),t==="hex3"&&(s=this.toHexString(!0)),t==="hex4"&&(s=this.toHex8String(!0)),t==="hex8"&&(s=this.toHex8String()),t==="name"&&(s=this.toName()),t==="hsl"&&(s=this.toHslString()),t==="hsv"&&(s=this.toHsvString()),s||this.toHexString())},clone:function e(){return tinycolor(this.toString())},_applyModification:function e(t,n){var s=t.apply(null,[this].concat([].slice.call(n)));return this._r=s._r,this._g=s._g,this._b=s._b,this.setAlpha(s._a),this},lighten:function e(){return this._applyModification(_lighten,arguments)},brighten:function e(){return this._applyModification(_brighten,arguments)},darken:function e(){return this._applyModification(_darken,arguments)},desaturate:function e(){return this._applyModification(_desaturate,arguments)},saturate:function e(){return this._applyModification(_saturate,arguments)},greyscale:function e(){return this._applyModification(_greyscale,arguments)},spin:function e(){return this._applyModification(_spin,arguments)},_applyCombination:function e(t,n){return t.apply(null,[this].concat([].slice.call(n)))},analogous:function e(){return this._applyCombination(_analogous,arguments)},complement:function e(){return this._applyCombination(_complement,arguments)},monochromatic:function e(){return this._applyCombination(_monochromatic,arguments)},splitcomplement:function e(){return this._applyCombination(_splitcomplement,arguments)},triad:function e(){return this._applyCombination(polyad,[3])},tetrad:function e(){return this._applyCombination(polyad,[4])}},tinycolor.fromRatio=function(e,t){if(_typeof(e)=="object"){var n={};for(var s in e)e.hasOwnProperty(s)&&(s==="a"?n[s]=e[s]:n[s]=convertToPercentage(e[s]));e=n}return tinycolor(e,t)};function inputToRGB(e){var t={r:0,g:0,b:0},n=1,s=null,u=null,d=null,f=!1,o=!1;return typeof e=="string"&&(e=stringInputToObject(e)),_typeof(e)=="object"&&(isValidCSSUnit(e.r)&&isValidCSSUnit(e.g)&&isValidCSSUnit(e.b)?(t=rgbToRgb(e.r,e.g,e.b),f=!0,o=String(e.r).substr(-1)==="%"?"prgb":"rgb"):isValidCSSUnit(e.h)&&isValidCSSUnit(e.s)&&isValidCSSUnit(e.v)?(s=convertToPercentage(e.s),u=convertToPercentage(e.v),t=hsvToRgb(e.h,s,u),f=!0,o="hsv"):isValidCSSUnit(e.h)&&isValidCSSUnit(e.s)&&isValidCSSUnit(e.l)&&(s=convertToPercentage(e.s),d=convertToPercentage(e.l),t=hslToRgb(e.h,s,d),f=!0,o="hsl"),e.hasOwnProperty("a")&&(n=e.a)),n=boundAlpha(n),{ok:f,format:e.format||o,r:Math.min(255,Math.max(t.r,0)),g:Math.min(255,Math.max(t.g,0)),b:Math.min(255,Math.max(t.b,0)),a:n}}function rgbToRgb(e,t,n){return{r:bound01(e,255)*255,g:bound01(t,255)*255,b:bound01(n,255)*255}}function rgbToHsl(e,t,n){e=bound01(e,255),t=bound01(t,255),n=bound01(n,255);var s=Math.max(e,t,n),u=Math.min(e,t,n),d,f,o=(s+u)/2;if(s==u)d=f=0;else{var a=s-u;switch(f=o>.5?a/(2-s-u):a/(s+u),s){case e:d=(t-n)/a+(t<n?6:0);break;case t:d=(n-e)/a+2;break;case n:d=(e-t)/a+4;break}d/=6}return{h:d,s:f,l:o}}function hslToRgb(e,t,n){var s,u,d;e=bound01(e,360),t=bound01(t,100),n=bound01(n,100);function f(l,r,i){return i<0&&(i+=1),i>1&&(i-=1),i<.16666666666666666?l+(r-l)*6*i:i<.5?r:i<.6666666666666666?l+(r-l)*(.6666666666666666-i)*6:l}if(t===0)s=u=d=n;else{var o=n<.5?n*(1+t):n+t-n*t,a=2*n-o;s=f(a,o,e+.3333333333333333),u=f(a,o,e),d=f(a,o,e-.3333333333333333)}return{r:s*255,g:u*255,b:d*255}}function rgbToHsv(e,t,n){e=bound01(e,255),t=bound01(t,255),n=bound01(n,255);var s=Math.max(e,t,n),u=Math.min(e,t,n),d,f,o=s,a=s-u;if(f=s===0?0:a/s,s==u)d=0;else{switch(s){case e:d=(t-n)/a+(t<n?6:0);break;case t:d=(n-e)/a+2;break;case n:d=(e-t)/a+4;break}d/=6}return{h:d,s:f,v:o}}function hsvToRgb(e,t,n){e=bound01(e,360)*6,t=bound01(t,100),n=bound01(n,100);var s=Math.floor(e),u=e-s,d=n*(1-t),f=n*(1-u*t),o=n*(1-(1-u)*t),a=s%6,l=[n,f,d,d,o,n][a],r=[o,n,n,f,d,d][a],i=[d,d,o,n,n,f][a];return{r:l*255,g:r*255,b:i*255}}function rgbToHex(e,t,n,s){var u=[pad2(Math.round(e).toString(16)),pad2(Math.round(t).toString(16)),pad2(Math.round(n).toString(16))];return s&&u[0].charAt(0)==u[0].charAt(1)&&u[1].charAt(0)==u[1].charAt(1)&&u[2].charAt(0)==u[2].charAt(1)?u[0].charAt(0)+u[1].charAt(0)+u[2].charAt(0):u.join("")}function rgbaToHex(e,t,n,s,u){var d=[pad2(Math.round(e).toString(16)),pad2(Math.round(t).toString(16)),pad2(Math.round(n).toString(16)),pad2(convertDecimalToHex(s))];return u&&d[0].charAt(0)==d[0].charAt(1)&&d[1].charAt(0)==d[1].charAt(1)&&d[2].charAt(0)==d[2].charAt(1)&&d[3].charAt(0)==d[3].charAt(1)?d[0].charAt(0)+d[1].charAt(0)+d[2].charAt(0)+d[3].charAt(0):d.join("")}function rgbaToArgbHex(e,t,n,s){var u=[pad2(convertDecimalToHex(s)),pad2(Math.round(e).toString(16)),pad2(Math.round(t).toString(16)),pad2(Math.round(n).toString(16))];return u.join("")}tinycolor.equals=function(e,t){return!e||!t?!1:tinycolor(e).toRgbString()==tinycolor(t).toRgbString()},tinycolor.random=function(){return tinycolor.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})};function _desaturate(e,t){t=t===0?0:t||10;var n=tinycolor(e).toHsl();return n.s-=t/100,n.s=clamp01(n.s),tinycolor(n)}function _saturate(e,t){t=t===0?0:t||10;var n=tinycolor(e).toHsl();return n.s+=t/100,n.s=clamp01(n.s),tinycolor(n)}function _greyscale(e){return tinycolor(e).desaturate(100)}function _lighten(e,t){t=t===0?0:t||10;var n=tinycolor(e).toHsl();return n.l+=t/100,n.l=clamp01(n.l),tinycolor(n)}function _brighten(e,t){t=t===0?0:t||10;var n=tinycolor(e).toRgb();return n.r=Math.max(0,Math.min(255,n.r-Math.round(255*-(t/100)))),n.g=Math.max(0,Math.min(255,n.g-Math.round(255*-(t/100)))),n.b=Math.max(0,Math.min(255,n.b-Math.round(255*-(t/100)))),tinycolor(n)}function _darken(e,t){t=t===0?0:t||10;var n=tinycolor(e).toHsl();return n.l-=t/100,n.l=clamp01(n.l),tinycolor(n)}function _spin(e,t){var n=tinycolor(e).toHsl(),s=(n.h+t)%360;return n.h=s<0?360+s:s,tinycolor(n)}function _complement(e){var t=tinycolor(e).toHsl();return t.h=(t.h+180)%360,tinycolor(t)}function polyad(e,t){if(isNaN(t)||t<=0)throw new Error("Argument to polyad must be a positive number");for(var n=tinycolor(e).toHsl(),s=[tinycolor(e)],u=360/t,d=1;d<t;d++)s.push(tinycolor({h:(n.h+d*u)%360,s:n.s,l:n.l}));return s}function _splitcomplement(e){var t=tinycolor(e).toHsl(),n=t.h;return[tinycolor(e),tinycolor({h:(n+72)%360,s:t.s,l:t.l}),tinycolor({h:(n+216)%360,s:t.s,l:t.l})]}function _analogous(e,t,n){t=t||6,n=n||30;var s=tinycolor(e).toHsl(),u=360/n,d=[tinycolor(e)];for(s.h=(s.h-(u*t>>1)+720)%360;--t;)s.h=(s.h+u)%360,d.push(tinycolor(s));return d}function _monochromatic(e,t){t=t||6;for(var n=tinycolor(e).toHsv(),s=n.h,u=n.s,d=n.v,f=[],o=1/t;t--;)f.push(tinycolor({h:s,s:u,v:d})),d=(d+o)%1;return f}tinycolor.mix=function(e,t,n){n=n===0?0:n||50;var s=tinycolor(e).toRgb(),u=tinycolor(t).toRgb(),d=n/100,f={r:(u.r-s.r)*d+s.r,g:(u.g-s.g)*d+s.g,b:(u.b-s.b)*d+s.b,a:(u.a-s.a)*d+s.a};return tinycolor(f)},tinycolor.readability=function(e,t){var n=tinycolor(e),s=tinycolor(t);return(Math.max(n.getLuminance(),s.getLuminance())+.05)/(Math.min(n.getLuminance(),s.getLuminance())+.05)},tinycolor.isReadable=function(e,t,n){var s=tinycolor.readability(e,t),u,d;switch(d=!1,u=validateWCAG2Parms(n),u.level+u.size){case"AAsmall":case"AAAlarge":d=s>=4.5;break;case"AAlarge":d=s>=3;break;case"AAAsmall":d=s>=7;break}return d},tinycolor.mostReadable=function(e,t,n){var s=null,u=0,d,f,o,a;n=n||{},f=n.includeFallbackColors,o=n.level,a=n.size;for(var l=0;l<t.length;l++)d=tinycolor.readability(e,t[l]),d>u&&(u=d,s=tinycolor(t[l]));return tinycolor.isReadable(e,s,{level:o,size:a})||!f?s:(n.includeFallbackColors=!1,tinycolor.mostReadable(e,["#fff","#000"],n))};var names=tinycolor.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},hexNames=tinycolor.hexNames=flip(names);function flip(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[e[n]]=n);return t}function boundAlpha(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function bound01(e,t){isOnePointZero(e)&&(e="100%");var n=isPercentage(e);return e=Math.min(t,Math.max(0,parseFloat(e))),n&&(e=parseInt(e*t,10)/100),Math.abs(e-t)<1e-6?1:e%t/parseFloat(t)}function clamp01(e){return Math.min(1,Math.max(0,e))}function parseIntFromHex(e){return parseInt(e,16)}function isOnePointZero(e){return typeof e=="string"&&e.indexOf(".")!=-1&&parseFloat(e)===1}function isPercentage(e){return typeof e=="string"&&e.indexOf("%")!=-1}function pad2(e){return e.length==1?"0"+e:""+e}function convertToPercentage(e){return e<=1&&(e=e*100+"%"),e}function convertDecimalToHex(e){return Math.round(parseFloat(e)*255).toString(16)}function convertHexToDecimal(e){return parseIntFromHex(e)/255}var matchers=function(){var e="[-\\+]?\\d+%?",t="[-\\+]?\\d*\\.\\d+%?",n="(?:"+t+")|(?:"+e+")",s="[\\s|\\(]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")\\s*\\)?",u="[\\s|\\(]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")\\s*\\)?";return{CSS_UNIT:new RegExp(n),rgb:new RegExp("rgb"+s),rgba:new RegExp("rgba"+u),hsl:new RegExp("hsl"+s),hsla:new RegExp("hsla"+u),hsv:new RegExp("hsv"+s),hsva:new RegExp("hsva"+u),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function isValidCSSUnit(e){return!!matchers.CSS_UNIT.exec(e)}function stringInputToObject(e){e=e.replace(trimLeft,"").replace(trimRight,"").toLowerCase();var t=!1;if(names[e])e=names[e],t=!0;else if(e=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var n;return(n=matchers.rgb.exec(e))?{r:n[1],g:n[2],b:n[3]}:(n=matchers.rgba.exec(e))?{r:n[1],g:n[2],b:n[3],a:n[4]}:(n=matchers.hsl.exec(e))?{h:n[1],s:n[2],l:n[3]}:(n=matchers.hsla.exec(e))?{h:n[1],s:n[2],l:n[3],a:n[4]}:(n=matchers.hsv.exec(e))?{h:n[1],s:n[2],v:n[3]}:(n=matchers.hsva.exec(e))?{h:n[1],s:n[2],v:n[3],a:n[4]}:(n=matchers.hex8.exec(e))?{r:parseIntFromHex(n[1]),g:parseIntFromHex(n[2]),b:parseIntFromHex(n[3]),a:convertHexToDecimal(n[4]),format:t?"name":"hex8"}:(n=matchers.hex6.exec(e))?{r:parseIntFromHex(n[1]),g:parseIntFromHex(n[2]),b:parseIntFromHex(n[3]),format:t?"name":"hex"}:(n=matchers.hex4.exec(e))?{r:parseIntFromHex(n[1]+""+n[1]),g:parseIntFromHex(n[2]+""+n[2]),b:parseIntFromHex(n[3]+""+n[3]),a:convertHexToDecimal(n[4]+""+n[4]),format:t?"name":"hex8"}:(n=matchers.hex3.exec(e))?{r:parseIntFromHex(n[1]+""+n[1]),g:parseIntFromHex(n[2]+""+n[2]),b:parseIntFromHex(n[3]+""+n[3]),format:t?"name":"hex"}:!1}function validateWCAG2Parms(e){var t,n;return e=e||{level:"AA",size:"small"},t=(e.level||"AA").toUpperCase(),n=(e.size||"small").toLowerCase(),t!=="AA"&&t!=="AAA"&&(t="AA"),n!=="small"&&n!=="large"&&(n="small"),{level:t,size:n}}var QueryTable;(e=>{function t(s,u){if(DOM.clearChildren(s),!Array.isArray(u)){for(const[d,f]of Object.entries(u)){const o=n(d,f);DOM.append(s,o)}return}for(const d of Object.values(u))for(const[f,o]of Object.entries(d)){const a=n(f,o,defaultOptions.colors[d[LAYER]]);DOM.append(s,a)}}e.formatQueryTable=t;function n(s,u,d){const f=DOM.element("tr"),o=DOM.element("td",{classes:tw("tw-border tw-border-black tw-px-3 tw-py-1"),textContent:s}),a=DOM.element("td",{classes:tw("tw-border tw-border-black tw-px-3 tw-py-1 tw-font-mono"),textContent:formatLabel(u)});if(d){const[l,r]=[d,"black"];DOM.setStyles(o,{backgroundColor:l,borderColor:r}),DOM.setStyles(a,{backgroundColor:l,borderColor:r}),tinycolor(d).getBrightness()<127&&(DOM.setStyles(o,{color:"white"}),DOM.setStyles(a,{color:"white"}))}return DOM.append(f,o),DOM.append(f,a),f}})(QueryTable||(QueryTable={})),exports.Plot=void 0,(e=>{function t(R,T,L){const G=DOM.element("div",{id:"plot",classes:tw("tw-relative tw-h-full tw-w-full tw-drop-shadow-md")});R=R??[],T=T??exports.Scales.of();const P={},H=[],F=[],N=[],j={...structuredClone(defaultOptions),...L},{expandX:B,expandY:q}=j,$=[[B,q,1-B,1-q]],V={active:!1,locked:!1,mousedown:!1,mousebutton:MouseButton.Left,mode:"select",mousecoords:[0,0,0,0],lastkey:"",ratio:(L==null?void 0:L.ratio)??void 0},U=L.type??"unknown",X=L.representation??"absolute",Q=Reactive.of()({type:U,representation:X,data:R,container:G,frames:P,scales:T,renderables:H,selectables:F,queryables:N,zoomStack:$,parameters:V,options:j});return setupFrames(Q,j),setupScales(Q),setupEvents$1(Q),Q}e.of=t,e.scatter=Scatterplot,e.bar=Barplot,e.fluct=Fluctuationplot,e.histo=Histogram,e.histo2d=Histogram2d,e.pcoords=Pcoordsplot,e.bibar=Bibarplot;function n(R,T){R.appendChild(T.container),e.resize(T)}e.append=n;function s(R,T){const{renderables:L,selectables:G,queryables:P}=R;for(const H of[L,G,P])H.push(T);Reactive.listen(T,"coords-changed",()=>e.render(R))}e.addGeom=s;function u(R,T){const{renderables:L,selectables:G,queryables:P}=R;for(const H of[L,G,P])remove(H,T);Reactive.removeAllListeners(T)}e.deleteGeom=u;const d=tw("tw-outline tw-outline-2 tw-outline-slate-600");function f(R){DOM.addClasses(R.container,d),R.parameters.active=!0,Reactive.dispatch(R,"activated")}e.activate=f;function o(R){DOM.removeClasses(R.container,d),R.parameters.active=!1,Reactive.dispatch(R,"deactivated")}e.deactivate=o;function a(R){R.parameters.locked=!0}e.lock=a;function l(R){R.parameters.locked=!1}e.unlock=l;function r(R){for(const T of dataLayers)Frame.clear(R.frames[T]);for(const T of R.renderables)Geom.render(T,R.frames)}e.render=r;function i(R){renderAxisLabels(R),renderAxisTitles(R)}e.renderAxes=i;function c(R){Frame.clear(R.frames.user)}e.clearUserFrame=c;function p(R){const{container:T,scales:L,frames:G,parameters:P,options:H}=R,{clientWidth:F,clientHeight:N}=T,{x:j,y:B,width:q,height:$,area:V}=L,{margins:U,marginLines:X}=H,Q=getComputedStyle(R.container),Z=parseFloat(Q.fontSize);for(let J=0;J<U.length;J++)U[J]=X[J]*Z;for(const J of Object.values(R.frames))Frame.resize(J);const[K,W]=[U[0],U[1]],[te,Y]=[N-U[2],F-U[3]];DOM.setStyles(G.under.canvas,{width:`calc(100% - ${W}px - ${U[3]}px)`,height:`calc(100% - ${K}px - ${U[2]}px)`,top:`${U[2]}px`,right:`${U[3]}px`}),DOM.setStyles(G.over.canvas,{width:`calc(100% - ${W}px - ${U[3]}px)`,height:`calc(100% - ${K}px - ${U[2]}px)`,top:`${U[2]}px`,right:`${U[3]}px`});const ee={default:!0,silent:!0};exports.Expanse.set(j.codomain,()=>({min:W,max:Y}),ee),exports.Expanse.set(B.codomain,()=>({min:K,max:te}),ee);const[ne,re]=[Y-W,te-K];if(exports.Expanse.set(q.codomain,()=>({max:ne}),ee),exports.Expanse.set($.codomain,()=>({max:re}),ee),exports.Expanse.set(V.codomain,()=>({max:Math.min(ne,re)}),ee),P.ratio){const{expandX:J,expandY:oe}=defaultOptions;exports.Scale.set(j,()=>({zero:J,one:1-J}),ee),exports.Scale.set(B,()=>({zero:oe,one:1-oe}),ee),e.applyRatio(R,P.ratio)}e.render(R),e.renderAxes(R)}e.resize=p;function m(R){const{selectables:T,parameters:L}=R,G=new Set;for(const H of T){const F=Geom.check(H,L.mousecoords);for(let N=0;N<F.length;N++)G.add(F[N])}const P=Array.from(G);Reactive.dispatch(R,"set-selected",{cases:P})}e.checkSelection=m;function y(R,T){R.parameters.mode=T}e.setMode=y;function b(R,T){R.parameters.mousedown=T}e.setMousedown=b;function x(R,T){R.parameters.mousebutton=T}e.setMouseButton=x,e.mousemoveHandlers={select:A,pan:S,query:M};function A(R,T){const{container:L,parameters:G,frames:P}=R;if(!G.active||!G.mousedown)return;const{mousecoords:H}=G,{clientHeight:F}=L,N=T.offsetX,j=F-T.offsetY;H[2]=N,H[3]=j,e.checkSelection(R),Reactive.dispatch(R,"lock-others"),e.clearUserFrame(R),Frame.rectangleXY(P.user,...G.mousecoords,1)}function S(R,T){const{container:L,scales:G,parameters:P}=R;if(!P.active||!P.mousedown)return;const{mousecoords:H}=P,{clientWidth:F,clientHeight:N}=L,[j,B]=H,q=T.offsetX,$=N-T.offsetY,V=(q-j)/F,U=($-B)/N;exports.Scale.move(G.x,V),exports.Scale.move(G.y,U),H[0]=q,H[1]=$,e.clearUserFrame(R)}function M(R,T){const{offsetX:L,offsetY:G}=T,{queryTable:P,queryables:H,container:F}=R,{clientHeight:N}=F;if(!P)return;DOM.setStyles(P,{display:"none"});const[j,B]=[L,N-G];let q;for(const $ of H)if(q=Geom.query($,[j,B]),q)break;q&&(QueryTable.formatQueryTable(P,q),P.style.display="inline-block")}e.keybindings={"=":"grow","-":"shrink","]":"unfade","[":"fade",z:"zoom",x:"pop-zoom",o:"reorder",";":"decrement-anchor","'":"increment-anchor",n:"normalize"};function v(R){const{area:T,size:L,width:G}=R.scales,P=10/9,H={silent:!0};exports.Expanse.set(T.codomain,F=>({min:F.min*P,max:F.max*P}),H),exports.Expanse.set(L.codomain,F=>({min:F.min*P,max:F.max*P}),H),exports.Expanse.set(G.codomain,F=>F.mult<1?{mult:F.mult*P}:{},H),e.render(R)}e.grow=v;function z(R){const{area:T,size:L,width:G}=R.scales,P=9/10,H={silent:!0};exports.Expanse.set(T.codomain,F=>({min:F.min*P,max:F.max*P}),H),exports.Expanse.set(L.codomain,F=>({min:F.min*P,max:F.max*P}),H),exports.Expanse.set(G.codomain,F=>({mult:F.mult*9/10}),H),e.render(R)}e.shrink=z;function k(R){const{frames:T}=R;for(const L of baseLayers)Frame.setAlpha(T[L],G=>G*9/10);e.render(R)}e.fade=k;function C(R){const{frames:T}=R;for(const L of baseLayers)Frame.setAlpha(T[L],G=>G*10/9);e.render(R)}e.unfade=C;function g(R){const{frames:T,scales:L}=R;for(const G of baseLayers)Frame.resetAlpha(T[G]);for(const G of Object.values(L))exports.Scale.restore(G);R.zoomStack.length=1,e.clearUserFrame(R)}e.reset=g;function h(R){e.setMode(R,"query")}e.setQueryMode=h;function w(R,T){const{scales:L,parameters:G,zoomStack:P}=R;let{coords:H,units:F}=T??{};F=F??"screen";let[N,j,B,q]=H??G.mousecoords;const{x:$,y:V}=L;if(F==="data"){const Y={silent:!0};exports.Scale.set($,()=>({zero:0,one:1}),Y),exports.Scale.set(V,()=>({zero:0,one:1}),Y),N=exports.Expanse.normalize($.domain,N),B=exports.Expanse.normalize($.domain,B),j=exports.Expanse.normalize(V.domain,j),q=exports.Expanse.normalize(V.domain,q)}if(F==="screen"){if(Math.abs(B-N)<10||Math.abs(q-j)<10)return;N=trunc(exports.Expanse.normalize($.codomain,N)),B=trunc(exports.Expanse.normalize($.codomain,B)),j=trunc(exports.Expanse.normalize(V.codomain,j)),q=trunc(exports.Expanse.normalize(V.codomain,q))}[N,B]=[N,B].sort(diff),[j,q]=[j,q].sort(diff),exports.Scale.expand(L.x,N,B),exports.Scale.expand(L.y,j,q);const U=rangeInverse(N,B),X=rangeInverse(j,q),Q=sqrt(max(U,X)),{width:Z,height:K,area:W,size:te}=L;Z.codomain!==W.codomain&&exports.Expanse.set(Z.codomain,Y=>({max:Y.max*U})),K.codomain!==W.codomain&&exports.Expanse.set(K.codomain,Y=>({max:Y.max*X})),exports.Expanse.set(W.codomain,Y=>({max:Y.max*Q})),exports.Expanse.set(te.codomain,Y=>({max:Y.max*Q})),P.push([N,j,B,q]),Reactive.dispatch(R,"clear-transient"),e.render(R)}e.zoom=w;function E(R){const{scales:T,zoomStack:L}=R;if(L.length===1)return;const[G,P,H,F]=L[L.length-1],[N,j]=invertRange(G,H),[B,q]=invertRange(P,F);exports.Scale.expand(T.x,N,j),exports.Scale.expand(T.y,B,q);const $=rangeInverse(N,j),V=rangeInverse(B,q),U=1/sqrt(max(1/$,1/V)),{width:X,height:Q,area:Z,size:K}=T;X.codomain!==Z.codomain&&exports.Expanse.set(X.codomain,W=>({max:W.max*$})),Q.codomain!==Z.codomain&&exports.Expanse.set(Q.codomain,W=>({max:W.max*V})),exports.Expanse.set(Z.codomain,W=>({max:W.max*U})),exports.Expanse.set(K.codomain,W=>({max:W.max*U})),L.pop(),e.clearUserFrame(R),e.render(R)}e.popZoom=E;function I(R,T){const{x:L,y:G}=R.scales;if(!exports.Expanse.isContinuous(L.domain)||!exports.Expanse.isContinuous(G.domain))throw new Error("Both axes need to be continuous to set a ratio");R.parameters.ratio=T,e.resize(R)}e.setRatio=I;function D(R,T){const{scales:L}=R,{x:G,y:P}=L,H=exports.Scale.unitRatio(G),F=exports.Scale.unitRatio(P)*T,N={default:!0,silent:!0};if(H>F){const j=F/H*exports.Scale.unitRange(P),[B,q]=[(1-j)/2,(1+j)/2];exports.Scale.set(G,()=>({zero:B,one:q}),N)}else{const j=H/F*exports.Scale.unitRange(G),[B,q]=[(1-j)/2,(1+j)/2];exports.Scale.set(P,()=>({zero:B,one:q}),N)}}e.applyRatio=D;function O(R,T){return R.scales[T]}e.getScale=O;function _(R,T,L){let{min:G,max:P,zero:H,one:F,mult:N,labels:j,direction:B}=L;const q=R.scales[T],$=q.domain;if(!Object.keys(R.scales).includes(T))throw new Error(`Unrecognized scale '${T}'`);const V={default:L.default??!1,unfreeze:L.unfreeze??!1};if([H,F].some(isDefined)&&(H=H??q.props.zero,F=F??q.props.one,exports.Scale.set(q,()=>({zero:H,one:F}),V),R.parameters.ratio=void 0),[G,P].some(isDefined)){if(!exports.Expanse.isContinuous($))throw new Error("Limits can only be set with a continuous domain");H=G?H??0:q.props.zero,F=P?F??1:q.props.one,G=G??$.props.min,P=P??$.props.max,exports.Expanse.set($,()=>({min:G,max:P}),V),exports.Scale.set(q,()=>({zero:H,one:F}),V),R.parameters.ratio=void 0}if(j){if(!exports.Expanse.isDiscrete($))throw new Error("Labels can be ordered with a discrete domain only");if(!stringArraysMatch($.props.labels,j))throw new Error("Labels must match the scale's labels");const U=orderIndicesByTable($.props.labels,j);exports.Expanse.reorder($,U)}B&&exports.Scale.set(q,()=>({direction:B}),V),N&&exports.Scale.set(q,()=>({mult:N}),V)}e.setScale=_})(exports.Plot||(exports.Plot={}));function setupFrames(e,t){const{container:n,frames:s}=e,{margins:u,colors:d,axisLabelSize:f,axisTitleSize:o}=t,[a,l,r,i]=u,c=[7,6,5,4,3,2,1,0],p="tw-absolute tw-top-0 tw-right-0 tw-w-full tw-h-full ";for(const g of c){const h={zIndex:`${7-g+2}`},w=d[g],E={fillStyle:w,strokeStyle:w},I=Frame.of({classes:p,contextProps:E,canvasStyles:h,margins:u});s[g]=I}const m=Frame.of({classes:p+"tw-bg-gray-100"});Frame.setContext(m,{font:`${o}em sans-serif`,textBaseline:"middle",textAlign:"center"});const y=`calc(100% - ${l}px - ${i}px)`,b=`calc(100% - ${a}px - ${r}px)`,x={width:y,height:b,top:r+"px",right:i+"px"},A=Frame.of({classes:p+"tw-z-1 tw-bg-white",canvasStyles:x}),M=Frame.of({classes:p+"tw-z-10 tw-border tw-border-b-black tw-border-l-black",canvasStyles:x}),v=Frame.of({classes:p+"tw-z-10",margins:u});Frame.setContext(v,{globalAlpha:.06666666666666667});const z="#3B4854",k=Frame.of({classes:p});Frame.setContext(k,{fillStyle:z,textBaseline:"top",textAlign:"center",font:`${f}em serif`});const C=Frame.of({classes:p});Frame.setContext(C,{fillStyle:"#3B4854",textBaseline:"middle",textAlign:"right",font:`${f}em serif`}),Object.assign(s,{base:m,under:A,over:M,user:v,xAxis:k,yAxis:C});for(let[g,h]of Object.entries(s))isNaN(parseFloat(g))||(g="data-"+g),h.canvas.id=`frame-${g}`,Frame.append(h,n)}function setupEvents$1(e){const{container:t,parameters:n}=e,{mousecoords:s}=n;for(const[u,d]of Object.entries(exports.Plot.keybindings))Reactive.listen(e,u,()=>Reactive.dispatch(e,d));t.addEventListener("mousedown",u=>{const{locked:d}=n;exports.Plot.activate(e),exports.Plot.setMousedown(e,!0),exports.Plot.setMouseButton(e,u.button),u.button===MouseButton.Left?exports.Plot.setMode(e,"select"):u.button===MouseButton.Right&&exports.Plot.setMode(e,"pan");const f=u.offsetX,o=t.clientHeight-u.offsetY;copyValues([f,o,f,o],s),!d&&n.mode==="select"&&(Reactive.dispatch(e,"clear-transient"),exports.Plot.checkSelection(e)),exports.Plot.unlock(e)}),t.addEventListener("contextmenu",u=>{u.preventDefault(),exports.Plot.setMousedown(e,!0),exports.Plot.setMouseButton(e,MouseButton.Right),exports.Plot.setMode(e,"pan"),s[0]=u.offsetX,s[1]=t.clientHeight-u.offsetY,exports.Plot.clearUserFrame(e)}),t.addEventListener("mouseup",()=>exports.Plot.setMousedown(e,!1)),t.addEventListener("mousemove",throttle(u=>{exports.Plot.mousemoveHandlers[n.mode](e,u)},20)),Reactive.listen(e,"reset",()=>exports.Plot.reset(e)),Reactive.listen(e,"resize",()=>exports.Plot.resize(e)),Reactive.listen(e,"activate",()=>exports.Plot.activate(e)),Reactive.listen(e,"deactivate",()=>exports.Plot.deactivate(e)),Reactive.listen(e,"render",()=>exports.Plot.render(e)),Reactive.listen(e,"lock",()=>exports.Plot.lock(e)),Reactive.listen(e,"unlock",()=>exports.Plot.unlock(e)),Reactive.listen(e,"query-mode",()=>exports.Plot.setMode(e,"query")),Reactive.listen(e,"render-axes",()=>exports.Plot.renderAxes(e)),Reactive.listen(e,"clear-transient",()=>exports.Plot.clearUserFrame(e)),Reactive.listen(e,"get-scale",u=>{if(!(!u||!u.scale))return exports.Plot.getScale(e,u.scale)}),Reactive.listen(e,"set-scale",u=>{!u||!u.scale||exports.Plot.setScale(e,u.scale,u)}),Reactive.listen(e,"grow",()=>exports.Plot.grow(e),{throttle:10}),Reactive.listen(e,"shrink",()=>exports.Plot.shrink(e),{throttle:10}),Reactive.listen(e,"fade",()=>exports.Plot.fade(e),{throttle:10}),Reactive.listen(e,"unfade",()=>exports.Plot.unfade(e),{throttle:10}),Reactive.listen(e,"zoom",u=>exports.Plot.zoom(e,u)),Reactive.listen(e,"pop-zoom",()=>exports.Plot.popZoom(e));for(const u of Object.values(e.scales))Reactive.listen(u,"changed",()=>{exports.Plot.render(e),exports.Plot.renderAxes(e)})}function setupScales(e){const{scales:t}=e,{x:n,y:s,width:u,height:d,size:f,area:o,areaPct:a}=t,l={default:!0,silent:!0},{expandX:r,expandY:i}=defaultOptions;exports.Expanse.set(o.domain,()=>({ratio:!0}),l),exports.Expanse.set(a.domain,()=>({ratio:!0}),l),exports.Expanse.set(f.domain,()=>({ratio:!0}),l),exports.Expanse.set(f.codomain,()=>({trans:square,inv:sqrt}),l),exports.Expanse.set(o.codomain,()=>({trans:square,inv:sqrt}),l),exports.Expanse.set(a.codomain,()=>({trans:square,inv:sqrt}),l),exports.Scale.set(n,()=>({zero:r,one:1-r}),l),exports.Scale.set(s,()=>({zero:i,one:1-i}),l),exports.Scale.set(u,()=>({one:1-2*r}),l),exports.Scale.set(d,()=>({one:1-2*i}),l),exports.Scale.set(o,()=>({one:1-2*Math.max(r,i)}),l);const c=p=>Math.max(p,0);exports.Expanse.set(u.codomain,()=>({inv:c}),l),exports.Expanse.set(d.codomain,()=>({inv:c}),l)}var KeybindingsMenu;(e=>{function t(s){const u=DOM.element("div"),d=DOM.element("div",{id:"modal"}),f=DOM.element("div",{id:"bindings"}),o=DOM.element("button",{textContent:"key bindings"});DOM.addClasses(d,tw("tw-absolute tw-left-0 tw-top-0 tw-z-50 tw-flex tw-size-full tw-flex-col tw-items-center tw-bg-slate-800 tw-bg-opacity-80 tw-p-10")),DOM.addClasses(f,tw("tw-relative tw-flex tw-h-full tw-w-fit tw-flex-col tw-flex-wrap tw-justify-start tw-py-10")),DOM.addClasses(o,tw("tw-absolute tw-right-0 tw-top-0 tw-z-30 tw-select-none tw-rounded-bl-md tw-bg-gray-300 tw-p-1 tw-px-2 tw-text-sm tw-text-white hover:tw-bg-gray-400")),DOM.append(u,d),DOM.append(u,o),DOM.append(d,f),f.style.columnFill="auto",d.style.display="none";let a=!1;function l(){d.style.display="flex"}function r(){a||(d.style.display="none")}o.addEventListener("click",l),d.addEventListener("click",r);for(const[i,c]of Object.entries(s)){const p=DOM.element("span",{classes:tw("tw-m-1 tw-flex tw-flex-row")}),m=DOM.element("button",{textContent:i}),y=DOM.element("div",{classes:tw("tw-m-1 tw-p-1 tw-px-2 tw-text-white"),textContent:capitalize(c.replaceAll("-"," "))});DOM.addClasses(m,tw("tw-m-1 tw-w-8 tw-rounded-md tw-bg-gray-400 tw-p-1 tw-px-2 tw-text-center tw-text-white tw-outline-none hover:tw-bg-gray-500")),DOM.append(p,m),DOM.append(p,y),y.addEventListener("click",x=>x.stopPropagation()),m.addEventListener("click",x=>{a||(x.stopPropagation(),DOM.addClasses(m,tw("text-black bg-slate-200 hover:bg-slate-200")),window.addEventListener("keydown",b),a=!0)});const b=x=>{const{key:A}=x,S=m.innerText;A in s&&A!==S||(n(s,A,c),m.innerText=x.key,DOM.removeClasses(m,tw("tw-text-black tw-bg-slate-200 hover:tw-bg-slate-200")),window.removeEventListener("keydown",b),a=!1)};f.appendChild(p)}return u}e.of=t;function n(s,u,d){let f;for(const[o,a]of Object.entries(s))if(a===d){f=o;break}f&&delete s[f],s[u]=d}})(KeybindingsMenu||(KeybindingsMenu={})),exports.Scene=void 0,(e=>{function t(g,h){const w=DOM.element("div",{id:"scene-container"}),E=DOM.element("div",{id:"plots-container"});DOM.addClasses(w,tw("tailwind tw-pr-15 tw-relative tw-flex tw-h-full tw-w-full tw-content-center tw-items-center tw-justify-center tw-bg-[#deded9] tw-p-10")),DOM.addClasses(E,tw("tw-grid tw-h-full tw-w-full tw-grid-cols-1 tw-grid-rows-1 tw-gap-[1em]"));const I=DOM.element("table",{classes:tw("tw-absolute tw-z-30 tw-bg-gray-100 tw-shadow-md")});DOM.setStyles(I,{pointerEvents:"none"});const D={...e.keybindings,...exports.Plot.keybindings},O=KeybindingsMenu.of(D);DOM.append(w,E),DOM.append(w,O),DOM.append(w,I);const[_,R,T]=[1,1,!1],L=Marker.of(Object.values(g)[0].length),G=[],P={},H={send:console.log},F=Object.assign(defaultOptions,h);for(const[j,B]of Object.entries(g))Meta.hasMetadata(B)||(g[j]=Meta.of(B)),Meta.has(B,"name")||Meta.set(B,{name:j});const N=Reactive.of()({data:g,container:w,plotsContainer:E,queryTable:I,rows:_,cols:R,active:T,marker:L,client:H,plots:G,plotIndicesByType:P,options:F,keybindings:D});if(h!=null&&h.websocketURL){const j=new WebSocket(h.websocketURL),B={sender:"scene",target:"server",type:"connected"};j.addEventListener("open",()=>j.send(JSON.stringify(B))),j.addEventListener("message",q=>{b(N,JSON.parse(q.data))}),window.addEventListener("beforeunload",()=>j.close()),N.client=j}return setupEvents(N),N}e.of=t;async function n(g,h){const w=await fetchJSON(g);return e.of(w,h)}e.ofAsync=n;function s(g,h){g.appendChild(h.container),e.resize(h)}e.append=s;function u(g,h){const{plotsContainer:w,marker:E,plots:I,plotIndicesByType:D}=g;Reactive.listen(h,"activated",()=>{for(const R of I)R!=h&&Reactive.dispatch(R,"deactivate");const _=I.indexOf(h);g.activePlotIndex=_}),Reactive.listen(h,"lock-others",()=>{for(const _ of I)_!==h&&(exports.Plot.clearUserFrame(_),Reactive.dispatch(_,"lock"))}),Reactive.listen(h,"set-selected",_=>{Marker.update(E,_.cases)}),Reactive.listen(h,"clear-transient",()=>{for(const _ of I)exports.Plot.clearUserFrame(_);Marker.clearTransient(E)}),Reactive.listen(h,"render-all",()=>{for(const _ of I)Reactive.dispatch(_,"render")});const{type:O}=h;D[O]||(D[O]=[]),D[O].push(I.length),I.push(h),exports.Plot.append(w,h),h.queryTable=g.queryTable,f(g),c(g),e.resize(g)}e.addPlot=u;function d(g,h){const{type:w,variables:E,reducer:I,queries:D}=h??{};if(!w||w==="unknown"||!E)return;for(const T of E)if(!Object.keys(g.data).includes(T))throw new Error(`Variable '${T}' is not present in the data`);const O=keysToSelectors(E),_={};if(_.ratio=h==null?void 0:h.ratio,I&&(_.reducer=exports.Reducer.parse(I)),D)if(isStringArray(D))_.queries=keysToSelectors(D);else{const T=L=>D.map(([G,P])=>[L[G],exports.Reducer.parse(P)]);_.queries=T}const R=exports.Plot[w](g,O,_);e.addPlot(g,R)}e.addPlotBySpec=d;function f(g){for(let h=0;h<g.plots.length;h++)g.plots[h].container.id=`plot${h+1}`}function o(g){const h=last(g.plots);h&&l(g,h)}e.popPlot=o;function a(g,h){const w=i(g,h);w&&l(g,w)}e.removePlot=a;function l(g,h){const{plots:w,plotIndicesByType:E,plotsContainer:I}=g,D=w.indexOf(h);for(const O of Object.values(E))if(O.indexOf(D)!==-1){remove(O,D);break}remove(w,h),I.removeChild(h.container),Reactive.removeAllListeners(h),f(g),c(g),e.resize(g)}function r(g,h){return h==="scene"?g:i(g,h)}e.getTarget=r;function i(g,h){const{plots:w,plotIndicesByType:E}=g;let[I,D]=splitNumericSuffix(h);const O=parseInt(D,10)-1;if(I==="plot"||I==="p")return w[O];if(I=I.replace("plot","").replace("gram",""),I in Object.keys(plotIdShort)&&(I=plotIdShort[I]),I in E)return w[E[I][O]]}e.getPlot=i;function c(g){const{plots:h}=g;if(h.length===0)return;const w=Math.ceil(Math.sqrt(h.length)),E=Math.ceil(h.length/w);e.setDimensions(g,E,w)}function p(g,h,w){const{plotsContainer:E}=g;g.rows=h,g.cols=w;const I=Array(h).fill("1fr").join(" "),D=Array(w).fill("1fr").join(" ");DOM.setStyles(E,{gridTemplateRows:I,gridTemplateColumns:D}),e.resize(g)}e.setDimensions=p;function m(g,h){const{plotsContainer:w,plots:E}=g,I=new Set(h.flat()),D=new Set(seq(0,E.length-1));for(const P of I)D.delete(P);D.size>0&&alert("Warning: Some plots are not included in the layout and will be hidden.");for(let P=0;P<E.length;P++)DOM.setStyles(E[P].container,{gridArea:`plot${P}`});let _="";for(const P of h)_+=`"${P.map(H=>`plot${H}`).join(" ")}" `;const[R,T]=[h.length,h[0].length],L=Array(R).fill("1fr").join(" "),G=Array(T).fill("1fr").join(" ");DOM.setStyles(w,{gridTemplateAreas:_,gridTemplateRows:L,gridTemplateColumns:G}),e.resize(g)}e.setLayout=m;function y(g){const{plotsContainer:h,plots:w}=g;DOM.setStyles(h,{gridTemplateAreas:""});for(const E of w)DOM.setStyles(E.container,{gridArea:"auto"});c(g)}e.clearLayout=y;function b(g,h){if(!g.client)return;const{target:w,data:E}=h,I=h.type,D=r(g,w);D&&I&&Reactive.dispatch(D,I,E)}e.handleMessage=b;function x(g,h,w){const[E,I]=["scene","server"],D=JSON.stringify({sender:E,target:I,type:h,data:w});g.client.send(D)}e.sendMessage=x;function A(g,h){const{container:w}=g;let{fontSize:E}=h??{};if(!E){const{clientWidth:I,clientHeight:D}=w,O=Math.min(I,D)/100;E=Math.min(Math.max(8,3*O),16)}DOM.setStyles(w,{fontSize:E+"px"});for(const I of g.plots)Reactive.dispatch(I,"resize")}e.resize=A;function S(g){for(const h of g.plots)exports.Plot.render(h)}e.render=S;function M(g){for(const h of g.plots)Reactive.dispatch(h,"reset");Marker.clearTransient(g.marker)}e.reset=M;function v(g){for(const h of g.plots)Reactive.dispatch(h,"query-mode")}e.setQueryMode=v;function z(g){Marker.setGroup(g.marker,Group.First)}e.setGroupFirst=z;function k(g){Marker.setGroup(g.marker,Group.Second)}e.setGroupSecond=k;function C(g){Marker.setGroup(g.marker,Group.Third)}e.setGroupThird=C,e.keybindings={r:"reset",q:"query-mode",1:"group-1",2:"group-2",3:"group-3"}})(exports.Scene||(exports.Scene={}));function setupEvents(e){const{marker:t,plots:n,container:s,plotsContainer:u,keybindings:d,queryTable:f}=e;document.addEventListener("load",()=>{exports.Scene.resize(e),exports.Scene.render(e)}),document.addEventListener("visibilitychange",()=>{document.hidden||(exports.Scene.resize(e),exports.Scene.render(e))}),window.addEventListener("mousedown",o=>{s.contains(o.target)?e.active=!0:e.active=!1}),s.addEventListener("mousedown",o=>{if(o.target===s)for(const a of n)Reactive.dispatch(a,"deactivate")}),s.addEventListener("dblclick",()=>{for(const o of n)Reactive.dispatch(o,"deactivate"),Frame.clear(o.frames.user);Marker.clearAll(e.marker),e.activePlotIndex=void 0}),u.addEventListener("mousemove",throttle(o=>{const{clientWidth:a,clientHeight:l}=u,{clientWidth:r,clientHeight:i}=f;let{offsetX:c,offsetY:p}=o,m=o.target;for(;m!==u;){if(m===null)return;c+=m.offsetLeft,p+=m.offsetTop,m=m.parentElement}let[y,b]=[c+2,p+2];c+r>a&&(y=y-r-4),p+i>l&&(b=b-i-4),DOM.setStyles(f,{left:y+"px",top:b+"px"})},20)),window.addEventListener("keydown",o=>{const a=d[o.key],{active:l,activePlotIndex:r}=e;if(!(!a||!l)){if(r!==void 0){const i=n[r];Reactive.dispatch(i,a)}Reactive.dispatch(e,a)}}),window.addEventListener("keyup",()=>{Marker.setGroup(t,Transient);for(const o of e.plots)o.parameters.mode="select",DOM.setStyles(f,{display:"none"})}),window.addEventListener("resize",throttle(()=>exports.Scene.resize(e),10)),Reactive.listen(t,"cleared",()=>{for(const o of n)Reactive.dispatch(o,"unlock")}),Reactive.listen(e,"resize",()=>exports.Scene.resize(e)),Reactive.listen(e,"reset",()=>exports.Scene.reset(e)),Reactive.listen(e,"query-mode",()=>exports.Scene.setQueryMode(e)),Reactive.listen(e,"group-1",()=>exports.Scene.setGroupFirst(e)),Reactive.listen(e,"group-2",()=>exports.Scene.setGroupSecond(e)),Reactive.listen(e,"group-3",()=>exports.Scene.setGroupThird(e)),Reactive.listen(e,"connected",()=>{var o;return console.log(`Connected to Websocket server on: ${(o=e.client)==null?void 0:o.url}`)}),Reactive.listen(e,"set-dims",o=>{!o||!o.rows||!o.columns||exports.Scene.setDimensions(e,o.rows,o.cols)}),Reactive.listen(e,"add-plot",o=>{o&&exports.Scene.addPlotBySpec(e,o)}),Reactive.listen(e,"get-plot",o=>{!o||o.id}),Reactive.listen(e,"pop-plot",()=>exports.Scene.popPlot(e)),Reactive.listen(e,"remove-plot",o=>{!o||!o.id||exports.Scene.removePlot(e,o.id)}),Reactive.listen(e,"set-selected",o=>{!o||!o.cases||Marker.update(t,o.cases)}),Reactive.listen(e,"set-assigned",o=>{if(!o||!o.group)return;const a=7-Math.min(o.group,3);Marker.update(t,o.cases,{group:a})}),Reactive.listen(e,"get-selected",()=>{const o=filterIndices(Array.from(t.indices),Marker.isTransient);exports.Scene.sendMessage(e,"get-selected",{cases:o})}),Reactive.listen(e,"get-assigned",o=>{if(!o||!o.group)return;const a=r=>(r|4)===7-Math.min(o.group,3),l=filterIndices(Array.from(t.indices),a);exports.Scene.sendMessage(e,"get-assigned",{cases:l,group:o.group})}),Reactive.listen(e,"clear-selection",()=>Marker.clearAll(t)),Reactive.listen(e,"get-scale",o=>{if(!o||!o.id)return;const a=exports.Scene.getPlot(e,o.id);a&&Reactive.dispatch(a,"get-scale",o)}),Reactive.listen(e,"set-scale",o=>{if(!o||!o.id)return;const a=exports.Scene.getPlot(e,o.id);a&&Reactive.dispatch(a,"set-scale",o)}),Reactive.listen(e,"normalize",o=>{if(!o||!o.id)return;const a=exports.Scene.getPlot(e,o.id);a&&Reactive.dispatch(a,"normalize")}),Reactive.listen(e,"zoom",o=>{if(!o||!o.id)return;const a=exports.Scene.getPlot(e,o.id);a&&Reactive.dispatch(a,"zoom",o)}),Reactive.listen(e,"set-layout",o=>{!o||!o.layout||exports.Scene.setLayout(e,o.layout)}),Reactive.listen(e,"set-parameters",o=>{if(!o||!o.id)return;const a=exports.Scene.getPlot(e,o.id);a&&Reactive.dispatch(a,"set-parameters",o)}),Reactive.listen(e,"clear-layout",()=>exports.Scene.clearLayout(e))}const plotIdShort={s:"scatter",b:"bar",bb:"bibar",h:"histo",f:"fluct",hh:"histo2d",pc:"pcoords"};return exports.METHODS=METHODS,exports.addIndexed=addIndexed,exports.addTailwind=addTailwind,exports.applyDirection=applyDirection,exports.applyWith=applyWith,exports.bimap=bimap,exports.binBreaks=binBreaks,exports.call=call,exports.capitalize=capitalize,exports.compareAlphaNumeric=compareAlphaNumeric,exports.convertToSuperscript=convertToSuperscript,exports.copyProps=copyProps,exports.copyValues=copyValues,exports.cumsum=cumsum,exports.dec=dec,exports.diff=diff,exports.exp10=exp10,exports.exponentialToSuperscript=exponentialToSuperscript,exports.fetchJSON=fetchJSON,exports.filterIndices=filterIndices,exports.findLength=findLength,exports.formatAxisLabels=formatAxisLabels,exports.formatLabel=formatLabel,exports.formatText=formatText,exports.identity=identity,exports.inc=inc,exports.invertRange=invertRange,exports.isDefined=isDefined,exports.isEventTarget=isEventTarget,exports.isIntegerString=isIntegerString,exports.isNumber=isNumber,exports.isNumberArray=isNumberArray,exports.isObject=isObject,exports.isPrimitive=isPrimitive,exports.isStringArray=isStringArray,exports.isTypedArray=isTypedArray,exports.just=just,exports.keysToSelectors=keysToSelectors,exports.last=last,exports.log10=log10,exports.max=max,exports.merge=merge,exports.minDecimal=minDecimal,exports.minmax=minmax,exports.one=one,exports.orderBy=orderBy,exports.orderIndices=orderIndices,exports.orderIndicesByTable=orderIndicesByTable,exports.ordered=ordered,exports.pointInRect=pointInRect,exports.prettyBreaks=prettyBreaks,exports.prod=prod,exports.randomInteger=randomInteger,exports.rangeInverse=rangeInverse,exports.rectSegmentIntersect=rectSegmentIntersect,exports.rectsIntersect=rectsIntersect,exports.remove=remove,exports.removeTailwind=removeTailwind,exports.rep=rep,exports.round=round,exports.row=row,exports.segmentsIntersect=segmentsIntersect,exports.selector=selector,exports.seq=seq,exports.seqLength=seqLength,exports.splitNumericSuffix=splitNumericSuffix,exports.sqrt=sqrt,exports.square=square,exports.stringArraysMatch=stringArraysMatch,exports.stripWS=stripWS,exports.subset=subset,exports.sum=sum,exports.throttle=throttle,exports.timeExecution=timeExecution,exports.toLowerCase=toLowerCase,exports.toUpperCase=toUpperCase,exports.trunc=trunc,exports.tw=tw,exports.uniqueIntegers=uniqueIntegers,exports.zero=zero,Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),exports}({});
