var plotscape=function(exports){"use strict";var __vite_style__=document.createElement("style");__vite_style__.textContent=`*:where(.tailwind,.tailwind *),:before:where(.tailwind,.tailwind *),:after:where(.tailwind,.tailwind *){box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}:before:where(.tailwind,.tailwind *),:after:where(.tailwind,.tailwind *){--tw-content: ""}.tailwind{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;-o-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}.tailwind{margin:0;line-height:inherit}hr:where(.tailwind,.tailwind *){height:0;color:inherit;border-top-width:1px}abbr:where([title]):where(.tailwind,.tailwind *){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1:where(.tailwind,.tailwind *),h2:where(.tailwind,.tailwind *),h3:where(.tailwind,.tailwind *),h4:where(.tailwind,.tailwind *),h5:where(.tailwind,.tailwind *),h6:where(.tailwind,.tailwind *){font-size:inherit;font-weight:inherit}a:where(.tailwind,.tailwind *){color:inherit;text-decoration:inherit}b:where(.tailwind,.tailwind *),strong:where(.tailwind,.tailwind *){font-weight:bolder}code:where(.tailwind,.tailwind *),kbd:where(.tailwind,.tailwind *),samp:where(.tailwind,.tailwind *),pre:where(.tailwind,.tailwind *){font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small:where(.tailwind,.tailwind *){font-size:80%}sub:where(.tailwind,.tailwind *),sup:where(.tailwind,.tailwind *){font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub:where(.tailwind,.tailwind *){bottom:-.25em}sup:where(.tailwind,.tailwind *){top:-.5em}table:where(.tailwind,.tailwind *){text-indent:0;border-color:inherit;border-collapse:collapse}button:where(.tailwind,.tailwind *),input:where(.tailwind,.tailwind *),optgroup:where(.tailwind,.tailwind *),select:where(.tailwind,.tailwind *),textarea:where(.tailwind,.tailwind *){font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button:where(.tailwind,.tailwind *),select:where(.tailwind,.tailwind *){text-transform:none}button:where(.tailwind,.tailwind *),input:where([type=button]):where(.tailwind,.tailwind *),input:where([type=reset]):where(.tailwind,.tailwind *),input:where([type=submit]):where(.tailwind,.tailwind *){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring:where(.tailwind,.tailwind *){outline:auto}:-moz-ui-invalid:where(.tailwind,.tailwind *){box-shadow:none}progress:where(.tailwind,.tailwind *){vertical-align:baseline}::-webkit-inner-spin-button:where(.tailwind,.tailwind *),::-webkit-outer-spin-button:where(.tailwind,.tailwind *){height:auto}[type=search]:where(.tailwind,.tailwind *){-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration:where(.tailwind,.tailwind *){-webkit-appearance:none}::-webkit-file-upload-button:where(.tailwind,.tailwind *){-webkit-appearance:button;font:inherit}summary:where(.tailwind,.tailwind *){display:list-item}blockquote:where(.tailwind,.tailwind *),dl:where(.tailwind,.tailwind *),dd:where(.tailwind,.tailwind *),h1:where(.tailwind,.tailwind *),h2:where(.tailwind,.tailwind *),h3:where(.tailwind,.tailwind *),h4:where(.tailwind,.tailwind *),h5:where(.tailwind,.tailwind *),h6:where(.tailwind,.tailwind *),hr:where(.tailwind,.tailwind *),figure:where(.tailwind,.tailwind *),p:where(.tailwind,.tailwind *),pre:where(.tailwind,.tailwind *){margin:0}fieldset:where(.tailwind,.tailwind *){margin:0;padding:0}legend:where(.tailwind,.tailwind *){padding:0}ol:where(.tailwind,.tailwind *),ul:where(.tailwind,.tailwind *),menu:where(.tailwind,.tailwind *){list-style:none;margin:0;padding:0}dialog:where(.tailwind,.tailwind *){padding:0}textarea:where(.tailwind,.tailwind *){resize:vertical}input::-moz-placeholder:where(.tailwind,.tailwind *),textarea::-moz-placeholder:where(.tailwind,.tailwind *){opacity:1;color:#9ca3af}input::placeholder:where(.tailwind,.tailwind *),textarea::placeholder:where(.tailwind,.tailwind *){opacity:1;color:#9ca3af}button:where(.tailwind,.tailwind *),[role=button]:where(.tailwind,.tailwind *){cursor:pointer}:disabled:where(.tailwind,.tailwind *){cursor:default}img:where(.tailwind,.tailwind *),svg:where(.tailwind,.tailwind *),video:where(.tailwind,.tailwind *),canvas:where(.tailwind,.tailwind *),audio:where(.tailwind,.tailwind *),iframe:where(.tailwind,.tailwind *),embed:where(.tailwind,.tailwind *),object:where(.tailwind,.tailwind *){display:block;vertical-align:middle}img:where(.tailwind,.tailwind *),video:where(.tailwind,.tailwind *){max-width:100%;height:auto}[hidden]:where(.tailwind,.tailwind *){display:none}*,:before,:after{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }.tw-absolute{position:absolute}.tw-relative{position:relative}.tw-left-0{left:0}.tw-right-0{right:0}.tw-top-0{top:0}.tw-z-10{z-index:10}.tw-z-30{z-index:30}.tw-z-50{z-index:50}.tw-m-1{margin:.25rem}.tw-flex{display:flex}.tw-grid{display:grid}.tw-size-full{width:100%;height:100%}.tw-h-5\\/6{height:83.333333%}.tw-h-full{height:100%}.tw-h-screen{height:100vh}.tw-w-5\\/6{width:83.333333%}.tw-w-8{width:2rem}.tw-w-fit{width:-moz-fit-content;width:fit-content}.tw-w-full{width:100%}.tw-select-none{-webkit-user-select:none;-moz-user-select:none;user-select:none}.tw-grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.tw-grid-rows-1{grid-template-rows:repeat(1,minmax(0,1fr))}.tw-flex-row{flex-direction:row}.tw-flex-col{flex-direction:column}.tw-flex-wrap{flex-wrap:wrap}.tw-content-center{align-content:center}.tw-items-center{align-items:center}.tw-justify-start{justify-content:flex-start}.tw-justify-center{justify-content:center}.tw-gap-\\[1em\\]{gap:1em}.tw-rounded-md{border-radius:.375rem}.tw-rounded-bl-md{border-bottom-left-radius:.375rem}.tw-border{border-width:1px}.tw-border-black{--tw-border-opacity: 1;border-color:rgb(0 0 0 / var(--tw-border-opacity))}.tw-border-b-black{--tw-border-opacity: 1;border-bottom-color:rgb(0 0 0 / var(--tw-border-opacity))}.tw-border-l-black{--tw-border-opacity: 1;border-left-color:rgb(0 0 0 / var(--tw-border-opacity))}.tw-bg-\\[\\#deded9\\]{--tw-bg-opacity: 1;background-color:rgb(222 222 217 / var(--tw-bg-opacity))}.tw-bg-gray-100{--tw-bg-opacity: 1;background-color:rgb(243 244 246 / var(--tw-bg-opacity))}.tw-bg-gray-300{--tw-bg-opacity: 1;background-color:rgb(209 213 219 / var(--tw-bg-opacity))}.tw-bg-gray-400{--tw-bg-opacity: 1;background-color:rgb(156 163 175 / var(--tw-bg-opacity))}.tw-bg-slate-200{--tw-bg-opacity: 1;background-color:rgb(226 232 240 / var(--tw-bg-opacity))}.tw-bg-slate-800{--tw-bg-opacity: 1;background-color:rgb(30 41 59 / var(--tw-bg-opacity))}.tw-bg-white{--tw-bg-opacity: 1;background-color:rgb(255 255 255 / var(--tw-bg-opacity))}.tw-bg-opacity-80{--tw-bg-opacity: .8}.tw-p-1{padding:.25rem}.tw-p-10{padding:2.5rem}.tw-px-2{padding-left:.5rem;padding-right:.5rem}.tw-px-3{padding-left:.75rem;padding-right:.75rem}.tw-py-1{padding-top:.25rem;padding-bottom:.25rem}.tw-py-10{padding-top:2.5rem;padding-bottom:2.5rem}.tw-text-center{text-align:center}.tw-font-mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}.tw-text-sm{font-size:.875rem;line-height:1.25rem}.tw-text-black{--tw-text-opacity: 1;color:rgb(0 0 0 / var(--tw-text-opacity))}.tw-text-white{--tw-text-opacity: 1;color:rgb(255 255 255 / var(--tw-text-opacity))}.tw-shadow-md{--tw-shadow: 0 4px 6px -1px rgb(0 0 0 / .1), 0 2px 4px -2px rgb(0 0 0 / .1);--tw-shadow-colored: 0 4px 6px -1px var(--tw-shadow-color), 0 2px 4px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.tw-outline-none{outline:2px solid transparent;outline-offset:2px}.tw-outline{outline-style:solid}.tw-outline-2{outline-width:2px}.tw-outline-slate-600{outline-color:#475569}.tw-drop-shadow-md{--tw-drop-shadow: drop-shadow(0 4px 3px rgb(0 0 0 / .07)) drop-shadow(0 2px 2px rgb(0 0 0 / .06));filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.hover\\:tw-bg-gray-400:hover{--tw-bg-opacity: 1;background-color:rgb(156 163 175 / var(--tw-bg-opacity))}.hover\\:tw-bg-gray-500:hover{--tw-bg-opacity: 1;background-color:rgb(107 114 128 / var(--tw-bg-opacity))}.hover\\:tw-bg-slate-200:hover{--tw-bg-opacity: 1;background-color:rgb(226 232 240 / var(--tw-bg-opacity))}
`,document.head.appendChild(__vite_style__);const NAME=Symbol("name"),LENGTH=Symbol("length"),MIN=Symbol("min"),MAX=Symbol("max"),QUERYABLE=Symbol("queryable"),REDUCED=Symbol("reduced"),PARENT_VALUES=Symbol("parent-values"),IS_DIMENSION=Symbol("is-dimension"),keyToSymbolMap={name:NAME,length:LENGTH,min:MIN,max:MAX,queryable:QUERYABLE,reduced:REDUCED,parent:PARENT_VALUES,isDimension:IS_DIMENSION};var Meta;(e=>{function t(l,s){return!!l[keyToSymbolMap[s]]}e.has=t;function n(l,s){return Array.isArray(s)?s.map(i=>o(l,i)):o(l,s)}e.get=n;function o(l,s){return s==="length"&&Array.isArray(l)?l.length:l[keyToSymbolMap[s]]}function f(l,s){for(const[i,d]of Object.entries(s))l[keyToSymbolMap[i]]=d}e.set=f;function a(l,s,i){const d=i??Object.keys(keyToSymbolMap);for(const r of d)l[keyToSymbolMap[r]]=n(s,r)}e.copy=a})(Meta||(Meta={}));var Getter;(e=>{function t(s){if(typeof s=="function")return s;if(Array.isArray(s)){const i=d=>s[d];return Meta.set(i,{length:s.length}),i}if(isTypedArray(s)){const i=d=>s[d];return Meta.set(i,{length:s.length}),i}return()=>s}e.of=t;function n(s){return()=>s}e.constant=n;function o(s,i){const d=e.of(s),r=c=>d(i[c]);return isObject(s)&&Meta.copy(r,s),Meta.set(r,{length:i.length}),r}e.proxy=o;function f(s){const i=s.map(e.of),d=r=>i.map(c=>c(r));return Meta.copy(d,s[0],["length"]),d}e.multi=f;function a(s){const i={};for(const d of Reflect.ownKeys(s))i[d]=e.of(s[d]);return i}e.mapObject=a;function l(s,i){const d=e.of(i),r=Array(s);for(let c=0;c<s;c++)r[c]=d(c);return r}e.array=l})(Getter||(Getter={}));function identity(e){return e}const just=e=>()=>e,zero=just(0),one=just(1);function inc(e){return e+1}function dec(e){return e-1}function call(e){return e()}function bimap(e,t,n){if(e.length!==t.length)throw new Error("Arrays must be of the same length");const o=Array(e.length);for(let f=0;f<e.length;f++)o[f]=n(e[f],t[f]);return o}function square(e){return e**2}const sqrt=Math.sqrt,log10=Math.log10;function exp10(e){return 10**e}const max=Math.max;function diff(e,t){return e-t}function sum(e,t){return e+t}function prod(e,t){return e*t}function trunc(e,t=0,n=1){return Math.min(Math.max(e,t),n)}function rangeInverse(e,t){return 1/(t-e)}function invertRange(e,t){const n=rangeInverse(e,t);return[-e*n,n-e*n]}function round(e,t=0){return Math.round(e*10**t)/10**t}function compareAlphaNumeric(e,t){return e.localeCompare(t,"en",{numeric:!0})}function capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}function toLowerCase(e){return e.toLocaleLowerCase()}function toUpperCase(e){return e.toLocaleUpperCase()}function stripWS(e){return e.replace(/\s/g,"")}function last(e){return e[e.length-1]}function rep(e,t){return Array(t).fill(e)}function seq(e,t,n){const o=Math.abs(t-e);n=n??Math.ceil(o)+1;const f=o/(n-1),a=t>=e?1:-1;return Array.from(Array(n),(l,s)=>e+a*f*s)}function seqLength(e,t){return Array.from(Array(t),(n,o)=>e+o)}function subset(e,t){const n=Array(t.length);for(let o=0;o<t.length;o++)n[o]=e[t[o]];return n}function remove(e,t){const n=e.indexOf(t);n!==-1&&e.splice(n,1)}function ordered(e,t){const n=Array(t.length);for(let o=0;o<t.length;o++)n[t[o]]=e[o];return n}function orderIndices(e){const t=e.toSorted(diff),n={},o={};for(let f=0;f<t.length;f++){const a=e[f];o[a]=o[a]+1||0,n[f]=t.indexOf(a)+o[a]}return Object.values(n)}function orderBy(e,t){const n=Array(e.length);for(let o=0;o<e.length;o++)n[o]=e[t[o]];for(let o=0;o<e.length;o++)e[o]=n[o]}function orderIndicesByTable(e,t){const n=Array(e.length);for(let o=0;o<e.length;o++)n[o]=t.indexOf(e[o]);return n}function minmax(e){let[t,n]=[1/0,-1/0];for(let o=0;o<e.length;o++)t=Math.min(t,e[o]),n=Math.max(n,e[o]);return[t,n]}function cumsum(e){const t=Array(e.length);t[0]=e[0];for(let n=1;n<e.length;n++)t[n]=e[n]+t[n-1];return t}function randomInteger(e,t){return Math.floor(e+Math.random()*t)}function uniqueIntegers(e,t,n=t-e){const o=t-e,f=[],a=new Set;for(;f.length<Math.min(n,o);){let l=randomInteger(e,t);for(;a.has(l);)l=randomInteger(e,t);f.push(l),a.add(l)}return f}async function fetchJSON(e){return await(await fetch(e)).json()}function merge(e,t){return{...e,...t}}function copyValues(e,t){if(e!==t){if(isTypedArray(e)&&isTypedArray(t))t.set(e);else if(Array.isArray(e)&&Array.isArray(t)){t.length=e.length;for(let n=0;n<e.length;n++)t[n]=e[n]}}}function copyProps(e,t){for(const[n,o]of Object.entries(e))Array.isArray(o)&&Array.isArray(e[n])?copyValues(o,e[n]):t[n]=o}function applyDirection(e,t){return .5*(1-t)+t*e}function prettyBreaks(e,t,n=4){const o=(t-e)/n,f=Math.floor(Math.log10(o)),a=[1,2,4,5,10];let[l,s]=[1/0,0];for(let p=0;p<a.length;p++){const x=(a[p]*10**f-o)**2;x<l&&([l,s]=[x,a[p]])}const i=10**f*s,d=Math.ceil(e/i)*i,r=Math.floor(t/i)*i,c=Math.round((r-d)/i),u=[];for(let p=0;p<c+1;p++){const x=d+p*i;u.push(x)}return u}function binBreaks(e,t){let{width:n,anchor:o,nBins:f}=t||{};const[a,l]=minmax(e),s=l-a;f=f??(n?Math.ceil(s/n)+1:10),n=n??s/(f-1),o=o??a;const i=a-n+(o-a)%n,d=l+n-(l-o)%n,r=Array(f+2);r[0]=i,r[r.length-1]=d;for(let c=1;c<r.length-1;c++)r[c]=i+c*n;return r}function tw(e){return e.trim().split(/\s+/)}function addTailwind(e,t){for(const n of t.trim().split(/\s+/))e.classList.add(n)}function removeTailwind(e,t){for(const n of t.trim().split(/\s+/))e.classList.remove(n)}function throttle(e,t){let n=0;return function(...o){const f=new Date().getTime();f-n<t||(n=f,e(...o))}}function timeExecution(e){const t=performance.now();return e(),performance.now()-t}function segmentToPointVec(e){const[t,n,o,f]=e;return[t,n,o-t,f-n]}function inRange(e,t,n){return!(e<t)&&!(e>n)}function segmentsIntersect(e,t){let[n,o,f,a]=segmentToPointVec(e),[l,s,i,d]=segmentToPointVec(t);const r=i*a-f*d,c=((n-l)*a-(o-s)*f)/r,u=-(-(n-l)*d+(o-s)*i)/r;return inRange(c,0,1)&&inRange(u,0,1)}function rectSegmentIntersect(e,t){const[n,o,f,a]=e;return segmentsIntersect([n,o,f,o],t)||segmentsIntersect([n,o,n,a],t)||segmentsIntersect([f,o,f,a],t)||segmentsIntersect([n,a,f,a],t)}function pointInRect(e,t){const[n,o]=e;let[f,a,l,s]=t;return[f,l]=[f,l].sort(diff),[a,s]=[a,s].sort(diff),!(n<f||n>l||o<a||o>s)}function rectsIntersect(e,t){const[n,o]=[e[0],e[2]].sort(diff),[f,a]=[e[1],e[3]].sort(diff),[l,s]=[t[0],t[2]].sort(diff),[i,d]=[t[1],t[3]].sort(diff);return!(o<l||n>s||a<i||f>d)}function addIndexed(e,t,n){const f=Object.keys(e).filter(s=>s.replace(/[0-9]*$/,"")===t);if(f.length===0){e[`${t}1`]=n;return}const a=f.map(s=>parseInt(s.match(/[0-9]*$/)[0],10)),l=Math.max(...a);e[`${t}${l+1}`]=n}function minDecimal(e){let t=1/0;for(let n=0;n<e.length;n++)e[n]!==0&&(t=Math.min(t,Math.log10(Math.abs(e[n]))));return t>3?0:Math.floor(Math.abs(t))+2}function formatText(e,t={lowercase:!0,capitalize:!0,split:!0}){return t!=null&&t.split&&(e=e.replace(/_/g," ")),t!=null&&t.lowercase&&(e=e.toLocaleLowerCase()),t!=null&&t.capitalize&&(e=capitalize(e)),e}function formatLabel(e){if(typeof e=="string")return e;if(e===0)return e.toString();const t=Math.floor(Math.log10(Math.abs(e)));return t>=3?round(e).toString():t<=-3?round(e,-t+1).toString():round(e,2).toString()}function formatAxisLabels(e,t){if(!isNumberArray(e))return e;const n=(t==null?void 0:t.tens)??4,o=s=>s!=0&&Math.abs(Math.log10(s))>n,f=(t==null?void 0:t.decimals)??minDecimal(e);e=e.map(s=>round(s,f));const l=minmax(e).some(o)?superscriptFn:noSuperscriptFn;return e.map(l)}function superscriptFn(e){return e===0?"0":exponentialToSuperscript(e.toExponential())}function noSuperscriptFn(e){return e===0?"0":parseFloat(e.toPrecision(12)).toString()}function exponentialToSuperscript(e){let[t,n]=e.split("e");return n=convertToSuperscript(n),t+"×10"+n}const sups={"-":"⁻","+":"",0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹"};function convertToSuperscript(e){return e.split("").map(t=>sups[t]).join("")}function isDefined(e){return e!=null}const primitives=["string","number","boolean","undefined"];function isPrimitive(e){return e===null||primitives.includes(typeof e)}function isObject(e){return typeof e=="object"&&e!==null}function isTypedArray(e){return ArrayBuffer.isView(e)}function isNumber(e){return typeof e=="number"}function isIntegerString(e){return/^[0-9]+/.test(e)}function isNumberArray(e){return typeof e[0]=="number"&&typeof last(e)=="number"}function isStringArray(e){return typeof e[0]=="string"&&typeof last(e)=="string"}function isEventTarget(e){return"addEventListener"in e}function findLength(e){for(const n of e){if(!n)continue;const o=Meta.get(n,"length");if(o)return o}const t="At least one variable needs to be of fixed length";throw new Error(t)}function applyWith(...e){return function(t){return t(...e)}}function row(e,t){const n={};for(const[o,f]of Object.entries(e))n[o]=Getter.of(f)(t);return n}function selector(e){return function(t){return t[e]}}function keysToSelectors(e){return function(t){return e.map(n=>t[n])}}function splitNumericSuffix(e){let t=e.length-1;for(;t>0&&/[0-9]/.test(e[t]);)t--;return t+=1,[e.substring(0,t),e.substring(t,e.length)]}function filterIndices(e,t){const n=[];for(let o=0;o<e.length;o++)t(e[o])&&n.push(o);return n}function stringArraysMatch(e,t){if(e.length!==t.length)return!1;const n=e.toSorted(compareAlphaNumeric).join(""),o=t.toSorted(compareAlphaNumeric).join("");return n===o}const LISTENERS=Symbol("listeners");var Reactive;(e=>{function t(){return function(r){return{...r,[LISTENERS]:{}}}}e.of=t;function n(r){return(r==null?void 0:r[LISTENERS])!==void 0}e.is=n;function o(r,c,u,p){if(!e.is(r))return;p!=null&&p.throttle&&(u=throttle(u,p.throttle));const x=(p==null?void 0:p.priority)??1,S=r[LISTENERS],m={priority:x,callback:u};S[c]||(S[c]=[]),S[c].includes(m)||S[c].push(m),S[c].sort((b,v)=>b.priority-v.priority)}e.listen=o;function f(r,c,u){if(!e.is(r))return;const p=r[LISTENERS][c];if(p)for(const{callback:x}of p)x(u)}e.dispatch=f;function a(r,c,u){if(!e.is(r)||!e.is(c))return;const p=()=>e.dispatch(c,u);e.listen(r,u,p,{priority:99})}e.propagate=a;function l(r,c){e.is(r)&&(c(r),e.dispatch(r,"changed"))}e.set=l;function s(r,c,u){if(!e.is(r))return;const p=r[LISTENERS][c]??[];for(let x=0;x<p.length;x++)p[x].callback===u&&p.splice(x,1)}e.remove=s;function i(r,c){e.is(r)&&r[LISTENERS][c]&&(r[LISTENERS][c].length=0)}e.removeAll=i;function d(r){if(!e.is(r))return;const c=r[LISTENERS];if(c)for(const u of Object.values(c))u.length=0}e.removeAllListeners=d})(Reactive||(Reactive={}));const METHODS=Symbol("methods");exports.Poly=void 0,(e=>{function t(f){const a=function(...l){return n(a,f,l[0].type)(...l)};return a[METHODS]={},a}e.of=t;function n(f,a,l){return f[METHODS][l]??a}e.dispatch=n;function o(f,a,l){f[METHODS][a]=l}e.set=o})(exports.Poly||(exports.Poly={})),exports.Expanse=void 0,(e=>{e.normalize=exports.Poly.of(t),e.unnormalize=exports.Poly.of(n),e.train=exports.Poly.of(o),e.breaks=exports.Poly.of(f),e.reorder=exports.Poly.of(a);function t(m,b){throw new Error(`Method 'normalize' not implemented for expanse of type '${m.type}'`)}function n(m,b){throw new Error(`Method 'unnormalize' not implemented for expanse of type '${m.type}'`)}function o(m,b,v){throw new Error(`Method 'train' not implemented for expanse of type '${m.type}'`)}e.trainDefault=o;function f(m,b,v){throw new Error(`Method 'breaks' not implemented for expanse of type '${m.type}'`)}function a(m,b){throw new Error(`Method 'reorder' not implemented for expanse of type '${m.type}'`)}function l(){return Reactive.of()({})}e.base=l;function s(m,b,v){const{frozen:M,props:R}=m,A=b({...R});if(!(v!=null&&v.unfreeze))for(const w of M)delete A[w];for(const w of Object.keys(A))A[w]===m.props[w]&&delete A[w];copyProps(A,m.props),v!=null&&v.default&&copyProps(A,m.defaults),v!=null&&v.silent||Reactive.dispatch(m,"changed")}e.set=s;function i(m,b){for(const v of b)m.frozen.includes(v)||m.frozen.push(v)}e.freeze=i;function d(m,b){const{defaults:v}=m;for(const[M,R]of Object.entries(v))Array.isArray(R)&&Array.isArray(m.props[M])?copyValues(R,m.props[M]):m.props[M]=R;b!=null&&b.silent||Reactive.dispatch(m,"changed")}e.reset=d;function r(m){return m.type==="continuous"||m.type==="split"}e.isContinuous=r;function c(m){return m.type==="point"}e.isPoint=c;function u(m){return m.type==="point"||m.type==="band"}e.isDiscrete=u;function p(m){return m.type==="band"}e.isBand=p;function x(m){return m.type==="compound"}e.isCompound=x;function S(m){return m.type==="split"}e.isSplit=S})(exports.Expanse||(exports.Expanse={}));var ExpanseBand;(e=>{const t="band";function n(r=[]){const c="",u=exports.Expanse.base(),[p,x]=[!1,seqLength(0,r.length)],S=Array(r.length).fill(1),m=cumsum(S),b={labels:r,ordered:p,order:x,weights:S,cumulativeWeights:m},v=structuredClone(b);return{...u,type:t,value:c,props:b,defaults:v,frozen:[]}}e.of=n,exports.Poly.set(exports.Expanse.normalize,t,o),exports.Poly.set(exports.Expanse.unnormalize,t,f),exports.Poly.set(exports.Expanse.train,t,a),exports.Poly.set(exports.Expanse.breaks,t,s),exports.Poly.set(exports.Expanse.reorder,t,l);function o(r,c){const{labels:u}=r.props,p=u.indexOf(c);if(p===-1)throw new Error(`Label ${c} not found in: ${u}`);return d(r,p)}e.normalize=o;function f(r,c){const{labels:u}=r.props,p=Math.round((2*c*u.length-1)/2);return u[p]}e.unnormalize=f;function a(r,c,u){const{props:p}=r,{order:x}=p,S=Array.from(new Set(c)).sort(compareAlphaNumeric);if(!x.length){for(let M=0;M<S.length;M++)x[M]=M;r.defaults.order=[...x],p.ordered=!1}const m=Array(S.length).fill(1),b=cumsum(ordered(m,x)),v={labels:S,weights:m,cumulativeWeights:b};for(const[M,R]of Object.entries(v))copyValues(R,r.props[M]),u!=null&&u.default&&copyValues(R,r.defaults[M]);exports.Expanse.set(r,()=>({}),u)}e.train=a;function l(r,c){const{props:u,defaults:p}=r,{order:x,weights:S,cumulativeWeights:m}=r.props;if(!c){copyValues(p.order,x),copyValues(cumsum(ordered(S,x)),m),u.ordered=!1,Reactive.dispatch(r,"changed");return}copyValues(c,x),copyValues(cumsum(ordered(S,c)),m),u.ordered=!0,Reactive.dispatch(r,"changed")}e.reorder=l;function s(r){const{labels:c,order:u}=r.props;return ordered(c,u)}e.breaks=s;function i(r,c){const{props:u,defaults:p}=r;if(c=c??Array(u.labels.length).fill(1),c.length!=u.labels.length){const m="The length of the weights must match the length of labels";throw new Error(m)}const{order:x}=u,S=cumsum(ordered(c,x));copyValues(c,u.weights),copyValues(c,p.weights),copyValues(S,u.cumulativeWeights),copyValues(S,p.cumulativeWeights),Reactive.dispatch(r,"changed")}e.setWeights=i;function d(r,c){const{order:u,cumulativeWeights:p}=r.props;c=u[c];const x=p[c-1]??0,S=p[c],m=last(p);return(x+S)/2/m}})(ExpanseBand||(ExpanseBand={}));var ExpanseContinuous;(e=>{const t="continuous";function n(i=0,d=1){const c=exports.Expanse.base(),[u,p]=[identity,identity],[x,S,m,b]=[1,1,0,!1],v={min:i,max:d,scale:x,mult:S,offset:m,ratio:b,trans:u,inv:p},M={...v,trans:u,inv:p};return{...c,value:0,type:t,props:v,defaults:M,frozen:[]}}e.of=n,exports.Poly.set(exports.Expanse.normalize,t,o),exports.Poly.set(exports.Expanse.unnormalize,t,f),exports.Poly.set(exports.Expanse.train,t,a),exports.Poly.set(exports.Expanse.breaks,t,l);function o(i,d){const{min:r,max:c,scale:u,mult:p,offset:x,trans:S}=i.props,m=S(c)-S(r);let b=d/(u*p)-x;return b=(S(b-x)-S(r))/m,b}e.normalize=o;function f(i,d){const{min:r,max:c,scale:u,mult:p,offset:x,trans:S,inv:m}=i.props,b=S(c)-S(r);let v=m(S(r)+d*b);return v=v*(u*p)+x,v}e.unnormalize=f;function a(i,d,r){const{ratio:c}=i.props;let[u,p]=Meta.get(d,["min","max"]);(!u||!p)&&([u,p]=minmax(d)),u=c||r!=null&&r.ratio?0:u,exports.Expanse.set(i,()=>({min:u,max:p}),r)}e.train=a;function l(i,d=0,r=1){let[c,u]=[d,r].map(x=>f(i,x));return[c,u]=[c,u].sort(diff),prettyBreaks(c,u,4)}e.breaks=l;function s(i){const{min:d,max:r}=i.props;return r-d}e.range=s})(ExpanseContinuous||(ExpanseContinuous={})),exports.Scale=void 0,(e=>{function t(w,g){const k={zero:0,one:1,direction:1},h={...k},[y,z]=[[],[]],C=Reactive.of()({domain:w,codomain:g,props:k,defaults:h,frozen:z,linked:y});return Reactive.propagate(w,C,"changed"),Reactive.propagate(g,C,"changed"),C}e.of=t;function n(){return e.of(ExpanseContinuous.of(),ExpanseContinuous.of())}e.standard=n;function o(w,g){const{domain:k,codomain:h,props:y}=w,{zero:z,one:C,direction:T}=y;let O=exports.Expanse.normalize(k,g);return Array.isArray(O)?O=O.map(_=>a(z+_*(C-z),T)):(O=z+O*(C-z),O=a(O,T)),exports.Expanse.unnormalize(h,O)}e.pushforward=o;function f(w,g){const{domain:k,codomain:h,props:y}=w,{zero:z,one:C}=y;let T=exports.Expanse.normalize(h,g);return Array.isArray(T)?T=T.map(O=>(O-z)/(C-z)):T=(T-z)/(C-z),exports.Expanse.unnormalize(k,T)}e.pullback=f;function a(w,g){return .5*(1-g)+g*w}function l(w,g,k){const{linked:h,frozen:y,props:z}=w,C=g({...z});if(!(k!=null&&k.unfreeze))for(const T of y)delete C[T];Object.assign(z,C),k!=null&&k.default&&Object.assign(w.defaults,C),k!=null&&k.silent||Reactive.dispatch(w,"changed");for(const T of h)e.set(T,g,k)}e.set=l;function s(w,g){for(const k of g)w.frozen.includes(k)||w.frozen.push(k)}e.freeze=s;function i(w){e.set(w,g=>({direction:-1*g.direction}))}e.flip=i;function d(w,g){let{direction:k,zero:h,one:y}=w.props;h+=k*g,y+=k*g,e.set(w,()=>({zero:h,one:y}))}e.move=d;function r(w,g,k,h){const{zero:y,one:z,direction:C}=w.props,T=z-y;C===-1&&([g,k]=[1-g,1-k]),[g,k]=[g,k].map(O=>(O-y)/T),[g,k]=invertRange(g,k),C===-1&&([g,k]=[1-g,1-k]),e.set(w,()=>({zero:g,one:k}),h)}e.expand=r;function c(w,g,k){if(((k==null?void 0:k.name)??!0)&&Meta.has(g,"name")&&Meta.copy(w,g,["name"]),typeof g[0]=="string"&&exports.Expanse.isContinuous(w.domain)){const y=Array.from(new Set(g));w.domain=ExpanseBand.of(y)}exports.Expanse.train(w.domain,g,k)}e.train=c;function u(w,g){Object.assign(w.props,w.defaults),g!=null&&g.silent||Reactive.dispatch(w,"changed")}e.reset=u;function p(w){exports.Expanse.reset(w.domain,{silent:!0}),exports.Expanse.reset(w.codomain,{silent:!0}),e.reset(w)}e.restore=p;function x(w){const{domain:g,props:k}=w;let{zero:h,one:y}=k;[h,y]=invertRange(h,y);const z=exports.Expanse.breaks(g,h,y);let C=formatAxisLabels(z);if(exports.Expanse.isCompound(w.domain)){C=formatAxisLabels(z,{decimals:1});const O=z.map(_=>exports.Expanse.unnormalize(w.codomain,ExpanseContinuous.normalize(w.domain,_)));return{labels:C,positions:O}}else if(exports.Expanse.isSplit(w.codomain)){const O=e.pushforward(w,z);return{labels:C,positions:O}}const T=z.map(O=>e.pushforward(w,O));return{labels:C,positions:T}}e.breaks=x;function S(w,g){w.linked.includes(g)||w.linked.push(g)}e.link=S;function m(w,g){g.codomain=w.codomain}e.shareCodomain=m;function b(w){return w.props.one-w.props.zero}e.unitRange=b;function v(w){const{domain:g}=w;if(exports.Expanse.isContinuous(g))return ExpanseContinuous.range(g)/b(w)}e.domainRange=v;function M(w){const{codomain:g}=w;if(exports.Expanse.isContinuous(g))return ExpanseContinuous.range(g)*b(w)}e.codomainRange=M;function R(w){if(!A(w))throw new Error("Both domain and codomain need to be continuous");const{domain:g,codomain:k}=w,h=ExpanseContinuous.range(g);return ExpanseContinuous.range(k)*b(w)/h}e.unitRatio=R;function A(w){const{domain:g,codomain:k}=w;return exports.Expanse.isContinuous(g)&&exports.Expanse.isContinuous(k)}e.isContinuous=A})(exports.Scale||(exports.Scale={})),exports.Factor=void 0,(e=>{e.POSITIONS=Symbol("positions"),e.DIMENSION=Symbol("dimension"),e.CHILD_INDICES=Symbol("child-indices");function t(r,c,u,p){return Reactive.of()({type:r,cardinality:c,indices:u,data:p})}e.of=t;function n(r,c){c.cardinality=r.cardinality,copyValues(r.indices,c.indices);for(const u of Reflect.ownKeys(r.data))Array.isArray(r.data[u])&&Array.isArray(c.data[u])?(copyValues(r.data[u],c.data[u]),Meta.copy(c.data[u],r.data[u])):c.data[u]=r.data[u]}e.copyFrom=n;function o(r,c){if([r,c].some(u=>u.type==="bijection"))return!0;if(r.indices.length!==c.indices.length)throw new Error("Factors do not have matching length")}function f(r,c){const p=new Uint32Array(seq(0,r)),x=b=>[b];c=c??{};for(const b of Object.values(c))Meta.set(b,{queryable:!0});const S="bijection",m={...c,[e.POSITIONS]:x};return t(S,1/0,p,m)}e.bijection=f;function a(r){const u=new Uint32Array(r).fill(0),p=()=>Array.from(u),x="constant",S={[e.POSITIONS]:p};return t(x,1,u,S)}e.mono=a;function l(r,c){const u=r.map(v=>v.toString());c=c??Array.from(new Set(u)).sort(compareAlphaNumeric),Meta.has(r,"name")&&Meta.copy(c,r,["name"]);const p=new Uint32Array(r.length),x={};for(let v=0;v<u.length;v++){const M=c.indexOf(u[v]);x[M]||(x[M]=[]),p[v]=M,x[M].push(v)}Meta.set(c,{queryable:!0,isDimension:!0});const S=Object.values(x),m="surjection",b={label:c,[e.POSITIONS]:S};return t(m,c.length,p,b)}e.from=l;function s(r,c){function u(){const x=(c==null?void 0:c.breaks)??binBreaks(r,c),S=new Set,m=new Uint32Array(r.length),b={};for(let T=0;T<r.length;T++){const O=x.findIndex(_=>_>=r[T])-1;b[O]||(b[O]=[]),m[T]=O,b[O].push(T),S.add(O)}const v=Array.from(S).sort(diff);for(let T=0;T<m.length;T++)m[T]=v.indexOf(m[T]);const[M,R]=[[],[]];for(let T=0;T<v.length;T++)M.push(x[v[T]]),R.push(x[v[T]+1]);const[A,w]=[x[v[0]],x[last(v)+1]],g=`min of ${Meta.get(r,"name")}`,k=`max of ${Meta.get(r,"name")}`,h={queryable:!0,isDimension:!0};Meta.set(M,{min:A,max:w,name:g,...h}),Meta.set(R,{min:A,max:w,name:k,...h}),Meta.copy(x,r,["name"]);const y=Object.values(b),z="surjection",C={binMin:M,binMax:R,breaks:x,[e.POSITIONS]:y};return t(z,v.length,m,C)}const p=u();return c&&Reactive.is(c)&&Reactive.listen(c,"changed",()=>{const x=u();e.copyFrom(x,p),Reactive.dispatch(p,"changed")}),p}e.bin=s;function i(r,c){o(r,c),r.data[e.CHILD_INDICES]=[];function u(){if(r.type==="bijection"){const _={};for(const L of Reflect.ownKeys(r.data))_[L]=Getter.of(r.data[L]),Meta.copy(_[L],r.data[L]);for(const L of Reflect.ownKeys(c.data))_[L]=Getter.proxy(c.data[L],c.indices),Meta.copy(_[L],c.data[L]);const q="bijection",E=c.indices.length,I=new Uint32Array(c.indices.length),P=t(q,E,I,_);P.parent=r;const D=Array.from(Array(I.length),(L,N)=>[N]);return copyValues(D,r.data[e.CHILD_INDICES]),P}if(r.type==="constant"){const{type:_,data:q,cardinality:E,indices:I}=c,P=t(_,E,I,q);return P.parent=r,P}const x=Math.max(r.cardinality,c.cardinality)+1,S=new Set,m=new Uint32Array(r.indices.length),b={},v={},M={},R=Getter.of(r.indices),A=Getter.of(c.indices);for(let _=0;_<r.indices.length;_++){const[q,E]=[R(_),A(_)],I=x*q+E;I in v||(v[I]=q,M[I]=E,b[I]=[]),m[_]=I,b[I].push(_),S.add(I)}const w=Array.from(S).sort(diff),g={};for(const _ of Object.keys(v))g[parseInt(_)]=w.indexOf(parseInt(_));for(let _=0;_<m.length;_++)m[_]=g[m[_]];const k={};for(const[_,q]of Object.entries(v))q in k||(k[q]=[]),k[q].push(g[parseInt(_)]);const h=Object.values(v),y=Object.values(M),z={};for(let _ of Reflect.ownKeys(r.data)){let q=_;if(typeof _=="string")for(;q in z;)_+="$";const[E,I]=[r.data[_],h],P=Array.isArray(E)?subset(E,I):Getter.proxy(E,I);Meta.copy(P,E),z[q]=P}for(let _ of Reflect.ownKeys(c.data)){let q=_;if(typeof _=="string")for(;q in z;)q+="$";const[E,I]=[c.data[_],y],P=Array.isArray(E)?subset(E,I):Getter.proxy(E,I);Meta.copy(P,E),z[q]=P}const C="surjection";z[e.POSITIONS]=Object.values(b);const T=t(C,w.length,m,z);T.parent=r;const O=Object.values(k);return copyValues(O,r.data[e.CHILD_INDICES]),T}const p=u();return Reactive.listen(r,"changed",()=>{const x=u();e.copyFrom(x,p),Reactive.dispatch(p,"changed")}),Reactive.listen(c,"changed",()=>{const x=u();e.copyFrom(x,p),Reactive.dispatch(p,"changed")}),p}e.product=i;function d(r,c){const u={};for(let p=0;p<c.indices.length&&(u[c.indices[p]]=r.indices[p],!(Object.keys(u).length>=c.cardinality));p++);return Object.values(u)}e.parentIndices=d})(exports.Factor||(exports.Factor={}));const Transient=255;var Group=(e=>(e[e.Base=7]="Base",e[e.First=6]="First",e[e.Second=5]="Second",e[e.Third=4]="Third",e[e.BaseTransient=3]="BaseTransient",e[e.FirstTransient=2]="FirstTransient",e[e.SecondTransient=1]="SecondTransient",e[e.ThirdTransient=0]="ThirdTransient",e))(Group||{});const LAYER=Symbol("layer");var Marker;(e=>{function t(r){const c=Transient,u=new Uint32Array(r).fill(7),p=[],x="surjection",S=[0,1,2,3,4,5,6,7],m=exports.Factor.of(x,8,u,{[LAYER]:S});Meta.set(S,{queryable:!0});const b=Reactive.of()({group:c,indices:u,transientIndices:p,factor:m});return Reactive.listen(b,"updated",()=>Reactive.dispatch(m,"changed")),Reactive.listen(b,"cleared",()=>Reactive.dispatch(m,"changed")),b}e.of=t;function n(r,c){r.group=c}e.setGroup=n;function o(r,c,u){const p=(u==null?void 0:u.group)??r.group;if(a(r,{silent:!0}),p===Transient){for(let x=0;x<c.length;x++){const S=c[x];r.indices[S]=i(r.indices[S])}r.transientIndices=c}else for(let x=0;x<c.length;x++){const S=c[x];r.indices[S]=p}u!=null&&u.silent||Reactive.dispatch(r,"updated")}e.update=o;function f(r,c){for(let u=0;u<r.indices.length;u++)r.indices[u]=7;c!=null&&c.silent||Reactive.dispatch(r,"cleared")}e.clearAll=f;function a(r,c){for(let u=0;u<r.transientIndices.length;u++){const p=r.transientIndices[u];r.indices[p]=d(r.indices[p])}c!=null&&c.silent||Reactive.dispatch(r,"cleared")}e.clearTransient=a;function l(r){const{factor:c,indices:u}=r;return p=>c.data[LAYER][u[p]]}e.getLayer=l;function s(r){return!(r&4)}e.isTransient=s;function i(r){return r&-5}function d(r){return r|4}})(Marker||(Marker={}));var Reduced;(e=>{e.PARENT=Symbol("parent"),e.VALUES=Symbol("values"),e.INDICES=Symbol("indices"),e.FACTOR=Symbol("factor"),e.REDUCER=Symbol("reducer"),e.ORIGINAL_VALUES=Symbol("original-values");function t(u,p,x,S){const m=u;return m[e.VALUES]=u,m[e.FACTOR]=p,m[e.REDUCER]=x,m[e.ORIGINAL_VALUES]=u,S&&n(m,S),m}e.of=t;function n(u,p){u[e.PARENT]=p}e.setParent=n;function o(u){const[,p,x,S]=c(u);if(!S)throw new Error("Parent missing");const m=exports.Factor.parentIndices(s(S),p),b=subset(S,m),v=t(b,s(S),x,i(S));return d(v,S),r(v,m),v[e.ORIGINAL_VALUES]=u[e.ORIGINAL_VALUES],Meta.copy(v,u,["name","queryable","reduced"]),v}e.parent=o;function f(u){const[p,x,S,m,b]=c(u);if(!m)throw new Error("Cannot stack a without a parent");const v=exports.Factor.parentIndices(s(m),x),{reducefn:M,initialfn:R}=S,[A,w]=[p.length,[]],g=Array.from(Array(A),()=>R()),k=Getter.of(v);for(let z=0;z<p.length;z++){const C=k(z);w[C]===void 0&&(w[C]=R()),w[C]=M(w[C],p[z]),g[z]=w[C]}const h=b?subset(g,b):g,y=e.of(h,x,S,m);return d(y,g),b&&r(y,b),y[e.ORIGINAL_VALUES]=u[e.ORIGINAL_VALUES],Meta.copy(y,u,["name","queryable","reduced"]),y}e.stack=f;function a(u,p){const[x,S,m,b,v]=c(u);if(!b)throw new Error("Cannot normalize a without a parent");const M=exports.Factor.parentIndices(s(b),S),R=subset(b,M),A=[...x];for(let k=0;k<u.length;k++)A[k]=p(A[k],R[k]);const w=v?subset(A,v):A,g=e.of(w,S,m,b);return d(g,A),v&&r(g,v),g[e.ORIGINAL_VALUES]=u[e.ORIGINAL_VALUES],Meta.copy(g,u,["name","queryable","reduced"]),g}e.normalize=a;function l(u){const[p,x,S,m,b]=c(u),v=[];v.push(S.initialfn());for(let A=0;A<p.length-1;A++)v.push(p[A]);const M=b?subset(v,b):v,R=e.of(M,x,S,m);return d(R,v),b&&r(R,b),R[e.ORIGINAL_VALUES]=u[e.ORIGINAL_VALUES],Meta.copy(R,u,["name","queryable"]),R}e.shiftLeft=l;function s(u){return u[e.FACTOR]}function i(u){return u[e.PARENT]}e.getParent=i;function d(u,p){u[e.VALUES]=p}function r(u,p){u[e.INDICES]=p}function c(u){return[u[e.VALUES],u[e.FACTOR],u[e.REDUCER],u[e.PARENT],u[e.INDICES]]}})(Reduced||(Reduced={}));var Geom;(e=>{function t(u){const p=Reactive.of()(u),x=last(u.coordinates)??Reactive.of()({});return Reactive.listen(x,"changed",()=>Reactive.dispatch(p,"coords-changed")),p}e.of=t,e.render=exports.Poly.of(n),e.check=exports.Poly.of(o),e.query=exports.Poly.of(f);function n(u,p){throw new Error(`Method 'render' not implemented for geom of type '${u.type}'`)}function o(u,p){throw new Error(`Method 'check' not implemented for geom of type '${u.type}'`)}function f(u,p){throw new Error(`Method 'render' not implemented for geom of type '${u.type}'`)}function a(u,p){const x=last(u.coordinates)??Reactive.of()({});Reactive.removeAllListeners(x),u.coordinates=p;const S=last(p)??{};Reactive.listen(S,"changed",()=>Reactive.dispatch(u,"coords-changed")),Reactive.dispatch(u,"coords-swapped")}e.setCoordinates=a;function l(u){return u.coordinates[u.coordinates.length-2]}e.flatData=l;function s(u){return u.coordinates[u.coordinates.length-1]}e.groupedData=s;function i(u,p,x){const[S,m]=[Array(u),Getter.of(p)];for(let b=0;b<u;b++)S[b]=x[m(b)];return S}e.frames=i;function d(u,p){const x=[];for(const[S,m]of p){const b=Array(u),v=Getter.of(S??1);for(let M=0;M<u;M++)b[M]=exports.Scale.pushforward(m,v(M));x.push(b)}return x}e.scaledArrays=d;function r(u,p){const x=p[0],m=[c(u,x,{dimension:"only"})];for(let b=0;b<p.length;b++){const v=p[b],M=c(u,v,{dimension:"exclude"});M[LAYER]=Getter.of(u[LAYER])(v),m.push(M)}return m}e.getQueryInfo=r;function c(u,p,x){const S={},m=x==null?void 0:x.dimension;for(const b of Object.values(u)){if(m==="exclude"&&Meta.get(b,"isDimension")||m==="only"&&!Meta.get(b,"isDimension"))continue;const[v,M,R]=Meta.get(b,["name","queryable","reduced"]);if(!v||!M)continue;const A=R?b[Reduced.ORIGINAL_VALUES]:b,w=Getter.of(A);S[v]=w(p)}return S}})(Geom||(Geom={}));var DOM;(e=>{function t(i,d){const r=document.createElement(i);return d!=null&&d.id&&(r.id=d.id),d!=null&&d.classes&&a(r,d.classes),d!=null&&d.textContent&&(r.textContent=d.textContent),r}e.element=t;function n(i,d){i.appendChild(d)}e.append=n;function o(i,d){return i.querySelector(d)}e.select=o;function f(i,d){for(const[r,c]of Object.entries(d))i.style[r]=c}e.setStyles=f;function a(i,d){for(const r of d)i.classList.add(r)}e.addClasses=a;function l(i,d){for(const r of d)i.classList.remove(r)}e.removeClasses=l;function s(i){i.innerHTML=""}e.clearChildren=s})(DOM||(DOM={}));var VAnchor=(e=>(e[e.Middle=.5]="Middle",e[e.Top=1]="Top",e[e.Bottom=0]="Bottom",e))(VAnchor||{}),HAnchor=(e=>(e[e.Center=.5]="Center",e[e.Left=1]="Left",e[e.Right=0]="Right",e))(HAnchor||{}),MouseButton=(e=>(e[e.Left=0]="Left",e[e.Right=2]="Right",e))(MouseButton||{});const dataLayers=[0,1,2,3,4,5,6,7],baseLayers=[4,5,6,7];var Frame;(e=>{function t(R){const A=DOM.element("canvas"),w=A.getContext("2d");DOM.addClasses(A,tw(R.classes??""));for(const[q,E]of Object.entries(R.canvasStyles??{}))A.style[q]=E;const{clientWidth:g,clientHeight:k,clientLeft:h,clientTop:y}=A,z=g-h,C=k-y,T=2,{margins:O=[0,0,0,0],contextProps:_={}}=R;return{canvas:A,context:w,width:z,height:C,margins:O,scalingFactor:T,contextProps:_}}e.of=t;function n(R,A){A.appendChild(R.canvas),R.parent=A,e.resize(R)}e.append=n;function o(R,A){for(const[w,g]of Object.entries(A))R.contextProps[w]=g,R.context[w]=g}e.setContext=o;function f(R){const{context:A,canvas:w,scalingFactor:g}=R,{clientWidth:k,clientHeight:h,clientLeft:y,clientTop:z}=w,C=k-y,T=h-z;R.width=C,R.height=T,R.canvas.width=C*g,R.canvas.height=T*g;for(const[O,_]of Object.entries(R.contextProps))R.context[O]=_;A.scale(g,g),e.clip(R)}e.resize=f;function a(R){const{context:A}=R;let{width:w,height:g}=R;const[k,h,y,z]=R.margins;w=Math.max(w-h-z,0),g=Math.max(g-y-k,0),A.beginPath(),A.rect(h,y,w,g),A.clip()}e.clip=a;function l(R){R.context.clearRect(0,0,R.width,R.height)}e.clear=l;function s(R,A){R.context.globalAlpha=A(R.context.globalAlpha)}e.setAlpha=s;function i(R){R.context.globalAlpha=1}e.resetAlpha=i;function d(R,A){return R.context.measureText(A).width}e.textWidth=d;function r(R,A){const w=R.context.measureText(A);return w.actualBoundingBoxAscent+w.actualBoundingBoxDescent}e.textHeight=r;function c(R,A,w,g,k){const{context:h}=R,y=R.canvas.clientHeight,z=(k==null?void 0:k.hAnchor)??HAnchor.Center,C=(k==null?void 0:k.vAnchor)??VAnchor.Middle;A=A+2*(z-.5)*g,w=y-w+2*(.5-C)*g,h.beginPath(),h.arc(A,w,g,0,Math.PI*2),h.fill()}e.point=c;function u(R,A,w,g,k){for(let h=0;h<A.length;h++)c(R[h],A[h],w[h],g[h],k)}e.points=u;function p(R,A,w,g,k,h){const{context:y,height:z}=R,C=g-A,T=k-w;A=A+(1-h)/2*C,g=g-(1-h)/2*C,w=w+(1-h)/2*T,k=k-(1-h)/2*T,y.fillRect(A,z-w,g-A,w-k)}e.rectangleXY=p;function x(R,A,w,g,k,h){for(let y=0;y<A.length;y++)p(R[y],A[y],w[y],g[y],k[y],h[y])}e.rectanglesXY=x;function S(R,A,w,g,k,h){const{context:y,height:z}=R,C=(h==null?void 0:h.hAnchor)??HAnchor.Center,T=(h==null?void 0:h.vAnchor)??VAnchor.Middle;A=A-C*g,w=z-w+T*k,y.fillRect(A,w,g,-k)}e.rectangleWH=S;function m(R,A,w,g,k,h){for(let y=0;y<A.length;y++)S(R[y],A[y],w[y],g[y],k[y],h)}e.rectanglesWH=m;function b(R,A,w){const{context:g,height:k}=R;g.beginPath(),g.moveTo(A[0],k-w[0]);for(let h=0;h<A.length;h++)g.lineTo(A[h],k-w[h]);g.stroke()}e.line=b;function v(R,A,w){for(let g=0;g<A.length;g++)b(R[g],A[g],w[g])}e.lines=v;function M(R,A,w,g,k){const{context:h,height:y}=R;h.save(),h.translate(A,y-w),k!=null&&k.vertical&&h.rotate(-Math.PI/2),h.fillText(g,0,0),h.translate(-A,-(y-w)),h.restore()}e.text=M})(Frame||(Frame={}));var Bars;(e=>{const t="bars";function n(l,s,i){const d=(i==null?void 0:i.vAnchor)??VAnchor.Bottom,r=(i==null?void 0:i.hAnchor)??HAnchor.Center;return Geom.of({type:t,coordinates:l,scales:s,vAnchor:d,hAnchor:r})}e.of=n,exports.Poly.set(Geom.render,t,o),exports.Poly.set(Geom.check,t,f),exports.Poly.set(Geom.query,t,a);function o(l,s){const{scales:i,hAnchor:d,vAnchor:r}=l,c=Geom.groupedData(l),u=findLength(Object.values(c)),[p,x,S,m]=Geom.scaledArrays(u,[[c.x,i.x],[c.y,i.y],[c.width,i.width],[c.height,i.height]]),b=Geom.frames(u,c[LAYER],s);Frame.rectanglesWH(b,p,x,S,m,{hAnchor:d,vAnchor:r})}function f(l,s){const{scales:i,hAnchor:d,vAnchor:r}=l,c=Geom.flatData(l),u=findLength(Object.values(c)),{x:p,y:x,width:S,height:m}=Getter.mapObject(c),b=Getter.of(c[exports.Factor.POSITIONS]),v=[];for(let M=0;M<u;M++){let R=exports.Scale.pushforward(i.x,p(M)),A=exports.Scale.pushforward(i.y,x(M)),w=exports.Scale.pushforward(i.width,S(M)),g=exports.Scale.pushforward(i.height,m(M));const k=[R-w*d,A-g*r,R+w*d,A+g*(1-r)];if(rectsIntersect(s,k)){const h=b(M);for(let y=0;y<h.length;y++)v.push(h[y])}}return v}function a(l,s){var v;const{scales:i,hAnchor:d,vAnchor:r}=l,c=Geom.flatData(l),u=Geom.groupedData(l),p=findLength(Object.values(c)),{x,y:S,width:m,height:b}=Getter.mapObject(c);for(let M=0;M<p;M++){let R=exports.Scale.pushforward(i.x,x(M)),A=exports.Scale.pushforward(i.y,S(M)),w=exports.Scale.pushforward(i.width,m(M)),g=exports.Scale.pushforward(i.height,b(M));const k=[R-w*d,A-g*r,R+w*d,A+g*(1-r)];if(pointInRect(s,k)){const h=(v=c[exports.Factor.CHILD_INDICES])==null?void 0:v[M];return Geom.getQueryInfo(u,h??[])}}}})(Bars||(Bars={}));var ExpanseCompound;(e=>{const t="compound";function n(i){const d=[];return{...ExpanseContinuous.of(),type:t,value:d,expanses:i??[]}}e.of=n,exports.Poly.set(exports.Expanse.normalize,t,o),exports.Poly.set(exports.Expanse.unnormalize,t,f),exports.Poly.set(exports.Expanse.train,t,a),exports.Poly.set(exports.Expanse.breaks,t,l);function o(i,d){const{expanses:r}=i;return d.map((c,u)=>exports.Expanse.normalize(r[u],c))}e.normalize=o;function f(i,d){const{expanses:r}=i;return d.map((c,u)=>exports.Expanse.unnormalize(r[u],c))}e.unnormalize=f;function a(i,d){const{expanses:r}=i;if(d.length!=r.length){const c="The number of arrays does not match the number of expanses.";throw new Error(c)}for(let c=0;c<d.length;c++)exports.Expanse.train(r[c],d[c])}e.train=a;function l(i){return ExpanseContinuous.breaks(i)}e.breaks=l;function s(i){for(const d of i.expanses)exports.Expanse.reset(d)}e.reset=s})(ExpanseCompound||(ExpanseCompound={}));var ExpansePoint;(e=>{const t="point";function n(i=[]){const d="",r=exports.Expanse.base(),[c,u]=[!1,seqLength(0,i.length)],p={labels:i,ordered:c,order:u},x=structuredClone(p);return{...r,type:t,value:d,props:p,defaults:x,frozen:[]}}e.of=n,exports.Poly.set(exports.Expanse.normalize,t,o),exports.Poly.set(exports.Expanse.unnormalize,t,f),exports.Poly.set(exports.Expanse.train,t,a),exports.Poly.set(exports.Expanse.breaks,t,s),exports.Poly.set(exports.Expanse.reorder,t,l);function o(i,d){const{labels:r,order:c}=i.props,u=c[r.indexOf(d)];return u===-1?u:u/(r.length-1)}e.normalize=o;function f(i,d){const{labels:r,order:c}=i.props;return d=Math.round(d*(r.length-1)),r[c[d]]}e.unnormalize=f;function a(i,d,r){const{props:c,defaults:u}=i,{order:p}=c,x=Array.from(new Set(d)).sort(compareAlphaNumeric);if(!p.length){for(let S=0;S<x.length;S++)p[S]=S;u.order=[...p],c.ordered=!1}copyValues(x,c.labels),r!=null&&r.default&&copyValues(x,i.defaults.labels),exports.Expanse.set(i,()=>({}),r)}e.train=a;function l(i,d){const{props:r,defaults:c}=i,{order:u}=r;if(!d){copyValues(c.order,u),r.ordered=!1,Reactive.dispatch(i,"changed");return}copyValues(d,u),r.ordered=!0,Reactive.dispatch(i,"changed")}e.reorder=l;function s(i){const{labels:d,order:r}=i.props;return ordered(d,r)}e.breaks=s})(ExpansePoint||(ExpansePoint={}));var ExpanseSplit;(e=>{const t="split";function n(s){const i=[],d=s??ExpanseContinuous.of(),r=d.type;return{...d,value:i,type:t,innerType:r}}e.of=n,exports.Poly.set(exports.Expanse.normalize,t,o),exports.Poly.set(exports.Expanse.unnormalize,t,f),exports.Poly.set(exports.Expanse.train,t,a),exports.Poly.set(exports.Expanse.breaks,t,l);function o(s,i){const{innerType:d}=s,r=exports.Poly.dispatch(exports.Expanse.normalize,identity,d);return Array.isArray(i)?i.map(c=>r(s,c)):r(s,i)}e.normalize=o;function f(s,i){const{innerType:d}=s,r=exports.Poly.dispatch(exports.Expanse.unnormalize,identity,d);return Array.isArray(i)?i.map(c=>r(s,c)):r(s,i)}e.unnormalize=f;function a(s,i){const{innerType:d}=s;exports.Poly.dispatch(exports.Expanse.train,identity,d)(s,i)}e.train=a;function l(s){const{innerType:i}=s;return exports.Poly.dispatch(exports.Expanse.breaks,identity,i)(s)}e.breaks=l})(ExpanseSplit||(ExpanseSplit={}));const expanseMap={continuous:ExpanseContinuous,point:ExpansePoint,band:ExpanseBand,split:ExpanseSplit,compound:ExpanseCompound},scaleNames=["x","y","size","area","areaPct","width","height"];exports.Scales=void 0,(e=>{function t(o){const f={};for(const a of scaleNames)f[a]=exports.Scale.standard();for(const[a,[l,s]]of Object.entries(o??{}))f[a]=exports.Scale.of(expanseMap[l].of(),expanseMap[s].of());return f}e.of=t;function n(o,f,a){return{...o,[f]:a}}e.set=n})(exports.Scales||(exports.Scales={})),exports.Reducer=void 0,(Reducer=>{Reducer.sum={name:"sum",fallback:"count",initialfn:()=>0,reducefn:(e,t)=>e+t},Reducer.max={name:"max",initialfn:()=>-1/0,reducefn:(e,t)=>Math.max(e,t)},Reducer.product={name:"product",initialfn:()=>1,reducefn:(e,t)=>e*t},Reducer.table={name:"table",initialfn:()=>({}),reducefn:(e,t)=>(e[t]=e[t]+1||0,e)};function parse(value){if(typeof value=="string")return Reducer[value];if(typeof value.initialfn=="string"&&typeof value.reducefn=="string"){const parsed={name:value.name};return parsed.initialfn=eval(value.initialfn),parsed.reducefn=eval(value.reducefn),parsed}return value}Reducer.parse=parse;function reduce(e,t,n){const{indices:o,cardinality:f}=t,{initialfn:a,reducefn:l}=n,s=Array.from(Array(f),()=>a()),i=Getter.of(o),d=Getter.of(e);for(let u=0;u<o.length;u++){const p=i(u);s[p]=l(s[p],d(u))}const r=Reduced.of(s,t,n);Meta.copy(r,e);const c=getName(s,n)??"[unknown summary]";return Meta.set(r,{name:c,queryable:!0,reduced:!0}),r}Reducer.reduce=reduce;function getName(e,t){return Meta.has(e,"name")?`${t.name} of ${Meta.get(e,"name")}`:t.fallback}Reducer.getName=getName})(exports.Reducer||(exports.Reducer={}));var Summaries;(e=>{function t(a,l){const s=[];for(let i=0;i<l.length;i++){const d=l[i],r=n(a,d),c=Reactive.of()(merge(r,d.data));if(s.push(c),i>0)for(const u of Object.keys(r)){const p=s[i-1][u];Reduced.setParent(r[u],p)}Reactive.listen(d,"changed",()=>{const u=n(a,d);for(const p of Object.keys(u))copyValues(u[p],r[p]);for(const p of Reflect.ownKeys(d.data))copyValues(d.data[p],c[p])}),Reactive.propagate(d,c,"changed")}return s}e.of=t;function n(a,l){const s={};for(const[i,d]of Object.entries(a)){const[r,c]=d;s[i]=exports.Reducer.reduce(r,l,c)}return s}function o(a,l){const s=[];for(let i=0;i<a.length;i++){let d=function(c){const u=l[i](c),p=Reflect.ownKeys(c);for(const x of p)(typeof x=="symbol"||isIntegerString(x))&&(u[x]=c[x]);return u};const r=Reactive.of()(d(a[i]));s.push(r),Reactive.listen(a[i],"changed",()=>{const c=d(a[i]);for(const u of Reflect.ownKeys(c))Array.isArray(c[u])&&Array.isArray(r[u])&&copyValues(c[u],r[u]);Reactive.dispatch(r,"changed")})}return s}e.translate=o;function f(a,l){const s={};let i=0;for(const[d,r]of a)s[`q${i++}`]=[d(l),r];return s}e.formatQueries=f})(Summaries||(Summaries={}));function Barplot(e,t,n){const{data:o,marker:f}=e;let[a,l]=t(o);const s=l&&(n!=null&&n.reducer)?n.reducer:exports.Reducer.sum,i=l||(()=>1),d=exports.Factor.from(a),r=exports.Factor.product(d,f.factor),c=[d,r],u=n!=null&&n.queries?n.queries(o):{},p=[i,s],x=Summaries.of({stat:p,...u},c),S=exports.Scales.of({x:["band","continuous"]}),m={type:"bar",representation:"absolute"},b=Bars.of([],S),v=Object.assign(exports.Plot.of(x,S,m),{bars:b});return barplot$1(v),exports.Plot.addGeom(v,b),Reactive.listen(v,"normalize",()=>switchRepresentation$3(v)),v}function sortAxis$1(e,t){if(e.props.ordered)ExpanseBand.reorder(e);else{const n=orderIndices(t);ExpanseBand.reorder(e,n)}}function switchRepresentation$3(e){e.representation==="absolute"?spineplot(e):barplot$1(e)}function barplot$1(e){const{data:t,scales:n,bars:o}=e,f=Summaries.translate(t,[d=>({x:d.label,y:zero,height:d.stat,width:one}),d=>({x:d.label,y:zero,height:Reduced.stack(d.stat),width:one})]),[a]=f,l={default:!0,ratio:!0};exports.Scale.train(n.x,a.x,l),exports.Scale.train(n.y,a.height,l),exports.Scale.train(n.width,[0,1],l),exports.Scale.train(n.height,a.height,l),exports.Scale.freeze(n.y,["zero"]),exports.Scale.freeze(n.height,["zero"]),ExpanseBand.setWeights(n.x.domain);const s=1/new Set(a.x).size;exports.Scale.link(n.y,n.height);const i={scale:s,mult:.9,offset:0};return exports.Expanse.set(n.width.codomain,()=>i,{default:!0}),Meta.copy(n.y,a.height,["name"]),Reactive.removeAll(e,"reorder"),Reactive.listen(e,"reorder",()=>sortAxis$1(n.x.domain,a.height)),Geom.setCoordinates(o,f),e.representation="absolute",exports.Plot.render(e),exports.Plot.renderAxes(e),e}function spineplot(e){const{data:t,scales:n,bars:o}=e,f=Summaries.translate(t,[i=>({x:i.label,y:zero,height:one,width:i.stat}),i=>({x:i.label,y:zero,height:Reduced.normalize(Reduced.stack(i.stat),(d,r)=>d/r),width:Reduced.parent(i.stat)})]),[a]=f,l={default:!0,ratio:!0};exports.Scale.train(n.x,a.x,l),exports.Scale.train(n.y,[0,1],l),exports.Scale.train(n.width,cumsum(a.width),l),exports.Scale.train(n.height,[0,1],l),exports.Scale.freeze(n.y,["zero"]),exports.Scale.freeze(n.height,["zero"]),ExpanseBand.setWeights(n.x.domain,a.width),exports.Scale.link(n.y,n.height);const s={scale:1,mult:1,offset:-1};exports.Expanse.set(n.width.codomain,()=>s,{default:!0}),Meta.set(n.y,{name:"proportion"}),Reactive.removeAll(e,"reorder"),Reactive.listen(e,"reorder",()=>sortAxis$1(n.x.domain,a.width)),Geom.setCoordinates(o,f),e.representation="propotion",exports.Plot.render(e),exports.Plot.renderAxes(e)}function Bibarplot(e,t,n){const{data:o,marker:f}=e;let[a,l,s]=t(o);const i=exports.Reducer.sum,d=exports.Reducer.sum,r=s?l:()=>1,c=s||l,u=exports.Factor.from(a),p=exports.Factor.product(u,f.factor),x=[u,p],S=n!=null&&n.queries?n.queries(o):{},m=[r,i],b=[c,d],v=Summaries.of({stat1:m,stat2:b,...S},x),M=exports.Scales.of({x:["band","continuous"],heightUp:["continuous","continuous"],heightDown:["continuous","continuous"]});exports.Scale.shareCodomain(M.height,M.heightUp),exports.Scale.shareCodomain(M.height,M.heightDown),exports.Scale.set(M.heightUp,()=>({one:.4}),{default:!0}),exports.Scale.set(M.heightDown,()=>({one:-.4}),{default:!0});const R={type:"bar",representation:"absolute"},A={...M,height:M.heightUp},w={...M,height:M.heightDown},g=Bars.of([],A),k=Bars.of([],w),h={bars1:g,bars2:k},y=Object.assign(exports.Plot.of(v,M,R),h);return barplot(y),exports.Plot.addGeom(y,g),exports.Plot.addGeom(y,k),exports.Expanse.set(M.height.codomain,()=>({inv:identity}),{default:!0}),y}function sortAxis(e,t){if(e.props.ordered)ExpanseBand.reorder(e);else{const n=orderIndices(t);ExpanseBand.reorder(e,n)}}function barplot(e){const{data:t,scales:n,bars1:o,bars2:f}=e,a=Summaries.translate(t,[b=>({x:b.label,y:zero,height:b.stat1,width:one}),b=>({x:b.label,y:zero,height:Reduced.stack(b.stat1),width:one})]),l=Summaries.translate(t,[b=>({x:b.label,y:zero,height:b.stat2,width:one}),b=>({x:b.label,y:zero,height:Reduced.stack(b.stat2),width:one})]),[s]=a,i={default:!0,ratio:!0},{stat1:d,stat2:r}=t[0],c=Math.max(...d),u=Math.max(...r);exports.Scale.train(n.x,s.x,i),exports.Scale.train(n.y,[-1,1],{default:!0,ratio:!1}),exports.Scale.train(n.width,[0,1],i),exports.Scale.train(n.heightUp,[0,c],i),exports.Scale.train(n.heightDown,[0,u],i),console.log(n.heightDown.codomain.props),console.log(exports.Scale.pushforward(n.heightDown,1)),ExpanseBand.setWeights(n.x.domain);const[p,x]=[d,r].map(b=>Meta.get(b,"name"));Meta.set(n.y,{name:`${x} / ${p}`});const m={scale:1/new Set(s.x).size,mult:.9,offset:0};return exports.Expanse.set(n.width.codomain,()=>m,{default:!0}),Reactive.removeAll(e,"reorder"),Reactive.listen(e,"reorder",()=>sortAxis(n.x.domain,s.height)),Geom.setCoordinates(o,a),Geom.setCoordinates(f,l),e.representation="absolute",exports.Plot.render(e),exports.Plot.renderAxes(e),e}function Fluctuationplot(e,t,n){const{data:o,marker:f}=e;let[a,l,s]=t(o);const i=s&&(n!=null&&n.reducer)?n.reducer:exports.Reducer.sum,d=s?[...s]:()=>1,r=exports.Factor.product(exports.Factor.from(a),exports.Factor.from(l)),c=exports.Factor.product(r,f.factor),u=[r,c],p=n!=null&&n.queries?n.queries(o):{},x=[d,i],S=Summaries.of({stat:x,...p},u),m=exports.Scales.of({x:["band","continuous"],y:["band","continuous"]}),b={type:"fluct",representation:"absolute"},v=Bars.of([],m,{vAnchor:VAnchor.Middle}),M=Object.assign(exports.Plot.of(S,m,b),{bars:v});return exports.Scale.shareCodomain(m.area,m.width),exports.Scale.shareCodomain(m.area,m.height),fluctplot(M),exports.Plot.addGeom(M,v),Reactive.listen(M,"normalize",()=>switchRepresentation$2(M)),M}function switchRepresentation$2(e){e.representation==="absolute"?pctfluctplot(e):fluctplot(e)}function fluctplot(e){const{data:t,scales:n,bars:o}=e,f=Summaries.translate(t,[d=>({x:d.label,y:d.label$,height:d.stat,width:d.stat}),d=>({x:d.label,y:d.label$,height:Reduced.stack(d.stat),width:Reduced.stack(d.stat)})]),[a]=f,l={default:!0,ratio:!0};exports.Scale.train(n.x,a.x,l),exports.Scale.train(n.y,a.y,l),exports.Scale.train(n.width,a.width,l),exports.Scale.train(n.height,a.height,l);const i={scale:1/max(new Set(a.x).size,new Set(a.y).size),mult:.9,offset:0};exports.Expanse.set(n.area.codomain,()=>i,{default:!0}),Geom.setCoordinates(o,f),e.representation="absolute",exports.Plot.render(e)}function pctfluctplot(e){const{data:t,scales:n,bars:o}=e,f=Summaries.translate(t,[d=>({x:d.label,y:d.label$,height:one,width:one}),d=>({x:d.label,y:d.label$,height:Reduced.normalize(Reduced.stack(d.stat),(r,c)=>r/c),width:Reduced.normalize(Reduced.stack(d.stat),(r,c)=>r/c)})]),[a]=f,l={default:!0,ratio:!0};exports.Scale.train(n.x,a.x,l),exports.Scale.train(n.y,a.y,l),exports.Scale.train(n.width,[0,1],l),exports.Scale.train(n.height,[0,1],l);const i={scale:1/max(new Set(a.x).size,new Set(a.y).size),mult:.9,offset:-1};exports.Expanse.set(n.area.codomain,()=>i,{default:!0}),Geom.setCoordinates(o,f),e.representation="propotion",exports.Plot.render(e)}var Rectangles;(e=>{const t="rectangles";function n(l,s){return Geom.of({type:t,coordinates:l,scales:s})}e.of=n,exports.Poly.set(Geom.render,t,o),exports.Poly.set(Geom.check,t,f),exports.Poly.set(Geom.query,t,a);function o(l,s){const{scales:i}=l,d=Geom.groupedData(l),r=findLength(Object.values(d)),[c,u,p,x,S]=Geom.scaledArrays(r,[[d.x0,i.x],[d.y0,i.y],[d.x1,i.x],[d.y1,i.y],[d.area,i.areaPct]]),m=Geom.frames(r,d[LAYER],s);Frame.rectanglesXY(m,c,u,p,x,S)}e.render=o;function f(l,s){const{scales:i}=l,d=Geom.flatData(l),r=findLength(Object.values(d)),{x0:c,y0:u,x1:p,y1:x,area:S}=Getter.mapObject(d),m=Getter.of(d[exports.Factor.POSITIONS]),b=[];for(let v=0;v<r;v++){let M=exports.Scale.pushforward(i.x,c(v)),R=exports.Scale.pushforward(i.y,u(v)),A=exports.Scale.pushforward(i.x,p(v)),w=exports.Scale.pushforward(i.y,x(v));if(d.area){const g=exports.Scale.pushforward(i.areaPct,S(v)),k=A-M,h=w-R;M=M+(1-g)/2*k,A=A-(1-g)/2*k,R=R+(1-g)/2*h,w=w-(1-g)/2*h}if(rectsIntersect(s,[M,R,A,w])){const g=m(v);for(let k=0;k<g.length;k++)b.push(g[k])}}return b}e.check=f;function a(l,s){var b;const{scales:i}=l,d=Geom.flatData(l),r=Geom.groupedData(l),c=findLength(Object.values(d)),{x0:u,y0:p,x1:x,y1:S,area:m}=Getter.mapObject(d);for(let v=0;v<c;v++){let M=exports.Scale.pushforward(i.x,u(v)),R=exports.Scale.pushforward(i.y,p(v)),A=exports.Scale.pushforward(i.x,x(v)),w=exports.Scale.pushforward(i.y,S(v));if(d.area){const g=exports.Scale.pushforward(i.areaPct,m(v)),k=A-M,h=w-R;M=M+(1-g)/2*k,A=A-(1-g)/2*k,R=R+(1-g)/2*h,w=w-(1-g)/2*h}if(pointInRect(s,[M,R,A,w])){const g=(b=d[exports.Factor.CHILD_INDICES])==null?void 0:b[v];return Geom.getQueryInfo(r,g)}}}e.query=a})(Rectangles||(Rectangles={}));function Histogram(e,t,n){const{data:o,marker:f}=e;let[a,l]=t(o);const s=l&&(n!=null&&n.reducer)?n.reducer:exports.Reducer.sum,i=l||(()=>1),[d,r]=minmax(a),c=r-d,u=Reactive.of()({anchor:d,width:c/15}),p=exports.Factor.mono(a.length),x=exports.Factor.product(p,exports.Factor.bin(a,u)),S=exports.Factor.product(x,f.factor),m=[p,x,S],b=n!=null&&n.queries?n.queries(o):{},v=[i,s],M=Summaries.of({stat:v,...b},m),R=exports.Scales.of(),A={type:"histo",representation:"absolute"},w=Rectangles.of([],R),g=Object.assign(exports.Plot.of(M,R,A),{rectangles:w});histogram(g),exports.Plot.addGeom(g,w),Reactive.listen(g,"normalize",()=>switchRepresentation$1(g));const k=c/10;return Reactive.listen(g,"set-parameters",h=>{h&&(h.width&&Reactive.set(u,y=>y.width=h.width),h.anchor&&Reactive.set(u,y=>y.anchor=h.anchor))}),Reactive.listen(g,"grow",()=>Reactive.set(u,h=>h.width*=1.1111111111111112)),Reactive.listen(g,"shrink",()=>Reactive.set(u,h=>h.width*=.9)),Reactive.listen(g,"increment-anchor",()=>Reactive.set(u,h=>h.anchor+=k)),Reactive.listen(g,"decrement-anchor",()=>Reactive.set(u,h=>h.anchor-=k)),Reactive.listen(g,"reset",()=>{Reactive.set(u,h=>(h.anchor=d,h.width=c/15))}),g}function switchRepresentation$1(e){e.representation==="absolute"?spinogram(e):histogram(e)}function histogram(e){const{data:t,rectangles:n}=e,o=Summaries.translate(t,[l=>l,l=>({x0:l.binMin,y0:zero,x1:l.binMax,y1:l.stat}),l=>({x0:l.binMin,y0:zero,x1:l.binMax,y1:Reduced.stack(l.stat)})]),{scales:f}=e,[,a]=o;exports.Scale.train(f.x,a.x1,{default:!0,name:!1}),exports.Scale.train(f.y,a.y1,{default:!0,ratio:!0}),exports.Scale.freeze(f.y,["zero"]),Reactive.removeAll(n.coordinates[1],"changed"),Reactive.listen(o[1],"changed",()=>{exports.Scale.train(f.x,a.x1,{default:!0,name:!1}),exports.Scale.train(f.y,a.y1,{default:!0,ratio:!0})}),Meta.copy(f.x,t[1].breaks,["name"]),Meta.copy(f.y,a.y1,["name"]),Geom.setCoordinates(n,o),e.representation="absolute",exports.Plot.render(e),exports.Plot.renderAxes(e)}function spinogram(e){const{data:t,rectangles:n}=e,o=Summaries.translate(t,[l=>l,l=>({x0:Reduced.shiftLeft(Reduced.stack(l.stat)),y0:zero,x1:Reduced.stack(l.stat),y1:one}),l=>({x0:Reduced.shiftLeft(Reduced.stack(Reduced.parent(l.stat))),y0:zero,x1:Reduced.stack(Reduced.parent(l.stat)),y1:Reduced.normalize(Reduced.stack(l.stat),(s,i)=>s/i),query1:l.binMin,query2:l.binMax})]),{scales:f}=e,[,a]=o;exports.Scale.train(f.x,[0,...a.x1],{default:!0,name:!1}),exports.Scale.train(f.y,[0,1],{default:!0,ratio:!0}),exports.Scale.freeze(f.y,["zero"]),Reactive.removeAll(n.coordinates[1],"changed"),Reactive.listen(o[1],"changed",()=>{exports.Scale.train(f.x,[0,...a.x1],{default:!0,name:!1})}),Meta.set(f.x,{name:"cumulative count"}),Meta.set(f.y,{name:"proportion"}),Geom.setCoordinates(n,o),e.representation="propotion",exports.Plot.render(e),exports.Plot.renderAxes(e)}function Histogram2d(e,t,n){const{data:o,marker:f}=e;let[a,l,s]=t(o);const i=s&&(n!=null&&n.reducer)?n.reducer:exports.Reducer.sum,d=s||(()=>1),[r,c]=minmax(a),[u,p]=minmax(l),[x,S]=[c-r,p-u],m=Reactive.of()({anchor:r,width:x/15}),b=Reactive.of()({anchor:u,width:S/15}),v=exports.Factor.bin(a,m),M=exports.Factor.bin(l,b),R=exports.Factor.product(v,M),A=exports.Factor.product(R,f.factor),w=[R,A],g=n!=null&&n.queries?n.queries(o):{},k=[d,i],h=Summaries.of({stat:k,...g},w),y=exports.Scales.of(),z={type:"histo2d",representation:"absolute"},C=Rectangles.of([],y),T=Object.assign(exports.Plot.of(h,y,z),{rectangles:C});return histogram2d(T),exports.Plot.addGeom(T,C),Reactive.listen(T,"normalize",()=>switchRepresentation(T)),Reactive.listen(T,"set-parameters",O=>{O&&(O.width1&&Reactive.set(m,_=>_.width=O.width1),O.anchor1&&Reactive.set(m,_=>_.anchor=O.anchor1),O.width2&&Reactive.set(b,_=>_.width=O.width2),O.anchor2&&Reactive.set(b,_=>_.anchor=O.anchor2))}),Reactive.listen(T,"grow",()=>{Reactive.set(m,O=>O.width*=1.1111111111111112),Reactive.set(b,O=>O.width*=1.1111111111111112)}),Reactive.listen(T,"shrink",()=>{Reactive.set(m,O=>O.width*=.9),Reactive.set(b,O=>O.width*=.9)}),Reactive.listen(T,"reset",()=>{Reactive.set(m,O=>(O.anchor=r,O.width=x/15)),Reactive.set(b,O=>(O.anchor=u,O.width=S/15))}),T}function switchRepresentation(e){e.representation==="absolute"?spinogram2d(e):histogram2d(e)}function histogram2d(e){const{data:t,rectangles:n}=e,o=Summaries.translate(t,[l=>({x0:l.binMin,y0:l.binMin$,x1:l.binMax,y1:l.binMax$,area:l.stat}),l=>({x0:l.binMin,y0:l.binMin$,x1:l.binMax,y1:l.binMax$,area:Reduced.stack(l.stat)})]),{scales:f}=e,[,a]=o;exports.Scale.train(f.x,a.x1,{default:!0}),exports.Scale.train(f.y,a.y1,{default:!0}),exports.Scale.train(f.areaPct,a.area,{default:!0}),exports.Expanse.set(f.area.codomain,()=>({min:0,max:1}),{default:!0}),exports.Expanse.freeze(f.area.codomain,["min","max"]),Reactive.removeAll(n.coordinates[0],"changed"),Reactive.listen(o[0],"changed",()=>{exports.Scale.train(f.x,a.x1,{default:!0,name:!1}),exports.Scale.train(f.y,a.y1,{default:!0,name:!1}),exports.Scale.train(f.areaPct,a.area,{default:!0})}),e.representation="absolute",Geom.setCoordinates(n,o),Meta.copy(f.x,t[1].breaks,["name"]),Meta.copy(f.y,t[1].breaks$,["name"]),exports.Plot.render(e),exports.Plot.renderAxes(e)}function spinogram2d(e){const{data:t,rectangles:n}=e,o=Summaries.translate(t,[l=>({x0:l.binMin,y0:l.binMin$,x1:l.binMax,y1:l.binMax$,area:one}),l=>({x0:l.binMin,y0:l.binMin$,x1:l.binMax,y1:l.binMax$,area:Reduced.normalize(Reduced.stack(l.stat),(s,i)=>s/i)})]),{scales:f}=e,[,a]=o;exports.Scale.train(f.x,a.x1,{default:!0}),exports.Scale.train(f.y,a.y1,{default:!0}),exports.Scale.train(f.areaPct,[0,1],{default:!0}),exports.Expanse.set(f.area.codomain,()=>({min:0,max:1}),{default:!0}),exports.Expanse.freeze(f.area.codomain,["min","max"]),Reactive.removeAll(n.coordinates[0],"changed"),Reactive.listen(o[0],"changed",()=>{exports.Scale.train(f.x,a.x1,{default:!0,name:!1}),exports.Scale.train(f.y,a.y1,{default:!0,name:!1})}),e.representation="propotion",Geom.setCoordinates(n,o),Meta.copy(f.x,t[1].breaks,["name"]),Meta.copy(f.y,t[1].breaks$,["name"]),exports.Plot.render(e),exports.Plot.renderAxes(e)}var Lines;(e=>{const t="lines";function n(l,s){return Geom.of({type:t,coordinates:l,scales:s})}e.of=n,exports.Poly.set(Geom.render,t,o),exports.Poly.set(Geom.check,t,f),exports.Poly.set(Geom.query,t,a);function o(l,s){const{scales:i}=l,d=Geom.groupedData(l),r=findLength(Object.values(d)),[c,u]=Geom.scaledArrays(r,[[d.x,i.x],[d.y,i.y]]),p=Geom.frames(r,d[LAYER],s);Frame.lines(p,c,u)}e.render=o;function f(l,s){const{scales:i}=l,d=Geom.flatData(l),r=findLength(Object.values(d)),{x:c,y:u}=Getter.mapObject(d),p=Getter.of(d[exports.Factor.POSITIONS]),x=[];for(let S=0;S<r;S++){const m=exports.Scale.pushforward(i.x,c(S)),b=exports.Scale.pushforward(i.y,u(S));for(let v=1;v<m.length;v++){const M=[m[v-1],b[v-1],m[v],b[v]];if(rectSegmentIntersect(s,M)){const R=p(S);for(let A=0;A<R.length;A++)x.push(R[A])}}}return x}e.check=f;function a(l,s){var S;let{scales:i}=l;const d=Geom.flatData(l),r=Geom.groupedData(l),c=findLength(Object.values(d)),{x:u,y:p}=Getter.mapObject(d),x=bimap([...s,...s],[-1,-1,1,1],sum);for(let m=0;m<c;m++){const b=exports.Scale.pushforward(i.x,u(m)),v=exports.Scale.pushforward(i.y,p(m));for(let M=1;M<b.length;M++){const R=[b[M-1],v[M-1],b[M],v[M]];if(rectSegmentIntersect(x,R)){const A=(S=d[exports.Factor.CHILD_INDICES])==null?void 0:S[m],w=u(m),g=p(m),k={};for(let y=0;y<w.length;y++)k[w[y]]=g[y];const h=A[0];return k[LAYER]=Getter.of(r[LAYER])(h),[k]}}}}e.query=a})(Lines||(Lines={}));function inferExpanse(e,t={train:!0}){const o=isNumberArray(e)?ExpanseContinuous.of():ExpansePoint.of();return t.train&&exports.Expanse.train(o,e),o}function Pcoordsplot(e,t,n){const{data:o,marker:f}=e,a=t(o),l=a.map(M=>Meta.get(M,"name")),s=Getter.constant(l),i=Getter.multi(a),d=n!=null&&n.queries?n.queries(o):{},r=exports.Factor.bijection(a[0].length,{x:s,y:i,...d}),c=exports.Factor.product(r,f.factor),u=Summaries.of({},[r,c]),p=exports.Scales.of({x:["split","split"],y:["compound","split"]}),x={type:"pcoords",representation:"absolute"},S=Summaries.translate(u,[M=>M,M=>M]),m=Lines.of(S,p),b=Object.assign(exports.Plot.of(u,p,x),{lines:m});exports.Plot.addGeom(b,m);const v=a.map(M=>inferExpanse(M));return p.x.domain=ExpanseSplit.of(ExpansePoint.of(l)),p.y.domain=ExpanseCompound.of(v),Meta.set(p.x,{name:"variable"}),Meta.set(p.y,{name:"value"}),b}var Points;(e=>{const t="points";function n(l,s){return Geom.of({type:t,coordinates:l,scales:s})}e.of=n,exports.Poly.set(Geom.render,t,o),exports.Poly.set(Geom.check,t,f),exports.Poly.set(Geom.query,t,a);function o(l,s){const{scales:i}=l,d=Geom.groupedData(l),r=findLength(Object.values(d)),[c,u,p]=Geom.scaledArrays(r,[[d.x,i.x],[d.y,i.y],[d.size,i.size]]),x=Geom.frames(r,d[LAYER],s);Frame.points(x,c,u,p)}e.render=o;function f(l,s){const{scales:i}=l,d=Geom.flatData(l),r=findLength(Object.values(d)),{x:c,y:u,size:p}=Getter.mapObject(d),x=Getter.of(d[exports.Factor.POSITIONS]),S=[];for(let m=0;m<r;m++){const b=exports.Scale.pushforward(i.x,c(m)),v=exports.Scale.pushforward(i.y,u(m));let M=exports.Scale.pushforward(i.size,p(m));M=M/Math.sqrt(2);const R=[b-M,v-M,b+M,v+M];if(rectsIntersect(s,R)){const A=x(m);for(let w=0;w<A.length;w++)S.push(A[w])}}return S}e.check=f;function a(l,s){var S;const{scales:i}=l,d=Geom.flatData(l),r=Geom.groupedData(l),c=findLength(Object.values(d)),{x:u,y:p,size:x}=Getter.mapObject(d);for(let m=0;m<c;m++){const b=exports.Scale.pushforward(i.x,u(m)),v=exports.Scale.pushforward(i.y,p(m));let M=exports.Scale.pushforward(i.size,x(m));M=M/Math.sqrt(2);const R=[b-M,v-M,b+M,v+M];if(pointInRect(s,R)){const A=(S=d[exports.Factor.CHILD_INDICES])==null?void 0:S[m];return Geom.getQueryInfo(r,A)}}}e.query=a})(Points||(Points={}));function Scatterplot(e,t,n){const{data:o,marker:f}=e,[a,l,s]=t(o),i=n!=null&&n.queries?n==null?void 0:n.queries(o):{},d={x:a,y:l,size:s??(()=>.5),...i},r=exports.Factor.bijection(a.length,d),c=exports.Factor.product(r,f.factor),u=Summaries.of({},[r,c]),p=Summaries.translate(u,[v=>v,v=>v]),x=exports.Scales.of(),S=exports.Plot.of(u,x,{ratio:n==null?void 0:n.ratio});exports.Scale.train(x.x,a,{default:!0}),exports.Scale.train(x.y,l,{default:!0}),s&&exports.Scale.train(x.size,s,{default:!0});const m=30/Math.log(a.length+2);exports.Expanse.set(x.size.codomain,()=>({max:m}),{default:!0});const b=Points.of(p,x);return exports.Plot.addGeom(S,b),S}const defaultOptions={size:10,expandX:.1,expandY:.1,gapPct:.8,gapPx:1,axisLabelSize:1,axisTitleSize:1.25,margins:[0,0,0,0],marginLines:[3.5,3.5,1,1],colors:["#FF7F00","#E31A1C","#33A02C","#1F78B4","#FDBF6F","#FB9A99","#B2DF8A","#A6CEE3"],plotBackground:"#fefffe"};function renderAxisLabels(e){renderSingleAxisLabels(e,"x"),renderSingleAxisLabels(e,"y")}function renderSingleAxisLabels(e,t){const{frames:n,scales:o,options:f}=e,{margins:a,marginLines:l}=f,s=o[t],i=t==="x"?o.y:o.x,d=n[`${t}Axis`],{context:r}=d,{labels:c,positions:u}=exports.Scale.breaks(s),[p,x,S,m]=a,b=parseInt(r.font.match(/^[0-9]*/)[0],10),v=i.codomain.props.min-b/2,{width:M,height:R}=d;if(Frame.clear(d),t==="x"){let[A,w]=[0,0];for(let g=0;g<c.length;g++){const k=c[g],h=u[g],y=Frame.textWidth(d,k)+1;outside(h,x,M-m)||overlap(A,h,w,y)||([A,w]=[h,y],Frame.text(d,h,v,k))}}else if(t==="y"){let[A,w]=[0,0];for(let g=0;g<c.length;g++){const k=c[g],h=u[g],y=Frame.textWidth(d,k)+1,z=Frame.textHeight(d,k)+1;if(!outside(h,p,R-S)&&!overlap(A,h,w,z)){for(;a[1]/2<y+z;)l[1]*=1.01,exports.Plot.resize(e);[A,w]=[h,z],Frame.text(d,v,h,k)}}}}function renderAxisTitles(e){renderSingleAxisTitle(e,"x"),renderSingleAxisTitle(e,"y")}function renderSingleAxisTitle(e,t){const{scales:n,frames:o,options:f}=e,{margins:a}=f,l=n[t],s=t==="x"?e.scales.y:e.scales.x,i=o.base,d=Meta.get(l,"name"),r=t==="x"?a[0]:a[1],c=exports.Expanse.unnormalize(l.codomain,.5),u=exports.Expanse.unnormalize(s.codomain,0)-r*2/3;t==="x"&&Frame.text(i,c,u,d),t==="y"&&Frame.text(i,u,c,d,{vertical:!0})}function outside(e,t,n){return e<t||e>n}function overlap(e,t,n,o){const[f,a]=[e-n/2,e+n/2],[l,s]=[t-o/2,t+o/2];return f<s&&a>=l}function _typeof(e){"@babel/helpers - typeof";return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(e)}var trimLeft=/^\s+/,trimRight=/\s+$/;function tinycolor(e,t){if(e=e||"",t=t||{},e instanceof tinycolor)return e;if(!(this instanceof tinycolor))return new tinycolor(e,t);var n=inputToRGB(e);this._originalInput=e,this._r=n.r,this._g=n.g,this._b=n.b,this._a=n.a,this._roundA=Math.round(100*this._a)/100,this._format=t.format||n.format,this._gradientType=t.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=n.ok}tinycolor.prototype={isDark:function e(){return this.getBrightness()<128},isLight:function e(){return!this.isDark()},isValid:function e(){return this._ok},getOriginalInput:function e(){return this._originalInput},getFormat:function e(){return this._format},getAlpha:function e(){return this._a},getBrightness:function e(){var t=this.toRgb();return(t.r*299+t.g*587+t.b*114)/1e3},getLuminance:function e(){var t=this.toRgb(),n,o,f,a,l,s;return n=t.r/255,o=t.g/255,f=t.b/255,n<=.03928?a=n/12.92:a=Math.pow((n+.055)/1.055,2.4),o<=.03928?l=o/12.92:l=Math.pow((o+.055)/1.055,2.4),f<=.03928?s=f/12.92:s=Math.pow((f+.055)/1.055,2.4),.2126*a+.7152*l+.0722*s},setAlpha:function e(t){return this._a=boundAlpha(t),this._roundA=Math.round(100*this._a)/100,this},toHsv:function e(){var t=rgbToHsv(this._r,this._g,this._b);return{h:t.h*360,s:t.s,v:t.v,a:this._a}},toHsvString:function e(){var t=rgbToHsv(this._r,this._g,this._b),n=Math.round(t.h*360),o=Math.round(t.s*100),f=Math.round(t.v*100);return this._a==1?"hsv("+n+", "+o+"%, "+f+"%)":"hsva("+n+", "+o+"%, "+f+"%, "+this._roundA+")"},toHsl:function e(){var t=rgbToHsl(this._r,this._g,this._b);return{h:t.h*360,s:t.s,l:t.l,a:this._a}},toHslString:function e(){var t=rgbToHsl(this._r,this._g,this._b),n=Math.round(t.h*360),o=Math.round(t.s*100),f=Math.round(t.l*100);return this._a==1?"hsl("+n+", "+o+"%, "+f+"%)":"hsla("+n+", "+o+"%, "+f+"%, "+this._roundA+")"},toHex:function e(t){return rgbToHex(this._r,this._g,this._b,t)},toHexString:function e(t){return"#"+this.toHex(t)},toHex8:function e(t){return rgbaToHex(this._r,this._g,this._b,this._a,t)},toHex8String:function e(t){return"#"+this.toHex8(t)},toRgb:function e(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function e(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function e(){return{r:Math.round(bound01(this._r,255)*100)+"%",g:Math.round(bound01(this._g,255)*100)+"%",b:Math.round(bound01(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function e(){return this._a==1?"rgb("+Math.round(bound01(this._r,255)*100)+"%, "+Math.round(bound01(this._g,255)*100)+"%, "+Math.round(bound01(this._b,255)*100)+"%)":"rgba("+Math.round(bound01(this._r,255)*100)+"%, "+Math.round(bound01(this._g,255)*100)+"%, "+Math.round(bound01(this._b,255)*100)+"%, "+this._roundA+")"},toName:function e(){return this._a===0?"transparent":this._a<1?!1:hexNames[rgbToHex(this._r,this._g,this._b,!0)]||!1},toFilter:function e(t){var n="#"+rgbaToArgbHex(this._r,this._g,this._b,this._a),o=n,f=this._gradientType?"GradientType = 1, ":"";if(t){var a=tinycolor(t);o="#"+rgbaToArgbHex(a._r,a._g,a._b,a._a)}return"progid:DXImageTransform.Microsoft.gradient("+f+"startColorstr="+n+",endColorstr="+o+")"},toString:function e(t){var n=!!t;t=t||this._format;var o=!1,f=this._a<1&&this._a>=0,a=!n&&f&&(t==="hex"||t==="hex6"||t==="hex3"||t==="hex4"||t==="hex8"||t==="name");return a?t==="name"&&this._a===0?this.toName():this.toRgbString():(t==="rgb"&&(o=this.toRgbString()),t==="prgb"&&(o=this.toPercentageRgbString()),(t==="hex"||t==="hex6")&&(o=this.toHexString()),t==="hex3"&&(o=this.toHexString(!0)),t==="hex4"&&(o=this.toHex8String(!0)),t==="hex8"&&(o=this.toHex8String()),t==="name"&&(o=this.toName()),t==="hsl"&&(o=this.toHslString()),t==="hsv"&&(o=this.toHsvString()),o||this.toHexString())},clone:function e(){return tinycolor(this.toString())},_applyModification:function e(t,n){var o=t.apply(null,[this].concat([].slice.call(n)));return this._r=o._r,this._g=o._g,this._b=o._b,this.setAlpha(o._a),this},lighten:function e(){return this._applyModification(_lighten,arguments)},brighten:function e(){return this._applyModification(_brighten,arguments)},darken:function e(){return this._applyModification(_darken,arguments)},desaturate:function e(){return this._applyModification(_desaturate,arguments)},saturate:function e(){return this._applyModification(_saturate,arguments)},greyscale:function e(){return this._applyModification(_greyscale,arguments)},spin:function e(){return this._applyModification(_spin,arguments)},_applyCombination:function e(t,n){return t.apply(null,[this].concat([].slice.call(n)))},analogous:function e(){return this._applyCombination(_analogous,arguments)},complement:function e(){return this._applyCombination(_complement,arguments)},monochromatic:function e(){return this._applyCombination(_monochromatic,arguments)},splitcomplement:function e(){return this._applyCombination(_splitcomplement,arguments)},triad:function e(){return this._applyCombination(polyad,[3])},tetrad:function e(){return this._applyCombination(polyad,[4])}},tinycolor.fromRatio=function(e,t){if(_typeof(e)=="object"){var n={};for(var o in e)e.hasOwnProperty(o)&&(o==="a"?n[o]=e[o]:n[o]=convertToPercentage(e[o]));e=n}return tinycolor(e,t)};function inputToRGB(e){var t={r:0,g:0,b:0},n=1,o=null,f=null,a=null,l=!1,s=!1;return typeof e=="string"&&(e=stringInputToObject(e)),_typeof(e)=="object"&&(isValidCSSUnit(e.r)&&isValidCSSUnit(e.g)&&isValidCSSUnit(e.b)?(t=rgbToRgb(e.r,e.g,e.b),l=!0,s=String(e.r).substr(-1)==="%"?"prgb":"rgb"):isValidCSSUnit(e.h)&&isValidCSSUnit(e.s)&&isValidCSSUnit(e.v)?(o=convertToPercentage(e.s),f=convertToPercentage(e.v),t=hsvToRgb(e.h,o,f),l=!0,s="hsv"):isValidCSSUnit(e.h)&&isValidCSSUnit(e.s)&&isValidCSSUnit(e.l)&&(o=convertToPercentage(e.s),a=convertToPercentage(e.l),t=hslToRgb(e.h,o,a),l=!0,s="hsl"),e.hasOwnProperty("a")&&(n=e.a)),n=boundAlpha(n),{ok:l,format:e.format||s,r:Math.min(255,Math.max(t.r,0)),g:Math.min(255,Math.max(t.g,0)),b:Math.min(255,Math.max(t.b,0)),a:n}}function rgbToRgb(e,t,n){return{r:bound01(e,255)*255,g:bound01(t,255)*255,b:bound01(n,255)*255}}function rgbToHsl(e,t,n){e=bound01(e,255),t=bound01(t,255),n=bound01(n,255);var o=Math.max(e,t,n),f=Math.min(e,t,n),a,l,s=(o+f)/2;if(o==f)a=l=0;else{var i=o-f;switch(l=s>.5?i/(2-o-f):i/(o+f),o){case e:a=(t-n)/i+(t<n?6:0);break;case t:a=(n-e)/i+2;break;case n:a=(e-t)/i+4;break}a/=6}return{h:a,s:l,l:s}}function hslToRgb(e,t,n){var o,f,a;e=bound01(e,360),t=bound01(t,100),n=bound01(n,100);function l(d,r,c){return c<0&&(c+=1),c>1&&(c-=1),c<.16666666666666666?d+(r-d)*6*c:c<.5?r:c<.6666666666666666?d+(r-d)*(.6666666666666666-c)*6:d}if(t===0)o=f=a=n;else{var s=n<.5?n*(1+t):n+t-n*t,i=2*n-s;o=l(i,s,e+.3333333333333333),f=l(i,s,e),a=l(i,s,e-.3333333333333333)}return{r:o*255,g:f*255,b:a*255}}function rgbToHsv(e,t,n){e=bound01(e,255),t=bound01(t,255),n=bound01(n,255);var o=Math.max(e,t,n),f=Math.min(e,t,n),a,l,s=o,i=o-f;if(l=o===0?0:i/o,o==f)a=0;else{switch(o){case e:a=(t-n)/i+(t<n?6:0);break;case t:a=(n-e)/i+2;break;case n:a=(e-t)/i+4;break}a/=6}return{h:a,s:l,v:s}}function hsvToRgb(e,t,n){e=bound01(e,360)*6,t=bound01(t,100),n=bound01(n,100);var o=Math.floor(e),f=e-o,a=n*(1-t),l=n*(1-f*t),s=n*(1-(1-f)*t),i=o%6,d=[n,l,a,a,s,n][i],r=[s,n,n,l,a,a][i],c=[a,a,s,n,n,l][i];return{r:d*255,g:r*255,b:c*255}}function rgbToHex(e,t,n,o){var f=[pad2(Math.round(e).toString(16)),pad2(Math.round(t).toString(16)),pad2(Math.round(n).toString(16))];return o&&f[0].charAt(0)==f[0].charAt(1)&&f[1].charAt(0)==f[1].charAt(1)&&f[2].charAt(0)==f[2].charAt(1)?f[0].charAt(0)+f[1].charAt(0)+f[2].charAt(0):f.join("")}function rgbaToHex(e,t,n,o,f){var a=[pad2(Math.round(e).toString(16)),pad2(Math.round(t).toString(16)),pad2(Math.round(n).toString(16)),pad2(convertDecimalToHex(o))];return f&&a[0].charAt(0)==a[0].charAt(1)&&a[1].charAt(0)==a[1].charAt(1)&&a[2].charAt(0)==a[2].charAt(1)&&a[3].charAt(0)==a[3].charAt(1)?a[0].charAt(0)+a[1].charAt(0)+a[2].charAt(0)+a[3].charAt(0):a.join("")}function rgbaToArgbHex(e,t,n,o){var f=[pad2(convertDecimalToHex(o)),pad2(Math.round(e).toString(16)),pad2(Math.round(t).toString(16)),pad2(Math.round(n).toString(16))];return f.join("")}tinycolor.equals=function(e,t){return!e||!t?!1:tinycolor(e).toRgbString()==tinycolor(t).toRgbString()},tinycolor.random=function(){return tinycolor.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})};function _desaturate(e,t){t=t===0?0:t||10;var n=tinycolor(e).toHsl();return n.s-=t/100,n.s=clamp01(n.s),tinycolor(n)}function _saturate(e,t){t=t===0?0:t||10;var n=tinycolor(e).toHsl();return n.s+=t/100,n.s=clamp01(n.s),tinycolor(n)}function _greyscale(e){return tinycolor(e).desaturate(100)}function _lighten(e,t){t=t===0?0:t||10;var n=tinycolor(e).toHsl();return n.l+=t/100,n.l=clamp01(n.l),tinycolor(n)}function _brighten(e,t){t=t===0?0:t||10;var n=tinycolor(e).toRgb();return n.r=Math.max(0,Math.min(255,n.r-Math.round(255*-(t/100)))),n.g=Math.max(0,Math.min(255,n.g-Math.round(255*-(t/100)))),n.b=Math.max(0,Math.min(255,n.b-Math.round(255*-(t/100)))),tinycolor(n)}function _darken(e,t){t=t===0?0:t||10;var n=tinycolor(e).toHsl();return n.l-=t/100,n.l=clamp01(n.l),tinycolor(n)}function _spin(e,t){var n=tinycolor(e).toHsl(),o=(n.h+t)%360;return n.h=o<0?360+o:o,tinycolor(n)}function _complement(e){var t=tinycolor(e).toHsl();return t.h=(t.h+180)%360,tinycolor(t)}function polyad(e,t){if(isNaN(t)||t<=0)throw new Error("Argument to polyad must be a positive number");for(var n=tinycolor(e).toHsl(),o=[tinycolor(e)],f=360/t,a=1;a<t;a++)o.push(tinycolor({h:(n.h+a*f)%360,s:n.s,l:n.l}));return o}function _splitcomplement(e){var t=tinycolor(e).toHsl(),n=t.h;return[tinycolor(e),tinycolor({h:(n+72)%360,s:t.s,l:t.l}),tinycolor({h:(n+216)%360,s:t.s,l:t.l})]}function _analogous(e,t,n){t=t||6,n=n||30;var o=tinycolor(e).toHsl(),f=360/n,a=[tinycolor(e)];for(o.h=(o.h-(f*t>>1)+720)%360;--t;)o.h=(o.h+f)%360,a.push(tinycolor(o));return a}function _monochromatic(e,t){t=t||6;for(var n=tinycolor(e).toHsv(),o=n.h,f=n.s,a=n.v,l=[],s=1/t;t--;)l.push(tinycolor({h:o,s:f,v:a})),a=(a+s)%1;return l}tinycolor.mix=function(e,t,n){n=n===0?0:n||50;var o=tinycolor(e).toRgb(),f=tinycolor(t).toRgb(),a=n/100,l={r:(f.r-o.r)*a+o.r,g:(f.g-o.g)*a+o.g,b:(f.b-o.b)*a+o.b,a:(f.a-o.a)*a+o.a};return tinycolor(l)},tinycolor.readability=function(e,t){var n=tinycolor(e),o=tinycolor(t);return(Math.max(n.getLuminance(),o.getLuminance())+.05)/(Math.min(n.getLuminance(),o.getLuminance())+.05)},tinycolor.isReadable=function(e,t,n){var o=tinycolor.readability(e,t),f,a;switch(a=!1,f=validateWCAG2Parms(n),f.level+f.size){case"AAsmall":case"AAAlarge":a=o>=4.5;break;case"AAlarge":a=o>=3;break;case"AAAsmall":a=o>=7;break}return a},tinycolor.mostReadable=function(e,t,n){var o=null,f=0,a,l,s,i;n=n||{},l=n.includeFallbackColors,s=n.level,i=n.size;for(var d=0;d<t.length;d++)a=tinycolor.readability(e,t[d]),a>f&&(f=a,o=tinycolor(t[d]));return tinycolor.isReadable(e,o,{level:s,size:i})||!l?o:(n.includeFallbackColors=!1,tinycolor.mostReadable(e,["#fff","#000"],n))};var names=tinycolor.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},hexNames=tinycolor.hexNames=flip(names);function flip(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[e[n]]=n);return t}function boundAlpha(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function bound01(e,t){isOnePointZero(e)&&(e="100%");var n=isPercentage(e);return e=Math.min(t,Math.max(0,parseFloat(e))),n&&(e=parseInt(e*t,10)/100),Math.abs(e-t)<1e-6?1:e%t/parseFloat(t)}function clamp01(e){return Math.min(1,Math.max(0,e))}function parseIntFromHex(e){return parseInt(e,16)}function isOnePointZero(e){return typeof e=="string"&&e.indexOf(".")!=-1&&parseFloat(e)===1}function isPercentage(e){return typeof e=="string"&&e.indexOf("%")!=-1}function pad2(e){return e.length==1?"0"+e:""+e}function convertToPercentage(e){return e<=1&&(e=e*100+"%"),e}function convertDecimalToHex(e){return Math.round(parseFloat(e)*255).toString(16)}function convertHexToDecimal(e){return parseIntFromHex(e)/255}var matchers=function(){var e="[-\\+]?\\d+%?",t="[-\\+]?\\d*\\.\\d+%?",n="(?:"+t+")|(?:"+e+")",o="[\\s|\\(]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")\\s*\\)?",f="[\\s|\\(]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")\\s*\\)?";return{CSS_UNIT:new RegExp(n),rgb:new RegExp("rgb"+o),rgba:new RegExp("rgba"+f),hsl:new RegExp("hsl"+o),hsla:new RegExp("hsla"+f),hsv:new RegExp("hsv"+o),hsva:new RegExp("hsva"+f),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function isValidCSSUnit(e){return!!matchers.CSS_UNIT.exec(e)}function stringInputToObject(e){e=e.replace(trimLeft,"").replace(trimRight,"").toLowerCase();var t=!1;if(names[e])e=names[e],t=!0;else if(e=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var n;return(n=matchers.rgb.exec(e))?{r:n[1],g:n[2],b:n[3]}:(n=matchers.rgba.exec(e))?{r:n[1],g:n[2],b:n[3],a:n[4]}:(n=matchers.hsl.exec(e))?{h:n[1],s:n[2],l:n[3]}:(n=matchers.hsla.exec(e))?{h:n[1],s:n[2],l:n[3],a:n[4]}:(n=matchers.hsv.exec(e))?{h:n[1],s:n[2],v:n[3]}:(n=matchers.hsva.exec(e))?{h:n[1],s:n[2],v:n[3],a:n[4]}:(n=matchers.hex8.exec(e))?{r:parseIntFromHex(n[1]),g:parseIntFromHex(n[2]),b:parseIntFromHex(n[3]),a:convertHexToDecimal(n[4]),format:t?"name":"hex8"}:(n=matchers.hex6.exec(e))?{r:parseIntFromHex(n[1]),g:parseIntFromHex(n[2]),b:parseIntFromHex(n[3]),format:t?"name":"hex"}:(n=matchers.hex4.exec(e))?{r:parseIntFromHex(n[1]+""+n[1]),g:parseIntFromHex(n[2]+""+n[2]),b:parseIntFromHex(n[3]+""+n[3]),a:convertHexToDecimal(n[4]+""+n[4]),format:t?"name":"hex8"}:(n=matchers.hex3.exec(e))?{r:parseIntFromHex(n[1]+""+n[1]),g:parseIntFromHex(n[2]+""+n[2]),b:parseIntFromHex(n[3]+""+n[3]),format:t?"name":"hex"}:!1}function validateWCAG2Parms(e){var t,n;return e=e||{level:"AA",size:"small"},t=(e.level||"AA").toUpperCase(),n=(e.size||"small").toLowerCase(),t!=="AA"&&t!=="AAA"&&(t="AA"),n!=="small"&&n!=="large"&&(n="small"),{level:t,size:n}}var QueryTable;(e=>{function t(o,f){if(DOM.clearChildren(o),!Array.isArray(f)){for(const[a,l]of Object.entries(f)){const s=n(a,l);DOM.append(o,s)}return}for(const a of Object.values(f))for(const[l,s]of Object.entries(a)){const i=n(l,s,defaultOptions.colors[a[LAYER]]);DOM.append(o,i)}}e.formatQueryTable=t;function n(o,f,a){const l=DOM.element("tr"),s=DOM.element("td",{classes:tw("tw-border tw-border-black tw-px-3 tw-py-1"),textContent:o}),i=DOM.element("td",{classes:tw("tw-border tw-border-black tw-px-3 tw-py-1 tw-font-mono"),textContent:formatLabel(f)});if(a){const[d,r]=[a,"black"];DOM.setStyles(s,{backgroundColor:d,borderColor:r}),DOM.setStyles(i,{backgroundColor:d,borderColor:r}),tinycolor(a).getBrightness()<127&&(DOM.setStyles(s,{color:"white"}),DOM.setStyles(i,{color:"white"}))}return DOM.append(l,s),DOM.append(l,i),l}})(QueryTable||(QueryTable={})),exports.Plot=void 0,(e=>{(E=>{E.Select="select",E.Pan="pan",E.Query="query"})(e.Mode||(e.Mode={}));function t(E,I,P){const D=DOM.element("div",{id:"plot",classes:tw("tw-relative tw-h-full tw-w-full tw-drop-shadow-md")});E=E??[],I=I??exports.Scales.of();const L={},N=[],F=[],j=[],H=structuredClone({...defaultOptions,...P}),{expandX:B,expandY:G}=H,U=[[B,G,1-B,1-G]],V={active:!1,locked:!1,mousedown:!1,mousebutton:MouseButton.Left,mode:"select",mousecoords:[0,0,0,0],lastkey:"",ratio:(P==null?void 0:P.ratio)??void 0},$=P.type??"unknown",X=P.representation??"absolute",Q=Reactive.of()({type:$,representation:X,data:E,container:D,frames:L,scales:I,renderables:N,selectables:F,queryables:j,zoomStack:U,parameters:V,options:H});return setupFrames(Q,H),setupScales(Q),setupEvents$1(Q),Q}e.of=t,e.scatter=Scatterplot,e.bar=Barplot,e.fluct=Fluctuationplot,e.histo=Histogram,e.histo2d=Histogram2d,e.pcoords=Pcoordsplot,e.bibar=Bibarplot;function n(E,I){E.appendChild(I.container),e.resize(I)}e.append=n;function o(E,I){const{renderables:P,selectables:D,queryables:L}=E;for(const N of[P,D,L])N.push(I)}e.addGeom=o;function f(E,I){const{renderables:P,selectables:D,queryables:L}=E;for(const N of[P,D,L])remove(N,I)}e.deleteGeom=f;const a=tw("tw-outline tw-outline-2 tw-outline-slate-600");function l(E){DOM.addClasses(E.container,a),E.parameters.active=!0,Reactive.dispatch(E,"activated")}e.activate=l;function s(E){DOM.removeClasses(E.container,a),E.parameters.active=!1,Reactive.dispatch(E,"deactivated")}e.deactivate=s;function i(E){E.parameters.locked=!0}e.lock=i;function d(E){E.parameters.locked=!1}e.unlock=d;function r(E){for(const I of dataLayers)Frame.clear(E.frames[I]);for(const I of E.renderables)Geom.render(I,E.frames)}e.render=r;function c(E){for(const I of["base","xAxis","yAxis"])Frame.clear(E.frames[I]);renderAxisLabels(E),renderAxisTitles(E)}e.renderAxes=c;function u(E){Frame.clear(E.frames.user)}e.clearUserFrame=u;function p(E){const{container:I,scales:P,frames:D,parameters:L,options:N}=E,{clientWidth:F,clientHeight:j}=I,{x:H,y:B,width:G,height:U,area:V}=P,{margins:$,marginLines:X}=N,Q=getComputedStyle(E.container),Z=parseFloat(Q.fontSize);for(let J=0;J<$.length;J++)$[J]=X[J]*Z;for(const J of Object.values(E.frames))Frame.resize(J);const[K,W]=[$[0],$[1]],[te,Y]=[j-$[2],F-$[3]];DOM.setStyles(D.under.canvas,{width:`calc(100% - ${W}px - ${$[3]}px)`,height:`calc(100% - ${K}px - ${$[2]}px)`,top:`${$[2]}px`,right:`${$[3]}px`}),DOM.setStyles(D.over.canvas,{width:`calc(100% - ${W}px - ${$[3]}px)`,height:`calc(100% - ${K}px - ${$[2]}px)`,top:`${$[2]}px`,right:`${$[3]}px`});const ee={default:!0,silent:!0};exports.Expanse.set(H.codomain,()=>({min:W,max:Y}),ee),exports.Expanse.set(B.codomain,()=>({min:K,max:te}),ee);const[ne,re]=[Y-W,te-K];if(exports.Expanse.set(G.codomain,()=>({max:ne}),ee),exports.Expanse.set(U.codomain,()=>({max:re}),ee),exports.Expanse.set(V.codomain,()=>({max:Math.min(ne,re)}),ee),L.ratio){const{expandX:J,expandY:oe}=defaultOptions;exports.Scale.set(H,()=>({zero:J,one:1-J}),ee),exports.Scale.set(B,()=>({zero:oe,one:1-oe}),ee),e.applyRatio(E,L.ratio)}e.render(E),e.renderAxes(E)}e.resize=p;function x(E){const{selectables:I,parameters:P}=E,D=new Set;for(const L of I){const N=Geom.check(L,P.mousecoords);for(let F=0;F<N.length;F++)D.add(N[F])}Reactive.dispatch(E,"set-selected",{cases:Array.from(D)})}e.checkSelection=x;function S(E,I){E.parameters.mode=I}e.setMode=S;function m(E,I){E.parameters.mousedown=I}e.setMousedown=m;function b(E,I){E.parameters.mousebutton=I}e.setMouseButton=b,e.mousemoveHandlers={select:v,pan:M,query:R};function v(E,I){const{container:P,parameters:D,frames:L}=E;if(!D.active||!D.mousedown)return;Reactive.dispatch(E,"clear-transient");const{mousecoords:N}=D,{clientHeight:F}=P,j=I.offsetX,H=F-I.offsetY;N[2]=j,N[3]=H,e.checkSelection(E),Reactive.dispatch(E,"lock-others"),Frame.clear(L.user),Frame.rectangleXY(L.user,...D.mousecoords,1)}function M(E,I){const{container:P,scales:D,parameters:L}=E;if(!L.active||!L.mousedown)return;const{mousecoords:N}=L,{clientWidth:F,clientHeight:j}=P,[H,B]=N,G=I.offsetX,U=j-I.offsetY,V=(G-H)/F,$=(U-B)/j;exports.Scale.move(D.x,V),exports.Scale.move(D.y,$),N[0]=G,N[1]=U,e.clearUserFrame(E)}function R(E,I){const{offsetX:P,offsetY:D}=I,{queryTable:L,queryables:N,container:F}=E,{clientHeight:j}=F;if(!L)return;DOM.setStyles(L,{display:"none"});const[H,B]=[P,j-D];let G;for(const U of N)if(G=Geom.query(U,[H,B]),G)break;G&&(QueryTable.formatQueryTable(L,G),L.style.display="inline-block")}e.keybindings={"=":"grow","-":"shrink","]":"unfade","[":"fade",z:"zoom",x:"pop-zoom",o:"reorder",";":"decrement-anchor","'":"increment-anchor",n:"normalize"};function A(E){const{area:I,size:P,width:D}=E.scales,L=10/9,N={silent:!0};exports.Expanse.set(I.codomain,F=>({min:F.min*L,max:F.max*L}),N),exports.Expanse.set(P.codomain,F=>({min:F.min*L,max:F.max*L}),N),exports.Expanse.set(D.codomain,F=>F.mult<1?{mult:F.mult*L}:{},N),e.render(E)}e.grow=A;function w(E){const{area:I,size:P,width:D}=E.scales,L=9/10,N={silent:!0};exports.Expanse.set(I.codomain,F=>({min:F.min*L,max:F.max*L}),N),exports.Expanse.set(P.codomain,F=>({min:F.min*L,max:F.max*L}),N),exports.Expanse.set(D.codomain,F=>({mult:F.mult*9/10}),N),e.render(E)}e.shrink=w;function g(E){const{frames:I}=E;for(const P of baseLayers)Frame.setAlpha(I[P],D=>D*9/10);e.render(E)}e.fade=g;function k(E){const{frames:I}=E;for(const P of baseLayers)Frame.setAlpha(I[P],D=>D*10/9);e.render(E)}e.unfade=k;function h(E){const{frames:I,scales:P}=E;for(const D of baseLayers)Frame.resetAlpha(I[D]);for(const D of Object.values(P))exports.Scale.restore(D);E.zoomStack.length=1,e.clearUserFrame(E)}e.reset=h;function y(E){e.setMode(E,"query")}e.setQueryMode=y;function z(E,I){const{scales:P,parameters:D,zoomStack:L}=E;let{coords:N,units:F}=I??{};F=F??"screen";let[j,H,B,G]=N??D.mousecoords;const{x:U,y:V}=P;if(F==="data"){const Y={silent:!0};exports.Scale.set(U,()=>({zero:0,one:1}),Y),exports.Scale.set(V,()=>({zero:0,one:1}),Y),j=exports.Expanse.normalize(U.domain,j),B=exports.Expanse.normalize(U.domain,B),H=exports.Expanse.normalize(V.domain,H),G=exports.Expanse.normalize(V.domain,G)}if(F==="screen"){if(Math.abs(B-j)<10||Math.abs(G-H)<10)return;j=trunc(exports.Expanse.normalize(U.codomain,j)),B=trunc(exports.Expanse.normalize(U.codomain,B)),H=trunc(exports.Expanse.normalize(V.codomain,H)),G=trunc(exports.Expanse.normalize(V.codomain,G))}[j,B]=[j,B].sort(diff),[H,G]=[H,G].sort(diff),exports.Scale.expand(P.x,j,B),exports.Scale.expand(P.y,H,G);const $=rangeInverse(j,B),X=rangeInverse(H,G),Q=sqrt(max($,X)),{width:Z,height:K,area:W,size:te}=P;Z.codomain!==W.codomain&&exports.Expanse.set(Z.codomain,Y=>({max:Y.max*$})),K.codomain!==W.codomain&&exports.Expanse.set(K.codomain,Y=>({max:Y.max*X})),exports.Expanse.set(W.codomain,Y=>({max:Y.max*Q})),exports.Expanse.set(te.codomain,Y=>({max:Y.max*Q})),L.push([j,H,B,G]),Reactive.dispatch(E,"clear-transient"),e.render(E)}e.zoom=z;function C(E){const{scales:I,zoomStack:P}=E;if(P.length===1)return;const[D,L,N,F]=P[P.length-1],[j,H]=invertRange(D,N),[B,G]=invertRange(L,F);exports.Scale.expand(I.x,j,H),exports.Scale.expand(I.y,B,G);const U=rangeInverse(j,H),V=rangeInverse(B,G),$=1/sqrt(max(1/U,1/V)),{width:X,height:Q,area:Z,size:K}=I;X.codomain!==Z.codomain&&exports.Expanse.set(X.codomain,W=>({max:W.max*U})),Q.codomain!==Z.codomain&&exports.Expanse.set(Q.codomain,W=>({max:W.max*V})),exports.Expanse.set(Z.codomain,W=>({max:W.max*$})),exports.Expanse.set(K.codomain,W=>({max:W.max*$})),P.pop(),e.clearUserFrame(E),e.render(E)}e.popZoom=C;function T(E,I){const{x:P,y:D}=E.scales;if(!exports.Expanse.isContinuous(P.domain)||!exports.Expanse.isContinuous(D.domain))throw new Error("Both axes need to be continuous to set a ratio");E.parameters.ratio=I,e.resize(E)}e.setRatio=T;function O(E,I){const{scales:P}=E,{x:D,y:L}=P,N=exports.Scale.unitRatio(D),F=exports.Scale.unitRatio(L)*I,j={default:!0,silent:!0};if(N>F){const H=F/N*exports.Scale.unitRange(L),[B,G]=[(1-H)/2,(1+H)/2];exports.Scale.set(D,()=>({zero:B,one:G}),j)}else{const H=N/F*exports.Scale.unitRange(D),[B,G]=[(1-H)/2,(1+H)/2];exports.Scale.set(L,()=>({zero:B,one:G}),j)}}e.applyRatio=O;function _(E,I){return E.scales[I].domain}e.getScale=_;function q(E,I,P){let{min:D,max:L,zero:N,one:F,mult:j,labels:H,direction:B}=P;const G=E.scales[I],U=G.domain,V=G.codomain;if(!Object.keys(E.scales).includes(I))throw new Error(`Unrecognized scale '${I}'`);const $={default:P.default??!1,unfreeze:P.unfreeze??!1};if([N,F].some(isDefined)&&(N=N??G.props.zero,F=F??G.props.one,exports.Scale.set(G,()=>({zero:N,one:F}),$),E.parameters.ratio=void 0),[D,L].some(isDefined)){if(!exports.Expanse.isContinuous(U))throw new Error("Limits can only be set with a continuous domain");N=D?N??0:G.props.zero,F=L?F??1:G.props.one,D=D??U.props.min,L=L??U.props.max,exports.Expanse.set(U,()=>({min:D,max:L}),$),exports.Scale.set(G,()=>({zero:N,one:F}),$),E.parameters.ratio=void 0}if(H){if(!exports.Expanse.isDiscrete(U))throw new Error("Labels can be ordered with a discrete domain only");if(!stringArraysMatch(U.props.labels,H))throw new Error("Labels must match the scale's labels");const X=orderIndicesByTable(U.props.labels,H);exports.Expanse.reorder(U,X)}B&&exports.Scale.set(G,()=>({direction:B}),$),j&&exports.Expanse.set(V,()=>({mult:j}),$)}e.setScale=q})(exports.Plot||(exports.Plot={}));function setupFrames(e,t){const{container:n,frames:o}=e,{margins:f,colors:a,axisLabelSize:l,axisTitleSize:s}=t,[i,d,r,c]=f,u=[7,6,5,4,3,2,1,0],p="tw-absolute tw-top-0 tw-right-0 tw-w-full tw-h-full ";for(const h of u){const y={zIndex:`${7-h+2}`},z=a[h],C={fillStyle:z,strokeStyle:z},T=Frame.of({classes:p,contextProps:C,canvasStyles:y,margins:f});o[h]=T}const x=Frame.of({classes:p+"tw-bg-gray-100"});Frame.setContext(x,{font:`${s}em sans-serif`,textBaseline:"middle",textAlign:"center"});const S=`calc(100% - ${d}px - ${c}px)`,m=`calc(100% - ${i}px - ${r}px)`,b={width:S,height:m,top:r+"px",right:c+"px"},v=Frame.of({classes:p+"tw-z-1 tw-bg-white",canvasStyles:b}),R=Frame.of({classes:p+"tw-z-10 tw-border tw-border-b-black tw-border-l-black",canvasStyles:b}),A=Frame.of({classes:p+"tw-z-10",margins:f});Frame.setContext(A,{globalAlpha:.06666666666666667});const w="#3B4854",g=Frame.of({classes:p});Frame.setContext(g,{fillStyle:w,textBaseline:"top",textAlign:"center",font:`${l}em serif`});const k=Frame.of({classes:p});Frame.setContext(k,{fillStyle:"#3B4854",textBaseline:"middle",textAlign:"right",font:`${l}em serif`}),Object.assign(o,{base:x,under:v,over:R,user:A,xAxis:g,yAxis:k});for(let[h,y]of Object.entries(o))isNaN(parseFloat(h))||(h="data-"+h),y.canvas.id=`frame-${h}`,Frame.append(y,n)}function setupEvents$1(e){const{container:t,parameters:n,frames:o}=e,{mousecoords:f}=n;for(const[a,l]of Object.entries(exports.Plot.keybindings))Reactive.listen(e,a,()=>Reactive.dispatch(e,l));t.addEventListener("mousedown",a=>{a.stopPropagation();const{locked:l}=n;exports.Plot.activate(e),exports.Plot.setMousedown(e,!0),exports.Plot.setMouseButton(e,a.button),a.button===MouseButton.Left?exports.Plot.setMode(e,"select"):a.button===MouseButton.Right&&exports.Plot.setMode(e,"pan");const s=a.offsetX,i=t.clientHeight-a.offsetY;copyValues([s,i,s,i],f),!l&&n.mode==="select"&&(Reactive.dispatch(e,"clear-transient"),exports.Plot.checkSelection(e)),exports.Plot.unlock(e)}),t.addEventListener("contextmenu",a=>{a.preventDefault(),exports.Plot.setMousedown(e,!0),exports.Plot.setMouseButton(e,MouseButton.Right),exports.Plot.setMode(e,"pan"),f[0]=a.offsetX,f[1]=t.clientHeight-a.offsetY,Frame.clear(o.user)}),t.addEventListener("mouseup",()=>exports.Plot.setMousedown(e,!1)),t.addEventListener("mousemove",throttle(a=>{exports.Plot.mousemoveHandlers[n.mode](e,a)},20)),Reactive.listen(e,"reset",()=>exports.Plot.reset(e)),Reactive.listen(e,"resize",()=>exports.Plot.resize(e)),Reactive.listen(e,"activate",()=>exports.Plot.activate(e)),Reactive.listen(e,"deactivate",()=>exports.Plot.deactivate(e)),Reactive.listen(e,"render",()=>exports.Plot.render(e)),Reactive.listen(e,"lock",()=>exports.Plot.lock(e)),Reactive.listen(e,"unlock",()=>exports.Plot.unlock(e)),Reactive.listen(e,"query-mode",()=>exports.Plot.setMode(e,"query")),Reactive.listen(e,"render-axes",()=>exports.Plot.renderAxes(e)),Reactive.listen(e,"clear-transient",()=>exports.Plot.clearUserFrame(e)),Reactive.listen(e,"get-scale",a=>{if(!(!a||!a.scale))return exports.Plot.getScale(e,a.scale)}),Reactive.listen(e,"set-scale",a=>{!a||!a.scale||exports.Plot.setScale(e,a.scale,a)}),Reactive.listen(e,"grow",()=>exports.Plot.grow(e),{throttle:10}),Reactive.listen(e,"shrink",()=>exports.Plot.shrink(e),{throttle:10}),Reactive.listen(e,"fade",()=>exports.Plot.fade(e),{throttle:10}),Reactive.listen(e,"unfade",()=>exports.Plot.unfade(e),{throttle:10}),Reactive.listen(e,"zoom",a=>exports.Plot.zoom(e,a)),Reactive.listen(e,"pop-zoom",()=>exports.Plot.popZoom(e));for(const a of Object.values(e.scales))Reactive.listen(a,"changed",()=>{exports.Plot.render(e),exports.Plot.renderAxes(e)})}function setupScales(e){const{scales:t}=e,{x:n,y:o,width:f,height:a,size:l,area:s,areaPct:i}=t,d={default:!0,silent:!0},{expandX:r,expandY:c}=defaultOptions;exports.Expanse.set(s.domain,()=>({ratio:!0}),d),exports.Expanse.set(i.domain,()=>({ratio:!0}),d),exports.Expanse.set(l.domain,()=>({ratio:!0}),d),exports.Expanse.set(l.codomain,()=>({trans:square,inv:sqrt}),d),exports.Expanse.set(s.codomain,()=>({trans:square,inv:sqrt}),d),exports.Expanse.set(i.codomain,()=>({trans:square,inv:sqrt}),d),exports.Scale.set(n,()=>({zero:r,one:1-r}),d),exports.Scale.set(o,()=>({zero:c,one:1-c}),d),exports.Scale.set(f,()=>({one:1-2*r}),d),exports.Scale.set(a,()=>({one:1-2*c}),d),exports.Scale.set(s,()=>({one:1-2*Math.max(r,c)}),d);const u=p=>Math.max(p,0);exports.Expanse.set(f.codomain,()=>({inv:u}),d),exports.Expanse.set(a.codomain,()=>({inv:u}),d)}var KeybindingsMenu;(e=>{function t(o){const f=DOM.element("div"),a=DOM.element("div",{id:"modal"}),l=DOM.element("div",{id:"bindings"}),s=DOM.element("button",{textContent:"key bindings"});DOM.addClasses(a,tw("tw-absolute tw-left-0 tw-top-0 tw-z-50 tw-flex tw-size-full tw-flex-col tw-items-center tw-bg-slate-800 tw-bg-opacity-80 tw-p-10")),DOM.addClasses(l,tw("tw-relative tw-flex tw-h-full tw-w-fit tw-flex-col tw-flex-wrap tw-justify-start tw-py-10")),DOM.addClasses(s,tw("tw-absolute tw-right-0 tw-top-0 tw-z-30 tw-select-none tw-rounded-bl-md tw-bg-gray-300 tw-p-1 tw-px-2 tw-text-sm tw-text-white hover:tw-bg-gray-400")),DOM.append(f,a),DOM.append(f,s),DOM.append(a,l),l.style.columnFill="auto",a.style.display="none";let i=!1;function d(){a.style.display="flex"}function r(){i||(a.style.display="none")}s.addEventListener("click",d),a.addEventListener("click",r);for(const[c,u]of Object.entries(o)){const p=DOM.element("span",{classes:tw("tw-m-1 tw-flex tw-flex-row")}),x=DOM.element("button",{textContent:c}),S=DOM.element("div",{classes:tw("tw-m-1 tw-p-1 tw-px-2 tw-text-white"),textContent:capitalize(u.replaceAll("-"," "))});DOM.addClasses(x,tw("tw-m-1 tw-w-8 tw-rounded-md tw-bg-gray-400 tw-p-1 tw-px-2 tw-text-center tw-text-white tw-outline-none hover:tw-bg-gray-500")),DOM.append(p,x),DOM.append(p,S),S.addEventListener("click",b=>b.stopPropagation()),x.addEventListener("click",b=>{i||(b.stopPropagation(),DOM.addClasses(x,tw("text-black bg-slate-200 hover:bg-slate-200")),window.addEventListener("keydown",m),i=!0)});const m=b=>{const{key:v}=b,M=x.innerText;v in o&&v!==M||(n(o,v,u),x.innerText=b.key,DOM.removeClasses(x,tw("tw-text-black tw-bg-slate-200 hover:tw-bg-slate-200")),window.removeEventListener("keydown",m),i=!1)};l.appendChild(p)}return f}e.of=t;function n(o,f,a){let l;for(const[s,i]of Object.entries(o))if(i===a){l=s;break}l&&delete o[l],o[f]=a}})(KeybindingsMenu||(KeybindingsMenu={})),exports.Scene=void 0,(e=>{function t(h,y){const z=DOM.element("div",{id:"scene-container"}),C=DOM.element("div",{id:"plots-container"});DOM.addClasses(z,tw("tailwind tw-pr-15 tw-relative tw-flex tw-h-full tw-w-full tw-content-center tw-items-center tw-justify-center tw-bg-[#deded9] tw-p-10")),DOM.addClasses(C,tw("tw-grid tw-h-full tw-w-full tw-grid-cols-1 tw-grid-rows-1 tw-gap-[1em]"));const T=DOM.element("table",{classes:tw("tw-absolute tw-z-30 tw-bg-gray-100 tw-shadow-md")});DOM.setStyles(T,{pointerEvents:"none"});const O={...e.keybindings,...exports.Plot.keybindings},_=KeybindingsMenu.of(O);DOM.append(z,C),DOM.append(z,_),DOM.append(z,T);const[q,E]=[1,1],I=Marker.of(Object.values(h)[0].length),P=[],D={},L=Object.assign(defaultOptions,y);for(const[j,H]of Object.entries(h))Meta.has(H,"name")||Meta.set(H,{name:j});const N={send:console.log},F=Reactive.of()({data:h,container:z,plotsContainer:C,queryTable:T,rows:q,cols:E,marker:I,client:N,plots:P,plotsByType:D,options:L,keybindings:O});if(y!=null&&y.websocketURL){const j=new WebSocket(y.websocketURL),H={sender:"scene",target:"server",type:"connected"};j.addEventListener("open",()=>j.send(JSON.stringify(H))),j.addEventListener("message",B=>{m(F,JSON.parse(B.data))}),window.addEventListener("beforeunload",()=>j.close()),F.client=j}return setupEvents(F),F}e.of=t;async function n(h,y){const z=await fetchJSON(h);return e.of(z,y)}e.ofAsync=n;function o(h,y){h.appendChild(y.container),e.resize(y)}e.append=o;function f(h,y){const{plotsContainer:z,marker:C,plots:T,plotsByType:O}=h;Reactive.listen(y,"activated",()=>{for(const q of T)q!=y&&Reactive.dispatch(q,"deactivate");h.activePlot=y}),Reactive.listen(y,"lock-others",()=>{for(const q of T)q!==y&&Reactive.dispatch(q,"lock")}),Reactive.listen(y,"set-selected",q=>{Marker.update(C,q.cases)}),Reactive.listen(y,"clear-transient",()=>{for(const q of T)exports.Plot.clearUserFrame(q);Marker.clearTransient(C)}),Reactive.listen(y,"render-all",()=>{for(const q of T)Reactive.dispatch(q,"render")});const{type:_}=y;O[_]||(O[_]=[]),O[_].push(T.length),T.push(y),exports.Plot.append(z,y),y.queryTable=h.queryTable,l(h),u(h),e.resize(h)}e.addPlot=f;function a(h,y){const{type:z,variables:C,reducer:T,queries:O}=y??{};if(!z||z==="unknown"||!C)return;for(const I of C)if(!Object.keys(h.data).includes(I))throw new Error(`Variable '${I}' is not present in the data`);const _=keysToSelectors(C),q={};if(T&&(q.reducer=exports.Reducer.parse(T)),O)if(isStringArray(O))q.queries=keysToSelectors(O);else{const I=P=>O.map(([D,L])=>[P[D],exports.Reducer.parse(L)]);q.queries=I}const E=exports.Plot[z](h,_,q);e.addPlot(h,E)}e.addPlotBySpec=a;function l(h){for(let y=0;y<h.plots.length;y++)h.plots[y].container.id=`plot${y+1}`}function s(h){const y=last(h.plots);y&&d(h,y)}e.popPlot=s;function i(h,y){const z=c(h,y);z&&d(h,z)}e.removePlot=i;function d(h,y){const{plots:z,plotsByType:C,plotsContainer:T}=h,O=z.indexOf(y);for(const _ of Object.values(C))if(_.indexOf(O)!==-1){remove(_,O);break}remove(z,y),T.removeChild(y.container),Reactive.removeAllListeners(y),l(h),u(h),e.resize(h)}function r(h,y){return y==="scene"?h:c(h,y)}e.getTarget=r;function c(h,y){const{plots:z,plotsByType:C}=h;let[T,O]=splitNumericSuffix(y);const _=parseInt(O,10)-1;if(T==="plot"||T==="p")return z[_];if(T=T.replace("plot","").replace("gram",""),T in Object.keys(plotIdShort)&&(T=plotIdShort[T]),T in C)return z[C[T][_]]}e.getPlot=c;function u(h){const{plots:y}=h;if(y.length===0)return;const z=Math.ceil(Math.sqrt(y.length)),C=Math.ceil(y.length/z);e.setDimensions(h,C,z)}function p(h,y,z){const{plotsContainer:C}=h;h.rows=y,h.cols=z,C.style.gridTemplateRows=Array(y).fill("1fr").join(" "),C.style.gridTemplateColumns=Array(z).fill("1fr").join(" "),e.resize(h)}e.setDimensions=p;function x(h,y){const{plotsContainer:z,plots:C}=h,T=new Set(y.flat()),O=new Set(seq(0,C.length-1));for(const I of T)O.delete(I);O.size>0&&alert("Warning: Some plots are not included in the layout and will be hidden.");for(let I=0;I<C.length;I++)C[I].container.style.gridArea=`plot${I}`;let _="";for(const I of y)_+=`"${I.map(P=>`plot${P}`).join(" ")}" `;const[q,E]=[y.length,y[0].length];z.style.gridTemplateAreas=_,z.style.gridTemplateRows=Array(q).fill("1fr").join(" "),z.style.gridTemplateColumns=Array(E).fill("1fr").join(" "),e.resize(h)}e.setLayout=x;function S(h){h.plotsContainer.style.gridTemplateAreas="";for(const y of h.plots)y.container.style.gridArea="auto";u(h)}e.clearLayout=S;function m(h,y){if(!h.client)return;const{type:z,target:C,data:T}=y,O=r(h,C);O&&Reactive.dispatch(O,z,T)}e.handleMessage=m;function b(h,y,z){const[C,T]=["scene","server"],O=JSON.stringify({sender:C,target:T,type:y,data:z});h.client.send(O)}e.sendMessage=b;function v(h){const{container:y}=h,{clientWidth:z,clientHeight:C}=y,T=Math.min(z,C)/100,O=Math.min(Math.max(8,3*T),16);y.style.fontSize=O+"px";for(const _ of h.plots)Reactive.dispatch(_,"resize")}e.resize=v;function M(h){for(const y of h.plots)exports.Plot.render(y)}e.render=M;function R(h){for(const y of h.plots)Reactive.dispatch(y,"reset");Marker.clearTransient(h.marker)}e.reset=R;function A(h){for(const y of h.plots)Reactive.dispatch(y,"query-mode")}e.setQueryMode=A;function w(h){Marker.setGroup(h.marker,Group.First)}e.setGroupFirst=w;function g(h){Marker.setGroup(h.marker,Group.Second)}e.setGroupSecond=g;function k(h){Marker.setGroup(h.marker,Group.Third)}e.setGroupThird=k,e.keybindings={r:"reset",q:"query-mode",1:"group-1",2:"group-2",3:"group-3"}})(exports.Scene||(exports.Scene={}));function setupEvents(e){const{marker:t,plots:n,container:o,plotsContainer:f,keybindings:a,queryTable:l}=e;window.addEventListener("pageshow",()=>{exports.Scene.resize(e),exports.Scene.render(e)}),document.addEventListener("load",()=>{exports.Scene.resize(e),exports.Scene.render(e)}),o.addEventListener("mousedown",()=>{for(const s of n)Reactive.dispatch(s,"deactivate")}),o.addEventListener("dblclick",()=>{for(const s of n)Reactive.dispatch(s,"deactivate"),Frame.clear(s.frames.user);Marker.clearAll(e.marker),e.activePlot=void 0}),f.addEventListener("mousemove",throttle(s=>{const{clientWidth:i,clientHeight:d}=f,{clientWidth:r,clientHeight:c}=l;let{offsetX:u,offsetY:p}=s,x=s.target;for(;x!==f;){if(x===null)return;u+=x.offsetLeft,p+=x.offsetTop,x=x.parentElement}let[S,m]=[u+2,p+2];u+r>i&&(S=S-r-4),p+c>d&&(m=m-c-4),DOM.setStyles(l,{left:S+"px",top:m+"px"})},20)),window.addEventListener("keydown",s=>{const i=a[s.key];i&&(e.activePlot&&Reactive.dispatch(e.activePlot,i),Reactive.dispatch(e,i))}),window.addEventListener("keyup",()=>{Marker.setGroup(t,Transient);for(const s of e.plots)s.parameters.mode=exports.Plot.Mode.Select,DOM.setStyles(l,{display:"none"})}),window.addEventListener("resize",throttle(()=>exports.Scene.resize(e),10)),Reactive.listen(t,"updated",()=>exports.Scene.render(e),{throttle:20}),Reactive.listen(t,"cleared",()=>{for(const s of n)Reactive.dispatch(s,"unlock")}),Reactive.listen(e,"resize",()=>exports.Scene.resize(e)),Reactive.listen(e,"reset",()=>exports.Scene.reset(e)),Reactive.listen(e,"query-mode",()=>exports.Scene.setQueryMode(e)),Reactive.listen(e,"group-1",()=>exports.Scene.setGroupFirst(e)),Reactive.listen(e,"group-2",()=>exports.Scene.setGroupSecond(e)),Reactive.listen(e,"group-3",()=>exports.Scene.setGroupThird(e)),Reactive.listen(e,"connected",()=>{var s;return console.log(`Connected to Websocket server on: ${(s=e.client)==null?void 0:s.url}`)}),Reactive.listen(e,"set-dims",s=>{!s||!s.rows||!s.columns||exports.Scene.setDimensions(e,s.rows,s.cols)}),Reactive.listen(e,"add-plot",s=>{s&&exports.Scene.addPlotBySpec(e,s)}),Reactive.listen(e,"pop-plot",()=>exports.Scene.popPlot(e)),Reactive.listen(e,"remove-plot",s=>{!s||!s.id||exports.Scene.removePlot(e,s.id)}),Reactive.listen(e,"set-selected",s=>{!s||!s.cases||Marker.update(t,s.cases)}),Reactive.listen(e,"set-assigned",s=>{if(!s||!s.group)return;const i=7-Math.min(s.group,3);Marker.update(t,s.cases,{group:i})}),Reactive.listen(e,"get-selected",()=>{const s=filterIndices(Array.from(t.indices),Marker.isTransient);exports.Scene.sendMessage(e,"get-selected",{cases:s})}),Reactive.listen(e,"get-assigned",s=>{if(!s||!s.group)return;const i=r=>(r|4)===7-Math.min(s.group,3),d=filterIndices(Array.from(t.indices),i);exports.Scene.sendMessage(e,"get-assigned",{cases:d,group:s.group})}),Reactive.listen(e,"clear-selection",()=>Marker.clearAll(t)),Reactive.listen(e,"get-scale",s=>{if(!s||!s.id)return;const i=exports.Scene.getPlot(e,s.id);i&&Reactive.dispatch(i,"get-scale",s)}),Reactive.listen(e,"set-scale",s=>{if(!s||!s.id)return;const i=exports.Scene.getPlot(e,s.id);i&&Reactive.dispatch(i,"set-scale",s)}),Reactive.listen(e,"normalize",s=>{if(!s||!s.id)return;const i=exports.Scene.getPlot(e,s.id);i&&Reactive.dispatch(i,"normalize")}),Reactive.listen(e,"zoom",s=>{if(!s||!s.id)return;const i=exports.Scene.getPlot(e,s.id);i&&Reactive.dispatch(i,"zoom",s)}),Reactive.listen(e,"set-layout",s=>{!s||!s.layout||exports.Scene.setLayout(e,s.layout)}),Reactive.listen(e,"set-parameters",s=>{if(!s||!s.id)return;const i=exports.Scene.getPlot(e,s.id);i&&Reactive.dispatch(i,"set-parameters",s)}),Reactive.listen(e,"clear-layout",()=>exports.Scene.clearLayout(e))}const plotIdShort={s:"scatter",b:"bar",h:"histo",f:"fluct",hh:"histo2d",pc:"pcoords"};return exports.METHODS=METHODS,exports.addIndexed=addIndexed,exports.addTailwind=addTailwind,exports.applyDirection=applyDirection,exports.applyWith=applyWith,exports.bimap=bimap,exports.binBreaks=binBreaks,exports.call=call,exports.capitalize=capitalize,exports.compareAlphaNumeric=compareAlphaNumeric,exports.convertToSuperscript=convertToSuperscript,exports.copyProps=copyProps,exports.copyValues=copyValues,exports.cumsum=cumsum,exports.dec=dec,exports.diff=diff,exports.exp10=exp10,exports.exponentialToSuperscript=exponentialToSuperscript,exports.fetchJSON=fetchJSON,exports.filterIndices=filterIndices,exports.findLength=findLength,exports.formatAxisLabels=formatAxisLabels,exports.formatLabel=formatLabel,exports.formatText=formatText,exports.identity=identity,exports.inc=inc,exports.invertRange=invertRange,exports.isDefined=isDefined,exports.isEventTarget=isEventTarget,exports.isIntegerString=isIntegerString,exports.isNumber=isNumber,exports.isNumberArray=isNumberArray,exports.isObject=isObject,exports.isPrimitive=isPrimitive,exports.isStringArray=isStringArray,exports.isTypedArray=isTypedArray,exports.just=just,exports.keysToSelectors=keysToSelectors,exports.last=last,exports.log10=log10,exports.max=max,exports.merge=merge,exports.minDecimal=minDecimal,exports.minmax=minmax,exports.one=one,exports.orderBy=orderBy,exports.orderIndices=orderIndices,exports.orderIndicesByTable=orderIndicesByTable,exports.ordered=ordered,exports.pointInRect=pointInRect,exports.prettyBreaks=prettyBreaks,exports.prod=prod,exports.randomInteger=randomInteger,exports.rangeInverse=rangeInverse,exports.rectSegmentIntersect=rectSegmentIntersect,exports.rectsIntersect=rectsIntersect,exports.remove=remove,exports.removeTailwind=removeTailwind,exports.rep=rep,exports.round=round,exports.row=row,exports.segmentsIntersect=segmentsIntersect,exports.selector=selector,exports.seq=seq,exports.seqLength=seqLength,exports.splitNumericSuffix=splitNumericSuffix,exports.sqrt=sqrt,exports.square=square,exports.stringArraysMatch=stringArraysMatch,exports.stripWS=stripWS,exports.subset=subset,exports.sum=sum,exports.throttle=throttle,exports.timeExecution=timeExecution,exports.toLowerCase=toLowerCase,exports.toUpperCase=toUpperCase,exports.trunc=trunc,exports.tw=tw,exports.uniqueIntegers=uniqueIntegers,exports.zero=zero,Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),exports}({});
