var plotscape=function(exports){"use strict";var __vite_style__=document.createElement("style");__vite_style__.textContent=`*:where(.tailwind,.tailwind *),:before:where(.tailwind,.tailwind *),:after:where(.tailwind,.tailwind *){box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}:before:where(.tailwind,.tailwind *),:after:where(.tailwind,.tailwind *){--tw-content: ""}.tailwind{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;-o-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}.tailwind{margin:0;line-height:inherit}hr:where(.tailwind,.tailwind *){height:0;color:inherit;border-top-width:1px}abbr:where([title]):where(.tailwind,.tailwind *){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1:where(.tailwind,.tailwind *),h2:where(.tailwind,.tailwind *),h3:where(.tailwind,.tailwind *),h4:where(.tailwind,.tailwind *),h5:where(.tailwind,.tailwind *),h6:where(.tailwind,.tailwind *){font-size:inherit;font-weight:inherit}a:where(.tailwind,.tailwind *){color:inherit;text-decoration:inherit}b:where(.tailwind,.tailwind *),strong:where(.tailwind,.tailwind *){font-weight:bolder}code:where(.tailwind,.tailwind *),kbd:where(.tailwind,.tailwind *),samp:where(.tailwind,.tailwind *),pre:where(.tailwind,.tailwind *){font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small:where(.tailwind,.tailwind *){font-size:80%}sub:where(.tailwind,.tailwind *),sup:where(.tailwind,.tailwind *){font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub:where(.tailwind,.tailwind *){bottom:-.25em}sup:where(.tailwind,.tailwind *){top:-.5em}table:where(.tailwind,.tailwind *){text-indent:0;border-color:inherit;border-collapse:collapse}button:where(.tailwind,.tailwind *),input:where(.tailwind,.tailwind *),optgroup:where(.tailwind,.tailwind *),select:where(.tailwind,.tailwind *),textarea:where(.tailwind,.tailwind *){font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button:where(.tailwind,.tailwind *),select:where(.tailwind,.tailwind *){text-transform:none}button:where(.tailwind,.tailwind *),input:where([type=button]):where(.tailwind,.tailwind *),input:where([type=reset]):where(.tailwind,.tailwind *),input:where([type=submit]):where(.tailwind,.tailwind *){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring:where(.tailwind,.tailwind *){outline:auto}:-moz-ui-invalid:where(.tailwind,.tailwind *){box-shadow:none}progress:where(.tailwind,.tailwind *){vertical-align:baseline}::-webkit-inner-spin-button:where(.tailwind,.tailwind *),::-webkit-outer-spin-button:where(.tailwind,.tailwind *){height:auto}[type=search]:where(.tailwind,.tailwind *){-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration:where(.tailwind,.tailwind *){-webkit-appearance:none}::-webkit-file-upload-button:where(.tailwind,.tailwind *){-webkit-appearance:button;font:inherit}summary:where(.tailwind,.tailwind *){display:list-item}blockquote:where(.tailwind,.tailwind *),dl:where(.tailwind,.tailwind *),dd:where(.tailwind,.tailwind *),h1:where(.tailwind,.tailwind *),h2:where(.tailwind,.tailwind *),h3:where(.tailwind,.tailwind *),h4:where(.tailwind,.tailwind *),h5:where(.tailwind,.tailwind *),h6:where(.tailwind,.tailwind *),hr:where(.tailwind,.tailwind *),figure:where(.tailwind,.tailwind *),p:where(.tailwind,.tailwind *),pre:where(.tailwind,.tailwind *){margin:0}fieldset:where(.tailwind,.tailwind *){margin:0;padding:0}legend:where(.tailwind,.tailwind *){padding:0}ol:where(.tailwind,.tailwind *),ul:where(.tailwind,.tailwind *),menu:where(.tailwind,.tailwind *){list-style:none;margin:0;padding:0}dialog:where(.tailwind,.tailwind *){padding:0}textarea:where(.tailwind,.tailwind *){resize:vertical}input::-moz-placeholder:where(.tailwind,.tailwind *),textarea::-moz-placeholder:where(.tailwind,.tailwind *){opacity:1;color:#9ca3af}input::placeholder:where(.tailwind,.tailwind *),textarea::placeholder:where(.tailwind,.tailwind *){opacity:1;color:#9ca3af}button:where(.tailwind,.tailwind *),[role=button]:where(.tailwind,.tailwind *){cursor:pointer}:disabled:where(.tailwind,.tailwind *){cursor:default}img:where(.tailwind,.tailwind *),svg:where(.tailwind,.tailwind *),video:where(.tailwind,.tailwind *),canvas:where(.tailwind,.tailwind *),audio:where(.tailwind,.tailwind *),iframe:where(.tailwind,.tailwind *),embed:where(.tailwind,.tailwind *),object:where(.tailwind,.tailwind *){display:block;vertical-align:middle}img:where(.tailwind,.tailwind *),video:where(.tailwind,.tailwind *){max-width:100%;height:auto}[hidden]:where(.tailwind,.tailwind *){display:none}*,:before,:after{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }.container{width:100%}@media (min-width: 640px){.container{max-width:640px}}@media (min-width: 768px){.container{max-width:768px}}@media (min-width: 1024px){.container{max-width:1024px}}@media (min-width: 1280px){.container{max-width:1280px}}@media (min-width: 1536px){.container{max-width:1536px}}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.left-0{left:0}.right-0{right:0}.top-0{top:0}.z-0{z-index:0}.z-10{z-index:10}.z-30{z-index:30}.z-50{z-index:50}.m-1{margin:.25rem}.inline-block{display:inline-block}.flex{display:flex}.table{display:table}.grid{display:grid}.hidden{display:none}.size-full{width:100%;height:100%}.h-5\\/6{height:83.333333%}.h-full{height:100%}.h-screen{height:100vh}.w-5\\/6{width:83.333333%}.w-8{width:2rem}.w-fit{width:-moz-fit-content;width:fit-content}.w-full{width:100%}.shrink{flex-shrink:1}.grow{flex-grow:1}.select-none{-webkit-user-select:none;-moz-user-select:none;user-select:none}.resize{resize:both}.grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.grid-rows-1{grid-template-rows:repeat(1,minmax(0,1fr))}.flex-row{flex-direction:row}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.content-center{align-content:center}.items-center{align-items:center}.justify-start{justify-content:flex-start}.justify-center{justify-content:center}.gap-5{gap:1.25rem}.rounded{border-radius:.25rem}.rounded-md{border-radius:.375rem}.rounded-bl-md{border-bottom-left-radius:.375rem}.border{border-width:1px}.border-gray-400{--tw-border-opacity: 1;border-color:rgb(156 163 175 / var(--tw-border-opacity))}.border-b-black{--tw-border-opacity: 1;border-bottom-color:rgb(0 0 0 / var(--tw-border-opacity))}.border-l-black{--tw-border-opacity: 1;border-left-color:rgb(0 0 0 / var(--tw-border-opacity))}.bg-\\[\\#deded9\\]{--tw-bg-opacity: 1;background-color:rgb(222 222 217 / var(--tw-bg-opacity))}.bg-gray-100{--tw-bg-opacity: 1;background-color:rgb(243 244 246 / var(--tw-bg-opacity))}.bg-gray-300{--tw-bg-opacity: 1;background-color:rgb(209 213 219 / var(--tw-bg-opacity))}.bg-gray-400{--tw-bg-opacity: 1;background-color:rgb(156 163 175 / var(--tw-bg-opacity))}.bg-gray-50{--tw-bg-opacity: 1;background-color:rgb(249 250 251 / var(--tw-bg-opacity))}.bg-slate-200{--tw-bg-opacity: 1;background-color:rgb(226 232 240 / var(--tw-bg-opacity))}.bg-slate-800{--tw-bg-opacity: 1;background-color:rgb(30 41 59 / var(--tw-bg-opacity))}.bg-white{--tw-bg-opacity: 1;background-color:rgb(255 255 255 / var(--tw-bg-opacity))}.bg-opacity-80{--tw-bg-opacity: .8}.p-1{padding:.25rem}.p-10{padding:2.5rem}.px-2{padding-left:.5rem;padding-right:.5rem}.px-3{padding-left:.75rem;padding-right:.75rem}.py-10{padding-top:2.5rem;padding-bottom:2.5rem}.text-center{text-align:center}.font-mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}.text-sm{font-size:.875rem;line-height:1.25rem}.uppercase{text-transform:uppercase}.lowercase{text-transform:lowercase}.capitalize{text-transform:capitalize}.text-black{--tw-text-opacity: 1;color:rgb(0 0 0 / var(--tw-text-opacity))}.text-white{--tw-text-opacity: 1;color:rgb(255 255 255 / var(--tw-text-opacity))}.shadow-md{--tw-shadow: 0 4px 6px -1px rgb(0 0 0 / .1), 0 2px 4px -2px rgb(0 0 0 / .1);--tw-shadow-colored: 0 4px 6px -1px var(--tw-shadow-color), 0 2px 4px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.outline-none{outline:2px solid transparent;outline-offset:2px}.outline{outline-style:solid}.outline-2{outline-width:2px}.outline-slate-600{outline-color:#475569}.drop-shadow-md{--tw-drop-shadow: drop-shadow(0 4px 3px rgb(0 0 0 / .07)) drop-shadow(0 2px 2px rgb(0 0 0 / .06));filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.hover\\:bg-gray-400:hover{--tw-bg-opacity: 1;background-color:rgb(156 163 175 / var(--tw-bg-opacity))}.hover\\:bg-gray-500:hover{--tw-bg-opacity: 1;background-color:rgb(107 114 128 / var(--tw-bg-opacity))}.hover\\:bg-slate-200:hover{--tw-bg-opacity: 1;background-color:rgb(226 232 240 / var(--tw-bg-opacity))}
`,document.head.appendChild(__vite_style__);const NAME=Symbol("name"),LENGTH=Symbol("length"),MIN=Symbol("min"),MAX=Symbol("max"),QUERYABLE=Symbol("queryable"),PARENTVALUES=Symbol("parentValues"),keyToSymbolMap={name:NAME,length:LENGTH,min:MIN,max:MAX,queryable:QUERYABLE,parent:PARENTVALUES};var Meta;(e=>{function t(a,f){return!!a[keyToSymbolMap[f]]}e.has=t;function n(a,f){return f==="length"&&Array.isArray(a)?a.length:a[keyToSymbolMap[f]]}e.get=n;function o(a,f){const c=[];for(let i=0;i<f.length;i++)c.push(n(a,f[i]));return c}e.getN=o;function l(a,f,c){a[keyToSymbolMap[f]]=c}e.set=l;function r(a,f,c){for(let i=0;i<f.length;i++)l(a,f[i],c[i])}e.setN=r;function u(a,f,c){const i=c??Object.keys(keyToSymbolMap);for(const s of i)a[keyToSymbolMap[s]]=n(f,s)}e.copy=u})(Meta||(Meta={}));var Getter;(e=>{function t(r){if(typeof r=="function")return r;if(isArray(r)){const u=a=>r[a];return Meta.set(u,"length",r.length),u}else return()=>r}e.of=t;function n(r){return()=>r}e.constant=n;function o(r,u){const a=e.of(r),f=c=>a(u[c]);return Meta.copy(f,r),Meta.set(f,"length",u.length),f}e.proxy=o;function l(r){const u=r.map(e.of),a=f=>u.map(c=>c(f));return Meta.copy(a,r[0],["length"]),a}e.multi=l})(Getter||(Getter={}));function identity(e){return e}const just=e=>()=>e,zero=just(0),one=just(1);function inc(e){return e+1}function dec(e){return e-1}function call(e){return e()}function square(e){return e**2}const sqrt=Math.sqrt,log10=Math.log10;function exp10(e){return 10**e}const max=Math.max;function diff(e,t){return e-t}function sum(e,t){return e+t}function prod(e,t){return e*t}function trunc(e,t=0,n=1){return Math.min(Math.max(e,t),n)}function rangeInverse(e,t){return 1/(t-e)}function invertRange(e,t){const n=rangeInverse(e,t);return[-e*n,n-e*n]}function round(e,t=0){return Math.round(e*10**t)/10**t}function compareAlphaNumeric(e,t){return e.localeCompare(t,"en",{numeric:!0})}function capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}function toLowerCase(e){return e.toLocaleLowerCase()}function toUpperCase(e){return e.toLocaleUpperCase()}function stripWS(e){return e.replace(/\s/g,"")}function last(e){return e[e.length-1]}function rep(e,t){return Array(t).fill(e)}function seq(e,t,n){const o=Math.abs(t-e);n=n??Math.ceil(o)+1;const l=o/(n-1),r=t>=e?1:-1;return Array.from(Array(n),(u,a)=>e+r*l*a)}function subset(e,t){const n=Array(t.length);for(let o=0;o<t.length;o++)n[o]=e[t[o]];return n}function remove(e,t){const n=e.indexOf(t);n!==-1&&e.splice(n,1)}function ordered(e,t){const n=Array(t.length);for(let o=0;o<t.length;o++)n[t[o]]=e[o];return n}function orderIndices(e){const t=e.toSorted(diff),n={},o={};for(let l=0;l<t.length;l++){const r=e[l];o[r]=o[r]+1||0,n[l]=t.indexOf(r)+o[r]}return Object.values(n)}function orderBy(e,t){const n=Array(e.length);for(let o=0;o<e.length;o++)n[o]=e[t[o]];for(let o=0;o<e.length;o++)e[o]=n[o]}function orderIndicesByTable(e,t){const n=Array(e.length);for(let o=0;o<e.length;o++)n[o]=t.indexOf(e[o]);return n}function minmax(e){let[t,n]=[1/0,-1/0];for(let o=0;o<e.length;o++)t=Math.min(t,e[o]),n=Math.max(n,e[o]);return[t,n]}function cumsum(e){const t=Array(e.length);t[0]=e[0];for(let n=1;n<e.length;n++)t[n]=e[n]+t[n-1];return t}function randomInteger(e,t){return Math.floor(e+Math.random()*t)}function uniqueIntegers(e,t,n=t-e){const o=t-e,l=[],r=new Set;for(;l.length<Math.min(n,o);){let u=randomInteger(e,t);for(;r.has(u);)u=randomInteger(e,t);l.push(u),r.add(u)}return l}async function fetchJSON(e){return await(await fetch(e)).json()}function merge(e,t){return{...e,...t}}function copyValues(e,t){if(e!==t){t.length=0;for(let n=0;n<e.length;n++)t.push(e[n])}}function copyProps(e,t){for(const[n,o]of Object.entries(e))isArray(o)&&isArray(e[n])?copyValues(o,e[n]):t[n]=o}function applyDirection(e,t){return .5*(1-t)+t*e}function prettyBreaks(e,t,n=4){const o=(t-e)/n,l=Math.floor(Math.log10(o)),r=[1,2,4,5,10];let[u,a]=[1/0,0];for(let g=0;g<r.length;g++){const x=(r[g]*10**l-o)**2;x<u&&([u,a]=[x,r[g]])}const f=10**l*a,c=Math.ceil(e/f)*f,i=Math.floor(t/f)*f,s=Math.round((i-c)/f),d=[];for(let g=0;g<s+1;g++){const x=c+g*f;d.push(x)}return d}function binBreaks(e,t){let{width:n,anchor:o,nBins:l}=t||{};const[r,u]=minmax(e),a=u-r;l=l??(n?Math.ceil(a/n)+1:10),n=n??a/(l-1),o=o??r;const f=r-n+(o-r)%n,c=u+n-(u-o)%n,i=Array(l+2);i[0]=f,i[i.length-1]=c;for(let s=1;s<i.length-1;s++)i[s]=f+s*n;return i}function addTailwind(e,t){for(const n of t.split(" "))e.classList.add(n)}function removeTailwind(e,t){for(const n of t.split(" "))e.classList.remove(n)}function throttle(e,t){let n=0;return function(...o){const l=new Date().getTime();l-n<t||(n=l,e(...o))}}function timeExecution(e){const t=performance.now();return e(),performance.now()-t}function makeGetter(e){return typeof e=="function"?e:isArray(e)?t=>e[t]:()=>e}function segmentToPointVec(e){const[t,n,o,l]=e;return[t,n,o-t,l-n]}function inRange(e,t,n){return!(e<t)&&!(e>n)}function segmentsIntersect(e,t){let[n,o,l,r]=segmentToPointVec(e),[u,a,f,c]=segmentToPointVec(t);const i=f*r-l*c,s=((n-u)*r-(o-a)*l)/i,d=-(-(n-u)*c+(o-a)*f)/i;return inRange(s,0,1)&&inRange(d,0,1)}function rectSegmentIntersect(e,t){const[n,o,l,r]=e;return segmentsIntersect([n,o,l,o],t)||segmentsIntersect([n,o,n,r],t)||segmentsIntersect([l,o,l,r],t)||segmentsIntersect([n,r,l,r],t)}function pointInRect(e,t){const[n,o]=e,[l,r,u,a]=t;return!(n<l||n>u||o<r||o>a)}function rectsIntersect(e,t){const[n,o]=[e[0],e[2]].sort(diff),[l,r]=[e[1],e[3]].sort(diff),[u,a]=[t[0],t[2]].sort(diff),[f,c]=[t[1],t[3]].sort(diff);return!(o<u||n>a||r<f||l>c)}function addIndexed(e,t,n){const l=Object.keys(e).filter(a=>a.replace(/[0-9]*$/,"")===t);if(l.length===0){e[`${t}1`]=n;return}const r=l.map(a=>parseInt(a.match(/[0-9]*$/)[0],10)),u=Math.max(...r);e[`${t}${u+1}`]=n}function minDecimal(e){let t=1/0;for(let n=0;n<e.length;n++)e[n]!==0&&(t=Math.min(t,Math.log10(Math.abs(e[n]))));return t>3?0:Math.floor(Math.abs(t))+2}function formatText(e,t={lowercase:!0,capitalize:!0,split:!0}){return t!=null&&t.split&&(e=e.replace(/_/g," ")),t!=null&&t.lowercase&&(e=e.toLocaleLowerCase()),t!=null&&t.capitalize&&(e=capitalize(e)),e}function formatLabel(e){if(typeof e=="string")return e;if(e===0)return e.toString();const t=Math.floor(Math.log10(Math.abs(e)));return t>=3?round(e).toString():t<=-3?round(e,-t+1).toString():round(e,2).toString()}function formatAxisLabels(e,t){if(!isNumberArray(e))return e;const n=(t==null?void 0:t.tens)??4,o=a=>a!=0&&Math.abs(Math.log10(a))>n,l=(t==null?void 0:t.decimals)??minDecimal(e);e=e.map(a=>round(a,l));const u=minmax(e).some(o)?superscriptFn:noSuperscriptFn;return e.map(u)}function superscriptFn(e){return e===0?"0":exponentialToSuperscript(e.toExponential())}function noSuperscriptFn(e){return e===0?"0":parseFloat(e.toPrecision(12)).toString()}function exponentialToSuperscript(e){let[t,n]=e.split("e");return n=convertToSuperscript(n),t+"×10"+n}const sups={"-":"⁻","+":"",0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹"};function convertToSuperscript(e){return e.split("").map(t=>sups[t]).join("")}const primitives=["string","number","boolean","undefined"];function isPrimitive(e){return e===null||primitives.includes(typeof e)}const isArray=Array.isArray;function isNumber(e){return typeof e=="number"}function isIntegerString(e){return/^[0-9]+/.test(e)}function isNumberArray(e){return typeof e[0]=="number"&&typeof last(e)=="number"}function isStringArray(e){return typeof e[0]=="string"&&typeof last(e)=="string"}function isEventTarget(e){return"addEventListener"in e}function findLength(e){for(const n of e){if(!n)continue;const o=Meta.get(n,"length");if(o)return o}const t="At least one variable needs to be of fixed length";throw new Error(t)}function applyWith(...e){return function(t){return t(...e)}}function row(e,t){const n={};for(const[o,l]of Object.entries(e))n[o]=Getter.of(l)(t);return n}function selector(e){return function(t){return t[e]}}function keysToSelectors(e){return function(t){return e.map(n=>t[n])}}function splitNumericSuffix(e){let t=e.length-1;for(;t>0&&/[0-9]/.test(e[t]);)t--;return t+=1,[e.substring(0,t),e.substring(t,e.length)]}function filterIndices(e,t){const n=[];for(let o=0;o<e.length;o++)t(e[o])&&n.push(o);return n}function stringArraysMatch(e,t){if(e.length!==t.length)return!1;const n=e.toSorted(compareAlphaNumeric).join(""),o=t.toSorted(compareAlphaNumeric).join("");return n===o}function clearNodeChildren(e){e.innerHTML=""}var Direction=(e=>(e[e.Forwards=1]="Forwards",e[e.Backwards=-1]="Backwards",e))(Direction||{}),VAnchor=(e=>(e[e.Middle=.5]="Middle",e[e.Top=1]="Top",e[e.Bottom=0]="Bottom",e))(VAnchor||{}),HAnchor=(e=>(e[e.Center=.5]="Center",e[e.Left=1]="Left",e[e.Right=0]="Right",e))(HAnchor||{}),MouseButton=(e=>(e[e.Left=0]="Left",e[e.Right=2]="Right",e))(MouseButton||{});const dataLayers=[0,1,2,3,4,5,6,7],baseLayers=[4,5,6,7];var Frame;(e=>{function t(h,m){if(!isCanvas(h))throw new Error("Node must be a HTML5 canvas element");const y=h.getContext("2d"),{clientWidth:v,clientHeight:S,clientLeft:k,clientTop:E}=h,w=v-k,M=S-E;return{canvas:h,context:y,width:w,height:M,margins:[0,0,0,0],scalingFactor:2,contextProps:{},options:m}}e.of=t;function n(h,m){m.appendChild(h.canvas),h.parent=m}e.append=n;function o(h,m){for(const[y,v]of Object.entries(m))h.contextProps[y]=v,h.context[y]=v}e.setContext=o;function l(h){const{context:m,canvas:y,scalingFactor:v}=h,{clientWidth:S,clientHeight:k,clientLeft:E,clientTop:w}=y,M=S-E,b=k-w;h.width=M,h.height=b,h.canvas.width=M*v,h.canvas.height=b*v;for(const[A,z]of Object.entries(h.contextProps))h.context[A]=z;m.scale(v,v),e.clip(h)}e.resize=l;function r(h){const{context:m}=h;let{width:y,height:v}=h;const[S,k,E,w]=h.margins;y=Math.max(y-k-w,0),v=Math.max(v-E-S,0),m.beginPath(),m.rect(k,E,y,v),m.clip()}e.clip=r;function u(h){h.context.clearRect(0,0,h.width,h.height)}e.clear=u;function a(h,m){h.context.globalAlpha=m(h.context.globalAlpha)}e.setAlpha=a;function f(h){h.context.globalAlpha=1}e.resetAlpha=f;function c(h,m){return h.context.measureText(m).width}e.textWidth=c;function i(h,m){const y=h.context.measureText(m);return y.actualBoundingBoxAscent+y.actualBoundingBoxDescent}e.textHeight=i;function s(h,m,y,v=h.options.size,S){const{context:k}=h,E=h.canvas.clientHeight,w=(S==null?void 0:S.hAnchor)??HAnchor.Center,M=(S==null?void 0:S.vAnchor)??VAnchor.Middle;m=m+2*(w-.5)*v,y=E-y+2*(.5-M)*v,k.beginPath(),k.arc(m,y,v,0,Math.PI*2),k.fill()}e.point=s;function d(h,m,y,v,S){const{context:k,height:E}=h;k.fillRect(m,E-y,v-m,y-S)}e.rectangleXY=d;function g(h,m,y,v,S,k){const{context:E,height:w}=h,M=(k==null?void 0:k.hAnchor)??HAnchor.Center,b=(k==null?void 0:k.vAnchor)??VAnchor.Middle;m=m-M*v,y=w-y+b*S,E.fillRect(m,y,v,-S)}e.rectangleWH=g;function x(h,m,y){const{context:v,height:S}=h;v.beginPath(),v.moveTo(m[0],S-y[0]);for(let k=0;k<m.length;k++)v.lineTo(m[k],S-y[k]);v.stroke()}e.line=x;function p(h,m,y,v,S){const{context:k,height:E}=h;k.save(),k.translate(m,E-y),S!=null&&S.vertical&&k.rotate(-Math.PI/2),k.fillText(v,0,0),k.translate(-m,-(E-y)),k.restore()}e.text=p})(Frame||(Frame={}));function isCanvas(e){return e.nodeName==="CANVAS"}const LISTENERS=Symbol("listeners"),DEFERRED=Symbol("deferred");var Reactive;(e=>{function t(){return function(i){return{...i,[LISTENERS]:{},[DEFERRED]:{}}}}e.of=t;function n(i){return i[LISTENERS]!==void 0}e.is=n;function o(i,s,d,g){g!=null&&g.throttle&&(d=throttle(d,g.throttle));const x=g!=null&&g.defer?i[DEFERRED]:i[LISTENERS];x[s]||(x[s]=[]),x[s].includes(d)||x[s].push(d)}e.listen=o;function l(i,s,d){const[g,x]=[i[LISTENERS][s],i[DEFERRED][s]];if(g)for(const p of g)p(d);if(x)for(const p of x)p(d)}e.dispatch=l;function r(i,s,d){const g=()=>e.dispatch(s,d);e.listen(i,d,g,{defer:!0})}e.propagate=r;function u(i,s){s(i),e.dispatch(i,"changed")}e.set=u;function a(i,s,d){const[g,x]=[i[LISTENERS][s],i[DEFERRED][s]];g&&remove(g,d),x&&remove(x,d)}e.remove=a;function f(i,s){const[d,g]=[i[LISTENERS][s],i[DEFERRED][s]];if(d)for(const x of d)remove(d,x);if(g)for(const x of g)remove(g,x)}e.removeAll=f;function c(i){const[s,d]=[i[LISTENERS],i[DEFERRED]];if(s)for(const g of Object.values(s))g.length=0;if(d)for(const g of Object.values(d))g.length=0}e.removeAllListeners=c})(Reactive||(Reactive={}));var ExpanseBand;(e=>{function t(s=[],d){const g="",x="band",p=exports.Expanse.base(d),{zero:h,one:m,direction:y}=p,v=Array.from(Array(s.length),(M,b)=>b),S=(d==null?void 0:d.weights)??Array(s.length).fill(1),k=cumsum(S),E=!1,w={ordered:E,labels:[...s],order:[...v],weights:[...S],cumulativeWeights:[...k],zero:h,one:m,direction:y};return{value:g,type:x,ordered:E,labels:s,order:v,weights:S,cumulativeWeights:k,...p,defaults:w}}e.of=t;function n(s,d){const{order:g,cumulativeWeights:x}=s;d=g[d];const p=x[d-1]??0,h=x[d],m=last(x);return(p+h)/2/m}function o(s,d){if(d=d??Array(s.labels.length).fill(1),d.length!=s.labels.length){const p="The length of the weights must match the length of labels";throw new Error(p)}const{order:g}=s,x=cumsum(ordered(d,g));copyValues(d,s.weights),copyValues(d,s.defaults.weights),copyValues(x,s.cumulativeWeights),copyValues(x,s.defaults.cumulativeWeights),Reactive.dispatch(s,"changed")}e.setWeights=o;function l(s,d){const{labels:g,zero:x,one:p,direction:h}=s,m=g.indexOf(d);if(m===-1)throw new Error(`Label ${d} not found in: ${g}`);const y=n(s,m),v=x+y*(p-x);return applyDirection(v,h)}e.normalize=l;function r(s,d){const{labels:g,zero:x,one:p,direction:h}=s;d=applyDirection(d,h);const m=(d-x)/(p-x),y=Math.round((2*m*g.length-1)/2);return g[y]}e.unnormalize=r;function u(s,d,g){const{order:x}=s,p=Array.from(new Set(d)).sort(compareAlphaNumeric);if(!x.length){for(let v=0;v<p.length;v++)x[v]=v;s.defaults.order=[...x],s.ordered=!1}const h=Array(p.length).fill(1),m=cumsum(ordered(h,x)),y={labels:p,weights:h,cumulativeWeights:m};for(const[v,S]of Object.entries(y))isArray(s[v])&&copyValues(S,s[v]),g!=null&&g.default&&copyValues(S,s.defaults[v])}e.train=u;function a(s,d){const{order:g,weights:x,cumulativeWeights:p,defaults:h}=s;if(!d){copyValues(h.order,g),copyValues(cumsum(ordered(x,g)),p),s.ordered=!1,Reactive.dispatch(s,"changed");return}copyValues(d,g),copyValues(cumsum(ordered(x,d)),p),s.ordered=!0,Reactive.dispatch(s,"changed")}e.reorder=a;function f(s){return ordered(s.labels,s.order)}e.breaks=f;function c(){return!1}e.isContinuous=c;function i(){return!0}e.isDiscrete=i})(ExpanseBand||(ExpanseBand={}));var ExpanseContinuous;(e=>{function t(a=0,f=1,c){const s="continuous",d=exports.Expanse.base(c),[g,x]=[identity,identity],p=(c==null?void 0:c.scale)??1,h=(c==null?void 0:c.mult)??1,m=(c==null?void 0:c.offset)??0,y=(c==null?void 0:c.ratio)??!1,v={min:a,max:f,scale:p,mult:h,...d,offset:m,trans:g,inv:x};return{value:0,type:s,min:a,max:f,scale:p,mult:h,offset:m,ratio:y,...d,trans:g,inv:x,defaults:v}}e.of=t;function n(a,f){const{min:c,max:i,zero:s,one:d}=a,{direction:g,scale:x,mult:p,offset:h,trans:m}=a;f=f/(x*p)-h;const y=m(i)-m(c);let v=(m(f-h)-m(c))/y;return v=s+v*(d-s),applyDirection(v,g)}e.normalize=n;function o(a,f){const{min:c,max:i,zero:s,one:d}=a,{scale:g,mult:x,offset:p,trans:h,inv:m}=a,y=(f-s)/(d-s),v=h(i)-h(c);return m(h(c)+y*v)*(g*x)+p}e.unnormalize=o;function l(a){const{min:f,max:c}=a;return c-f}e.range=l;function r(a,f,c){let[i,s]=Meta.getN(f,["min","max"]);(!i||!s)&&([i,s]=minmax(f)),i=a.ratio||c!=null&&c.ratio?0:i,exports.Expanse.set(a,d=>(d.min=i,d.max=s),c)}e.train=r;function u(a,f=4){const[c,i]=[0,1].map(d=>e.unnormalize(a,d)).sort(diff);return prettyBreaks(c,i,f)}e.breaks=u})(ExpanseContinuous||(ExpanseContinuous={}));var ExpanseCompound;(e=>{function t(a=[],f){const c=[],i="compound",s=exports.Expanse.continuous(0,1,f),{zero:d,one:g,direction:x}=s,p={zero:d,one:g,direction:x};for(const m of a)Object.assign(m,{zero:d,one:g,direction:x}),Object.assign(m.defaults,{zero:d,one:g,direction:x});const h={expanses:a,...s,value:c,type:i,defaults:p};return Reactive.listen(h,"changed",()=>{const{zero:m,one:y,direction:v}=h;for(const S of a)Object.assign(S,{zero:m,one:y,direction:v}),Object.assign(S.defaults,{zero:m,one:y,direction:v})}),h}e.of=t;function n(a,f){const{expanses:c}=a;return f.map((i,s)=>exports.Expanse.normalize(c[s],i))}e.normalize=n;function o(a,f){const{expanses:c}=a;return f.map((i,s)=>exports.Expanse.unnormalize(c[s],i))}e.unnormalize=o;function l(a,f){const{expanses:c}=a;if(f.length!=c.length){const i="The number of arrays does not match the number of expanses.";throw new Error(i)}for(let i=0;i<f.length;i++)exports.Expanse.train(c[i],f[i])}e.train=l;function r(a){return ExpanseContinuous.breaks(a)}e.breaks=r;function u(a){for(const f of a.expanses)exports.Expanse.restoreDefaults(f)}e.restoreDefaults=u})(ExpanseCompound||(ExpanseCompound={}));var ExpansePoint;(e=>{function t(a=[],f){const c="",i="point",s=exports.Expanse.base(f),{zero:d,one:g,direction:x}=s,p=Array.from(Array(a.length),(y,v)=>v),h=!1,m={ordered:h,labels:[...a],order:[...p],zero:d,one:g,direction:x};return{value:c,type:i,ordered:h,labels:a,order:p,...s,defaults:m}}e.of=t;function n(a,f){const{labels:c,order:i,zero:s,one:d,direction:g}=a,x=i[c.indexOf(f)];if(x===-1)return x;const p=s+x/(c.length-1)*(d-s);return applyDirection(p,g)}e.normalize=n;function o(a,f){const{labels:c,order:i,zero:s,one:d,direction:g}=a;f=applyDirection(f,g);const x=(f-s)/(d-s),p=Math.round(x*(c.length-1));return c[i[p]]}e.unnormalize=o;function l(a,f,c){const{order:i}=a,s=Array.from(new Set(f)).sort(compareAlphaNumeric);if(!i.length){for(let d=0;d<s.length;d++)i[d]=d;a.defaults.order=[...i],a.ordered=!1}copyValues(s,a.labels),c!=null&&c.default&&copyValues(s,a.defaults.labels)}e.train=l;function r(a,f){const{order:c,defaults:i}=a;if(!f){copyValues(i.order,c),a.ordered=!1,Reactive.dispatch(a,"changed");return}copyValues(f,c),a.ordered=!0,Reactive.dispatch(a,"changed")}e.reorder=r;function u(a){return ordered(a.labels,a.order)}e.breaks=u})(ExpansePoint||(ExpansePoint={}));var ExpanseSplit;(e=>{function t(u){const a=[],f="split",c=u.type;return{...u,value:a,type:f,innerType:c}}e.of=t;function n(u,a){return isArray(a)?a.map(f=>exports.Expanse.methods[u.innerType].normalize(u,f)):exports.Expanse.methods[u.innerType].normalize(u,a)}e.normalize=n;function o(u,a){return isArray(a)?a.map(f=>exports.Expanse.methods[u.innerType].unnormalize(u,f)):exports.Expanse.methods[u.innerType].unnormalize(u,a)}e.unnormalize=o;function l(u,a){exports.Expanse.methods[u.innerType].train(u,a)}e.train=l;function r(u){return exports.Expanse.methods[u.innerType].breaks(u)}e.breaks=r})(ExpanseSplit||(ExpanseSplit={})),exports.Expanse=void 0,(e=>{e.methods={continuous:ExpanseContinuous,point:ExpansePoint,band:ExpanseBand,compound:ExpanseCompound,split:ExpanseSplit},e.continuous=ExpanseContinuous.of,e.point=ExpansePoint.of,e.band=ExpanseBand.of,e.compound=ExpanseCompound.of,e.split=ExpanseSplit.of;function t(w){const M=(w==null?void 0:w.zero)??0,b=(w==null?void 0:w.one)??1,A=(w==null?void 0:w.direction)??Direction.Forwards,z=[],T=[];return Reactive.of()({zero:M,one:b,direction:A,frozen:z,linked:T})}e.base=t;function n(w,M,b){const{linked:A,frozen:z}=w,T={...w};M(T);for(const L of z)delete T[L];for(const L of Object.keys(T))T[L]===w[L]&&delete T[L];copyProps(T,w);for(const L of A)e.set(L,M);b!=null&&b.default&&copyProps(T,w.defaults),b!=null&&b.silent||Reactive.dispatch(w,"changed")}e.set=n;function o(w,M={train:!0}){const b=isNumberArray(w)?e.continuous():e.point();return M.train&&e.train(b,w),b}e.infer=o;function l(w,M){for(const b of M)w.frozen.includes(b)||w.frozen.push(b)}e.freeze=l;function r(w,M){w.linked.includes(M)||w.linked.push(M)}e.linkTo=r;function u(w){const{defaults:M}=w;for(const[b,A]of Object.entries(M))isArray(A)&&isArray(w[b])?copyValues(A,w[b]):w[b]=A;Reactive.dispatch(w,"changed")}e.restoreDefaults=u;function a(w,M){return e.methods[w.type].normalize(w,M)}e.normalize=a;function f(w,M){return e.methods[w.type].unnormalize(w,M)}e.unnormalize=f;function c(w,M,b){return e.methods[w.type].train(w,M,b)}e.train=c;function i(w){return e.methods[w.type].breaks(w)}e.breaks=i;function s(w,M){const{direction:b}=w,A=M;e.set(w,z=>(z.zero+=b*A,z.one+=b*A))}e.move=s;function d(w,M,b,A){const{zero:z,one:T,direction:L}=w,P=T-z;L===Direction.Backwards&&([M,b]=[1-M,1-b]);let[j,R]=[M,b].map(I=>(I-z)/P);[j,R]=invertRange(j,R),L===Direction.Backwards&&([j,R]=[1-j,1-R]),e.set(w,I=>(I.zero=j,I.one=R),A)}e.expand=d;function g(w){e.set(w,M=>M.direction*=-1)}e.flip=g;function x(w,M){if(!v(w))throw new Error("Expanse must be discrete");e.methods[w.type].reorder(w,M)}e.reorder=x;function p(w){return w.one-w.zero}e.unitRange=p;function h(w){if(!m(w))throw new Error("Can only compute range on a continuous expanse");return ExpanseContinuous.range(w)}e.range=h;function m(w){return w.type==="continuous"||w.type==="split"}e.isContinuous=m;function y(w){return w.type==="point"}e.isPoint=y;function v(w){return w.type==="point"||w.type==="band"}e.isDiscrete=v;function S(w){return w.type==="band"}e.isBand=S;function k(w){return w.type==="compound"}e.isCompound=k;function E(w){return w.type==="split"}e.isSplit=E})(exports.Expanse||(exports.Expanse={})),exports.Scale=void 0,(e=>{function t(p,h){const m=Reactive.of()({domain:p,codomain:h});return Reactive.propagate(p,m,"changed"),Reactive.propagate(h,m,"changed"),m}e.of=t;function n(p,h){p.domain=h,Reactive.propagate(p.domain,p,"changed")}e.setDomain=n;function o(p,h){p.codomain=h,Reactive.propagate(p.codomain,p,"changed")}e.setCoomain=o;function l(p,h){const{domain:m,codomain:y}=p;return exports.Expanse.unnormalize(y,exports.Expanse.normalize(m,h))}e.pushforward=l;function r(p,h){const{domain:m,codomain:y}=p;return exports.Expanse.unnormalize(m,exports.Expanse.normalize(y,h))}e.pullback=r;function u(p,h,m,y){exports.Expanse.expand(p.domain,h,m,y)}e.expand=u;function a(p,h,m){if(((m==null?void 0:m.name)??!0)&&Meta.has(h,"name")&&Meta.copy(p,h,["name"]),typeof h[0]=="string"&&exports.Expanse.isContinuous(p.domain)){const v=Array.from(new Set(h));p.domain=exports.Expanse.band(v)}exports.Expanse.train(p.domain,h,m)}e.train=a;function f(p){exports.Expanse.restoreDefaults(p.domain),exports.Expanse.restoreDefaults(p.codomain)}e.restoreDefaults=f;function c(p){const h=exports.Expanse.breaks(p.domain);let m=formatAxisLabels(h);if(exports.Expanse.isCompound(p.domain)){m=formatAxisLabels(h,{decimals:1});const v=h.map(S=>exports.Expanse.unnormalize(p.codomain,ExpanseContinuous.normalize(p.domain,S)));return{labels:m,positions:v}}else if(exports.Expanse.isSplit(p.codomain)){const v=e.pushforward(p,h);return{labels:m,positions:v}}const y=h.map(v=>e.pushforward(p,v));return{labels:m,positions:y}}e.breaks=c;function i(p,h){exports.Expanse.move(p.domain,h)}e.move=i;function s(p,h){h.codomain=p.codomain}e.shareCodomain=s;function d(p){return exports.Expanse.range(p.domain)/exports.Expanse.unitRange(p.domain)}e.domainRange=d;function g(p){return exports.Expanse.range(p.codomain)*exports.Expanse.unitRange(p.codomain)}e.codomainRange=g;function x(p){const{domain:h,codomain:m}=p;if([h,m].map(exports.Expanse.isContinuous).includes(!1))throw new Error("Both domain and codomain need to be continuous");const y=exports.Expanse.range(h);return exports.Expanse.range(m)*exports.Expanse.unitRange(m)/y}e.unitRatio=x})(exports.Scale||(exports.Scale={}));const POSITIONS=Symbol("positions");exports.Factor=void 0,(e=>{(c=>{c[c.Constant=0]="Constant",c[c.Bijection=1]="Bijection",c[c.Surjection=2]="Surjection"})(e.Type||(e.Type={}));function t(c,i,s,d){return Reactive.of()({type:c,cardinality:i,indices:s,data:d})}e.of=t;function n(c,i){i.cardinality=c.cardinality,copyValues(c.indices,i.indices);for(const s of Reflect.ownKeys(c.data))isArray(c.data[s])&&isArray(i.data[s])?(copyValues(c.data[s],i.data[s]),Meta.copy(i.data[s],c.data[s])):i.data[s]=c.data[s]}e.copyFrom=n;function o(c){const s=[],d=p=>[p],x={...c,[POSITIONS]:d};return t(1,1/0,s,x)}e.bijection=o;function l(c){const s=Array(c).fill(0),d=()=>s,g=0,x={[POSITIONS]:d};return t(g,1,s,x)}e.mono=l;function r(c,i){const s=c.map(h=>h.toString());i=i??Array.from(new Set(s)).sort(compareAlphaNumeric),Meta.has(c,"name")&&Meta.copy(i,c,["name"]);const d=[],g={};for(let h=0;h<s.length;h++){const m=i.indexOf(s[h]);g[m]||(g[m]=[]),d.push(m),g[m].push(h)}const x=2,p={label:i,[POSITIONS]:Object.values(g)};return t(x,i.length,d,p)}e.from=r;function u(c,i){function s(){const g=(i==null?void 0:i.breaks)??binBreaks(c,i),x=new Set,p=[],h={};for(let M=0;M<c.length;M++){const b=g.findIndex(A=>A>=c[M])-1;h[b]||(h[b]=[]),p.push(b),h[b].push(M),x.add(b)}const m=Array.from(x).sort(diff);for(let M=0;M<p.length;M++)p[M]=m.indexOf(p[M]);const[y,v]=[[],[]];for(let M=0;M<m.length;M++)y.push(g[m[M]]),v.push(g[m[M]+1]);const[S,k]=[g[m[0]],g[last(m)+1]];Meta.setN(y,["min","max"],[S,k]),Meta.setN(v,["min","max"],[S,k]),Meta.set(y,"name",`min of ${Meta.get(c,"name")}`),Meta.set(v,"name",`max of ${Meta.get(c,"name")}`),Meta.copy(g,c,["name"]);const E=2,w={binMin:y,binMax:v,breaks:g,[POSITIONS]:Object.values(h)};return t(E,m.length,p,w)}const d=s();return i&&Reactive.is(i)&&Reactive.listen(i,"changed",()=>{const g=s();e.copyFrom(g,d),Reactive.dispatch(d,"changed")}),d}e.bin=u;function a(c,i){function s(){if(c.type===1){const z={};for(const R of Reflect.ownKeys(c.data))z[R]=Getter.of(c.data[R]);for(const R of Reflect.ownKeys(i.data))z[R]=Getter.proxy(i.data[R],i.indices);const T=1,L=i.indices.length,j=t(T,L,[],z);return j.parent=c,j}if(c.type===0){const{type:z,data:T,cardinality:L,indices:P}=i,j=t(z,L,P,T);return j.parent=c,j}const g=Math.max(c.cardinality,i.cardinality)+1,x=new Set,p=[],h={},m={},y={},v=makeGetter(c.indices),S=makeGetter(i.indices);for(let z=0;z<c.indices.length;z++){const[T,L]=[v(z),S(z)],P=g*T+L;P in m||(m[P]=T,y[P]=L,h[P]=[]),p.push(P),h[P].push(z),x.add(P)}const k=Array.from(x).sort(diff);for(let z=0;z<p.length;z++)p[z]=k.indexOf(p[z]);const E=Object.values(m),w=Object.values(y),M={};for(let z of Reflect.ownKeys(c.data)){let T=z;if(typeof z=="string")for(;T in M;)z+="$";const[L,P]=[c.data[z],E],j=isArray(L)?subset(L,P):Getter.proxy(L,P);Meta.copy(j,L),M[T]=j}for(let z of Reflect.ownKeys(i.data)){let T=z;if(typeof z=="string")for(;T in M;)T+="$";const[L,P]=[i.data[z],w],j=isArray(L)?subset(L,P):Getter.proxy(L,P);Meta.copy(j,L),M[T]=j}const b=2;M[POSITIONS]=Object.values(h);const A=t(b,k.length,p,M);return A.parent=c,A}const d=s();return Reactive.listen(c,"changed",()=>{const g=s();e.copyFrom(g,d)}),Reactive.listen(i,"changed",()=>{const g=s();e.copyFrom(g,d)}),Reactive.propagate(c,d,"changed"),Reactive.propagate(i,d,"changed"),d}e.product=a;function f(c,i){const s={};for(let d=0;d<i.indices.length&&(s[i.indices[d]]=c.indices[d],!(Object.keys(s).length>=i.cardinality));d++);return Object.values(s)}e.parentIndices=f})(exports.Factor||(exports.Factor={}));const Transient=255;var Group=(e=>(e[e.Base=7]="Base",e[e.First=6]="First",e[e.Second=5]="Second",e[e.Third=4]="Third",e[e.BaseTransient=3]="BaseTransient",e[e.FirstTransient=2]="FirstTransient",e[e.SecondTransient=1]="SecondTransient",e[e.ThirdTransient=0]="ThirdTransient",e))(Group||{}),Marker;(e=>{function t(i){const s=Transient,d=Array(i).fill(7),g=[],x=exports.Factor.Type.Surjection,p=exports.Factor.of(x,8,d,{[LAYER]:[0,1,2,3,4,5,6,7]}),h=Reactive.of()({group:s,indices:d,transientIndices:g,factor:p});return Reactive.listen(h,"updated",()=>Reactive.dispatch(p,"changed")),Reactive.listen(h,"cleared",()=>Reactive.dispatch(p,"changed")),h}e.of=t;function n(i,s){i.group=s}e.setGroup=n;function o(i,s,d){const g=(d==null?void 0:d.group)??i.group;if(r(i,{silent:!0}),g===Transient){for(let x=0;x<s.length;x++){const p=s[x];i.indices[p]=f(i.indices[p])}i.transientIndices=s}else for(let x=0;x<s.length;x++){const p=s[x];i.indices[p]=g}d!=null&&d.silent||Reactive.dispatch(i,"updated")}e.update=o;function l(i,s){for(let d=0;d<i.indices.length;d++)i.indices[d]=7;s!=null&&s.silent||Reactive.dispatch(i,"cleared")}e.clearAll=l;function r(i,s){for(let d=0;d<i.transientIndices.length;d++){const g=i.transientIndices[d];i.indices[g]=c(i.indices[g])}s!=null&&s.silent||Reactive.dispatch(i,"cleared")}e.clearTransient=r;function u(i){const{factor:s,indices:d}=i;return g=>s.data[LAYER][d[g]]}e.getLayer=u;function a(i){return!(i&4)}e.isTransient=a;function f(i){return i&-5}function c(i){return i|4}})(Marker||(Marker={}));const LAYER=Symbol("layer");var Bars;(e=>{function t(r){const u={},a=[],f=Geom.Type.Bars,c=(r==null?void 0:r.vAnchor)??VAnchor.Bottom,i=(r==null?void 0:r.hAnchor)??HAnchor.Center,s=(r==null?void 0:r.postfn)??identity;return{type:f,data:a,scales:u,postfn:s,vAnchor:c,hAnchor:i}}e.of=t;function n(r,u){const{scales:a,postfn:f,hAnchor:c,vAnchor:i}=r,s=Geom.groupedData(r),d=findLength(Object.values(s)),g=["x","y","width","height",LAYER],[x,p,h,m,y]=Geom.getters(s,g);for(let v=0;v<d;v++){let S=exports.Scale.pushforward(a.x,x(v)),k=exports.Scale.pushforward(a.y,p(v)),E=exports.Scale.pushforward(a.width,h(v)),w=exports.Scale.pushforward(a.height,m(v));const M=u[y(v)],b=[S,k,E,w];f(b),Frame.rectangleWH(M,...b,{hAnchor:c,vAnchor:i})}}e.render=n;function o(r,u){const{scales:a,postfn:f,hAnchor:c,vAnchor:i}=r,s=Geom.flatData(r),d=findLength(Object.values(s)),g=["x","y","width","height",POSITIONS],[x,p,h,m,y]=Geom.getters(s,g),v=[];for(let S=0;S<d;S++){let k=exports.Scale.pushforward(a.x,x(S)),E=exports.Scale.pushforward(a.y,p(S)),w=exports.Scale.pushforward(a.width,h(S)),M=exports.Scale.pushforward(a.height,m(S));const b=[k,E,w,M];f(b),[k,E,w,M]=b;const A=[k-w*c,E-M*i,k+w*c,E+M*(1-i)];if(rectsIntersect(u,A)){const z=y(S);for(let T=0;T<z.length;T++)v.push(z[T])}}return v}e.check=o;function l(r,u){const{scales:a,postfn:f,hAnchor:c,vAnchor:i}=r,s=Geom.flatData(r),d=findLength(Object.values(s)),g=["x","y","width","height"],[x,p,h,m]=Geom.getters(s,g);for(let y=0;y<d;y++){let v=exports.Scale.pushforward(a.x,x(y)),S=exports.Scale.pushforward(a.y,p(y)),k=exports.Scale.pushforward(a.width,h(y)),E=exports.Scale.pushforward(a.height,m(y));const w=[v,S,k,E];f(w),[v,S,k,E]=w;const M=[v-k*c,S-E*i,v+k*c,S+E*(1-i)];if(pointInRect(u,M)){const b={};Meta.has(s.x,"name")&&(b[Meta.get(s.x,"name")]=x(y)),Meta.has(s.y,"name")&&(b[Meta.get(s.y,"name")]=p(y)),Meta.has(s.height,"name")&&(b[Meta.get(s.height,"name")]=m(y));for(const[A,z]of Object.entries(s))["x","y","width","height"].includes(A)||z&&Meta.has(z,"name")&&(b[Meta.get(z,"name")]=Geom.getter(z)(y));return b}}}e.query=l})(Bars||(Bars={}));var Lines;(e=>{function t(){const r={},u=[];return{type:Geom.Type.Lines,data:u,scales:r}}e.of=t;function n(r,u){const{scales:a}=r,f=Geom.groupedData(r),c=findLength(Object.values(f)),i=["x","y",LAYER],[s,d,g]=Geom.getters(f,i);for(let x=0;x<c;x++){const p=exports.Scale.pushforward(a.x,s(x)),h=exports.Scale.pushforward(a.y,d(x)),m=u[g(x)];Frame.line(m,p,h)}}e.render=n;function o(r,u){const{scales:a}=r,f=Geom.flatData(r),c=findLength(Object.values(f)),i=["x","y",POSITIONS],[s,d,g]=Geom.getters(f,i),x=[];for(let p=0;p<c;p++){const h=exports.Scale.pushforward(a.x,s(p)),m=exports.Scale.pushforward(a.y,d(p));for(let y=1;y<h.length;y++){const v=[h[y-1],m[y-1],h[y],m[y]];if(rectSegmentIntersect(u,v)){const S=g(p);for(let k=0;k<S.length;k++)x.push(S[k])}}}return x}e.check=o;function l(r,u){let{scales:a}=r;const f=Geom.flatData(r),c=findLength(Object.values(f)),i=["x","y",POSITIONS],[s,d]=Geom.getters(f,i),g=[u[0]-1,u[1]-1,u[0]+1,u[1]+1];for(let x=0;x<c;x++){const p=exports.Scale.pushforward(a.x,s(x)),h=exports.Scale.pushforward(a.y,d(x));for(let m=1;m<p.length;m++){const y=[p[m-1],h[m-1],p[m],h[m]];if(rectSegmentIntersect(g,y)){const v={},[S,k]=[s(x),d(x)];for(let E=0;E<S.length;E++)v[S[E]]=k[E];for(const[E,w]of Object.entries(f))E==="x"||E==="y"||w&&Meta.has(w,"name")&&(v[Meta.get(w,"name")]=Geom.getter(w)(x));return v}}}}e.query=l})(Lines||(Lines={}));var Points;(e=>{function t(){const r={},u=[];return{type:Geom.Type.Points,data:u,scales:r}}e.of=t;function n(r,u){const{scales:a}=r,f=Geom.groupedData(r),c=findLength(Object.values(f)),i=["x","y","size",LAYER],[s,d,g,x]=Geom.getters(f,i);for(let p=0;p<c;p++){const h=exports.Scale.pushforward(a.x,s(p)),m=exports.Scale.pushforward(a.y,d(p)),y=exports.Scale.pushforward(a.size,g(p)),v=u[x(p)];Frame.point(v,h,m,y)}}e.render=n;function o(r,u){const{scales:a}=r,f=Geom.flatData(r),c=findLength(Object.values(f)),i=["x","y","size",POSITIONS],[s,d,g,x]=Geom.getters(f,i),p=[];for(let h=0;h<c;h++){const m=exports.Scale.pushforward(a.x,s(h)),y=exports.Scale.pushforward(a.y,d(h));let v=exports.Scale.pushforward(a.size,g(h));v=v/Math.sqrt(2);const S=[m-v,y-v,m+v,y+v];if(rectsIntersect(u,S)){const k=x(h);for(let E=0;E<k.length;E++)p.push(k[E])}}return p}e.check=o;function l(r,u){const{scales:a}=r,f=Geom.flatData(r),c=findLength(Object.values(f)),i=["x","y","size"],[s,d,g]=Geom.getters(f,i);for(let x=0;x<c;x++){const p=exports.Scale.pushforward(a.x,s(x)),h=exports.Scale.pushforward(a.y,d(x));let m=exports.Scale.pushforward(a.size,g(x));m=m/Math.sqrt(2);const y=[p-m,h-m,p+m,h+m];if(pointInRect(u,y)){const v={};v[Meta.get(f.x,"name")]=s(x),v[Meta.get(f.y,"name")]=d(x);for(const[S,k]of Object.entries(f))S==="x"||S==="y"||k&&Meta.has(k,"name")&&(v[Meta.get(k,"name")]=Geom.getter(k)(x));return v}}}e.query=l})(Points||(Points={}));var Rectangles;(e=>{function t(){const r={},u=[];return{type:Geom.Type.Rectangles,data:u,scales:r}}e.of=t;function n(r,u){const{scales:a}=r,f=Geom.groupedData(r),c=findLength(Object.values(f)),i=["x0","y0","x1","y1","area",LAYER],[s,d,g,x,p,h]=Geom.getters(f,i);for(let m=0;m<c;m++){let y=exports.Scale.pushforward(a.x,s(m)),v=exports.Scale.pushforward(a.y,d(m)),S=exports.Scale.pushforward(a.x,g(m)),k=exports.Scale.pushforward(a.y,x(m));const E=u[h(m)];if(f.area){const w=exports.Scale.pushforward(a.area,p(m)),M=S-y,b=k-v;y=y+(1-w)/2*M,S=S-(1-w)/2*M,v=v+(1-w)/2*b,k=k-(1-w)/2*b}Frame.rectangleXY(E,y,v,S,k)}}e.render=n;function o(r,u){const{scales:a}=r,f=Geom.flatData(r),c=findLength(Object.values(f)),i=["x0","y0","x1","y1","area",POSITIONS],[s,d,g,x,p,h]=Geom.getters(f,i),m=[];for(let y=0;y<c;y++){let v=exports.Scale.pushforward(a.x,s(y)),S=exports.Scale.pushforward(a.y,d(y)),k=exports.Scale.pushforward(a.x,g(y)),E=exports.Scale.pushforward(a.y,x(y));if(f.area){const w=exports.Scale.pushforward(a.area,p(y)),M=k-v,b=E-S;v=v+(1-w)/2*M,k=k-(1-w)/2*M,S=S+(1-w)/2*b,E=E-(1-w)/2*b}if(rectsIntersect(u,[v,S,k,E])){const w=h(y);for(let M=0;M<w.length;M++)m.push(w[M])}}return m}e.check=o;function l(r,u){const{scales:a}=r,f=Geom.flatData(r),c=findLength(Object.values(f)),i=["x0","y0","x1","y1","area"],[s,d,g,x,p]=Geom.getters(f,i);for(let h=0;h<c;h++){let m=exports.Scale.pushforward(a.x,s(h)),y=exports.Scale.pushforward(a.y,d(h)),v=exports.Scale.pushforward(a.x,g(h)),S=exports.Scale.pushforward(a.y,x(h));if(f.area){const k=exports.Scale.pushforward(a.area,p(h)),E=v-m,w=S-y;m=m+(1-k)/2*E,v=v-(1-k)/2*E,y=y+(1-k)/2*w,S=S-(1-k)/2*w}if(pointInRect(u,[m,y,v,S])){const k={};for(const E of Object.values(f))E&&Meta.has(E,"name")&&(k[Meta.get(E,"name")]=Geom.getter(E)(h));return k}}}e.query=l})(Rectangles||(Rectangles={}));var Geom;(e=>{(c=>{c[c.Points=0]="Points",c[c.Bars=1]="Bars",c[c.Rectangles=2]="Rectangles",c[c.Lines=3]="Lines"})(e.Type||(e.Type={}));const t={0:Points,1:Bars,2:Rectangles,3:Lines};function n(c){return c.data[c.data.length-2]}e.flatData=n;function o(c){return c.data[c.data.length-1]}e.groupedData=o;function l(c,i=()=>.5){return makeGetter(c??i)}e.getter=l;function r(c,i,s=()=>.5){return i.map(d=>e.getter(c[d],s))}e.getters=r;function u(c,i){t[c.type].render(c,i)}e.render=u;function a(c,i){return t[c.type].check(c,i)}e.check=a;function f(c,i){return t[c.type].query(c,i)}e.query=f})(Geom||(Geom={}));const PARENT=Symbol("parent"),VALUES=Symbol("values"),INDICES=Symbol("indices"),FACTOR=Symbol("factor"),REDUCER=Symbol("reducer");var Reduced;(e=>{function t(d,g,x,p){const h=d;return h[VALUES]=d,h[FACTOR]=g,h[REDUCER]=x,p&&n(h,p),h}e.of=t;function n(d,g){d[PARENT]=g}e.setParent=n;function o(d){const[,g,x,p]=s(d);if(!p)throw new Error("Parent missing");const h=exports.Factor.parentIndices(a(p),g),m=subset(p,h),y=t(m,a(p),x,f(p));return c(y,p),i(y,h),Meta.copy(y,d,["name"]),y}e.parent=o;function l(d){const[g,x,p,h,m]=s(d);if(!h)throw new Error("Cannot stack a without a parent");const y=exports.Factor.parentIndices(a(h),x),{reducefn:v,initialfn:S}=p,[k,E]=[g.length,[]],w=Array.from(Array(k),()=>S()),M=Getter.of(y);for(let z=0;z<g.length;z++){const T=M(z);E[T]===void 0&&(E[T]=S()),E[T]=v(E[T],g[z]),w[z]=E[T]}const b=m?subset(w,m):w,A=e.of(b,x,p,h);return c(A,w),m&&i(A,m),Meta.copy(A,d,["name"]),A}e.stack=l;function r(d,g){const[x,p,h,m,y]=s(d);if(!m)throw new Error("Cannot normalize a without a parent");const v=exports.Factor.parentIndices(a(m),p),S=subset(m,v),k=[...x];for(let M=0;M<d.length;M++)k[M]=g(k[M],S[M]);const E=y?subset(k,y):k,w=e.of(E,p,h,m);return c(w,k),y&&i(w,y),Meta.copy(w,d,["name"]),w}e.normalize=r;function u(d){const[g,x,p,h,m]=s(d),y=[];y.push(p.initialfn());for(let k=0;k<g.length-1;k++)y.push(g[k]);const v=m?subset(y,m):y,S=e.of(v,x,p,h);return c(S,y),m&&i(S,m),Meta.copy(S,d,["name"]),S}e.shiftLeft=u;function a(d){return d[FACTOR]}function f(d){return d[PARENT]}e.getParent=f;function c(d,g){d[VALUES]=g}function i(d,g){d[INDICES]=g}function s(d){return[d[VALUES],d[FACTOR],d[REDUCER],d[PARENT],d[INDICES]]}})(Reduced||(Reduced={})),exports.Reducer=void 0,(Reducer=>{Reducer.sum={name:"sum",fallback:"count",initialfn:()=>0,reducefn:(e,t)=>e+t},Reducer.max={name:"max",initialfn:()=>-1/0,reducefn:(e,t)=>Math.max(e,t)},Reducer.product={name:"product",initialfn:()=>1,reducefn:(e,t)=>e*t},Reducer.table={name:"table",initialfn:()=>({}),reducefn:(e,t)=>(e[t]=e[t]+1||0,e)};function parse(value){if(typeof value=="string")return Reducer[value];if(typeof value.initialfn=="string"&&typeof value.reducefn=="string"){const parsed={name:value.name};return parsed.initialfn=eval(value.initialfn),parsed.reducefn=eval(value.reducefn),parsed}return value}Reducer.parse=parse;function reduce(e,t,n){const{indices:o,cardinality:l}=t,{initialfn:r,reducefn:u}=n,a=Array.from(Array(l),()=>r()),f=makeGetter(o),c=makeGetter(e);for(let s=0;s<o.length;s++)a[f(s)]=u(a[f(s)],c(s));const i=Reduced.of(a,t,n);return Meta.copy(i,e),Meta.set(i,"name",getName(a,n)??"[unknown summary]"),i}Reducer.reduce=reduce;function getName(e,t){return Meta.has(e,"name")?`${t.name} of ${Meta.get(e,"name")}`:t.fallback}Reducer.getName=getName})(exports.Reducer||(exports.Reducer={}));var Summaries;(e=>{function t(r,u){const a=[];for(let f=0;f<u.length;f++){const c=u[f],i=n(r,c),s=Reactive.of()(merge(i,c.data));if(a.push(s),f>0)for(const d of Object.keys(i)){const g=a[f-1][d];Reduced.setParent(i[d],g)}Reactive.listen(c,"changed",()=>{const d=n(r,c);for(const g of Object.keys(d))copyValues(d[g],i[g])}),Reactive.propagate(c,s,"changed")}return a}e.of=t;function n(r,u){const a={};for(const[f,c]of Object.entries(r)){const[i,s]=c;a[f]=exports.Reducer.reduce(i,u,s)}return a}function o(r,u){const a=[];for(let f=0;f<r.length;f++){let c=function(s){const d=u[f](s),g=Reflect.ownKeys(s);for(const x of g)(typeof x=="symbol"||isIntegerString(x))&&(d[x]=s[x]);return d};const i=Reactive.of()(c(r[f]));a.push(i),Reactive.listen(r[f],"changed",()=>{const s=c(r[f]);for(const d of Reflect.ownKeys(s))isArray(s[d])&&isArray(i[d])&&copyValues(s[d],i[d]);Reactive.dispatch(i,"changed")})}return a}e.translate=o;function l(r,u){const a={};let f=0;for(const[c,i]of r)a[`q${f++}`]=[c(u),i];return a}e.formatQueries=l})(Summaries||(Summaries={}));function Barplot(e,t,n){const{data:o,marker:l}=e;let[r,u]=t(o);const a=u&&(n!=null&&n.reducer)?n.reducer:exports.Reducer.sum,f=u||(()=>1),c=exports.Factor.from(r),i=exports.Factor.product(c,l.factor),s=[c,i],d=n!=null&&n.queries?n.queries(o):{},g=Summaries.of({stat:[f,a],...d},s),x=[],p=0,h={type:"bar",scales:{x:"band"}},m={representation:p,...exports.Plot.of(h),summaries:g,coordinates:x};return Reactive.listen(m,"normalize",()=>switchRepresentation$3(m)),barplot(m),exports.Plot.addGeom(m,Bars.of()),m}function sortAxis(e,t){if(e.ordered)ExpanseBand.reorder(e);else{const n=orderIndices(t);ExpanseBand.reorder(e,n)}}function switchRepresentation$3(e){e.representation===0?spineplot(e):barplot(e)}function barplot(e){const{summaries:t,scales:n}=e,o=Summaries.translate(t,[a=>({x:a.label,y:zero,height:a.stat,width:one}),a=>({x:a.label,y:zero,height:Reduced.stack(a.stat),width:one})]),[l]=o,r={default:!0,ratio:!0};exports.Scale.train(n.x,l.x,r),exports.Scale.train(n.y,l.height,r),exports.Scale.train(n.width,[0,1],r),exports.Scale.train(n.height,l.height,r),exports.Expanse.freeze(n.y.domain,["zero"]),exports.Expanse.freeze(n.height.domain,["zero"]),ExpanseBand.setWeights(n.x.domain);const u=1/new Set(l.x).size;exports.Expanse.linkTo(n.y.domain,n.height.domain),exports.Expanse.set(n.width.codomain,a=>{a.scale=u,a.mult=.9,a.offset=0},{default:!0}),Meta.copy(n.y,l.height,["name"]),Reactive.removeAll(e,"reorder"),Reactive.listen(e,"reorder",()=>sortAxis(n.x.domain,l.height)),e.representation=0,exports.Plot.setData(e,o),exports.Plot.render(e),exports.Plot.renderAxes(e)}function spineplot(e){const{summaries:t,scales:n}=e,o=Summaries.translate(t,[u=>({x:u.label,y:zero,height:one,width:u.stat}),u=>({x:u.label,y:zero,height:Reduced.normalize(Reduced.stack(u.stat),(a,f)=>a/f),width:Reduced.parent(u.stat)})]),[l]=o,r={default:!0,ratio:!0};exports.Scale.train(n.x,l.x,r),exports.Scale.train(n.y,[0,1],r),exports.Scale.train(n.width,cumsum(l.width),r),exports.Scale.train(n.height,[0,1],r),exports.Expanse.freeze(n.y.domain,["zero"]),exports.Expanse.freeze(n.height.domain,["zero"]),ExpanseBand.setWeights(n.x.domain,l.width),exports.Expanse.linkTo(n.y.domain,n.height.domain),exports.Expanse.set(n.width.codomain,u=>{u.scale=1,u.mult=1,u.offset=-1},{default:!0}),Meta.set(n.y,"name","proportion"),Reactive.removeAll(e,"reorder"),Reactive.listen(e,"reorder",()=>sortAxis(n.x.domain,l.width)),e.representation=1,exports.Plot.setData(e,o),exports.Plot.render(e),exports.Plot.renderAxes(e)}function Fluctuationplot(e,t,n){const{data:o,marker:l}=e;let[r,u,a]=t(o);const f=a&&(n!=null&&n.reducer)?n.reducer:exports.Reducer.sum,c=a?[...a]:()=>1,i=exports.Factor.product(exports.Factor.from(r),exports.Factor.from(u)),s=exports.Factor.product(i,l.factor),d=[i,s],g=Summaries.formatQueries((n==null?void 0:n.queries)??[],o),x=Summaries.of({stat:[c,f],...g},d),p=[],h=0,m={type:"fluct",scales:{x:"band",y:"band"}},y={representation:h,...exports.Plot.of(m),summaries:x,coordinates:p};return exports.Scale.shareCodomain(y.scales.area,y.scales.width),exports.Scale.shareCodomain(y.scales.area,y.scales.height),Reactive.listen(y,"normalize",()=>switchRepresentation$2(y)),fluctplot(y),exports.Plot.addGeom(y,Bars.of({vAnchor:VAnchor.Middle})),y}function switchRepresentation$2(e){e.representation===0?pctfluctplot(e):fluctplot(e)}function fluctplot(e){const{summaries:t,scales:n}=e,o=Summaries.translate(t,[a=>({x:a.label,y:a.label$,height:a.stat,width:a.stat}),a=>({x:a.label,y:a.label$,height:Reduced.stack(a.stat),width:Reduced.stack(a.stat)})]),[l]=o,r={default:!0,ratio:!0};exports.Scale.train(n.x,l.x,r),exports.Scale.train(n.y,l.y,r),exports.Scale.train(n.width,l.width,r),exports.Scale.train(n.height,l.height,r);const u=max(new Set(l.x).size,new Set(l.y).size);exports.Expanse.set(n.area.codomain,a=>{a.scale=1/u,a.mult=.9,a.offset=0},{default:!0}),exports.Plot.setData(e,o),e.representation=0,exports.Plot.render(e)}function pctfluctplot(e){const{summaries:t,scales:n}=e,o=Summaries.translate(t,[a=>({x:a.label,y:a.label$,height:one,width:one}),a=>({x:a.label,y:a.label$,height:Reduced.normalize(Reduced.stack(a.stat),(f,c)=>f/c),width:Reduced.normalize(Reduced.stack(a.stat),(f,c)=>f/c)})]),[l]=o,r={default:!0,ratio:!0};exports.Scale.train(n.x,l.x,r),exports.Scale.train(n.y,l.y,r),exports.Scale.train(n.width,[0,1],r),exports.Scale.train(n.height,[0,1],r);const u=max(new Set(l.x).size,new Set(l.y).size);exports.Expanse.set(n.area.codomain,a=>{a.scale=1/u,a.mult=.9,a.offset=-1},{default:!0}),exports.Plot.setData(e,o),e.representation=1,exports.Plot.render(e)}function Histogram(e,t,n){const{data:o,marker:l}=e;let[r,u]=t(o);const a=u&&(n!=null&&n.reducer)?n.reducer:exports.Reducer.sum,f=u||(()=>1),[c,i]=minmax(r),s=i-c,d=Reactive.of()({anchor:c,width:s/15}),g=exports.Factor.mono(r.length),x=exports.Factor.product(g,exports.Factor.bin(r,d)),p=exports.Factor.product(x,l.factor),h=[g,x,p],m=n!=null&&n.queries?n.queries(o):{},y=Summaries.of({stat:[f,a],...m},h),v=0,S=[],k={type:"histo"},E={representation:v,...exports.Plot.of(k),summaries:y,coordinates:S};Reactive.listen(E,"normalize",()=>switchRepresentation$1(E));const w=s/10;return Reactive.listen(E,"grow",()=>Reactive.set(d,M=>M.width*=1.1111111111111112)),Reactive.listen(E,"shrink",()=>Reactive.set(d,M=>M.width*=.9)),Reactive.listen(E,"increment-anchor",()=>Reactive.set(d,M=>M.anchor+=w)),Reactive.listen(E,"decrement-anchor",()=>Reactive.set(d,M=>M.anchor-=w)),Reactive.listen(E,"reset",()=>{Reactive.set(d,M=>(M.anchor=c,M.width=s/15))}),histogram(E),exports.Plot.addGeom(E,Rectangles.of()),E}function switchRepresentation$1(e){e.representation===0?spinogram(e):histogram(e)}function histogram(e){const{summaries:t}=e,n=Summaries.translate(t,[r=>r,r=>({x0:r.binMin,y0:zero,x1:r.binMax,y1:r.stat}),r=>({x0:r.binMin,y0:zero,x1:r.binMax,y1:Reduced.stack(r.stat)})]),{scales:o}=e,[,l]=n;exports.Scale.train(o.x,l.x1,{default:!0,name:!1}),exports.Scale.train(o.y,l.y1,{default:!0,ratio:!0});for(const r of e.data)Reactive.removeAll(r,"changed");Reactive.listen(l,"changed",()=>{exports.Scale.train(o.x,l.x1,{default:!0,name:!1}),exports.Scale.train(o.y,l.y1,{default:!0,ratio:!0})}),exports.Expanse.freeze(o.y.domain,["zero"]),Meta.copy(o.x,t[1].breaks,["name"]),Meta.copy(o.y,l.y1,["name"]),e.representation=0,exports.Plot.setData(e,n),exports.Plot.render(e),exports.Plot.renderAxes(e)}function spinogram(e){const{summaries:t}=e,n=Summaries.translate(t,[r=>r,r=>({x0:Reduced.shiftLeft(Reduced.stack(r.stat)),y0:zero,x1:Reduced.stack(r.stat),y1:one,query1:r.binMin,query2:r.binMax}),r=>({x0:Reduced.shiftLeft(Reduced.stack(Reduced.parent(r.stat))),y0:zero,x1:Reduced.stack(Reduced.parent(r.stat)),y1:Reduced.normalize(Reduced.stack(r.stat),(u,a)=>u/a)})]),{scales:o}=e,[,l]=n;exports.Scale.train(o.x,[0,...l.x1],{default:!0,name:!1}),exports.Scale.train(o.y,[0,1],{default:!0,ratio:!0}),Reactive.listen(l,"changed",()=>{exports.Scale.train(o.x,[0,...l.x1],{default:!0,name:!1})}),exports.Expanse.freeze(o.y.domain,["zero"]),Meta.set(o.x,"name","cumulative count"),Meta.set(o.y,"name","proportion"),exports.Plot.setData(e,n),e.representation=1,exports.Plot.render(e),exports.Plot.renderAxes(e)}function Histogram2d(e,t,n){const{data:o,marker:l}=e;let[r,u,a]=t(o);const f=a&&(n!=null&&n.reducer)?n.reducer:exports.Reducer.sum,c=a||(()=>1),[i,s]=minmax(r),[d,g]=minmax(u),[x,p]=[s-i,g-d],h=Reactive.of()({anchor:i,width:x/15}),m=Reactive.of()({anchor:d,width:p/15}),y=exports.Factor.bin(r,h),v=exports.Factor.bin(u,m),S=exports.Factor.product(y,v),k=exports.Factor.product(S,l.factor),E=[S,k],w=n!=null&&n.queries?n.queries(o):{},M=Summaries.of({stat:[c,f],...w},E),b=0,A=[],z={type:"histo2d",ratio:n==null?void 0:n.ratio},T={representation:b,...exports.Plot.of(z),summaries:M,coordinates:A};return Reactive.listen(T,"normalize",()=>switchRepresentation(T)),Reactive.listen(T,"grow",()=>{Reactive.set(h,L=>L.width*=1.1111111111111112),Reactive.set(m,L=>L.width*=1.1111111111111112)}),Reactive.listen(T,"shrink",()=>{Reactive.set(h,L=>L.width*=.9),Reactive.set(m,L=>L.width*=.9)}),Reactive.listen(T,"reset",()=>{Reactive.set(h,L=>(L.anchor=i,L.width=x/15)),Reactive.set(m,L=>(L.anchor=d,L.width=p/15))}),histogram2d(T),exports.Plot.addGeom(T,Rectangles.of()),T}function switchRepresentation(e){e.representation===0?spinogram2d(e):histogram2d(e)}function histogram2d(e){const{summaries:t}=e,n=Summaries.translate(t,[r=>({x0:r.binMin,y0:r.binMin$,x1:r.binMax,y1:r.binMax$,area:r.stat}),r=>({x0:r.binMin,y0:r.binMin$,x1:r.binMax,y1:r.binMax$,area:Reduced.stack(r.stat)})]),{scales:o}=e,[,l]=n;exports.Scale.train(o.x,l.x1,{default:!0}),exports.Scale.train(o.y,l.y1,{default:!0}),exports.Scale.train(o.area,l.area,{default:!0}),exports.Expanse.set(o.area.codomain,r=>(r.min=0,r.max=1),{default:!0}),exports.Expanse.freeze(o.area.codomain,["min","max"]);for(const r of e.data)Reactive.removeAll(r,"changed");Reactive.listen(l,"changed",()=>{exports.Scale.train(o.x,l.x1,{default:!0,name:!1}),exports.Scale.train(o.y,l.y1,{default:!0,name:!1}),exports.Scale.train(o.area,l.area,{default:!0})}),e.representation=0,exports.Plot.setData(e,n),Meta.copy(o.x,t[1].breaks,["name"]),Meta.copy(o.y,t[1].breaks$,["name"]),exports.Plot.render(e),exports.Plot.renderAxes(e)}function spinogram2d(e){const{summaries:t}=e,n=Summaries.translate(t,[r=>({x0:r.binMin,y0:r.binMin$,x1:r.binMax,y1:r.binMax$,area:one}),r=>({x0:r.binMin,y0:r.binMin$,x1:r.binMax,y1:r.binMax$,area:Reduced.normalize(Reduced.stack(r.stat),(u,a)=>u/a)})]),{scales:o}=e,[,l]=n;exports.Scale.train(o.x,l.x1,{default:!0}),exports.Scale.train(o.y,l.y1,{default:!0}),exports.Scale.train(o.area,[0,1],{default:!0}),exports.Expanse.set(o.area.codomain,r=>(r.min=0,r.max=1),{default:!0}),exports.Expanse.freeze(o.area.codomain,["min","max"]);for(const r of e.data)Reactive.removeAll(r,"changed");Reactive.listen(l,"changed",()=>{exports.Scale.train(o.x,l.x1,{default:!0,name:!1}),exports.Scale.train(o.y,l.y1,{default:!0,name:!1})}),e.representation=1,exports.Plot.setData(e,n),Meta.copy(o.x,t[1].breaks,["name"]),Meta.copy(o.y,t[1].breaks$,["name"]),exports.Plot.render(e),exports.Plot.renderAxes(e)}function Pcoordsplot(e,t,n){const{data:o,marker:l}=e,r=t(o),u=r.map(k=>Meta.get(k,"name")),a=Getter.constant(u),f=Getter.multi(r),c=n!=null&&n.queries?n.queries(o):{},i=exports.Factor.bijection({x:a,y:f,...c}),s=exports.Factor.product(i,l.factor),d=Summaries.of({},[i,s]),g=Summaries.translate(d,[k=>k,k=>k]),x=exports.Plot.of({type:"pcoords"}),{scales:p}=x,{expandX:h,expandY:m}=e.options,y={zero:h,one:1-h},v={zero:m,one:1-m};exports.Scale.setDomain(p.x,exports.Expanse.split(exports.Expanse.point(u,y))),exports.Scale.setCoomain(p.x,exports.Expanse.split(p.x.codomain));const S=r.map(k=>exports.Expanse.infer(k));return exports.Scale.setDomain(p.y,exports.Expanse.compound(S,v)),exports.Scale.setCoomain(p.y,exports.Expanse.split(p.y.codomain)),Meta.set(p.x,"name","variable"),Meta.set(p.y,"name","value"),exports.Plot.setData(x,g),exports.Plot.addGeom(x,Lines.of()),x}function Scatterplot(e,t,n){const{data:o,marker:l}=e,[r,u,a]=t(o),f=n!=null&&n.queries?n==null?void 0:n.queries(o):{},c={x:r,y:u,size:a??(()=>.5),...f},i=exports.Factor.bijection(c),s=exports.Factor.product(i,l.factor),d=Summaries.of({},[i,s]),g=Summaries.translate(d,[h=>h,h=>h]),x=exports.Plot.of({type:"scatter",ratio:n==null?void 0:n.ratio}),{scales:p}=x;return exports.Scale.train(p.x,r,{default:!0}),exports.Scale.train(p.y,u,{default:!0}),a&&exports.Scale.train(p.size,a,{default:!0}),exports.Plot.setData(x,g),exports.Plot.addGeom(x,Points.of()),{...x,summaries:d}}function _typeof(e){"@babel/helpers - typeof";return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(e)}var trimLeft=/^\s+/,trimRight=/\s+$/;function tinycolor(e,t){if(e=e||"",t=t||{},e instanceof tinycolor)return e;if(!(this instanceof tinycolor))return new tinycolor(e,t);var n=inputToRGB(e);this._originalInput=e,this._r=n.r,this._g=n.g,this._b=n.b,this._a=n.a,this._roundA=Math.round(100*this._a)/100,this._format=t.format||n.format,this._gradientType=t.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=n.ok}tinycolor.prototype={isDark:function e(){return this.getBrightness()<128},isLight:function e(){return!this.isDark()},isValid:function e(){return this._ok},getOriginalInput:function e(){return this._originalInput},getFormat:function e(){return this._format},getAlpha:function e(){return this._a},getBrightness:function e(){var t=this.toRgb();return(t.r*299+t.g*587+t.b*114)/1e3},getLuminance:function e(){var t=this.toRgb(),n,o,l,r,u,a;return n=t.r/255,o=t.g/255,l=t.b/255,n<=.03928?r=n/12.92:r=Math.pow((n+.055)/1.055,2.4),o<=.03928?u=o/12.92:u=Math.pow((o+.055)/1.055,2.4),l<=.03928?a=l/12.92:a=Math.pow((l+.055)/1.055,2.4),.2126*r+.7152*u+.0722*a},setAlpha:function e(t){return this._a=boundAlpha(t),this._roundA=Math.round(100*this._a)/100,this},toHsv:function e(){var t=rgbToHsv(this._r,this._g,this._b);return{h:t.h*360,s:t.s,v:t.v,a:this._a}},toHsvString:function e(){var t=rgbToHsv(this._r,this._g,this._b),n=Math.round(t.h*360),o=Math.round(t.s*100),l=Math.round(t.v*100);return this._a==1?"hsv("+n+", "+o+"%, "+l+"%)":"hsva("+n+", "+o+"%, "+l+"%, "+this._roundA+")"},toHsl:function e(){var t=rgbToHsl(this._r,this._g,this._b);return{h:t.h*360,s:t.s,l:t.l,a:this._a}},toHslString:function e(){var t=rgbToHsl(this._r,this._g,this._b),n=Math.round(t.h*360),o=Math.round(t.s*100),l=Math.round(t.l*100);return this._a==1?"hsl("+n+", "+o+"%, "+l+"%)":"hsla("+n+", "+o+"%, "+l+"%, "+this._roundA+")"},toHex:function e(t){return rgbToHex(this._r,this._g,this._b,t)},toHexString:function e(t){return"#"+this.toHex(t)},toHex8:function e(t){return rgbaToHex(this._r,this._g,this._b,this._a,t)},toHex8String:function e(t){return"#"+this.toHex8(t)},toRgb:function e(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function e(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function e(){return{r:Math.round(bound01(this._r,255)*100)+"%",g:Math.round(bound01(this._g,255)*100)+"%",b:Math.round(bound01(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function e(){return this._a==1?"rgb("+Math.round(bound01(this._r,255)*100)+"%, "+Math.round(bound01(this._g,255)*100)+"%, "+Math.round(bound01(this._b,255)*100)+"%)":"rgba("+Math.round(bound01(this._r,255)*100)+"%, "+Math.round(bound01(this._g,255)*100)+"%, "+Math.round(bound01(this._b,255)*100)+"%, "+this._roundA+")"},toName:function e(){return this._a===0?"transparent":this._a<1?!1:hexNames[rgbToHex(this._r,this._g,this._b,!0)]||!1},toFilter:function e(t){var n="#"+rgbaToArgbHex(this._r,this._g,this._b,this._a),o=n,l=this._gradientType?"GradientType = 1, ":"";if(t){var r=tinycolor(t);o="#"+rgbaToArgbHex(r._r,r._g,r._b,r._a)}return"progid:DXImageTransform.Microsoft.gradient("+l+"startColorstr="+n+",endColorstr="+o+")"},toString:function e(t){var n=!!t;t=t||this._format;var o=!1,l=this._a<1&&this._a>=0,r=!n&&l&&(t==="hex"||t==="hex6"||t==="hex3"||t==="hex4"||t==="hex8"||t==="name");return r?t==="name"&&this._a===0?this.toName():this.toRgbString():(t==="rgb"&&(o=this.toRgbString()),t==="prgb"&&(o=this.toPercentageRgbString()),(t==="hex"||t==="hex6")&&(o=this.toHexString()),t==="hex3"&&(o=this.toHexString(!0)),t==="hex4"&&(o=this.toHex8String(!0)),t==="hex8"&&(o=this.toHex8String()),t==="name"&&(o=this.toName()),t==="hsl"&&(o=this.toHslString()),t==="hsv"&&(o=this.toHsvString()),o||this.toHexString())},clone:function e(){return tinycolor(this.toString())},_applyModification:function e(t,n){var o=t.apply(null,[this].concat([].slice.call(n)));return this._r=o._r,this._g=o._g,this._b=o._b,this.setAlpha(o._a),this},lighten:function e(){return this._applyModification(_lighten,arguments)},brighten:function e(){return this._applyModification(_brighten,arguments)},darken:function e(){return this._applyModification(_darken,arguments)},desaturate:function e(){return this._applyModification(_desaturate,arguments)},saturate:function e(){return this._applyModification(_saturate,arguments)},greyscale:function e(){return this._applyModification(_greyscale,arguments)},spin:function e(){return this._applyModification(_spin,arguments)},_applyCombination:function e(t,n){return t.apply(null,[this].concat([].slice.call(n)))},analogous:function e(){return this._applyCombination(_analogous,arguments)},complement:function e(){return this._applyCombination(_complement,arguments)},monochromatic:function e(){return this._applyCombination(_monochromatic,arguments)},splitcomplement:function e(){return this._applyCombination(_splitcomplement,arguments)},triad:function e(){return this._applyCombination(polyad,[3])},tetrad:function e(){return this._applyCombination(polyad,[4])}},tinycolor.fromRatio=function(e,t){if(_typeof(e)=="object"){var n={};for(var o in e)e.hasOwnProperty(o)&&(o==="a"?n[o]=e[o]:n[o]=convertToPercentage(e[o]));e=n}return tinycolor(e,t)};function inputToRGB(e){var t={r:0,g:0,b:0},n=1,o=null,l=null,r=null,u=!1,a=!1;return typeof e=="string"&&(e=stringInputToObject(e)),_typeof(e)=="object"&&(isValidCSSUnit(e.r)&&isValidCSSUnit(e.g)&&isValidCSSUnit(e.b)?(t=rgbToRgb(e.r,e.g,e.b),u=!0,a=String(e.r).substr(-1)==="%"?"prgb":"rgb"):isValidCSSUnit(e.h)&&isValidCSSUnit(e.s)&&isValidCSSUnit(e.v)?(o=convertToPercentage(e.s),l=convertToPercentage(e.v),t=hsvToRgb(e.h,o,l),u=!0,a="hsv"):isValidCSSUnit(e.h)&&isValidCSSUnit(e.s)&&isValidCSSUnit(e.l)&&(o=convertToPercentage(e.s),r=convertToPercentage(e.l),t=hslToRgb(e.h,o,r),u=!0,a="hsl"),e.hasOwnProperty("a")&&(n=e.a)),n=boundAlpha(n),{ok:u,format:e.format||a,r:Math.min(255,Math.max(t.r,0)),g:Math.min(255,Math.max(t.g,0)),b:Math.min(255,Math.max(t.b,0)),a:n}}function rgbToRgb(e,t,n){return{r:bound01(e,255)*255,g:bound01(t,255)*255,b:bound01(n,255)*255}}function rgbToHsl(e,t,n){e=bound01(e,255),t=bound01(t,255),n=bound01(n,255);var o=Math.max(e,t,n),l=Math.min(e,t,n),r,u,a=(o+l)/2;if(o==l)r=u=0;else{var f=o-l;switch(u=a>.5?f/(2-o-l):f/(o+l),o){case e:r=(t-n)/f+(t<n?6:0);break;case t:r=(n-e)/f+2;break;case n:r=(e-t)/f+4;break}r/=6}return{h:r,s:u,l:a}}function hslToRgb(e,t,n){var o,l,r;e=bound01(e,360),t=bound01(t,100),n=bound01(n,100);function u(c,i,s){return s<0&&(s+=1),s>1&&(s-=1),s<.16666666666666666?c+(i-c)*6*s:s<.5?i:s<.6666666666666666?c+(i-c)*(.6666666666666666-s)*6:c}if(t===0)o=l=r=n;else{var a=n<.5?n*(1+t):n+t-n*t,f=2*n-a;o=u(f,a,e+.3333333333333333),l=u(f,a,e),r=u(f,a,e-.3333333333333333)}return{r:o*255,g:l*255,b:r*255}}function rgbToHsv(e,t,n){e=bound01(e,255),t=bound01(t,255),n=bound01(n,255);var o=Math.max(e,t,n),l=Math.min(e,t,n),r,u,a=o,f=o-l;if(u=o===0?0:f/o,o==l)r=0;else{switch(o){case e:r=(t-n)/f+(t<n?6:0);break;case t:r=(n-e)/f+2;break;case n:r=(e-t)/f+4;break}r/=6}return{h:r,s:u,v:a}}function hsvToRgb(e,t,n){e=bound01(e,360)*6,t=bound01(t,100),n=bound01(n,100);var o=Math.floor(e),l=e-o,r=n*(1-t),u=n*(1-l*t),a=n*(1-(1-l)*t),f=o%6,c=[n,u,r,r,a,n][f],i=[a,n,n,u,r,r][f],s=[r,r,a,n,n,u][f];return{r:c*255,g:i*255,b:s*255}}function rgbToHex(e,t,n,o){var l=[pad2(Math.round(e).toString(16)),pad2(Math.round(t).toString(16)),pad2(Math.round(n).toString(16))];return o&&l[0].charAt(0)==l[0].charAt(1)&&l[1].charAt(0)==l[1].charAt(1)&&l[2].charAt(0)==l[2].charAt(1)?l[0].charAt(0)+l[1].charAt(0)+l[2].charAt(0):l.join("")}function rgbaToHex(e,t,n,o,l){var r=[pad2(Math.round(e).toString(16)),pad2(Math.round(t).toString(16)),pad2(Math.round(n).toString(16)),pad2(convertDecimalToHex(o))];return l&&r[0].charAt(0)==r[0].charAt(1)&&r[1].charAt(0)==r[1].charAt(1)&&r[2].charAt(0)==r[2].charAt(1)&&r[3].charAt(0)==r[3].charAt(1)?r[0].charAt(0)+r[1].charAt(0)+r[2].charAt(0)+r[3].charAt(0):r.join("")}function rgbaToArgbHex(e,t,n,o){var l=[pad2(convertDecimalToHex(o)),pad2(Math.round(e).toString(16)),pad2(Math.round(t).toString(16)),pad2(Math.round(n).toString(16))];return l.join("")}tinycolor.equals=function(e,t){return!e||!t?!1:tinycolor(e).toRgbString()==tinycolor(t).toRgbString()},tinycolor.random=function(){return tinycolor.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})};function _desaturate(e,t){t=t===0?0:t||10;var n=tinycolor(e).toHsl();return n.s-=t/100,n.s=clamp01(n.s),tinycolor(n)}function _saturate(e,t){t=t===0?0:t||10;var n=tinycolor(e).toHsl();return n.s+=t/100,n.s=clamp01(n.s),tinycolor(n)}function _greyscale(e){return tinycolor(e).desaturate(100)}function _lighten(e,t){t=t===0?0:t||10;var n=tinycolor(e).toHsl();return n.l+=t/100,n.l=clamp01(n.l),tinycolor(n)}function _brighten(e,t){t=t===0?0:t||10;var n=tinycolor(e).toRgb();return n.r=Math.max(0,Math.min(255,n.r-Math.round(255*-(t/100)))),n.g=Math.max(0,Math.min(255,n.g-Math.round(255*-(t/100)))),n.b=Math.max(0,Math.min(255,n.b-Math.round(255*-(t/100)))),tinycolor(n)}function _darken(e,t){t=t===0?0:t||10;var n=tinycolor(e).toHsl();return n.l-=t/100,n.l=clamp01(n.l),tinycolor(n)}function _spin(e,t){var n=tinycolor(e).toHsl(),o=(n.h+t)%360;return n.h=o<0?360+o:o,tinycolor(n)}function _complement(e){var t=tinycolor(e).toHsl();return t.h=(t.h+180)%360,tinycolor(t)}function polyad(e,t){if(isNaN(t)||t<=0)throw new Error("Argument to polyad must be a positive number");for(var n=tinycolor(e).toHsl(),o=[tinycolor(e)],l=360/t,r=1;r<t;r++)o.push(tinycolor({h:(n.h+r*l)%360,s:n.s,l:n.l}));return o}function _splitcomplement(e){var t=tinycolor(e).toHsl(),n=t.h;return[tinycolor(e),tinycolor({h:(n+72)%360,s:t.s,l:t.l}),tinycolor({h:(n+216)%360,s:t.s,l:t.l})]}function _analogous(e,t,n){t=t||6,n=n||30;var o=tinycolor(e).toHsl(),l=360/n,r=[tinycolor(e)];for(o.h=(o.h-(l*t>>1)+720)%360;--t;)o.h=(o.h+l)%360,r.push(tinycolor(o));return r}function _monochromatic(e,t){t=t||6;for(var n=tinycolor(e).toHsv(),o=n.h,l=n.s,r=n.v,u=[],a=1/t;t--;)u.push(tinycolor({h:o,s:l,v:r})),r=(r+a)%1;return u}tinycolor.mix=function(e,t,n){n=n===0?0:n||50;var o=tinycolor(e).toRgb(),l=tinycolor(t).toRgb(),r=n/100,u={r:(l.r-o.r)*r+o.r,g:(l.g-o.g)*r+o.g,b:(l.b-o.b)*r+o.b,a:(l.a-o.a)*r+o.a};return tinycolor(u)},tinycolor.readability=function(e,t){var n=tinycolor(e),o=tinycolor(t);return(Math.max(n.getLuminance(),o.getLuminance())+.05)/(Math.min(n.getLuminance(),o.getLuminance())+.05)},tinycolor.isReadable=function(e,t,n){var o=tinycolor.readability(e,t),l,r;switch(r=!1,l=validateWCAG2Parms(n),l.level+l.size){case"AAsmall":case"AAAlarge":r=o>=4.5;break;case"AAlarge":r=o>=3;break;case"AAAsmall":r=o>=7;break}return r},tinycolor.mostReadable=function(e,t,n){var o=null,l=0,r,u,a,f;n=n||{},u=n.includeFallbackColors,a=n.level,f=n.size;for(var c=0;c<t.length;c++)r=tinycolor.readability(e,t[c]),r>l&&(l=r,o=tinycolor(t[c]));return tinycolor.isReadable(e,o,{level:a,size:f})||!u?o:(n.includeFallbackColors=!1,tinycolor.mostReadable(e,["#fff","#000"],n))};var names=tinycolor.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},hexNames=tinycolor.hexNames=flip(names);function flip(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[e[n]]=n);return t}function boundAlpha(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function bound01(e,t){isOnePointZero(e)&&(e="100%");var n=isPercentage(e);return e=Math.min(t,Math.max(0,parseFloat(e))),n&&(e=parseInt(e*t,10)/100),Math.abs(e-t)<1e-6?1:e%t/parseFloat(t)}function clamp01(e){return Math.min(1,Math.max(0,e))}function parseIntFromHex(e){return parseInt(e,16)}function isOnePointZero(e){return typeof e=="string"&&e.indexOf(".")!=-1&&parseFloat(e)===1}function isPercentage(e){return typeof e=="string"&&e.indexOf("%")!=-1}function pad2(e){return e.length==1?"0"+e:""+e}function convertToPercentage(e){return e<=1&&(e=e*100+"%"),e}function convertDecimalToHex(e){return Math.round(parseFloat(e)*255).toString(16)}function convertHexToDecimal(e){return parseIntFromHex(e)/255}var matchers=function(){var e="[-\\+]?\\d+%?",t="[-\\+]?\\d*\\.\\d+%?",n="(?:"+t+")|(?:"+e+")",o="[\\s|\\(]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")\\s*\\)?",l="[\\s|\\(]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")\\s*\\)?";return{CSS_UNIT:new RegExp(n),rgb:new RegExp("rgb"+o),rgba:new RegExp("rgba"+l),hsl:new RegExp("hsl"+o),hsla:new RegExp("hsla"+l),hsv:new RegExp("hsv"+o),hsva:new RegExp("hsva"+l),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function isValidCSSUnit(e){return!!matchers.CSS_UNIT.exec(e)}function stringInputToObject(e){e=e.replace(trimLeft,"").replace(trimRight,"").toLowerCase();var t=!1;if(names[e])e=names[e],t=!0;else if(e=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var n;return(n=matchers.rgb.exec(e))?{r:n[1],g:n[2],b:n[3]}:(n=matchers.rgba.exec(e))?{r:n[1],g:n[2],b:n[3],a:n[4]}:(n=matchers.hsl.exec(e))?{h:n[1],s:n[2],l:n[3]}:(n=matchers.hsla.exec(e))?{h:n[1],s:n[2],l:n[3],a:n[4]}:(n=matchers.hsv.exec(e))?{h:n[1],s:n[2],v:n[3]}:(n=matchers.hsva.exec(e))?{h:n[1],s:n[2],v:n[3],a:n[4]}:(n=matchers.hex8.exec(e))?{r:parseIntFromHex(n[1]),g:parseIntFromHex(n[2]),b:parseIntFromHex(n[3]),a:convertHexToDecimal(n[4]),format:t?"name":"hex8"}:(n=matchers.hex6.exec(e))?{r:parseIntFromHex(n[1]),g:parseIntFromHex(n[2]),b:parseIntFromHex(n[3]),format:t?"name":"hex"}:(n=matchers.hex4.exec(e))?{r:parseIntFromHex(n[1]+""+n[1]),g:parseIntFromHex(n[2]+""+n[2]),b:parseIntFromHex(n[3]+""+n[3]),a:convertHexToDecimal(n[4]+""+n[4]),format:t?"name":"hex8"}:(n=matchers.hex3.exec(e))?{r:parseIntFromHex(n[1]+""+n[1]),g:parseIntFromHex(n[2]+""+n[2]),b:parseIntFromHex(n[3]+""+n[3]),format:t?"name":"hex"}:!1}function validateWCAG2Parms(e){var t,n;return e=e||{level:"AA",size:"small"},t=(e.level||"AA").toUpperCase(),n=(e.size||"small").toLowerCase(),t!=="AA"&&t!=="AAA"&&(t="AA"),n!=="small"&&n!=="large"&&(n="small"),{level:t,size:n}}const defaultOptions={size:10,expandX:.1,expandY:.1,gapPct:.8,gapPx:1,axisLabelSize:1,axisTitleSize:1.25,margins:[0,0,0,0],colors:[],marginLines:[3.5,3.5,1,1],groupColors:["#984ea3","#e41a1c","#4daf4a","#377eb8"],plotBackground:"#fefffe"};updateOptions(defaultOptions);function updateOptions(e){const t=e.groupColors.length;e.colors.length=2*t;for(let r=0;r<t;r++){const u=e.groupColors[r];e.colors[r]=tinycolor(u).darken(10).saturate(20).toString(),e.colors[t+r]=tinycolor(u).lighten(20).saturate(20).toString()}const{marginLines:n,axisTitleSize:o}=e,l=parseFloat(getComputedStyle(document.documentElement).fontSize);e.margins=n.map(r=>r*l*o)}const React={createElement(e,t,...n){const o=document.createElement(e);for(const[l,r]of Object.entries(t||{}))l.startsWith("on")&&l.toLowerCase()in window?o.addEventListener(l.toLowerCase().slice(2),r):o.setAttribute(l,r);return appendChildren(o,...n),o}};function appendChildren(e,...t){if(t.length===0)return;if(t.length>1){for(const l of t)appendChildren(e,l);return}const n=t[0],o=isNode(n)?n:document.createTextNode(n);e.appendChild(o)}function isNode(e){return e.nodeType!=null}function renderAxisLabels(e){renderSingleAxisLabels(e,"x"),renderSingleAxisLabels(e,"y")}function renderSingleAxisLabels(e,t){const{frames:n,scales:o,options:l}=e,{margins:r}=l,u=o[t],a=t==="x"?o.y:o.x,f=n[`${t}Axis`],{context:c}=f,{labels:i,positions:s}=exports.Scale.breaks(u),[d,g,x,p]=r,h=parseInt(c.font.match(/^[0-9]*/)[0],10),m=a.codomain.min-h/2,{width:y,height:v}=f;if(Frame.clear(f),t==="x"){let[S,k]=[0,0];for(let E=0;E<i.length;E++){const w=i[E],M=s[E],b=Frame.textWidth(f,w)+1;outside(M,g,y-p)||overlap(S,M,k,b)||([S,k]=[M,b],Frame.text(f,M,m,w))}}else if(t==="y"){let[S,k]=[0,0];for(let E=0;E<i.length;E++){const w=i[E],M=s[E],b=Frame.textWidth(f,w)+1,A=Frame.textHeight(f,w)+1;r[1]/2<b+A&&(r[1]*=1.05,exports.Plot.resize(e)),!outside(M,d,v-x)&&(overlap(S,M,k,A)||([S,k]=[M,A],Frame.text(f,m,M,w)))}}}function renderAxisTitles(e){renderSingleAxisTitle(e,"x"),renderSingleAxisTitle(e,"y")}function renderSingleAxisTitle(e,t){const{scales:n,frames:o,options:l}=e,{margins:r}=l,u=n[t],a=t==="x"?e.scales.y:e.scales.x,f=o.base,c=Meta.get(u,"name"),i=t==="x"?r[0]:r[1],s=exports.Expanse.unnormalize(u.codomain,.5),d=exports.Expanse.unnormalize(a.codomain,0)-i*2/3;t==="x"&&Frame.text(f,s,d,c),t==="y"&&Frame.text(f,d,s,c,{vertical:!0})}function outside(e,t,n){return e<t||e>n}function overlap(e,t,n,o){const[l,r]=[e-n/2,e+n/2],[u,a]=[t-o/2,t+o/2];return l<a&&r>=u}exports.Plot=void 0,(e=>{(R=>{R.Select="select",R.Pan="pan",R.Query="query"})(e.Mode||(e.Mode={}));function t(R){const I=(R==null?void 0:R.type)??"unknown",_=React.createElement("div",{id:"plot",class:"relative h-full w-full drop-shadow-md"}),C=React.createElement("table",{class:"relative z-30 bg-gray-50 shadow-md"});_.appendChild(C);const O=[],F={},H={},N=[],D=[],q=[],G=structuredClone({...defaultOptions,...R}),{expandX:B,expandY:W}=G,$=[[B,W,1-B,1-W]],V={active:!1,locked:!1,mousedown:!1,mousebutton:MouseButton.Left,mode:"select",mousecoords:[0,0,0,0],lastkey:"",ratio:(R==null?void 0:R.ratio)??void 0},Y=Reactive.of()({type:I,data:O,container:_,queryTable:C,frames:F,scales:H,renderables:N,selectables:D,queryables:q,zoomStack:$,parameters:V,options:G});return setupFrames(Y,G),setupScales(Y,G),setupEvents$1(Y),Y}e.of=t,e.scatter=Scatterplot,e.bar=Barplot,e.fluct=Fluctuationplot,e.histo=Histogram,e.histo2d=Histogram2d,e.pcoords=Pcoordsplot;function n(R,I){R.appendChild(I.container),e.resize(I)}e.append=n;function o(R,I){for(const _ of R.data)Reactive.is(_)&&Reactive.removeAll(_,"changed");R.data.length=0;for(let _=0;_<I.length;_++)R.data.push(I[_]);Reactive.listen(last(I),"changed",()=>e.render(R))}e.setData=o;function l(R,I){I.scales=R.scales,I.data=R.data;const{renderables:_,selectables:C,queryables:O}=R;for(const F of[_,C,O])F.push(I)}e.addGeom=l;function r(R,I){const{renderables:_,selectables:C,queryables:O}=R;for(const F of[_,C,O])remove(F,I)}e.deleteGeom=r;function u(R){addTailwind(R.container,"outline outline-2 outline-slate-600"),R.parameters.active=!0,Reactive.dispatch(R,"activated")}e.activate=u;function a(R){removeTailwind(R.container,"outline outline-2 outline-slate-600"),R.parameters.active=!1,Reactive.dispatch(R,"deactivated")}e.deactivate=a;function f(R){R.parameters.locked=!0}e.lock=f;function c(R){R.parameters.locked=!1}e.unlock=c;function i(R){for(const I of dataLayers)Frame.clear(R.frames[I]);for(const I of R.renderables)Geom.render(I,R.frames)}e.render=i;function s(R){for(const I of["base","xAxis","yAxis"])Frame.clear(R.frames[I]);renderAxisLabels(R),renderAxisTitles(R)}e.renderAxes=s;function d(R){Frame.clear(R.frames.user)}e.clearUserFrame=d;function g(R){for(const U of Object.values(R.frames))Frame.resize(U);const{container:I,scales:_,frames:C,parameters:O,options:F}=R,{clientWidth:H,clientHeight:N}=I,{x:D,y:q,width:G,height:B,area:W}=_,{margins:$}=F,[V,Y]=[$[0],$[1]],[X,K]=[N-$[2],H-$[3]];C.under.canvas.style.width=`calc(100% - ${Y}px - ${$[3]}px)`,C.under.canvas.style.height=`calc(100% - ${V}px - ${$[2]}px)`,C.over.canvas.style.width=`calc(100% - ${Y}px - ${$[3]}px)`,C.over.canvas.style.height=`calc(100% - ${V}px - ${$[2]}px)`;for(const U of Object.values(C))Frame.clip(U);const Q={default:!0,silent:!0};exports.Expanse.set(D.codomain,U=>(U.min=Y,U.max=K),Q),exports.Expanse.set(q.codomain,U=>(U.min=V,U.max=X),Q);const[Z,ee]=[K-Y,X-V];if(exports.Expanse.set(G.codomain,U=>U.max=Z,Q),exports.Expanse.set(B.codomain,U=>U.max=ee,Q),exports.Expanse.set(W.codomain,U=>U.max=Math.min(Z,ee),Q),O.ratio){const{expandX:U,expandY:te}=defaultOptions;exports.Expanse.set(D.domain,J=>(J.zero=U,J.one=1-U),Q),exports.Expanse.set(q.domain,J=>(J.zero=te,J.one=1-te),Q),e.applyRatio(R,O.ratio)}e.render(R),e.renderAxes(R)}e.resize=g;function x(R){const{selectables:I,parameters:_,frames:C}=R,O=new Set;for(const F of I){const H=Geom.check(F,_.mousecoords);for(let N=0;N<H.length;N++)O.add(H[N])}Reactive.dispatch(R,"set-selected",{cases:Array.from(O)}),Reactive.dispatch(R,"lock-others"),Frame.clear(C.user),Frame.rectangleXY(C.user,..._.mousecoords)}e.checkSelection=x;function p(R,I){R.parameters.mode=I}e.setMode=p;function h(R,I){R.parameters.mousedown=I}e.setMousedown=h;function m(R,I){R.parameters.mousebutton=I}e.setMouseButton=m,e.mousemoveHandlers={select:y,pan:v,query:S};function y(R,I){const{container:_,parameters:C}=R;if(!C.active||!C.mousedown)return;Reactive.dispatch(R,"clear-transient");const{mousecoords:O}=C,{clientHeight:F}=_,H=I.offsetX,N=F-I.offsetY;O[2]=H,O[3]=N,e.checkSelection(R)}function v(R,I){const{container:_,scales:C,parameters:O}=R;if(!O.active||!O.mousedown)return;const{mousecoords:F}=O,{clientWidth:H,clientHeight:N}=_,[D,q]=F,G=I.offsetX,B=N-I.offsetY,W=(G-D)/H,$=(B-q)/N;exports.Scale.move(C.x,W),exports.Scale.move(C.y,$),F[0]=G,F[1]=B,e.clearUserFrame(R)}function S(R,I){const{offsetX:_,offsetY:C}=I,{container:O,queryTable:F,queryables:H}=R,{clientWidth:N,clientHeight:D}=O;F.style.display="none";const q=_,G=D-C;let B;for(const Y of H)if(B=Geom.query(Y,[q,G]),B)break;if(!B)return;clearNodeChildren(F);for(const[Y,X]of Object.entries(B)){const K=React.createElement("tr",null,React.createElement("td",{class:"border border-gray-400 px-3"},Y),React.createElement("td",{class:"border border-gray-400 px-3 font-mono"},formatLabel(X)));F.appendChild(K)}F.style.display="inline-block";const W=getComputedStyle(F),$=parseFloat(W.width.slice(0,-2)),{clientWidth:V}=F;q+$>N?(F.style.left="auto",F.style.right=`${V-_+5}px`):(F.style.left=`${q+5}px`,F.style.right="auto"),F.style.top=C+"px"}e.keybindings={"=":"grow","-":"shrink","]":"unfade","[":"fade",z:"zoom",x:"pop-zoom",o:"reorder",";":"decrement-anchor","'":"increment-anchor",n:"normalize"};function k(R){const{area:I,size:_,width:C}=R.scales;exports.Expanse.set(I.codomain,O=>(O.min*=1.1111111111111112,O.max*=1.1111111111111112)),exports.Expanse.set(_.codomain,O=>(O.min*=1.1111111111111112,O.max*=1.1111111111111112)),exports.Expanse.set(C.codomain,O=>O.mult<1?O.mult*=1.1111111111111112:null)}e.grow=k;function E(R){const{area:I,width:_,size:C}=R.scales;exports.Expanse.set(I.codomain,O=>(O.min*=.9,O.max*=.9)),exports.Expanse.set(C.codomain,O=>(O.min*=.9,O.max*=.9)),exports.Expanse.set(_.codomain,O=>O.mult*=.9)}e.shrink=E;function w(R){const{frames:I}=R;for(const _ of baseLayers)Frame.setAlpha(I[_],C=>C*9/10);e.render(R)}e.fade=w;function M(R){const{frames:I}=R;for(const _ of baseLayers)Frame.setAlpha(I[_],C=>C*10/9);e.render(R)}e.unfade=M;function b(R){const{frames:I,scales:_}=R;for(const C of baseLayers)Frame.resetAlpha(I[C]);for(const C of Object.values(_))exports.Scale.restoreDefaults(C);R.zoomStack.length=1,e.clearUserFrame(R)}e.reset=b;function A(R){e.setMode(R,"query")}e.setQueryMode=A;function z(R,I){const{scales:_,parameters:C,zoomStack:O}=R;let{coords:F,units:H}=I??{};H=H??"screen";let[N,D,q,G]=F??C.mousecoords;const{x:B,y:W}=_;if(H==="data"){const X={silent:!0};exports.Expanse.set(B.domain,K=>(K.zero=0,K.one=1),X),exports.Expanse.set(W.domain,K=>(K.zero=0,K.one=1),X),N=exports.Expanse.normalize(B.domain,N),q=exports.Expanse.normalize(B.domain,q),D=exports.Expanse.normalize(W.domain,D),G=exports.Expanse.normalize(W.domain,G)}if(H==="screen"){if(Math.abs(q-N)<10||Math.abs(G-D)<10)return;N=trunc(exports.Expanse.normalize(B.codomain,N)),q=trunc(exports.Expanse.normalize(B.codomain,q)),D=trunc(exports.Expanse.normalize(W.codomain,D)),G=trunc(exports.Expanse.normalize(W.codomain,G))}[N,q]=[N,q].sort(diff),[D,G]=[D,G].sort(diff),exports.Scale.expand(_.x,N,q),exports.Scale.expand(_.y,D,G);const $=rangeInverse(N,q),V=rangeInverse(D,G),Y=sqrt(max($,V));exports.Expanse.set(_.width.codomain,X=>X.max*=$),exports.Expanse.set(_.height.codomain,X=>X.max*=V),exports.Expanse.set(_.area.codomain,X=>X.max*=Y),exports.Expanse.set(_.size.codomain,X=>X.max*=Y),O.push([N,D,q,G]),Reactive.dispatch(R,"clear-transient"),e.render(R)}e.zoom=z;function T(R){const{scales:I,zoomStack:_}=R;if(_.length===1)return;const[C,O,F,H]=_[_.length-1],[N,D]=invertRange(C,F),[q,G]=invertRange(O,H);exports.Scale.expand(I.x,N,D),exports.Scale.expand(I.y,q,G);const B=rangeInverse(N,D),W=rangeInverse(q,G),$=1/sqrt(max(1/B,1/W));exports.Expanse.set(I.width.codomain,V=>V.max*=B),exports.Expanse.set(I.height.codomain,V=>V.max*=W),exports.Expanse.set(I.area.codomain,V=>V.max*=$),exports.Expanse.set(I.size.codomain,V=>V.max*=$),_.pop(),e.clearUserFrame(R),e.render(R)}e.popZoom=T;function L(R,I){const{x:_,y:C}=R.scales;if(!exports.Expanse.isContinuous(_.domain)||!exports.Expanse.isContinuous(C.domain))throw new Error("Both axes need to be continuous to set a ratio");R.parameters.ratio=I,e.resize(R)}e.setRatio=L;function P(R,I){const{scales:_}=R,{x:C,y:O}=_,F=exports.Scale.unitRatio(C),H=exports.Scale.unitRatio(O)*I,N={default:!0,silent:!0};if(F>H){const D=H/F*exports.Expanse.unitRange(O.domain);exports.Expanse.set(C.domain,q=>(q.zero=(1-D)/2,q.one=(1+D)/2),N)}else{const D=F/H*exports.Expanse.unitRange(C.domain);exports.Expanse.set(O.domain,q=>(q.zero=(1-D)/2,q.one=(1+D)/2),N)}}e.applyRatio=P;function j(R,I){let{scale:_,min:C,max:O,mult:F,labels:H,direction:N}=I;const D=R.scales[_].domain,q=R.scales[_].codomain;if(!["x","y","area","size"].includes(_))throw new Error(`Unrecognized scale '${_}'`);const G={default:I.default??!1};if(C!==void 0||O!==void 0){if(!exports.Expanse.isContinuous(D))throw new Error("Limits can only be set with a continuous scale");C=C??D.min,O=O??D.max,exports.Expanse.set(D,B=>(B.min=C,B.max=O),G),R.parameters.ratio=void 0}if(H){if(!exports.Expanse.isDiscrete(D))throw new Error("Labels can be ordered with a discrete scale only");if(!stringArraysMatch(D.labels,H))throw new Error("Labels must match the scale's labels");const B=orderIndicesByTable(D.labels,H);exports.Expanse.reorder(D,B)}N&&exports.Expanse.set(D,B=>B.direction=N,G),F&&exports.Expanse.set(q,B=>B.mult=F,G)}e.setScale=j})(exports.Plot||(exports.Plot={}));function setupFrames(e,t){const{container:n,frames:o}=e,{margins:l,colors:r,axisTitleSize:u}=t,[a,f,c,i]=l,s=[7,6,5,4,3,2,1,0],d="absolute top-0 right-0 w-full h-full";for(const g of s){const x=React.createElement("canvas",{class:d});x.style.zIndex=`${7-g+2}`;const p=Frame.of(x,t),h=r[g];Frame.setContext(p,{fillStyle:h,strokeStyle:h}),p.margins=l,o[g]=p}o.base=Frame.of(React.createElement("canvas",{class:d+" z-0 bg-gray-100"}),t),Frame.setContext(o.base,{font:`${u}rem sans-serif`,textBaseline:"middle",textAlign:"center"}),o.under=Frame.of(React.createElement("canvas",{class:d+" z-1 bg-white"}),t),o.under.canvas.style.width=`calc(100% - ${f}px - ${i}px)`,o.under.canvas.style.height=`calc(100% - ${a}px - ${c}px)`,o.under.canvas.style.top=c+"px",o.under.canvas.style.right=i+"px",o.over=Frame.of(React.createElement("canvas",{class:d+"relative z-10 border border-b-black border-l-black"}),t),o.over.canvas.style.width=`calc(100% - ${f}px - ${i}px)`,o.over.canvas.style.height=`calc(100% - ${a}px - ${c}px)`,o.over.canvas.style.top=c+"px",o.over.canvas.style.right=i+"px",o.user=Frame.of(React.createElement("canvas",{class:d+" z-10"}),t),o.user.margins=l,Frame.setContext(o.user,{globalAlpha:.06666666666666667}),o.xAxis=Frame.of(React.createElement("canvas",{class:d}),t),Frame.setContext(o.xAxis,{fillStyle:"#3B4854",textBaseline:"top",textAlign:"center",font:`${defaultOptions.axisLabelSize}rem serif`}),o.yAxis=Frame.of(React.createElement("canvas",{class:d}),t),Frame.setContext(o.yAxis,{fillStyle:"#3B4854",textBaseline:"middle",textAlign:"right",font:`${defaultOptions.axisLabelSize}rem serif`});for(let[g,x]of Object.entries(o))isNaN(parseFloat(g))||(g="data-"+g),x.canvas.id=`frame-${g}`,Frame.append(x,n)}function setupEvents$1(e){const{container:t,parameters:n,frames:o}=e,{mousecoords:l}=n;for(const[r,u]of Object.entries(exports.Plot.keybindings))Reactive.listen(e,r,()=>Reactive.dispatch(e,u));t.addEventListener("mousedown",r=>{r.stopPropagation();const{locked:u}=n;exports.Plot.activate(e),exports.Plot.setMousedown(e,!0),exports.Plot.setMouseButton(e,r.button),r.button===MouseButton.Left?exports.Plot.setMode(e,"select"):r.button===MouseButton.Right&&exports.Plot.setMode(e,"pan");const a=r.offsetX,f=t.clientHeight-r.offsetY;copyValues([a,f,a,f],l),!u&&n.mode==="select"&&(Reactive.dispatch(e,"clear-transient"),exports.Plot.checkSelection(e)),exports.Plot.unlock(e)}),t.addEventListener("contextmenu",r=>{r.preventDefault(),exports.Plot.setMousedown(e,!0),exports.Plot.setMouseButton(e,MouseButton.Right),exports.Plot.setMode(e,"pan"),l[0]=r.offsetX,l[1]=t.clientHeight-r.offsetY,Frame.clear(o.user)}),t.addEventListener("mouseup",()=>exports.Plot.setMousedown(e,!1)),t.addEventListener("mousemove",throttle(r=>{exports.Plot.mousemoveHandlers[n.mode](e,r)},20)),Reactive.listen(e,"reset",()=>exports.Plot.reset(e)),Reactive.listen(e,"resize",()=>exports.Plot.resize(e)),Reactive.listen(e,"activate",()=>exports.Plot.activate(e)),Reactive.listen(e,"deactivate",()=>exports.Plot.deactivate(e)),Reactive.listen(e,"render",()=>exports.Plot.render(e)),Reactive.listen(e,"lock",()=>exports.Plot.lock(e)),Reactive.listen(e,"unlock",()=>exports.Plot.unlock(e)),Reactive.listen(e,"query-mode",()=>exports.Plot.setMode(e,"query")),Reactive.listen(e,"render-axes",()=>exports.Plot.renderAxes(e)),Reactive.listen(e,"clear-transient",()=>exports.Plot.clearUserFrame(e)),Reactive.listen(e,"set-scale",r=>exports.Plot.setScale(e,r)),Reactive.listen(e,"grow",()=>exports.Plot.grow(e)),Reactive.listen(e,"shrink",()=>exports.Plot.shrink(e)),Reactive.listen(e,"fade",()=>exports.Plot.fade(e)),Reactive.listen(e,"unfade",()=>exports.Plot.unfade(e)),Reactive.listen(e,"zoom",r=>exports.Plot.zoom(e,r)),Reactive.listen(e,"pop-zoom",()=>exports.Plot.popZoom(e));for(const r of Object.values(e.scales))Reactive.listen(r,"changed",()=>{exports.Plot.render(e),exports.Plot.renderAxes(e)})}function setupScales(e,t){var y,v;const{scales:n,container:o}=e,{clientWidth:l,clientHeight:r}=o,u=exports.Expanse[((y=t==null?void 0:t.scales)==null?void 0:y.x)??"continuous"](),a=exports.Expanse[((v=t==null?void 0:t.scales)==null?void 0:v.y)??"continuous"]();n.x=exports.Scale.of(u,exports.Expanse.continuous(0,l)),n.y=exports.Scale.of(a,exports.Expanse.continuous(0,r)),n.height=exports.Scale.of(exports.Expanse.continuous(),exports.Expanse.continuous(0,r)),n.width=exports.Scale.of(exports.Expanse.continuous(),exports.Expanse.continuous(0,l)),n.area=exports.Scale.of(exports.Expanse.continuous(),exports.Expanse.continuous()),n.size=exports.Scale.of(exports.Expanse.continuous(),exports.Expanse.continuous(0,t.size));const{x:f,y:c,width:i,height:s,size:d,area:g}=n,x={default:!0,silent:!0},{expandX:p,expandY:h}=defaultOptions;exports.Expanse.set(g.domain,S=>S.ratio=!0,x),exports.Expanse.set(d.domain,S=>S.ratio=!0,x),exports.Expanse.set(g.codomain,S=>(S.trans=square,S.inv=sqrt),x),exports.Expanse.set(d.codomain,S=>(S.trans=square,S.inv=sqrt),x),exports.Expanse.set(f.domain,S=>(S.zero=p,S.one=1-p),x),exports.Expanse.set(c.domain,S=>(S.zero=h,S.one=1-h),x),exports.Expanse.set(i.domain,S=>S.one=1-2*p,x),exports.Expanse.set(s.domain,S=>S.one=1-2*h,x),exports.Expanse.set(g.domain,S=>S.one=1-2*Math.max(p,h),x);const m=S=>Math.max(S,0);exports.Expanse.set(i.codomain,S=>S.inv=m,x),exports.Expanse.set(s.codomain,S=>S.inv=m,x)}var DOM;(e=>{function t(n,o){return n.querySelector(o)}e.select=t})(DOM||(DOM={}));function keybindingsMenu(e){const t=React.createElement("div",null,React.createElement("div",{id:"modal",class:"tailwind absolute left-0 top-0 z-50 flex size-full flex-col items-center bg-slate-800 bg-opacity-80 p-10"},React.createElement("div",{id:"bindings",class:"relative flex h-full w-fit flex-col flex-wrap justify-start py-10"})),React.createElement("button",{class:"absolute right-0 top-0 z-30 select-none rounded-bl-md bg-gray-300 p-1 px-2 text-sm text-white hover:bg-gray-400"},"keybindings")),n=DOM.select(t,"#modal"),o=DOM.select(t,"#bindings"),l=DOM.select(t,"button");o.style.columnFill="auto",n.style.display="none";let r=!1;function u(){n.style.display="flex"}function a(){r||(n.style.display="none")}l.addEventListener("click",u),n.addEventListener("click",a);const f=e.keybindings;for(const[c,i]of Object.entries(f)){const s=React.createElement("span",{class:"m-1 flex flex-row"},React.createElement("button",{class:"m-1 w-8 rounded-md bg-gray-400 p-1 px-2 text-center text-white outline-none hover:bg-gray-500"},c),React.createElement("div",{class:"m-1 p-1 px-2 text-white"},capitalize(i.replaceAll("-"," ")))),d=DOM.select(s,"div"),g=DOM.select(s,"button");d.addEventListener("click",p=>p.stopPropagation()),g.addEventListener("click",p=>{r||(p.stopPropagation(),addTailwind(g,"text-black bg-slate-200 hover:bg-slate-200"),window.addEventListener("keydown",x),r=!0)});const x=p=>{const{key:h}=p,m=g.innerText;h in f&&h!==m||(exports.Scene.setKeyBinding(e,h,i),g.innerText=p.key,removeTailwind(g,"text-black bg-slate-200 hover:bg-slate-200"),window.removeEventListener("keydown",x),r=!1)};o.appendChild(s)}return t}exports.Scene=void 0,(e=>{function t(b,A){const z=React.createElement("div",{id:"scene-container",class:"pr-15 tailwind relative flex h-full w-full content-center items-center justify-center bg-[#deded9] p-10"},React.createElement("div",{id:"plots-container",class:"grid h-full w-full grid-cols-1 grid-rows-1 gap-5"})),T=DOM.select(z,"#plots-container"),[L,P]=[1,1],j=Marker.of(Object.values(b)[0].length),R=[],I={},_=Object.assign(defaultOptions,A);updateOptions(_);for(const[H,N]of Object.entries(b))Meta.has(N,"name")||Meta.set(N,"name",H);const C={...e.keybindings,...exports.Plot.keybindings},O={send:console.log},F=Reactive.of()({data:b,container:z,plotContainer:T,rows:L,cols:P,marker:j,client:O,plots:R,plotsByType:I,options:_,keybindings:C});if(A!=null&&A.websocketURL){const H=new WebSocket(A.websocketURL),N={sender:"scene",target:"session",type:"connected"};H.addEventListener("open",()=>H.send(JSON.stringify(N))),H.addEventListener("message",D=>{h(F,JSON.parse(D.data))}),window.addEventListener("beforeunload",()=>H.close()),F.client=H}return z.appendChild(keybindingsMenu(F)),setupEvents(F),F}e.of=t;async function n(b,A){const z=await fetchJSON(b);return e.of(z,A)}e.ofAsync=n;function o(b,A){b.appendChild(A.container),e.resize(A)}e.append=o;function l(b,A){const{plotContainer:z,marker:T,plots:L,plotsByType:P}=b;Reactive.listen(A,"activated",()=>{for(const R of L)R!=A&&Reactive.dispatch(R,"deactivate");b.activePlot=A}),Reactive.listen(A,"lock-others",()=>{for(const R of L)R!==A&&Reactive.dispatch(R,"lock")}),Reactive.listen(A,"set-selected",R=>{Marker.update(T,R.cases)}),Reactive.listen(A,"clear-transient",()=>{for(const R of L)exports.Plot.clearUserFrame(R);Marker.clearTransient(T)}),L.push(A);const{type:j}=A;P[j]||(P[j]=[]),P[j].push(A),exports.Plot.append(z,A),u(b),i(b),e.resize(b)}e.addPlot=l;function r(b,A){const{type:z,variables:T,reducer:L,queries:P}=A??{};if(!z||z==="unknown"||!T)return;for(const _ of T)if(!Object.keys(b.data).includes(_))throw new Error(`Variable '${_}' is not present in the data`);const j=keysToSelectors(T),R={};if(L&&(R.reducer=exports.Reducer.parse(L)),P)if(isStringArray(P))R.queries=keysToSelectors(P);else{const _=C=>P.map(([O,F])=>[C[O],exports.Reducer.parse(F)]);R.queries=_}const I=exports.Plot[z](b,j,R);e.addPlot(b,I)}e.addPlotBySpec=r;function u(b){for(let A=0;A<b.plots.length;A++)b.plots[A].container.id=`plot${A+1}`}function a(b){const A=last(b.plots);A&&c(b,A)}e.popPlot=a;function f(b,A){const z=p(b,A);z&&c(b,z)}e.removePlot=f;function c(b,A){remove(b.plots,A),remove(b.plotsByType[A.type],A),b.plotContainer.removeChild(A.container),Reactive.removeAllListeners(A),u(b),i(b),e.resize(b)}function i(b){const{plots:A}=b;if(A.length===0)return;const z=Math.ceil(Math.sqrt(A.length)),T=Math.ceil(A.length/z);e.setDimensions(b,T,z)}function s(b,A,z){const{plotContainer:T}=b;b.rows=A,b.cols=z,T.style.gridTemplateRows=Array(A).fill("1fr").join(" "),T.style.gridTemplateColumns=Array(z).fill("1fr").join(" "),e.resize(b)}e.setDimensions=s;function d(b,A){const{plotContainer:z,plots:T}=b,L=new Set(A.flat()),P=new Set(seq(0,T.length-1));for(const _ of L)P.delete(_);P.size>0&&alert("Warning: Some plots are not included in the layout and will be hidden.");for(let _=0;_<T.length;_++)T[_].container.style.gridArea=`plot${_}`;let j="";for(const _ of A)j+=`"${_.map(C=>`plot${C}`).join(" ")}" `;const[R,I]=[A.length,A[0].length];z.style.gridTemplateAreas=j,z.style.gridTemplateRows=Array(R).fill("1fr").join(" "),z.style.gridTemplateColumns=Array(I).fill("1fr").join(" "),e.resize(b)}e.setLayout=d;function g(b){b.plotContainer.style.gridTemplateAreas="";for(const A of b.plots)A.container.style.gridArea="auto";i(b)}e.clearLayout=g;function x(b,A){return A==="scene"?b:p(b,A)}e.getTarget=x;function p(b,A){const{plots:z,plotsByType:T}=b;let[L,P]=splitNumericSuffix(A);const j=parseInt(P,10)-1;if(L==="plot"||L==="p")return z[j];if(L=L.replace("plot","").replace("gram",""),L in Object.keys(plotIdShort)&&(L=plotIdShort[L]),L in T)return T[L][j]}e.getPlot=p;function h(b,A){if(!b.client)return;const{type:z,target:T,data:L}=A,P=x(b,T);P&&Reactive.dispatch(P,z,L)}e.handleMessage=h;function m(b,A,z){const[T,L]=["scene","session"],P=JSON.stringify({sender:T,target:L,type:A,data:z});b.client.send(P)}e.sendMessage=m;function y(b){for(const A of b.plots)Reactive.dispatch(A,"resize")}e.resize=y;function v(b){for(const A of b.plots)Reactive.dispatch(A,"reset");Marker.clearTransient(b.marker)}e.reset=v;function S(b){for(const A of b.plots)Reactive.dispatch(A,"query-mode")}e.setQueryMode=S;function k(b){Marker.setGroup(b.marker,Group.First)}e.setGroupFirst=k;function E(b){Marker.setGroup(b.marker,Group.Second)}e.setGroupSecond=E;function w(b){Marker.setGroup(b.marker,Group.Third)}e.setGroupThird=w;function M(b,A,z){let T;for(const[L,P]of Object.entries(b.keybindings))if(P===z){T=L;break}T&&delete b.keybindings[T],b.keybindings[A]=z}e.setKeyBinding=M,e.keybindings={r:"reset",q:"query-mode",1:"group-1",2:"group-2",3:"group-3"}})(exports.Scene||(exports.Scene={}));function setupEvents(e){const{marker:t,plots:n,container:o,keybindings:l}=e;o.addEventListener("mousedown",()=>{for(const r of n)Reactive.dispatch(r,"deactivate")}),o.addEventListener("dblclick",()=>{for(const r of n)Reactive.dispatch(r,"deactivate"),Frame.clear(r.frames.user);Marker.clearAll(e.marker),e.activePlot=void 0}),window.addEventListener("keydown",r=>{const u=l[r.key];u&&(e.activePlot&&Reactive.dispatch(e.activePlot,u),Reactive.dispatch(e,u))}),window.addEventListener("keyup",()=>{Marker.setGroup(t,Transient);for(const r of e.plots)r.parameters.mode=exports.Plot.Mode.Select,r.queryTable.style.display="none"}),window.addEventListener("resize",throttle(()=>exports.Scene.resize(e),10)),Reactive.listen(t,"cleared",()=>{for(const r of n)Reactive.dispatch(r,"unlock")}),Reactive.listen(e,"resize",()=>exports.Scene.resize(e)),Reactive.listen(e,"reset",()=>exports.Scene.reset(e)),Reactive.listen(e,"query-mode",()=>exports.Scene.setQueryMode(e)),Reactive.listen(e,"group-1",()=>exports.Scene.setGroupFirst(e)),Reactive.listen(e,"group-2",()=>exports.Scene.setGroupSecond(e)),Reactive.listen(e,"group-3",()=>exports.Scene.setGroupThird(e)),Reactive.listen(e,"connected",()=>{var r;return console.log(`Connected to Websocket server on: ${(r=e.client)==null?void 0:r.url}`)}),Reactive.listen(e,"set-dims",r=>{!r||!r.rows||!r.columns||exports.Scene.setDimensions(e,r.rows,r.cols)}),Reactive.listen(e,"add-plot",r=>{r&&exports.Scene.addPlotBySpec(e,r)}),Reactive.listen(e,"pop-plot",()=>exports.Scene.popPlot(e)),Reactive.listen(e,"remove-plot",r=>{!r||!r.id||exports.Scene.removePlot(e,r.id)}),Reactive.listen(e,"set-selected",r=>{!r||!r.cases||Marker.update(t,r.cases)}),Reactive.listen(e,"set-assigned",r=>{if(!r||!r.group)return;const u=7-Math.min(r.group,3);Marker.update(t,r.cases,{group:u})}),Reactive.listen(e,"get-selected",()=>{const r=filterIndices(t.indices,Marker.isTransient);exports.Scene.sendMessage(e,"get-selected",{cases:r})}),Reactive.listen(e,"get-assigned",r=>{if(!r||!r.group)return;const u=f=>(f|4)===7-Math.min(r.group,3),a=filterIndices(t.indices,u);exports.Scene.sendMessage(e,"get-assigned",{cases:a,group:r.group})}),Reactive.listen(e,"clear-selection",()=>Marker.clearAll(t)),Reactive.listen(e,"set-scale",r=>{if(!r||!r.id)return;const u=exports.Scene.getPlot(e,r.id);u&&Reactive.dispatch(u,"set-scale",r)}),Reactive.listen(e,"zoom",r=>{if(!r||!r.id)return;const u=exports.Scene.getPlot(e,r.id);u&&Reactive.dispatch(u,"zoom",r)}),Reactive.listen(e,"set-layout",r=>{!r||!r.layout||exports.Scene.setLayout(e,r.layout)}),Reactive.listen(e,"clear-layout",()=>exports.Scene.clearLayout(e))}const plotIdShort={s:"scatter",b:"bar",h:"histo",f:"fluct",hh:"histo2d",pc:"pcoords"};return exports.POSITIONS=POSITIONS,exports.addIndexed=addIndexed,exports.addTailwind=addTailwind,exports.applyDirection=applyDirection,exports.applyWith=applyWith,exports.binBreaks=binBreaks,exports.call=call,exports.capitalize=capitalize,exports.clearNodeChildren=clearNodeChildren,exports.compareAlphaNumeric=compareAlphaNumeric,exports.convertToSuperscript=convertToSuperscript,exports.copyProps=copyProps,exports.copyValues=copyValues,exports.cumsum=cumsum,exports.dec=dec,exports.diff=diff,exports.exp10=exp10,exports.exponentialToSuperscript=exponentialToSuperscript,exports.fetchJSON=fetchJSON,exports.filterIndices=filterIndices,exports.findLength=findLength,exports.formatAxisLabels=formatAxisLabels,exports.formatLabel=formatLabel,exports.formatText=formatText,exports.identity=identity,exports.inc=inc,exports.invertRange=invertRange,exports.isArray=isArray,exports.isEventTarget=isEventTarget,exports.isIntegerString=isIntegerString,exports.isNumber=isNumber,exports.isNumberArray=isNumberArray,exports.isPrimitive=isPrimitive,exports.isStringArray=isStringArray,exports.just=just,exports.keysToSelectors=keysToSelectors,exports.last=last,exports.log10=log10,exports.makeGetter=makeGetter,exports.max=max,exports.merge=merge,exports.minDecimal=minDecimal,exports.minmax=minmax,exports.one=one,exports.orderBy=orderBy,exports.orderIndices=orderIndices,exports.orderIndicesByTable=orderIndicesByTable,exports.ordered=ordered,exports.pointInRect=pointInRect,exports.prettyBreaks=prettyBreaks,exports.prod=prod,exports.randomInteger=randomInteger,exports.rangeInverse=rangeInverse,exports.rectSegmentIntersect=rectSegmentIntersect,exports.rectsIntersect=rectsIntersect,exports.remove=remove,exports.removeTailwind=removeTailwind,exports.rep=rep,exports.round=round,exports.row=row,exports.segmentsIntersect=segmentsIntersect,exports.selector=selector,exports.seq=seq,exports.splitNumericSuffix=splitNumericSuffix,exports.sqrt=sqrt,exports.square=square,exports.stringArraysMatch=stringArraysMatch,exports.stripWS=stripWS,exports.subset=subset,exports.sum=sum,exports.throttle=throttle,exports.timeExecution=timeExecution,exports.toLowerCase=toLowerCase,exports.toUpperCase=toUpperCase,exports.trunc=trunc,exports.uniqueIntegers=uniqueIntegers,exports.zero=zero,Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),exports}({});
