var plotscape=function(exports){"use strict";var __vite_style__=document.createElement("style");__vite_style__.textContent=`*:where(.tailwind,.tailwind *),:before:where(.tailwind,.tailwind *),:after:where(.tailwind,.tailwind *){box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}:before:where(.tailwind,.tailwind *),:after:where(.tailwind,.tailwind *){--tw-content: ""}.tailwind{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;-o-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}.tailwind{margin:0;line-height:inherit}hr:where(.tailwind,.tailwind *){height:0;color:inherit;border-top-width:1px}abbr:where([title]):where(.tailwind,.tailwind *){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1:where(.tailwind,.tailwind *),h2:where(.tailwind,.tailwind *),h3:where(.tailwind,.tailwind *),h4:where(.tailwind,.tailwind *),h5:where(.tailwind,.tailwind *),h6:where(.tailwind,.tailwind *){font-size:inherit;font-weight:inherit}a:where(.tailwind,.tailwind *){color:inherit;text-decoration:inherit}b:where(.tailwind,.tailwind *),strong:where(.tailwind,.tailwind *){font-weight:bolder}code:where(.tailwind,.tailwind *),kbd:where(.tailwind,.tailwind *),samp:where(.tailwind,.tailwind *),pre:where(.tailwind,.tailwind *){font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small:where(.tailwind,.tailwind *){font-size:80%}sub:where(.tailwind,.tailwind *),sup:where(.tailwind,.tailwind *){font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub:where(.tailwind,.tailwind *){bottom:-.25em}sup:where(.tailwind,.tailwind *){top:-.5em}table:where(.tailwind,.tailwind *){text-indent:0;border-color:inherit;border-collapse:collapse}button:where(.tailwind,.tailwind *),input:where(.tailwind,.tailwind *),optgroup:where(.tailwind,.tailwind *),select:where(.tailwind,.tailwind *),textarea:where(.tailwind,.tailwind *){font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button:where(.tailwind,.tailwind *),select:where(.tailwind,.tailwind *){text-transform:none}button:where(.tailwind,.tailwind *),input:where([type=button]):where(.tailwind,.tailwind *),input:where([type=reset]):where(.tailwind,.tailwind *),input:where([type=submit]):where(.tailwind,.tailwind *){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring:where(.tailwind,.tailwind *){outline:auto}:-moz-ui-invalid:where(.tailwind,.tailwind *){box-shadow:none}progress:where(.tailwind,.tailwind *){vertical-align:baseline}::-webkit-inner-spin-button:where(.tailwind,.tailwind *),::-webkit-outer-spin-button:where(.tailwind,.tailwind *){height:auto}[type=search]:where(.tailwind,.tailwind *){-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration:where(.tailwind,.tailwind *){-webkit-appearance:none}::-webkit-file-upload-button:where(.tailwind,.tailwind *){-webkit-appearance:button;font:inherit}summary:where(.tailwind,.tailwind *){display:list-item}blockquote:where(.tailwind,.tailwind *),dl:where(.tailwind,.tailwind *),dd:where(.tailwind,.tailwind *),h1:where(.tailwind,.tailwind *),h2:where(.tailwind,.tailwind *),h3:where(.tailwind,.tailwind *),h4:where(.tailwind,.tailwind *),h5:where(.tailwind,.tailwind *),h6:where(.tailwind,.tailwind *),hr:where(.tailwind,.tailwind *),figure:where(.tailwind,.tailwind *),p:where(.tailwind,.tailwind *),pre:where(.tailwind,.tailwind *){margin:0}fieldset:where(.tailwind,.tailwind *){margin:0;padding:0}legend:where(.tailwind,.tailwind *){padding:0}ol:where(.tailwind,.tailwind *),ul:where(.tailwind,.tailwind *),menu:where(.tailwind,.tailwind *){list-style:none;margin:0;padding:0}dialog:where(.tailwind,.tailwind *){padding:0}textarea:where(.tailwind,.tailwind *){resize:vertical}input::-moz-placeholder:where(.tailwind,.tailwind *),textarea::-moz-placeholder:where(.tailwind,.tailwind *){opacity:1;color:#9ca3af}input::placeholder:where(.tailwind,.tailwind *),textarea::placeholder:where(.tailwind,.tailwind *){opacity:1;color:#9ca3af}button:where(.tailwind,.tailwind *),[role=button]:where(.tailwind,.tailwind *){cursor:pointer}:disabled:where(.tailwind,.tailwind *){cursor:default}img:where(.tailwind,.tailwind *),svg:where(.tailwind,.tailwind *),video:where(.tailwind,.tailwind *),canvas:where(.tailwind,.tailwind *),audio:where(.tailwind,.tailwind *),iframe:where(.tailwind,.tailwind *),embed:where(.tailwind,.tailwind *),object:where(.tailwind,.tailwind *){display:block;vertical-align:middle}img:where(.tailwind,.tailwind *),video:where(.tailwind,.tailwind *){max-width:100%;height:auto}[hidden]:where(.tailwind,.tailwind *){display:none}*,:before,:after{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }.tw-absolute{position:absolute}.tw-relative{position:relative}.tw-left-0{left:0}.tw-right-0{right:0}.tw-top-0{top:0}.tw-z-10{z-index:10}.tw-z-30{z-index:30}.tw-z-50{z-index:50}.tw-m-1{margin:.25rem}.tw-flex{display:flex}.tw-grid{display:grid}.tw-size-full{width:100%;height:100%}.tw-h-5\\/6{height:83.333333%}.tw-h-full{height:100%}.tw-h-screen{height:100vh}.tw-w-5\\/6{width:83.333333%}.tw-w-8{width:2rem}.tw-w-fit{width:-moz-fit-content;width:fit-content}.tw-w-full{width:100%}.tw-select-none{-webkit-user-select:none;-moz-user-select:none;user-select:none}.tw-grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.tw-grid-rows-1{grid-template-rows:repeat(1,minmax(0,1fr))}.tw-flex-row{flex-direction:row}.tw-flex-col{flex-direction:column}.tw-flex-wrap{flex-wrap:wrap}.tw-content-center{align-content:center}.tw-items-center{align-items:center}.tw-justify-start{justify-content:flex-start}.tw-justify-center{justify-content:center}.tw-gap-\\[1em\\]{gap:1em}.tw-rounded-md{border-radius:.375rem}.tw-rounded-bl-md{border-bottom-left-radius:.375rem}.tw-border{border-width:1px}.tw-border-black{--tw-border-opacity: 1;border-color:rgb(0 0 0 / var(--tw-border-opacity))}.tw-border-b-black{--tw-border-opacity: 1;border-bottom-color:rgb(0 0 0 / var(--tw-border-opacity))}.tw-border-l-black{--tw-border-opacity: 1;border-left-color:rgb(0 0 0 / var(--tw-border-opacity))}.tw-bg-\\[\\#deded9\\]{--tw-bg-opacity: 1;background-color:rgb(222 222 217 / var(--tw-bg-opacity))}.tw-bg-gray-100{--tw-bg-opacity: 1;background-color:rgb(243 244 246 / var(--tw-bg-opacity))}.tw-bg-gray-300{--tw-bg-opacity: 1;background-color:rgb(209 213 219 / var(--tw-bg-opacity))}.tw-bg-gray-400{--tw-bg-opacity: 1;background-color:rgb(156 163 175 / var(--tw-bg-opacity))}.tw-bg-slate-200{--tw-bg-opacity: 1;background-color:rgb(226 232 240 / var(--tw-bg-opacity))}.tw-bg-slate-800{--tw-bg-opacity: 1;background-color:rgb(30 41 59 / var(--tw-bg-opacity))}.tw-bg-white{--tw-bg-opacity: 1;background-color:rgb(255 255 255 / var(--tw-bg-opacity))}.tw-bg-opacity-80{--tw-bg-opacity: .8}.tw-p-1{padding:.25rem}.tw-p-10{padding:2.5rem}.tw-px-2{padding-left:.5rem;padding-right:.5rem}.tw-px-3{padding-left:.75rem;padding-right:.75rem}.tw-py-1{padding-top:.25rem;padding-bottom:.25rem}.tw-py-10{padding-top:2.5rem;padding-bottom:2.5rem}.tw-text-center{text-align:center}.tw-font-mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}.tw-text-sm{font-size:.875rem;line-height:1.25rem}.tw-text-black{--tw-text-opacity: 1;color:rgb(0 0 0 / var(--tw-text-opacity))}.tw-text-white{--tw-text-opacity: 1;color:rgb(255 255 255 / var(--tw-text-opacity))}.tw-shadow-md{--tw-shadow: 0 4px 6px -1px rgb(0 0 0 / .1), 0 2px 4px -2px rgb(0 0 0 / .1);--tw-shadow-colored: 0 4px 6px -1px var(--tw-shadow-color), 0 2px 4px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.tw-outline-none{outline:2px solid transparent;outline-offset:2px}.tw-outline{outline-style:solid}.tw-outline-2{outline-width:2px}.tw-outline-slate-600{outline-color:#475569}.tw-drop-shadow-md{--tw-drop-shadow: drop-shadow(0 4px 3px rgb(0 0 0 / .07)) drop-shadow(0 2px 2px rgb(0 0 0 / .06));filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.hover\\:tw-bg-gray-400:hover{--tw-bg-opacity: 1;background-color:rgb(156 163 175 / var(--tw-bg-opacity))}.hover\\:tw-bg-gray-500:hover{--tw-bg-opacity: 1;background-color:rgb(107 114 128 / var(--tw-bg-opacity))}.hover\\:tw-bg-slate-200:hover{--tw-bg-opacity: 1;background-color:rgb(226 232 240 / var(--tw-bg-opacity))}
`,document.head.appendChild(__vite_style__);const METADATA=Symbol("metadata");var Meta;(e=>{function t(r){return r[METADATA]={},r}e.of=t;function n(r){return!!r[METADATA]}e.hasMetadata=n;function s(r,i){var o;return!!((o=r[METADATA])!=null&&o[i])}e.has=s;function d(r,i){return Array.isArray(i)?i.map(o=>f(r,o)):f(r,i)}e.get=d;function a(r,i){n(r)||(r[METADATA]={});for(const[o,c]of Object.entries(i))r[METADATA][o]=c}e.set=a;function u(r,i,o){if(!n(r))return;n(i)||(i[METADATA]={});const c=o??Object.keys(r[METADATA]);for(const l of c)i[METADATA][l]=d(r,l)}e.copy=u;function f(r,i){var o;return i==="length"&&Array.isArray(r)?r.length:(o=r[METADATA])==null?void 0:o[i]}})(Meta||(Meta={}));var Getter;(e=>{function t(f){if(typeof f=="function")return f;if(Array.isArray(f)){const r=i=>f[i];return Meta.set(r,{length:f.length}),r}if(isTypedArray(f)){const r=i=>f[i];return Meta.set(r,{length:f.length}),r}return()=>f}e.of=t;function n(f){return()=>f}e.constant=n;function s(f,r){const i=e.of(f),o=c=>i(r[c]);return isObject(f)&&Meta.copy(f,o),Meta.set(o,{length:r.length}),o}e.proxy=s;function d(f){const r=f.map(e.of),i=o=>r.map(c=>c(o));return Meta.copy(f[0],i,["length"]),i}e.multi=d;function a(f){const r={};for(const i of Reflect.ownKeys(f))r[i]=e.of(f[i]);return r}e.mapObject=a;function u(f,r){const i=e.of(r),o=Array(f);for(let c=0;c<f;c++)o[c]=i(c);return o}e.array=u})(Getter||(Getter={}));function identity(e){return e}const just=e=>()=>e,zero=just(0),one=just(1);function inc(e){return e+1}function dec(e){return e-1}function call(e){return e()}function bimap(e,t,n){if(e.length!==t.length)throw new Error("Arrays must be of the same length");const s=Array(e.length);for(let d=0;d<e.length;d++)s[d]=n(e[d],t[d]);return s}function square(e){return e**2}const sqrt=Math.sqrt,log10=Math.log10;function exp10(e){return 10**e}const max=Math.max;function diff(e,t){return e-t}function sum(e,t){return e+t}function prod(e,t){return e*t}function trunc(e,t=0,n=1){return Math.min(Math.max(e,t),n)}function rangeInverse(e,t){return 1/(t-e)}function invertRange(e,t){const n=rangeInverse(e,t);return[-e*n,n-e*n]}function round(e,t=0){return Math.round(e*10**t)/10**t}function compareAlphaNumeric(e,t){return e.localeCompare(t,"en",{numeric:!0})}function capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}function toLowerCase(e){return e.toLocaleLowerCase()}function toUpperCase(e){return e.toLocaleUpperCase()}function stripWS(e){return e.replace(/\s/g,"")}function last(e){return e[e.length-1]}function rep(e,t){return Array(t).fill(e)}function seq(e,t,n){const s=Math.abs(t-e);n=n??Math.ceil(s)+1;const d=s/(n-1),a=t>=e?1:-1;return Array.from(Array(n),(u,f)=>e+a*d*f)}function seqLength(e,t){return Array.from(Array(t),(n,s)=>e+s)}function subset(e,t){const n=Array(t.length);for(let s=0;s<t.length;s++)n[s]=e[t[s]];return n}function remove(e,t){const n=e.indexOf(t);n!==-1&&e.splice(n,1)}function ordered(e,t){const n=Array(t.length);for(let s=0;s<t.length;s++)n[t[s]]=e[s];return n}function orderIndices(e){const t=e.toSorted(diff),n={},s={};for(let d=0;d<t.length;d++){const a=e[d];s[a]=s[a]+1||0,n[d]=t.indexOf(a)+s[a]}return Object.values(n)}function orderBy(e,t){const n=Array(e.length);for(let s=0;s<e.length;s++)n[s]=e[t[s]];for(let s=0;s<e.length;s++)e[s]=n[s]}function orderIndicesByTable(e,t){const n=Array(e.length);for(let s=0;s<e.length;s++)n[s]=t.indexOf(e[s]);return n}function minmax(e){let[t,n]=[1/0,-1/0];for(let s=0;s<e.length;s++)t=Math.min(t,e[s]),n=Math.max(n,e[s]);return[t,n]}function cumsum(e){const t=Array(e.length);t[0]=e[0];for(let n=1;n<e.length;n++)t[n]=e[n]+t[n-1];return t}function randomInteger(e,t){return Math.floor(e+Math.random()*t)}function uniqueIntegers(e,t,n=t-e){const s=t-e,d=[],a=new Set;for(;d.length<Math.min(n,s);){let u=randomInteger(e,t);for(;a.has(u);)u=randomInteger(e,t);d.push(u),a.add(u)}return d}async function fetchJSON(e){return await(await fetch(e)).json()}function merge(e,t){return{...e,...t}}function copyValues(e,t){if(e!==t){if(isTypedArray(e)&&isTypedArray(t))t.set(e);else if(Array.isArray(e)&&Array.isArray(t)){t.length=e.length;for(let n=0;n<e.length;n++)t[n]=e[n]}}}function copyProps(e,t){for(const[n,s]of Object.entries(e))Array.isArray(s)&&Array.isArray(e[n])?copyValues(s,e[n]):t[n]=s}function applyDirection(e,t){return .5*(1-t)+t*e}function prettyBreaks(e,t,n=4){const s=(t-e)/n,d=Math.floor(Math.log10(s)),a=[1,2,4,5,10];let[u,f]=[1/0,0];for(let p=0;p<a.length;p++){const x=(a[p]*10**d-s)**2;x<u&&([u,f]=[x,a[p]])}const r=10**d*f,i=Math.ceil(e/r)*r,o=Math.floor(t/r)*r,c=Math.round((o-i)/r),l=[];for(let p=0;p<c+1;p++){const x=i+p*r;l.push(x)}return l}function binBreaks(e,t){let{width:n,anchor:s,nBins:d}=t||{};const[a,u]=minmax(e),f=u-a;d=d??(n?Math.ceil(f/n)+1:10),n=n??f/(d-1),s=s??a;const r=a-n+(s-a)%n,i=u+n-(u-s)%n,o=Array(d+2);o[0]=r,o[o.length-1]=i;for(let c=1;c<o.length-1;c++)o[c]=r+c*n;return o}function tw(e){return e.trim().split(/\s+/)}function addTailwind(e,t){for(const n of t.trim().split(/\s+/))e.classList.add(n)}function removeTailwind(e,t){for(const n of t.trim().split(/\s+/))e.classList.remove(n)}function throttle(e,t){let n=0;return function(...s){const d=new Date().getTime();d-n<t||(n=d,e(...s))}}function timeExecution(e){const t=performance.now();return e(),performance.now()-t}function segmentToPointVec(e){const[t,n,s,d]=e;return[t,n,s-t,d-n]}function inRange(e,t,n){return!(e<t)&&!(e>n)}function segmentsIntersect(e,t){let[n,s,d,a]=segmentToPointVec(e),[u,f,r,i]=segmentToPointVec(t);const o=r*a-d*i,c=((n-u)*a-(s-f)*d)/o,l=-(-(n-u)*i+(s-f)*r)/o;return inRange(c,0,1)&&inRange(l,0,1)}function rectSegmentIntersect(e,t){const[n,s,d,a]=e;return segmentsIntersect([n,s,d,s],t)||segmentsIntersect([n,s,n,a],t)||segmentsIntersect([d,s,d,a],t)||segmentsIntersect([n,a,d,a],t)}function pointInRect(e,t){const[n,s]=e;let[d,a,u,f]=t;return[d,u]=[d,u].sort(diff),[a,f]=[a,f].sort(diff),!(n<d||n>u||s<a||s>f)}function rectsIntersect(e,t){const[n,s]=[e[0],e[2]].sort(diff),[d,a]=[e[1],e[3]].sort(diff),[u,f]=[t[0],t[2]].sort(diff),[r,i]=[t[1],t[3]].sort(diff);return!(s<u||n>f||a<r||d>i)}function addIndexed(e,t,n){const d=Object.keys(e).filter(f=>f.replace(/[0-9]*$/,"")===t);if(d.length===0){e[`${t}1`]=n;return}const a=d.map(f=>parseInt(f.match(/[0-9]*$/)[0],10)),u=Math.max(...a);e[`${t}${u+1}`]=n}function minDecimal(e){let t=1/0;for(let n=0;n<e.length;n++)e[n]!==0&&(t=Math.min(t,Math.log10(Math.abs(e[n]))));return t>3?0:Math.floor(Math.abs(t))+2}function formatText(e,t={lowercase:!0,capitalize:!0,split:!0}){return t!=null&&t.split&&(e=e.replace(/_/g," ")),t!=null&&t.lowercase&&(e=e.toLocaleLowerCase()),t!=null&&t.capitalize&&(e=capitalize(e)),e}function formatLabel(e){if(typeof e=="string")return e;if(e===0)return e.toString();const t=Math.floor(Math.log10(Math.abs(e)));return t>=3?round(e).toString():t<=-3?round(e,-t+1).toString():round(e,2).toString()}function formatAxisLabels(e,t){if(!isNumberArray(e))return e;const n=(t==null?void 0:t.tens)??4,s=f=>f!=0&&Math.abs(Math.log10(f))>n,d=(t==null?void 0:t.decimals)??minDecimal(e);e=e.map(f=>round(f,d));const u=minmax(e).some(s)?superscriptFn:noSuperscriptFn;return e.map(u)}function superscriptFn(e){return e===0?"0":exponentialToSuperscript(e.toExponential())}function noSuperscriptFn(e){return e===0?"0":parseFloat(e.toPrecision(12)).toString()}function exponentialToSuperscript(e){let[t,n]=e.split("e");return n=convertToSuperscript(n),t+"×10"+n}const sups={"-":"⁻","+":"",0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹"};function convertToSuperscript(e){return e.split("").map(t=>sups[t]).join("")}function isDefined(e){return e!=null}const primitives=["string","number","boolean","undefined"];function isPrimitive(e){return e===null||primitives.includes(typeof e)}function isObject(e){return typeof e=="object"&&e!==null}function isTypedArray(e){return ArrayBuffer.isView(e)}function isNumber(e){return typeof e=="number"}function isIntegerString(e){return/^[0-9]+/.test(e)}function isNumberArray(e){return typeof e[0]=="number"&&typeof last(e)=="number"}function isStringArray(e){return typeof e[0]=="string"&&typeof last(e)=="string"}function isEventTarget(e){return"addEventListener"in e}function findLength(e){for(const n of e){if(!n)continue;const s=Meta.get(n,"length");if(s)return s}const t="At least one variable needs to be of fixed length";throw new Error(t)}function applyWith(...e){return function(t){return t(...e)}}function row(e,t){const n={};for(const[s,d]of Object.entries(e))n[s]=Getter.of(d)(t);return n}function selector(e){return function(t){return t[e]}}function keysToSelectors(e){return function(t){return e.map(n=>t[n])}}function splitNumericSuffix(e){let t=e.length-1;for(;t>0&&/[0-9]/.test(e[t]);)t--;return t+=1,[e.substring(0,t),e.substring(t,e.length)]}function filterIndices(e,t){const n=[];for(let s=0;s<e.length;s++)t(e[s])&&n.push(s);return n}function stringArraysMatch(e,t){if(e.length!==t.length)return!1;const n=e.toSorted(compareAlphaNumeric).join(""),s=t.toSorted(compareAlphaNumeric).join("");return n===s}const LISTENERS=Symbol("listeners");var Reactive;(e=>{function t(){return function(o){return{...o,[LISTENERS]:{}}}}e.of=t;function n(o){return(o==null?void 0:o[LISTENERS])!==void 0}e.isReactive=n;function s(o,c,l,p){if(!e.isReactive(o))return;p!=null&&p.throttle&&(l=throttle(l,p.throttle));const x=(p==null?void 0:p.priority)??1,v=o[LISTENERS],m={priority:x,callback:l};v[c]||(v[c]=[]),v[c].includes(m)||v[c].push(m),v[c].sort((y,S)=>y.priority-S.priority)}e.listen=s;function d(o,c,l){if(!n(o))return;const p=o[LISTENERS][c];if(p)for(const{callback:x}of p)x(l)}e.dispatch=d;function a(o,c,l,p,x){if(!n(o)||!n(c))return;s(o,l,()=>d(c,p??l),x)}e.propagate=a;function u(o,c){n(o)&&(Object.assign(o,c(o)),d(o,"changed"))}e.set=u;function f(o,c,l){if(!n(o))return;const p=o[LISTENERS][c]??[];for(let x=0;x<p.length;x++)p[x].callback===l&&p.splice(x,1)}e.remove=f;function r(o,c){n(o)&&o[LISTENERS][c]&&(o[LISTENERS][c].length=0)}e.removeAll=r;function i(o){if(!n(o))return;const c=o[LISTENERS];if(c)for(const l of Object.values(c))l.length=0}e.removeAllListeners=i})(Reactive||(Reactive={}));const METHODS=Symbol("methods");exports.Poly=void 0,(e=>{function t(d){const a=function(...u){return n(a,d,u[0].type)(...u)};return a[METHODS]={},a}e.of=t;function n(d,a,u){return d[METHODS][u]??a}e.dispatch=n;function s(d,a,u){d[METHODS][a]=u}e.set=s})(exports.Poly||(exports.Poly={})),exports.Expanse=void 0,(e=>{e.normalize=exports.Poly.of(t),e.unnormalize=exports.Poly.of(n),e.train=exports.Poly.of(s),e.breaks=exports.Poly.of(d),e.reorder=exports.Poly.of(a);function t(m,y){throw new Error(`Method 'normalize' not implemented for expanse of type '${m.type}'`)}function n(m,y){throw new Error(`Method 'unnormalize' not implemented for expanse of type '${m.type}'`)}function s(m,y,S){throw new Error(`Method 'train' not implemented for expanse of type '${m.type}'`)}e.trainDefault=s;function d(m,y,S){throw new Error(`Method 'breaks' not implemented for expanse of type '${m.type}'`)}function a(m,y){throw new Error(`Method 'reorder' not implemented for expanse of type '${m.type}'`)}function u(){return Reactive.of()({})}e.base=u;function f(m,y,S){const{frozen:R,props:A}=m,M=y({...A});if(!(S!=null&&S.unfreeze))for(const g of R)delete M[g];for(const g of Object.keys(M))M[g]===m.props[g]&&delete M[g];copyProps(M,m.props),S!=null&&S.default&&copyProps(M,m.defaults),S!=null&&S.silent||Reactive.dispatch(m,"changed")}e.set=f;function r(m,y){for(const S of y)m.frozen.includes(S)||m.frozen.push(S)}e.freeze=r;function i(m,y){const{defaults:S}=m;for(const[R,A]of Object.entries(S))Array.isArray(A)&&Array.isArray(m.props[R])?copyValues(A,m.props[R]):m.props[R]=A;y!=null&&y.silent||Reactive.dispatch(m,"changed")}e.reset=i;function o(m){return m.type==="continuous"||m.type==="split"}e.isContinuous=o;function c(m){return m.type==="point"}e.isPoint=c;function l(m){return m.type==="point"||m.type==="band"}e.isDiscrete=l;function p(m){return m.type==="band"}e.isBand=p;function x(m){return m.type==="compound"}e.isCompound=x;function v(m){return m.type==="split"}e.isSplit=v})(exports.Expanse||(exports.Expanse={}));var ExpanseBand;(e=>{const t="band";function n(o=[]){const c="",l=exports.Expanse.base(),[p,x]=[!1,seqLength(0,o.length)],v=Array(o.length).fill(1),m=cumsum(v),y={labels:o,ordered:p,order:x,weights:v,cumulativeWeights:m},S=structuredClone(y);return{...l,type:t,value:c,props:y,defaults:S,frozen:[]}}e.of=n,exports.Poly.set(exports.Expanse.normalize,t,s),exports.Poly.set(exports.Expanse.unnormalize,t,d),exports.Poly.set(exports.Expanse.train,t,a),exports.Poly.set(exports.Expanse.breaks,t,f),exports.Poly.set(exports.Expanse.reorder,t,u);function s(o,c){const{labels:l}=o.props,p=l.indexOf(c);if(p===-1)throw new Error(`Label ${c} not found in: ${l}`);return i(o,p)}e.normalize=s;function d(o,c){const{labels:l}=o.props,p=Math.round((2*c*l.length-1)/2);return l[p]}e.unnormalize=d;function a(o,c,l){const{props:p}=o,{order:x}=p,v=Array.from(new Set(c)).sort(compareAlphaNumeric);if(!x.length){for(let R=0;R<v.length;R++)x[R]=R;o.defaults.order=[...x],p.ordered=!1}const m=Array(v.length).fill(1),y=cumsum(ordered(m,x)),S={labels:v,weights:m,cumulativeWeights:y};for(const[R,A]of Object.entries(S))copyValues(A,o.props[R]),l!=null&&l.default&&copyValues(A,o.defaults[R]);exports.Expanse.set(o,()=>({}),l)}e.train=a;function u(o,c){const{props:l,defaults:p}=o,{order:x,weights:v,cumulativeWeights:m}=o.props;if(!c){copyValues(p.order,x),copyValues(cumsum(ordered(v,x)),m),l.ordered=!1,Reactive.dispatch(o,"changed");return}copyValues(c,x),copyValues(cumsum(ordered(v,c)),m),l.ordered=!0,Reactive.dispatch(o,"changed")}e.reorder=u;function f(o){const{labels:c,order:l}=o.props;return ordered(c,l)}e.breaks=f;function r(o,c){const{props:l,defaults:p}=o;if(c=c??Array(l.labels.length).fill(1),c.length!=l.labels.length){const m="The length of the weights must match the length of labels";throw new Error(m)}const{order:x}=l,v=cumsum(ordered(c,x));copyValues(c,l.weights),copyValues(c,p.weights),copyValues(v,l.cumulativeWeights),copyValues(v,p.cumulativeWeights),Reactive.dispatch(o,"changed")}e.setWeights=r;function i(o,c){const{order:l,cumulativeWeights:p}=o.props;c=l[c];const x=p[c-1]??0,v=p[c],m=last(p);return(x+v)/2/m}})(ExpanseBand||(ExpanseBand={}));var ExpanseContinuous;(e=>{const t="continuous";function n(r=0,i=1){const c=exports.Expanse.base(),[l,p]=[identity,identity],[x,v,m,y]=[1,1,0,!1],S={min:r,max:i,scale:x,mult:v,offset:m,ratio:y,trans:l,inv:p},R={...S,trans:l,inv:p};return{...c,value:0,type:t,props:S,defaults:R,frozen:[]}}e.of=n,exports.Poly.set(exports.Expanse.normalize,t,s),exports.Poly.set(exports.Expanse.unnormalize,t,d),exports.Poly.set(exports.Expanse.train,t,a),exports.Poly.set(exports.Expanse.breaks,t,u);function s(r,i){const{min:o,max:c,scale:l,mult:p,offset:x,trans:v}=r.props,m=v(c)-v(o);let y=i/(l*p)-x;return y=(v(y-x)-v(o))/m,y}e.normalize=s;function d(r,i){const{min:o,max:c,scale:l,mult:p,offset:x,trans:v,inv:m}=r.props,y=v(c)-v(o);let S=m(v(o)+i*y);return S=S*(l*p)+x,S}e.unnormalize=d;function a(r,i,o){const{ratio:c}=r.props;let[l,p]=Meta.get(i,["min","max"]);(!l||!p)&&([l,p]=minmax(i)),l=c||o!=null&&o.ratio?0:l,exports.Expanse.set(r,()=>({min:l,max:p}),o)}e.train=a;function u(r,i=0,o=1){let[c,l]=[i,o].map(x=>d(r,x));return[c,l]=[c,l].sort(diff),prettyBreaks(c,l,4)}e.breaks=u;function f(r){const{min:i,max:o}=r.props;return o-i}e.range=f})(ExpanseContinuous||(ExpanseContinuous={})),exports.Scale=void 0,(e=>{function t(g,b){const k={zero:0,one:1,direction:1},h={...k},[w,z]=[[],[]],O=Reactive.of()({domain:g,codomain:b,props:k,defaults:h,frozen:z,linked:w});return Reactive.propagate(g,O,"changed"),Reactive.propagate(b,O,"changed"),O}e.of=t;function n(){return e.of(ExpanseContinuous.of(),ExpanseContinuous.of())}e.standard=n;function s(g,b){const{domain:k,codomain:h,props:w}=g,{zero:z,one:O,direction:I}=w;let L=exports.Expanse.normalize(k,b);return Array.isArray(L)?L=L.map(C=>a(z+C*(O-z),I)):(L=z+L*(O-z),L=a(L,I)),exports.Expanse.unnormalize(h,L)}e.pushforward=s;function d(g,b){const{domain:k,codomain:h,props:w}=g,{zero:z,one:O}=w;let I=exports.Expanse.normalize(h,b);return Array.isArray(I)?I=I.map(L=>(L-z)/(O-z)):I=(I-z)/(O-z),exports.Expanse.unnormalize(k,I)}e.pullback=d;function a(g,b){return .5*(1-b)+b*g}function u(g,b,k){const{linked:h,frozen:w,props:z}=g,O=b({...z});if(!(k!=null&&k.unfreeze))for(const I of w)delete O[I];Object.assign(z,O),k!=null&&k.default&&Object.assign(g.defaults,O),k!=null&&k.silent||Reactive.dispatch(g,"changed");for(const I of h)e.set(I,b,k)}e.set=u;function f(g,b){for(const k of b)g.frozen.includes(k)||g.frozen.push(k)}e.freeze=f;function r(g){e.set(g,b=>({direction:-1*b.direction}))}e.flip=r;function i(g,b){let{direction:k,zero:h,one:w}=g.props;h+=k*b,w+=k*b,e.set(g,()=>({zero:h,one:w}))}e.move=i;function o(g,b,k,h){const{zero:w,one:z,direction:O}=g.props,I=z-w;O===-1&&([b,k]=[1-b,1-k]),[b,k]=[b,k].map(L=>(L-w)/I),[b,k]=invertRange(b,k),O===-1&&([b,k]=[1-b,1-k]),e.set(g,()=>({zero:b,one:k}),h)}e.expand=o;function c(g,b,k){if(((k==null?void 0:k.name)??!0)&&Meta.has(b,"name")&&Meta.copy(b,g,["name"]),typeof b[0]=="string"&&exports.Expanse.isContinuous(g.domain)){const w=Array.from(new Set(b));g.domain=ExpanseBand.of(w)}exports.Expanse.train(g.domain,b,k)}e.train=c;function l(g,b){Object.assign(g.props,g.defaults),b!=null&&b.silent||Reactive.dispatch(g,"changed")}e.reset=l;function p(g){exports.Expanse.reset(g.domain,{silent:!0}),exports.Expanse.reset(g.codomain,{silent:!0}),e.reset(g)}e.restore=p;function x(g){const{domain:b,props:k}=g;let{zero:h,one:w}=k;[h,w]=invertRange(h,w);const z=exports.Expanse.breaks(b,h,w);let O=formatAxisLabels(z);if(exports.Expanse.isCompound(g.domain)){O=formatAxisLabels(z,{decimals:1});const L=z.map(C=>exports.Expanse.unnormalize(g.codomain,ExpanseContinuous.normalize(g.domain,C)));return{labels:O,positions:L}}else if(exports.Expanse.isSplit(g.codomain)){const L=e.pushforward(g,z);return{labels:O,positions:L}}const I=z.map(L=>e.pushforward(g,L));return{labels:O,positions:I}}e.breaks=x;function v(g,b){g.linked.includes(b)||g.linked.push(b)}e.link=v;function m(g,b){for(const k of b)k.codomain=g.codomain}e.shareCodomain=m;function y(g){return g.props.one-g.props.zero}e.unitRange=y;function S(g){const{domain:b}=g;if(exports.Expanse.isContinuous(b))return ExpanseContinuous.range(b)/y(g)}e.domainRange=S;function R(g){const{codomain:b}=g;if(exports.Expanse.isContinuous(b))return ExpanseContinuous.range(b)*y(g)}e.codomainRange=R;function A(g){if(!M(g))throw new Error("Both domain and codomain need to be continuous");const{domain:b,codomain:k}=g,h=ExpanseContinuous.range(b);return ExpanseContinuous.range(k)*y(g)/h}e.unitRatio=A;function M(g){const{domain:b,codomain:k}=g;return exports.Expanse.isContinuous(b)&&exports.Expanse.isContinuous(k)}e.isContinuous=M})(exports.Scale||(exports.Scale={})),exports.Factor=void 0,(e=>{e.POSITIONS=Symbol("positions"),e.DIMENSION=Symbol("dimension"),e.CHILD_INDICES=Symbol("child-indices");function t(o,c,l,p){return Reactive.of()({type:o,cardinality:c,indices:l,data:p})}e.of=t;function n(o,c){c.cardinality=o.cardinality,copyValues(o.indices,c.indices);for(const l of Reflect.ownKeys(o.data))Array.isArray(o.data[l])&&Array.isArray(c.data[l])?(copyValues(o.data[l],c.data[l]),Meta.copy(o.data[l],c.data[l])):c.data[l]=o.data[l]}e.copyFrom=n;function s(o,c){if([o,c].some(l=>l.type==="bijection"))return!0;if(o.indices.length!==c.indices.length)throw new Error("Factors do not have matching length")}function d(o,c){const p=new Uint32Array(seq(0,o)),x=y=>[y];c=c??{};for(const y of Object.values(c))Meta.set(y,{queryable:!0});const v="bijection",m={...c,[e.POSITIONS]:x};return t(v,1/0,p,m)}e.bijection=d;function a(o){const l=new Uint32Array(o).fill(0),p=()=>Array.from(l),x="constant",v={[e.POSITIONS]:p};return t(x,1,l,v)}e.mono=a;function u(o,c){const l=o.map(S=>S.toString());c=c??Array.from(new Set(l)).sort(compareAlphaNumeric),Meta.has(o,"name")&&Meta.copy(o,c,["name"]);const p=new Uint32Array(o.length),x={};for(let S=0;S<l.length;S++){const R=c.indexOf(l[S]);x[R]||(x[R]=[]),p[S]=R,x[R].push(S)}Meta.set(c,{queryable:!0,isDimension:!0});const v=Object.values(x),m="surjection",y={label:c,[e.POSITIONS]:v};return t(m,c.length,p,y)}e.from=u;function f(o,c){function l(){const x=(c==null?void 0:c.breaks)??binBreaks(o,c),v=new Set,m=new Uint32Array(o.length),y={};for(let I=0;I<o.length;I++){const L=x.findIndex(C=>C>=o[I])-1;y[L]||(y[L]=[]),m[I]=L,y[L].push(I),v.add(L)}const S=Array.from(v).sort(diff);for(let I=0;I<m.length;I++)m[I]=S.indexOf(m[I]);const[R,A]=[[],[]];for(let I=0;I<S.length;I++)R.push(x[S[I]]),A.push(x[S[I]+1]);const[M,g]=[x[S[0]],x[last(S)+1]],b=`min of ${Meta.get(o,"name")}`,k=`max of ${Meta.get(o,"name")}`,h={queryable:!0,isDimension:!0};Meta.set(R,{min:M,max:g,name:b,...h}),Meta.set(A,{min:M,max:g,name:k,...h}),Meta.copy(o,x,["name"]);const w=Object.values(y),z="surjection",O={binMin:R,binMax:A,breaks:x,[e.POSITIONS]:w};return t(z,S.length,m,O)}const p=l();return c&&Reactive.isReactive(c)&&Reactive.listen(c,"changed",()=>{const x=l();e.copyFrom(x,p),Reactive.dispatch(p,"changed")}),p}e.bin=f;function r(o,c){s(o,c),o.data[e.CHILD_INDICES]=[];function l(){if(o.type==="bijection"){const C={};for(const _ of Reflect.ownKeys(o.data))C[_]=Getter.of(o.data[_]),Meta.copy(o.data[_],C[_]);for(const _ of Reflect.ownKeys(c.data))C[_]=Getter.proxy(c.data[_],c.indices),Meta.copy(c.data[_],C[_]);const D="bijection",E=c.indices.length,T=new Uint32Array(c.indices.length),P=t(D,E,T,C);P.parent=o;const F=Array.from(Array(T.length),(_,H)=>[H]);return copyValues(F,o.data[e.CHILD_INDICES]),P}if(o.type==="constant"){const{type:C,data:D,cardinality:E,indices:T}=c,P=t(C,E,T,D);return P.parent=o,P}const x=Math.max(o.cardinality,c.cardinality)+1,v=new Set,m=new Uint32Array(o.indices.length),y={},S={},R={},A=Getter.of(o.indices),M=Getter.of(c.indices);for(let C=0;C<o.indices.length;C++){const[D,E]=[A(C),M(C)],T=x*D+E;T in S||(S[T]=D,R[T]=E,y[T]=[]),m[C]=T,y[T].push(C),v.add(T)}const g=Array.from(v).sort(diff),b={};for(const C of Object.keys(S))b[parseInt(C)]=g.indexOf(parseInt(C));for(let C=0;C<m.length;C++)m[C]=b[m[C]];const k={};for(const[C,D]of Object.entries(S))D in k||(k[D]=[]),k[D].push(b[parseInt(C)]);const h=Object.values(S),w=Object.values(R),z={};for(let C of Reflect.ownKeys(o.data)){let D=C;if(typeof C=="string")for(;D in z;)C+="$";const[E,T]=[o.data[C],h],P=Array.isArray(E)?subset(E,T):Getter.proxy(E,T);Meta.copy(E,P),z[D]=P}for(let C of Reflect.ownKeys(c.data)){let D=C;if(typeof C=="string")for(;D in z;)D+="$";const[E,T]=[c.data[C],w],P=Array.isArray(E)?subset(E,T):Getter.proxy(E,T);Meta.copy(E,P),z[D]=P}const O="surjection";z[e.POSITIONS]=Object.values(y);const I=t(O,g.length,m,z);I.parent=o;const L=Object.values(k);return copyValues(L,o.data[e.CHILD_INDICES]),I}const p=l();return Reactive.listen(o,"changed",()=>{const x=l();e.copyFrom(x,p),Reactive.dispatch(p,"changed")},{priority:2}),Reactive.listen(c,"changed",()=>{const x=l();e.copyFrom(x,p),Reactive.dispatch(p,"changed")},{priority:2}),p}e.product=r;function i(o,c){const l={};for(let p=0;p<c.indices.length&&(l[c.indices[p]]=o.indices[p],!(Object.keys(l).length>=c.cardinality));p++);return Object.values(l)}e.parentIndices=i})(exports.Factor||(exports.Factor={}));const Transient=255;var Group=(e=>(e[e.Base=7]="Base",e[e.First=6]="First",e[e.Second=5]="Second",e[e.Third=4]="Third",e[e.BaseTransient=3]="BaseTransient",e[e.FirstTransient=2]="FirstTransient",e[e.SecondTransient=1]="SecondTransient",e[e.ThirdTransient=0]="ThirdTransient",e))(Group||{});const LAYER=Symbol("layer");var Marker;(e=>{function t(o){const c=Transient,l=new Uint32Array(o).fill(7),p=[],x="surjection",v=[0,1,2,3,4,5,6,7],m=exports.Factor.of(x,8,l,{[LAYER]:v});Meta.set(v,{queryable:!0});const y=Reactive.of()({group:c,indices:l,transientIndices:p,factor:m});return Reactive.propagate(y,m,"changed"),y}e.of=t;function n(o,c){o.group=c}e.setGroup=n;function s(o,c,l){const p=(l==null?void 0:l.group)??o.group;if(a(o,{silent:!0}),p===Transient){for(let x=0;x<c.length;x++){const v=c[x];o.indices[v]=r(o.indices[v])}o.transientIndices=c}else for(let x=0;x<c.length;x++){const v=c[x];o.indices[v]=p}l!=null&&l.silent||Reactive.dispatch(o,"changed")}e.update=s;function d(o,c){for(let l=0;l<o.indices.length;l++)o.indices[l]=7;c!=null&&c.silent||(Reactive.dispatch(o,"changed"),Reactive.dispatch(o,"cleared"))}e.clearAll=d;function a(o,c){for(let l=0;l<o.transientIndices.length;l++){const p=o.transientIndices[l];o.indices[p]=i(o.indices[p])}c!=null&&c.silent||(Reactive.dispatch(o,"changed"),Reactive.dispatch(o,"cleared"))}e.clearTransient=a;function u(o){const{factor:c,indices:l}=o;return p=>c.data[LAYER][l[p]]}e.getLayer=u;function f(o){return!(o&4)}e.isTransient=f;function r(o){return o&-5}function i(o){return o|4}})(Marker||(Marker={}));var Reduced;(e=>{e.PARENT=Symbol("parent"),e.VALUES=Symbol("values"),e.INDICES=Symbol("indices"),e.FACTOR=Symbol("factor"),e.REDUCER=Symbol("reducer"),e.ORIGINAL_VALUES=Symbol("original-values");function t(l,p,x,v){const m=l;return m[e.VALUES]=l,m[e.FACTOR]=p,m[e.REDUCER]=x,m[e.ORIGINAL_VALUES]=l,v&&n(m,v),m}e.of=t;function n(l,p){l[e.PARENT]=p}e.setParent=n;function s(l){const[,p,x,v]=c(l);if(!v)throw new Error("Parent missing");const m=exports.Factor.parentIndices(f(v),p),y=subset(v,m),S=t(y,f(v),x,r(v));return i(S,v),o(S,m),S[e.ORIGINAL_VALUES]=l[e.ORIGINAL_VALUES],Meta.copy(l,S,["name","queryable","reduced"]),S}e.parent=s;function d(l){const[p,x,v,m,y]=c(l);if(!m)throw new Error("Cannot stack a without a parent");const S=exports.Factor.parentIndices(f(m),x),{reducefn:R,initialfn:A}=v,[M,g]=[p.length,[]],b=Array.from(Array(M),()=>A()),k=Getter.of(S);for(let z=0;z<p.length;z++){const O=k(z);g[O]===void 0&&(g[O]=A()),g[O]=R(g[O],p[z]),b[z]=g[O]}const h=y?subset(b,y):b,w=e.of(h,x,v,m);return i(w,b),y&&o(w,y),w[e.ORIGINAL_VALUES]=l[e.ORIGINAL_VALUES],Meta.copy(l,w,["name","queryable","reduced"]),w}e.stack=d;function a(l,p){const[x,v,m,y,S]=c(l);if(!y)throw new Error("Cannot normalize a without a parent");const R=exports.Factor.parentIndices(f(y),v),A=subset(y,R),M=[...x];for(let k=0;k<l.length;k++)M[k]=p(M[k],A[k]);const g=S?subset(M,S):M,b=e.of(g,v,m,y);return i(b,M),S&&o(b,S),b[e.ORIGINAL_VALUES]=l[e.ORIGINAL_VALUES],Meta.copy(l,b,["name","queryable","reduced"]),b}e.normalize=a;function u(l){const[p,x,v,m,y]=c(l),S=[];S.push(v.initialfn());for(let M=0;M<p.length-1;M++)S.push(p[M]);const R=y?subset(S,y):S,A=e.of(R,x,v,m);return i(A,S),y&&o(A,y),A[e.ORIGINAL_VALUES]=l[e.ORIGINAL_VALUES],Meta.copy(l,A,["name","queryable"]),A}e.shiftLeft=u;function f(l){return l[e.FACTOR]}function r(l){return l[e.PARENT]}e.getParent=r;function i(l,p){l[e.VALUES]=p}function o(l,p){l[e.INDICES]=p}function c(l){return[l[e.VALUES],l[e.FACTOR],l[e.REDUCER],l[e.PARENT],l[e.INDICES]]}})(Reduced||(Reduced={}));var Geom;(e=>{function t(l){const p=Reactive.of()(l),x=last(l.coordinates)??Reactive.of()({});return Reactive.listen(x,"changed",()=>Reactive.dispatch(p,"coords-changed")),p}e.of=t,e.render=exports.Poly.of(n),e.check=exports.Poly.of(s),e.query=exports.Poly.of(d);function n(l,p){throw new Error(`Method 'render' not implemented for geom of type '${l.type}'`)}function s(l,p){throw new Error(`Method 'check' not implemented for geom of type '${l.type}'`)}function d(l,p){throw new Error(`Method 'render' not implemented for geom of type '${l.type}'`)}function a(l,p){const x=last(l.coordinates)??Reactive.of()({});Reactive.removeAllListeners(x),l.coordinates=p;const v=last(p)??{};Reactive.listen(v,"changed",()=>Reactive.dispatch(l,"coords-changed")),Reactive.dispatch(l,"coords-swapped")}e.setCoordinates=a;function u(l){return l.coordinates[l.coordinates.length-2]}e.flatData=u;function f(l){return l.coordinates[l.coordinates.length-1]}e.groupedData=f;function r(l,p,x){const[v,m]=[Array(l),Getter.of(p)];for(let y=0;y<l;y++)v[y]=x[m(y)];return v}e.frames=r;function i(l,p){const x=[];for(const[v,m]of p){const y=Array(l),S=Getter.of(v??1);for(let R=0;R<l;R++)y[R]=exports.Scale.pushforward(m,S(R));x.push(y)}return x}e.scaledArrays=i;function o(l,p){const x=p[0],m=[c(l,x,{dimension:"only"})];for(let y=0;y<p.length;y++){const S=p[y],R=c(l,S,{dimension:"exclude"});R[LAYER]=Getter.of(l[LAYER])(S),m.push(R)}return m}e.getQueryInfo=o;function c(l,p,x){const v={},m=x==null?void 0:x.dimension;for(const y of Object.values(l)){if(m==="exclude"&&Meta.get(y,"isDimension")||m==="only"&&!Meta.get(y,"isDimension"))continue;const[S,R,A]=Meta.get(y,["name","queryable","reduced"]);if(!S||!R)continue;const M=A?y[Reduced.ORIGINAL_VALUES]:y,g=Getter.of(M);v[S]=g(p)}return v}})(Geom||(Geom={}));var DOM;(e=>{function t(r,i){const o=document.createElement(r);return i!=null&&i.id&&(o.id=i.id),i!=null&&i.classes&&a(o,i.classes),i!=null&&i.textContent&&(o.textContent=i.textContent),o}e.element=t;function n(r,i){r.appendChild(i)}e.append=n;function s(r,i){return r.querySelector(i)}e.select=s;function d(r,i){for(const[o,c]of Object.entries(i))r.style[o]=c}e.setStyles=d;function a(r,i){for(const o of i)r.classList.add(o)}e.addClasses=a;function u(r,i){for(const o of i)r.classList.remove(o)}e.removeClasses=u;function f(r){r.innerHTML=""}e.clearChildren=f})(DOM||(DOM={}));var VAnchor=(e=>(e[e.Middle=.5]="Middle",e[e.Top=1]="Top",e[e.Bottom=0]="Bottom",e))(VAnchor||{}),HAnchor=(e=>(e[e.Center=.5]="Center",e[e.Left=1]="Left",e[e.Right=0]="Right",e))(HAnchor||{}),MouseButton=(e=>(e[e.Left=0]="Left",e[e.Right=2]="Right",e))(MouseButton||{});const dataLayers=[0,1,2,3,4,5,6,7],baseLayers=[4,5,6,7];var Frame;(e=>{function t(A){const M=DOM.element("canvas"),g=M.getContext("2d");DOM.addClasses(M,tw(A.classes??""));for(const[D,E]of Object.entries(A.canvasStyles??{}))M.style[D]=E;const{clientWidth:b,clientHeight:k,clientLeft:h,clientTop:w}=M,z=b-h,O=k-w,I=2,{margins:L=[0,0,0,0],contextProps:C={}}=A;return{canvas:M,context:g,width:z,height:O,margins:L,scalingFactor:I,contextProps:C}}e.of=t;function n(A,M){M.appendChild(A.canvas),A.parent=M,e.resize(A)}e.append=n;function s(A,M){for(const[g,b]of Object.entries(M))A.contextProps[g]=b,A.context[g]=b}e.setContext=s;function d(A){const{context:M,canvas:g,scalingFactor:b}=A,{clientWidth:k,clientHeight:h,clientLeft:w,clientTop:z}=g,O=k-w,I=h-z;A.width=O,A.height=I,A.canvas.width=O*b,A.canvas.height=I*b;for(const[L,C]of Object.entries(A.contextProps))A.context[L]=C;M.scale(b,b),e.clip(A)}e.resize=d;function a(A){const{context:M}=A;let{width:g,height:b}=A;const[k,h,w,z]=A.margins;g=Math.max(g-h-z,0),b=Math.max(b-w-k,0),M.beginPath(),M.rect(h,w,g,b),M.clip()}e.clip=a;function u(A){A.context.clearRect(0,0,A.width,A.height)}e.clear=u;function f(A,M){A.context.globalAlpha=M(A.context.globalAlpha)}e.setAlpha=f;function r(A){A.context.globalAlpha=1}e.resetAlpha=r;function i(A,M){return A.context.measureText(M).width}e.textWidth=i;function o(A,M){const g=A.context.measureText(M);return g.actualBoundingBoxAscent+g.actualBoundingBoxDescent}e.textHeight=o;function c(A,M,g,b,k){const{context:h}=A,w=A.canvas.clientHeight,z=(k==null?void 0:k.hAnchor)??HAnchor.Center,O=(k==null?void 0:k.vAnchor)??VAnchor.Middle;M=M+2*(z-.5)*b,g=w-g+2*(.5-O)*b,h.beginPath(),h.arc(M,g,b,0,Math.PI*2),h.fill()}e.point=c;function l(A,M,g,b,k){for(let h=0;h<M.length;h++)c(A[h],M[h],g[h],b[h],k)}e.points=l;function p(A,M,g,b,k,h){const{context:w,height:z}=A,O=b-M,I=k-g;M=M+(1-h)/2*O,b=b-(1-h)/2*O,g=g+(1-h)/2*I,k=k-(1-h)/2*I,w.fillRect(M,z-g,b-M,g-k)}e.rectangleXY=p;function x(A,M,g,b,k,h){for(let w=0;w<M.length;w++)p(A[w],M[w],g[w],b[w],k[w],h[w])}e.rectanglesXY=x;function v(A,M,g,b,k,h){const{context:w,height:z}=A,O=(h==null?void 0:h.hAnchor)??HAnchor.Center,I=(h==null?void 0:h.vAnchor)??VAnchor.Middle;M=M-O*b,g=z-g+I*k,w.fillRect(M,g,b,-k)}e.rectangleWH=v;function m(A,M,g,b,k,h){for(let w=0;w<M.length;w++)v(A[w],M[w],g[w],b[w],k[w],h)}e.rectanglesWH=m;function y(A,M,g){const{context:b,height:k}=A;b.beginPath(),b.moveTo(M[0],k-g[0]);for(let h=0;h<M.length;h++)b.lineTo(M[h],k-g[h]);b.stroke()}e.line=y;function S(A,M,g){for(let b=0;b<M.length;b++)y(A[b],M[b],g[b])}e.lines=S;function R(A,M,g,b,k){const{context:h,height:w}=A;h.save(),h.translate(M,w-g),k!=null&&k.vertical&&h.rotate(-Math.PI/2),h.fillText(b,0,0),h.translate(-M,-(w-g)),h.restore()}e.text=R})(Frame||(Frame={}));var Bars;(e=>{const t="bars";function n(u,f,r){const i=(r==null?void 0:r.vAnchor)??VAnchor.Bottom,o=(r==null?void 0:r.hAnchor)??HAnchor.Center;return Geom.of({type:t,coordinates:u,scales:f,vAnchor:i,hAnchor:o})}e.of=n,exports.Poly.set(Geom.render,t,s),exports.Poly.set(Geom.check,t,d),exports.Poly.set(Geom.query,t,a);function s(u,f){const{scales:r,hAnchor:i,vAnchor:o}=u,c=Geom.groupedData(u),l=findLength(Object.values(c)),[p,x,v,m]=Geom.scaledArrays(l,[[c.x,r.x],[c.y,r.y],[c.width,r.width],[c.height,r.height]]),y=Geom.frames(l,c[LAYER],f);Frame.rectanglesWH(y,p,x,v,m,{hAnchor:i,vAnchor:o})}function d(u,f){const{scales:r,hAnchor:i,vAnchor:o}=u,c=Geom.flatData(u),l=findLength(Object.values(c)),{x:p,y:x,width:v,height:m}=Getter.mapObject(c),y=Getter.of(c[exports.Factor.POSITIONS]),S=[];for(let R=0;R<l;R++){let A=exports.Scale.pushforward(r.x,p(R)),M=exports.Scale.pushforward(r.y,x(R)),g=exports.Scale.pushforward(r.width,v(R)),b=exports.Scale.pushforward(r.height,m(R));const k=[A-g*i,M-b*o,A+g*i,M+b*(1-o)];if(rectsIntersect(f,k)){const h=y(R);for(let w=0;w<h.length;w++)S.push(h[w])}}return S}function a(u,f){var S;const{scales:r,hAnchor:i,vAnchor:o}=u,c=Geom.flatData(u),l=Geom.groupedData(u),p=findLength(Object.values(c)),{x,y:v,width:m,height:y}=Getter.mapObject(c);for(let R=0;R<p;R++){let A=exports.Scale.pushforward(r.x,x(R)),M=exports.Scale.pushforward(r.y,v(R)),g=exports.Scale.pushforward(r.width,m(R)),b=exports.Scale.pushforward(r.height,y(R));const k=[A-g*i,M-b*o,A+g*i,M+b*(1-o)];if(pointInRect(f,k)){const h=(S=c[exports.Factor.CHILD_INDICES])==null?void 0:S[R];return Geom.getQueryInfo(l,h??[])}}}})(Bars||(Bars={}));var ExpanseCompound;(e=>{const t="compound";function n(r){const i=[];return{...ExpanseContinuous.of(),type:t,value:i,expanses:r??[]}}e.of=n,exports.Poly.set(exports.Expanse.normalize,t,s),exports.Poly.set(exports.Expanse.unnormalize,t,d),exports.Poly.set(exports.Expanse.train,t,a),exports.Poly.set(exports.Expanse.breaks,t,u);function s(r,i){const{expanses:o}=r;return i.map((c,l)=>exports.Expanse.normalize(o[l],c))}e.normalize=s;function d(r,i){const{expanses:o}=r;return i.map((c,l)=>exports.Expanse.unnormalize(o[l],c))}e.unnormalize=d;function a(r,i){const{expanses:o}=r;if(i.length!=o.length){const c="The number of arrays does not match the number of expanses.";throw new Error(c)}for(let c=0;c<i.length;c++)exports.Expanse.train(o[c],i[c])}e.train=a;function u(r){return ExpanseContinuous.breaks(r)}e.breaks=u;function f(r){for(const i of r.expanses)exports.Expanse.reset(i)}e.reset=f})(ExpanseCompound||(ExpanseCompound={}));var ExpansePoint;(e=>{const t="point";function n(r=[]){const i="",o=exports.Expanse.base(),[c,l]=[!1,seqLength(0,r.length)],p={labels:r,ordered:c,order:l},x=structuredClone(p);return{...o,type:t,value:i,props:p,defaults:x,frozen:[]}}e.of=n,exports.Poly.set(exports.Expanse.normalize,t,s),exports.Poly.set(exports.Expanse.unnormalize,t,d),exports.Poly.set(exports.Expanse.train,t,a),exports.Poly.set(exports.Expanse.breaks,t,f),exports.Poly.set(exports.Expanse.reorder,t,u);function s(r,i){const{labels:o,order:c}=r.props,l=c[o.indexOf(i)];return l===-1?l:l/(o.length-1)}e.normalize=s;function d(r,i){const{labels:o,order:c}=r.props;return i=Math.round(i*(o.length-1)),o[c[i]]}e.unnormalize=d;function a(r,i,o){const{props:c,defaults:l}=r,{order:p}=c,x=Array.from(new Set(i)).sort(compareAlphaNumeric);if(!p.length){for(let v=0;v<x.length;v++)p[v]=v;l.order=[...p],c.ordered=!1}copyValues(x,c.labels),o!=null&&o.default&&copyValues(x,r.defaults.labels),exports.Expanse.set(r,()=>({}),o)}e.train=a;function u(r,i){const{props:o,defaults:c}=r,{order:l}=o;if(!i){copyValues(c.order,l),o.ordered=!1,Reactive.dispatch(r,"changed");return}copyValues(i,l),o.ordered=!0,Reactive.dispatch(r,"changed")}e.reorder=u;function f(r){const{labels:i,order:o}=r.props;return ordered(i,o)}e.breaks=f})(ExpansePoint||(ExpansePoint={}));var ExpanseSplit;(e=>{const t="split";function n(f){const r=[],i=f??ExpanseContinuous.of(),o=i.type;return{...i,value:r,type:t,innerType:o}}e.of=n,exports.Poly.set(exports.Expanse.normalize,t,s),exports.Poly.set(exports.Expanse.unnormalize,t,d),exports.Poly.set(exports.Expanse.train,t,a),exports.Poly.set(exports.Expanse.breaks,t,u);function s(f,r){const{innerType:i}=f,o=exports.Poly.dispatch(exports.Expanse.normalize,identity,i);return Array.isArray(r)?r.map(c=>o(f,c)):o(f,r)}e.normalize=s;function d(f,r){const{innerType:i}=f,o=exports.Poly.dispatch(exports.Expanse.unnormalize,identity,i);return Array.isArray(r)?r.map(c=>o(f,c)):o(f,r)}e.unnormalize=d;function a(f,r){const{innerType:i}=f;exports.Poly.dispatch(exports.Expanse.train,identity,i)(f,r)}e.train=a;function u(f){const{innerType:r}=f;return exports.Poly.dispatch(exports.Expanse.breaks,identity,r)(f)}e.breaks=u})(ExpanseSplit||(ExpanseSplit={}));const expanseMap={continuous:ExpanseContinuous,point:ExpansePoint,band:ExpanseBand,split:ExpanseSplit,compound:ExpanseCompound},scaleNames=["x","y","size","area","areaPct","width","height"];exports.Scales=void 0,(e=>{function t(s){const d={};for(const a of scaleNames)d[a]=exports.Scale.standard();for(const[a,[u,f]]of Object.entries(s??{}))d[a]=exports.Scale.of(expanseMap[u].of(),expanseMap[f].of());return d}e.of=t;function n(s,d,a){return{...s,[d]:a}}e.set=n})(exports.Scales||(exports.Scales={})),exports.Reducer=void 0,(Reducer=>{Reducer.sum={name:"sum",fallback:"count",initialfn:()=>0,reducefn:(e,t)=>e+t},Reducer.max={name:"max",initialfn:()=>-1/0,reducefn:(e,t)=>Math.max(e,t)},Reducer.product={name:"product",initialfn:()=>1,reducefn:(e,t)=>e*t},Reducer.table={name:"table",initialfn:()=>({}),reducefn:(e,t)=>(e[t]=e[t]+1||0,e)};function parse(value){if(typeof value=="string")return Reducer[value];if(typeof value.initialfn=="string"&&typeof value.reducefn=="string"){const parsed={name:value.name};return parsed.initialfn=eval(value.initialfn),parsed.reducefn=eval(value.reducefn),parsed}return value}Reducer.parse=parse;function reduce(e,t,n){const{indices:s,cardinality:d}=t,{initialfn:a,reducefn:u}=n,f=Array.from(Array(d),()=>a()),r=Getter.of(s),i=Getter.of(e);for(let l=0;l<s.length;l++){const p=r(l);f[p]=u(f[p],i(l))}const o=Reduced.of(f,t,n);isObject(e)&&Meta.copy(e,o);const c=getName(f,n)??"[unknown summary]";return Meta.set(o,{name:c,queryable:!0,reduced:!0}),o}Reducer.reduce=reduce;function getName(e,t){return Meta.has(e,"name")?`${t.name} of ${Meta.get(e,"name")}`:t.fallback}Reducer.getName=getName})(exports.Reducer||(exports.Reducer={}));var Summaries;(e=>{function t(a,u){const f=[];for(let r=0;r<u.length;r++){const i=u[r],o=n(a,i),c=Reactive.of()(merge(o,i.data));if(f.push(c),r>0)for(const l of Object.keys(o)){const p=f[r-1][l];Reduced.setParent(o[l],p)}Reactive.listen(i,"changed",()=>{const l=n(a,i);for(const p of Object.keys(l))copyValues(l[p],o[p]);for(const p of Reflect.ownKeys(i.data))copyValues(i.data[p],c[p])}),Reactive.propagate(i,c,"changed")}return f}e.of=t;function n(a,u){const f={};for(const[r,i]of Object.entries(a)){const[o,c]=i;f[r]=exports.Reducer.reduce(o,u,c)}return f}function s(a,u){const f=[];for(let r=0;r<a.length;r++){let i=function(c){const l=u[r](c),p=Reflect.ownKeys(c);for(const x of p)(typeof x=="symbol"||isIntegerString(x))&&(l[x]=c[x]);return l};const o=Reactive.of()(i(a[r]));f.push(o),Reactive.listen(a[r],"changed",()=>{const c=i(a[r]);for(const l of Reflect.ownKeys(c))Array.isArray(c[l])&&Array.isArray(o[l])&&copyValues(c[l],o[l]);Reactive.dispatch(o,"changed")})}return f}e.translate=s;function d(a,u){const f={};let r=0;for(const[i,o]of a)f[`q${r++}`]=[i(u),o];return f}e.formatQueries=d})(Summaries||(Summaries={}));function Barplot(e,t,n){const{data:s,marker:d}=e;let[a,u]=t(s);const f=u&&(n!=null&&n.reducer)?n.reducer:exports.Reducer.sum,r=u||(()=>1),i=exports.Factor.from(a),o=exports.Factor.product(i,d.factor),c=[i,o],l=n!=null&&n.queries?n.queries(s):{},p=[r,f],x=Summaries.of({stat:p,...l},c),v=exports.Scales.of({x:["band","continuous"]}),[m,y]=["bar","absolute"],S={...n,type:m,representation:y},R=Bars.of([],v),A=Object.assign(exports.Plot.of(x,v,S),{bars:R});return barplot(A),exports.Plot.addGeom(A,R),Reactive.listen(A,"normalize",()=>switchRepresentation$3(A)),A}function sortAxis$1(e,t){if(e.props.ordered)ExpanseBand.reorder(e);else{const n=orderIndices(t);ExpanseBand.reorder(e,n)}}function switchRepresentation$3(e){e.representation==="absolute"?spineplot(e):barplot(e)}function barplot(e){const{data:t,scales:n,bars:s}=e,d=Summaries.translate(t,[i=>({x:i.label,y:zero,height:i.stat,width:one}),i=>({x:i.label,y:zero,height:Reduced.stack(i.stat),width:one})]),[a]=d,u={default:!0,ratio:!0};exports.Scale.train(n.x,a.x,u),exports.Scale.train(n.y,a.height,u),exports.Scale.train(n.width,[0,1],u),exports.Scale.train(n.height,a.height,u),exports.Scale.freeze(n.y,["zero"]),exports.Scale.freeze(n.height,["zero"]),ExpanseBand.setWeights(n.x.domain);const f=1/new Set(a.x).size;exports.Scale.link(n.y,n.height);const r={scale:f,mult:.9,offset:0};return exports.Expanse.set(n.width.codomain,()=>r,{default:!0}),Meta.copy(a.height,n.y,["name"]),Reactive.removeAll(e,"reorder"),Reactive.listen(e,"reorder",()=>sortAxis$1(n.x.domain,a.height)),Geom.setCoordinates(s,d),e.representation="absolute",exports.Plot.render(e),exports.Plot.renderAxes(e),e}function spineplot(e){const{data:t,scales:n,bars:s}=e,d=Summaries.translate(t,[r=>({x:r.label,y:zero,height:one,width:r.stat}),r=>({x:r.label,y:zero,height:Reduced.normalize(Reduced.stack(r.stat),(i,o)=>i/o),width:Reduced.parent(r.stat)})]),[a]=d,u={default:!0,ratio:!0};exports.Scale.train(n.x,a.x,u),exports.Scale.train(n.y,[0,1],u),exports.Scale.train(n.width,cumsum(a.width),u),exports.Scale.train(n.height,[0,1],u),exports.Scale.freeze(n.y,["zero"]),exports.Scale.freeze(n.height,["zero"]),ExpanseBand.setWeights(n.x.domain,a.width),exports.Scale.link(n.y,n.height);const f={scale:1,mult:1,offset:-1};exports.Expanse.set(n.width.codomain,()=>f,{default:!0}),Meta.set(n.y,{name:"proportion"}),Reactive.removeAll(e,"reorder"),Reactive.listen(e,"reorder",()=>sortAxis$1(n.x.domain,a.width)),Geom.setCoordinates(s,d),e.representation="propotion",exports.Plot.render(e),exports.Plot.renderAxes(e)}function Bibarplot(e,t,n){const{data:s,marker:d}=e;let[a,u,f]=t(s);const r=exports.Reducer.sum,i=exports.Reducer.sum,o=f?u:()=>1,c=f||u,l=exports.Factor.from(a),p=exports.Factor.product(l,d.factor),x=[l,p],v=n!=null&&n.queries?n.queries(s):{},m=[o,r],y=[c,i],S=Summaries.of({stat1:m,stat2:y,...v},x),R=exports.Scales.of({x:["band","continuous"],heightUp:["continuous","continuous"],heightDown:["continuous","continuous"]}),A={type:"bar",representation:"absolute"},M={...R,height:R.heightUp},g={...R,height:R.heightDown},b=Bars.of([],M),k=Bars.of([],g),h={bars1:b,bars2:k},w=Object.assign(exports.Plot.of(S,R,A),h);bibarplot(w),exports.Plot.addGeom(w,b),exports.Plot.addGeom(w,k);const z={default:!0};return exports.Scale.shareCodomain(R.height,[R.heightUp,R.heightDown]),exports.Scale.set(R.heightUp,()=>({one:.4}),z),exports.Scale.set(R.heightDown,()=>({one:-.4}),z),exports.Expanse.set(R.height.codomain,()=>({inv:identity}),z),w}function sortAxis(e,t){if(e.props.ordered)ExpanseBand.reorder(e);else{const n=orderIndices(t);ExpanseBand.reorder(e,n)}}function bibarplot(e){const{data:t,scales:n,bars1:s,bars2:d}=e,a=Summaries.translate(t,[y=>({x:y.label,y:zero,height:y.stat1,width:one}),y=>({x:y.label,y:zero,height:Reduced.stack(y.stat1),width:one})]),u=Summaries.translate(t,[y=>({x:y.label,y:zero,height:y.stat2,width:one}),y=>({x:y.label,y:zero,height:Reduced.stack(y.stat2),width:one})]),[f]=a,r={default:!0,ratio:!0},{stat1:i,stat2:o}=t[0],c=Math.max(...i),l=Math.max(...o);exports.Scale.train(n.x,f.x,r),exports.Scale.train(n.y,[-1,1],{default:!0,ratio:!1}),exports.Scale.train(n.width,[0,1],r),exports.Scale.train(n.heightUp,[0,c],r),exports.Scale.train(n.heightDown,[0,l],r),ExpanseBand.setWeights(n.x.domain);const[p,x]=[i,o].map(y=>Meta.get(y,"name"));Meta.set(n.y,{name:`${x} / ${p}`});const m={scale:1/new Set(f.x).size,mult:.9,offset:0};return exports.Expanse.set(n.width.codomain,()=>m,{default:!0}),Reactive.removeAll(e,"reorder"),Reactive.listen(e,"reorder",()=>sortAxis(n.x.domain,f.height)),Geom.setCoordinates(s,a),Geom.setCoordinates(d,u),e.representation="absolute",exports.Plot.render(e),exports.Plot.renderAxes(e),e}function Fluctuationplot(e,t,n){const{data:s,marker:d}=e;let[a,u,f]=t(s);const r=f&&(n!=null&&n.reducer)?n.reducer:exports.Reducer.sum,i=f?[...f]:()=>1,o=exports.Factor.product(exports.Factor.from(a),exports.Factor.from(u)),c=exports.Factor.product(o,d.factor),l=[o,c],p=n!=null&&n.queries?n.queries(s):{},x=[i,r],v=Summaries.of({stat:x,...p},l),m=exports.Scales.of({x:["band","continuous"],y:["band","continuous"]}),[y,S]=["fluct","absolute"],R={...n,type:y,representation:S},A=Bars.of([],m,{vAnchor:VAnchor.Middle}),M=Object.assign(exports.Plot.of(v,m,R),{bars:A});return exports.Scale.shareCodomain(m.area,[m.width,m.height]),fluctplot(M),exports.Plot.addGeom(M,A),Reactive.listen(M,"normalize",()=>switchRepresentation$2(M)),M}function switchRepresentation$2(e){e.representation==="absolute"?pctfluctplot(e):fluctplot(e)}function fluctplot(e){const{data:t,scales:n,bars:s}=e,d=Summaries.translate(t,[i=>({x:i.label,y:i.label$,height:i.stat,width:i.stat}),i=>({x:i.label,y:i.label$,height:Reduced.stack(i.stat),width:Reduced.stack(i.stat)})]),[a]=d,u={default:!0,ratio:!0};exports.Scale.train(n.x,a.x,u),exports.Scale.train(n.y,a.y,u),exports.Scale.train(n.width,a.width,u),exports.Scale.train(n.height,a.height,u);const r={scale:1/max(new Set(a.x).size,new Set(a.y).size),mult:.9,offset:0};exports.Expanse.set(n.area.codomain,()=>r,{default:!0}),Geom.setCoordinates(s,d),e.representation="absolute",exports.Plot.render(e)}function pctfluctplot(e){const{data:t,scales:n,bars:s}=e,d=Summaries.translate(t,[i=>({x:i.label,y:i.label$,height:one,width:one}),i=>({x:i.label,y:i.label$,height:Reduced.normalize(Reduced.stack(i.stat),(o,c)=>o/c),width:Reduced.normalize(Reduced.stack(i.stat),(o,c)=>o/c)})]),[a]=d,u={default:!0,ratio:!0};exports.Scale.train(n.x,a.x,u),exports.Scale.train(n.y,a.y,u),exports.Scale.train(n.width,[0,1],u),exports.Scale.train(n.height,[0,1],u);const r={scale:1/max(new Set(a.x).size,new Set(a.y).size),mult:.9,offset:-1};exports.Expanse.set(n.area.codomain,()=>r,{default:!0}),Geom.setCoordinates(s,d),e.representation="propotion",exports.Plot.render(e)}var Rectangles;(e=>{const t="rectangles";function n(u,f){return Geom.of({type:t,coordinates:u,scales:f})}e.of=n,exports.Poly.set(Geom.render,t,s),exports.Poly.set(Geom.check,t,d),exports.Poly.set(Geom.query,t,a);function s(u,f){const{scales:r}=u,i=Geom.groupedData(u),o=findLength(Object.values(i)),[c,l,p,x,v]=Geom.scaledArrays(o,[[i.x0,r.x],[i.y0,r.y],[i.x1,r.x],[i.y1,r.y],[i.area,r.areaPct]]),m=Geom.frames(o,i[LAYER],f);Frame.rectanglesXY(m,c,l,p,x,v)}e.render=s;function d(u,f){const{scales:r}=u,i=Geom.flatData(u),o=findLength(Object.values(i)),{x0:c,y0:l,x1:p,y1:x,area:v}=Getter.mapObject(i),m=Getter.of(i[exports.Factor.POSITIONS]),y=[];for(let S=0;S<o;S++){let R=exports.Scale.pushforward(r.x,c(S)),A=exports.Scale.pushforward(r.y,l(S)),M=exports.Scale.pushforward(r.x,p(S)),g=exports.Scale.pushforward(r.y,x(S));if(i.area){const b=exports.Scale.pushforward(r.areaPct,v(S)),k=M-R,h=g-A;R=R+(1-b)/2*k,M=M-(1-b)/2*k,A=A+(1-b)/2*h,g=g-(1-b)/2*h}if(rectsIntersect(f,[R,A,M,g])){const b=m(S);for(let k=0;k<b.length;k++)y.push(b[k])}}return y}e.check=d;function a(u,f){var y;const{scales:r}=u,i=Geom.flatData(u),o=Geom.groupedData(u),c=findLength(Object.values(i)),{x0:l,y0:p,x1:x,y1:v,area:m}=Getter.mapObject(i);for(let S=0;S<c;S++){let R=exports.Scale.pushforward(r.x,l(S)),A=exports.Scale.pushforward(r.y,p(S)),M=exports.Scale.pushforward(r.x,x(S)),g=exports.Scale.pushforward(r.y,v(S));if(i.area){const b=exports.Scale.pushforward(r.areaPct,m(S)),k=M-R,h=g-A;R=R+(1-b)/2*k,M=M-(1-b)/2*k,A=A+(1-b)/2*h,g=g-(1-b)/2*h}if(pointInRect(f,[R,A,M,g])){const b=(y=i[exports.Factor.CHILD_INDICES])==null?void 0:y[S];return Geom.getQueryInfo(o,b)}}}e.query=a})(Rectangles||(Rectangles={}));function Histogram(e,t,n){const{data:s,marker:d}=e;let[a,u]=t(s);const f=u&&(n!=null&&n.reducer)?n.reducer:exports.Reducer.sum,r=u||(()=>1),[i,o]=minmax(a),c=o-i,l=Reactive.of()({anchor:i,width:c/15}),p=exports.Factor.mono(a.length),x=exports.Factor.product(p,exports.Factor.bin(a,l)),v=exports.Factor.product(x,d.factor),m=[p,x,v],y=n!=null&&n.queries?n.queries(s):{},S=[r,f],R=Summaries.of({stat:S,...y},m),A=exports.Scales.of(),[M,g]=["histo","absolute"],b={...n,type:M,representation:g},k=Rectangles.of([],A),h=Object.assign(exports.Plot.of(R,A,b),{rectangles:k});histogram(h),exports.Plot.addGeom(h,k),Reactive.listen(h,"normalize",()=>switchRepresentation$1(h));const w=c/10;return Reactive.listen(h,"set-parameters",z=>{z&&(z.width&&Reactive.set(l,()=>({width:z.width})),z.anchor&&Reactive.set(l,()=>({anchor:z.anchor})))}),Reactive.listen(h,"grow",()=>Reactive.set(l,z=>({width:z.width*10/9}))),Reactive.listen(h,"shrink",()=>Reactive.set(l,z=>({width:z.width*9/10}))),Reactive.listen(h,"increment-anchor",()=>Reactive.set(l,z=>({anchor:z.anchor+w}))),Reactive.listen(h,"decrement-anchor",()=>Reactive.set(l,z=>({anchor:z.anchor-w}))),Reactive.listen(h,"reset",()=>{Reactive.set(l,()=>({anchor:i,width:c/15}))}),h}function switchRepresentation$1(e){e.representation==="absolute"?spinogram(e):histogram(e)}function histogram(e){const{data:t,rectangles:n}=e,s=Summaries.translate(t,[u=>u,u=>({x0:u.binMin,y0:zero,x1:u.binMax,y1:u.stat}),u=>({x0:u.binMin,y0:zero,x1:u.binMax,y1:Reduced.stack(u.stat)})]),{scales:d}=e,[,a]=s;exports.Scale.train(d.x,a.x1,{default:!0,name:!1}),exports.Scale.train(d.y,a.y1,{default:!0,ratio:!0}),exports.Scale.freeze(d.y,["zero"]),Reactive.removeAll(n.coordinates[1],"changed"),Reactive.listen(s[1],"changed",()=>{exports.Scale.train(d.x,a.x1,{default:!0,name:!1}),exports.Scale.train(d.y,a.y1,{default:!0,ratio:!0})}),Meta.copy(t[1].breaks,d.x,["name"]),Meta.copy(a.y1,d.y,["name"]),Geom.setCoordinates(n,s),e.representation="absolute",exports.Plot.render(e),exports.Plot.renderAxes(e)}function spinogram(e){const{data:t,rectangles:n}=e,s=Summaries.translate(t,[u=>u,u=>({x0:Reduced.shiftLeft(Reduced.stack(u.stat)),y0:zero,x1:Reduced.stack(u.stat),y1:one}),u=>({x0:Reduced.shiftLeft(Reduced.stack(Reduced.parent(u.stat))),y0:zero,x1:Reduced.stack(Reduced.parent(u.stat)),y1:Reduced.normalize(Reduced.stack(u.stat),(f,r)=>f/r),query1:u.binMin,query2:u.binMax})]),{scales:d}=e,[,a]=s;exports.Scale.train(d.x,[0,...a.x1],{default:!0,name:!1}),exports.Scale.train(d.y,[0,1],{default:!0,ratio:!0}),exports.Scale.freeze(d.y,["zero"]),Reactive.removeAll(n.coordinates[1],"changed"),Reactive.listen(s[1],"changed",()=>{exports.Scale.train(d.x,[0,...a.x1],{default:!0,name:!1})}),Meta.set(d.x,{name:"cumulative count"}),Meta.set(d.y,{name:"proportion"}),Geom.setCoordinates(n,s),e.representation="propotion",exports.Plot.render(e),exports.Plot.renderAxes(e)}function Histogram2d(e,t,n){const{data:s,marker:d}=e;let[a,u,f]=t(s);const r=f&&(n!=null&&n.reducer)?n.reducer:exports.Reducer.sum,i=f||(()=>1),[o,c]=minmax(a),[l,p]=minmax(u),[x,v]=[c-o,p-l],m=Reactive.of()({anchor:o,width:x/15}),y=Reactive.of()({anchor:l,width:v/15}),S=exports.Factor.bin(a,m),R=exports.Factor.bin(u,y),A=exports.Factor.product(S,R),M=exports.Factor.product(A,d.factor),g=[A,M],b=n!=null&&n.queries?n.queries(s):{},k=[i,r],h=Summaries.of({stat:k,...b},g),w=exports.Scales.of(),[z,O]=["histo2d","absolute"],I={...n,type:z,representation:O},L=Rectangles.of([],w),C=Object.assign(exports.Plot.of(h,w,I),{rectangles:L});return histogram2d(C),exports.Plot.addGeom(C,L),Reactive.listen(C,"normalize",()=>switchRepresentation(C)),Reactive.listen(C,"set-parameters",D=>{D&&(D.width1&&Reactive.set(m,()=>({width:D.width1})),D.anchor1&&Reactive.set(m,()=>({anchor:D.anchor1})),D.width2&&Reactive.set(y,()=>({width:D.width2})),D.anchor2&&Reactive.set(y,()=>({anchor:D.anchor2})))}),Reactive.listen(C,"grow",()=>{Reactive.set(m,D=>({width:D.width*10/9})),Reactive.set(y,D=>({width:D.width*10/9}))}),Reactive.listen(C,"shrink",()=>{Reactive.set(m,D=>({width:D.width*9/10})),Reactive.set(y,D=>({width:D.width*9/10}))}),Reactive.listen(C,"reset",()=>{Reactive.set(m,()=>({anchor:o,width:x/15})),Reactive.set(y,()=>({anchor:l,width:v/15}))}),C}function switchRepresentation(e){e.representation==="absolute"?spinogram2d(e):histogram2d(e)}function histogram2d(e){const{data:t,rectangles:n}=e,s=Summaries.translate(t,[u=>({x0:u.binMin,y0:u.binMin$,x1:u.binMax,y1:u.binMax$,area:u.stat}),u=>({x0:u.binMin,y0:u.binMin$,x1:u.binMax,y1:u.binMax$,area:Reduced.stack(u.stat)})]),{scales:d}=e,[,a]=s;exports.Scale.train(d.x,a.x1,{default:!0}),exports.Scale.train(d.y,a.y1,{default:!0}),exports.Scale.train(d.areaPct,a.area,{default:!0}),exports.Expanse.set(d.area.codomain,()=>({min:0,max:1}),{default:!0}),exports.Expanse.freeze(d.area.codomain,["min","max"]),Reactive.removeAll(n.coordinates[0],"changed"),Reactive.listen(s[0],"changed",()=>{exports.Scale.train(d.x,a.x1,{default:!0,name:!1}),exports.Scale.train(d.y,a.y1,{default:!0,name:!1}),exports.Scale.train(d.areaPct,a.area,{default:!0})}),e.representation="absolute",Geom.setCoordinates(n,s),Meta.copy(t[1].breaks,d.x,["name"]),Meta.copy(t[1].breaks$,d.y,["name"]),exports.Plot.render(e),exports.Plot.renderAxes(e)}function spinogram2d(e){const{data:t,rectangles:n}=e,s=Summaries.translate(t,[u=>({x0:u.binMin,y0:u.binMin$,x1:u.binMax,y1:u.binMax$,area:one}),u=>({x0:u.binMin,y0:u.binMin$,x1:u.binMax,y1:u.binMax$,area:Reduced.normalize(Reduced.stack(u.stat),(f,r)=>f/r)})]),{scales:d}=e,[,a]=s;exports.Scale.train(d.x,a.x1,{default:!0}),exports.Scale.train(d.y,a.y1,{default:!0}),exports.Scale.train(d.areaPct,[0,1],{default:!0}),exports.Expanse.set(d.area.codomain,()=>({min:0,max:1}),{default:!0}),exports.Expanse.freeze(d.area.codomain,["min","max"]),Reactive.removeAll(n.coordinates[0],"changed"),Reactive.listen(s[0],"changed",()=>{exports.Scale.train(d.x,a.x1,{default:!0,name:!1}),exports.Scale.train(d.y,a.y1,{default:!0,name:!1})}),e.representation="propotion",Geom.setCoordinates(n,s),Meta.copy(t[1].breaks,d.x,["name"]),Meta.copy(t[1].breaks$,d.y,["name"]),exports.Plot.render(e),exports.Plot.renderAxes(e)}var Lines;(e=>{const t="lines";function n(u,f){return Geom.of({type:t,coordinates:u,scales:f})}e.of=n,exports.Poly.set(Geom.render,t,s),exports.Poly.set(Geom.check,t,d),exports.Poly.set(Geom.query,t,a);function s(u,f){const{scales:r}=u,i=Geom.groupedData(u),o=findLength(Object.values(i)),[c,l]=Geom.scaledArrays(o,[[i.x,r.x],[i.y,r.y]]),p=Geom.frames(o,i[LAYER],f);Frame.lines(p,c,l)}e.render=s;function d(u,f){const{scales:r}=u,i=Geom.flatData(u),o=findLength(Object.values(i)),{x:c,y:l}=Getter.mapObject(i),p=Getter.of(i[exports.Factor.POSITIONS]),x=[];for(let v=0;v<o;v++){const m=exports.Scale.pushforward(r.x,c(v)),y=exports.Scale.pushforward(r.y,l(v));for(let S=1;S<m.length;S++){const R=[m[S-1],y[S-1],m[S],y[S]];if(rectSegmentIntersect(f,R)){const A=p(v);for(let M=0;M<A.length;M++)x.push(A[M])}}}return x}e.check=d;function a(u,f){var v;let{scales:r}=u;const i=Geom.flatData(u),o=Geom.groupedData(u),c=findLength(Object.values(i)),{x:l,y:p}=Getter.mapObject(i),x=bimap([...f,...f],[-1,-1,1,1],sum);for(let m=0;m<c;m++){const y=exports.Scale.pushforward(r.x,l(m)),S=exports.Scale.pushforward(r.y,p(m));for(let R=1;R<y.length;R++){const A=[y[R-1],S[R-1],y[R],S[R]];if(rectSegmentIntersect(x,A)){const M=(v=i[exports.Factor.CHILD_INDICES])==null?void 0:v[m],g=l(m),b=p(m),k={};for(let w=0;w<g.length;w++)k[g[w]]=b[w];const h=M[0];return k[LAYER]=Getter.of(o[LAYER])(h),[k]}}}}e.query=a})(Lines||(Lines={}));function inferExpanse(e,t={train:!0}){const s=isNumberArray(e)?ExpanseContinuous.of():ExpansePoint.of();return t.train&&exports.Expanse.train(s,e),s}function Pcoordsplot(e,t,n){const{data:s,marker:d}=e,a=t(s),u=a.map(M=>Meta.get(M,"name")),f=Getter.constant(u),r=Getter.multi(a),i=n!=null&&n.queries?n.queries(s):{},o=exports.Factor.bijection(a[0].length,{x:f,y:r,...i}),c=exports.Factor.product(o,d.factor),l=Summaries.of({},[o,c]),p=exports.Scales.of({x:["split","split"],y:["compound","split"]}),x=Summaries.translate(l,[M=>M,M=>M]),v=Lines.of(x,p),[m,y]=["pcoords","absolute"],S={...n,type:m,representation:y},R=Object.assign(exports.Plot.of(l,p,S),{lines:v});exports.Plot.addGeom(R,v);const A=a.map(M=>inferExpanse(M));return p.x.domain=ExpanseSplit.of(ExpansePoint.of(u)),p.y.domain=ExpanseCompound.of(A),Meta.set(p.x,{name:"variable"}),Meta.set(p.y,{name:"value"}),R}var Points;(e=>{const t="points";function n(u,f){return Geom.of({type:t,coordinates:u,scales:f})}e.of=n,exports.Poly.set(Geom.render,t,s),exports.Poly.set(Geom.check,t,d),exports.Poly.set(Geom.query,t,a);function s(u,f){const{scales:r}=u,i=Geom.groupedData(u),o=findLength(Object.values(i)),[c,l,p]=Geom.scaledArrays(o,[[i.x,r.x],[i.y,r.y],[i.size,r.size]]),x=Geom.frames(o,i[LAYER],f);Frame.points(x,c,l,p)}e.render=s;function d(u,f){const{scales:r}=u,i=Geom.flatData(u),o=findLength(Object.values(i)),{x:c,y:l,size:p}=Getter.mapObject(i),x=Getter.of(i[exports.Factor.POSITIONS]),v=[];for(let m=0;m<o;m++){const y=exports.Scale.pushforward(r.x,c(m)),S=exports.Scale.pushforward(r.y,l(m));let R=exports.Scale.pushforward(r.size,p(m));R=R/Math.sqrt(2);const A=[y-R,S-R,y+R,S+R];if(rectsIntersect(f,A)){const M=x(m);for(let g=0;g<M.length;g++)v.push(M[g])}}return v}e.check=d;function a(u,f){var v;const{scales:r}=u,i=Geom.flatData(u),o=Geom.groupedData(u),c=findLength(Object.values(i)),{x:l,y:p,size:x}=Getter.mapObject(i);for(let m=0;m<c;m++){const y=exports.Scale.pushforward(r.x,l(m)),S=exports.Scale.pushforward(r.y,p(m));let R=exports.Scale.pushforward(r.size,x(m));R=R/Math.sqrt(2);const A=[y-R,S-R,y+R,S+R];if(pointInRect(f,A)){const M=(v=i[exports.Factor.CHILD_INDICES])==null?void 0:v[m];return Geom.getQueryInfo(o,M)}}}e.query=a})(Points||(Points={}));function Scatterplot(e,t,n){const{data:s,marker:d}=e,[a,u,f]=t(s),r=n!=null&&n.queries?n==null?void 0:n.queries(s):{},i={x:a,y:u,size:f??(()=>.5),...r},o=exports.Factor.bijection(a.length,i),c=exports.Factor.product(o,d.factor),l=Summaries.of({},[o,c]),p=Summaries.translate(l,[R=>R,R=>R]),x=exports.Scales.of(),v={...n,type:"scatter"},m=exports.Plot.of(l,x,v);exports.Scale.train(x.x,a,{default:!0}),exports.Scale.train(x.y,u,{default:!0}),f&&exports.Scale.train(x.size,f,{default:!0});const y=30/Math.log(a.length+2);exports.Expanse.set(x.size.codomain,()=>({max:y}),{default:!0});const S=Points.of(p,x);return exports.Plot.addGeom(m,S),m}const defaultOptions={size:10,expandX:.1,expandY:.1,gapPct:.8,gapPx:1,axisLabelSize:1,axisTitleSize:1.25,margins:[0,0,0,0],marginLines:[3.5,3.5,1,1],colors:["#FF7F00","#E31A1C","#33A02C","#1F78B4","#FDBF6F","#FB9A99","#B2DF8A","#A6CEE3"],plotBackground:"#fefffe"};function renderAxisLabels(e){renderSingleAxisLabels(e,"x"),renderSingleAxisLabels(e,"y")}function renderSingleAxisLabels(e,t){const{frames:n,scales:s,options:d}=e,{margins:a,marginLines:u}=d,f=s[t],r=t==="x"?s.y:s.x,i=n[`${t}Axis`],{context:o}=i,{labels:c,positions:l}=exports.Scale.breaks(f),[p,x,v,m]=a,y=parseInt(o.font.match(/^[0-9]*/)[0],10),S=r.codomain.props.min-y/2,{width:R,height:A}=i;if(Frame.clear(i),t==="x"){let[M,g]=[0,0];for(let b=0;b<c.length;b++){const k=c[b],h=l[b],w=Frame.textWidth(i,k)+1;outside(h,x,R-m)||overlap(M,h,g,w)||([M,g]=[h,w],Frame.text(i,h,S,k))}}else if(t==="y"){let[M,g]=[0,0];for(let b=0;b<c.length;b++){const k=c[b],h=l[b],w=Frame.textWidth(i,k)+1,z=Frame.textHeight(i,k)+1;if(!outside(h,p,A-v)&&!overlap(M,h,g,z)){for(;a[1]/2<w+z;)u[1]*=1.01,exports.Plot.resize(e);[M,g]=[h,z],Frame.text(i,S,h,k)}}}}function renderAxisTitles(e){renderSingleAxisTitle(e,"x"),renderSingleAxisTitle(e,"y")}function renderSingleAxisTitle(e,t){const{scales:n,frames:s,options:d}=e,{margins:a}=d,u=n[t],f=t==="x"?e.scales.y:e.scales.x,r=s.base,i=Meta.get(u,"name"),o=t==="x"?a[0]:a[1],c=exports.Expanse.unnormalize(u.codomain,.5),l=exports.Expanse.unnormalize(f.codomain,0)-o*2/3;t==="x"&&Frame.text(r,c,l,i),t==="y"&&Frame.text(r,l,c,i,{vertical:!0})}function outside(e,t,n){return e<t||e>n}function overlap(e,t,n,s){const[d,a]=[e-n/2,e+n/2],[u,f]=[t-s/2,t+s/2];return d<f&&a>=u}function _typeof(e){"@babel/helpers - typeof";return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(e)}var trimLeft=/^\s+/,trimRight=/\s+$/;function tinycolor(e,t){if(e=e||"",t=t||{},e instanceof tinycolor)return e;if(!(this instanceof tinycolor))return new tinycolor(e,t);var n=inputToRGB(e);this._originalInput=e,this._r=n.r,this._g=n.g,this._b=n.b,this._a=n.a,this._roundA=Math.round(100*this._a)/100,this._format=t.format||n.format,this._gradientType=t.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=n.ok}tinycolor.prototype={isDark:function e(){return this.getBrightness()<128},isLight:function e(){return!this.isDark()},isValid:function e(){return this._ok},getOriginalInput:function e(){return this._originalInput},getFormat:function e(){return this._format},getAlpha:function e(){return this._a},getBrightness:function e(){var t=this.toRgb();return(t.r*299+t.g*587+t.b*114)/1e3},getLuminance:function e(){var t=this.toRgb(),n,s,d,a,u,f;return n=t.r/255,s=t.g/255,d=t.b/255,n<=.03928?a=n/12.92:a=Math.pow((n+.055)/1.055,2.4),s<=.03928?u=s/12.92:u=Math.pow((s+.055)/1.055,2.4),d<=.03928?f=d/12.92:f=Math.pow((d+.055)/1.055,2.4),.2126*a+.7152*u+.0722*f},setAlpha:function e(t){return this._a=boundAlpha(t),this._roundA=Math.round(100*this._a)/100,this},toHsv:function e(){var t=rgbToHsv(this._r,this._g,this._b);return{h:t.h*360,s:t.s,v:t.v,a:this._a}},toHsvString:function e(){var t=rgbToHsv(this._r,this._g,this._b),n=Math.round(t.h*360),s=Math.round(t.s*100),d=Math.round(t.v*100);return this._a==1?"hsv("+n+", "+s+"%, "+d+"%)":"hsva("+n+", "+s+"%, "+d+"%, "+this._roundA+")"},toHsl:function e(){var t=rgbToHsl(this._r,this._g,this._b);return{h:t.h*360,s:t.s,l:t.l,a:this._a}},toHslString:function e(){var t=rgbToHsl(this._r,this._g,this._b),n=Math.round(t.h*360),s=Math.round(t.s*100),d=Math.round(t.l*100);return this._a==1?"hsl("+n+", "+s+"%, "+d+"%)":"hsla("+n+", "+s+"%, "+d+"%, "+this._roundA+")"},toHex:function e(t){return rgbToHex(this._r,this._g,this._b,t)},toHexString:function e(t){return"#"+this.toHex(t)},toHex8:function e(t){return rgbaToHex(this._r,this._g,this._b,this._a,t)},toHex8String:function e(t){return"#"+this.toHex8(t)},toRgb:function e(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function e(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function e(){return{r:Math.round(bound01(this._r,255)*100)+"%",g:Math.round(bound01(this._g,255)*100)+"%",b:Math.round(bound01(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function e(){return this._a==1?"rgb("+Math.round(bound01(this._r,255)*100)+"%, "+Math.round(bound01(this._g,255)*100)+"%, "+Math.round(bound01(this._b,255)*100)+"%)":"rgba("+Math.round(bound01(this._r,255)*100)+"%, "+Math.round(bound01(this._g,255)*100)+"%, "+Math.round(bound01(this._b,255)*100)+"%, "+this._roundA+")"},toName:function e(){return this._a===0?"transparent":this._a<1?!1:hexNames[rgbToHex(this._r,this._g,this._b,!0)]||!1},toFilter:function e(t){var n="#"+rgbaToArgbHex(this._r,this._g,this._b,this._a),s=n,d=this._gradientType?"GradientType = 1, ":"";if(t){var a=tinycolor(t);s="#"+rgbaToArgbHex(a._r,a._g,a._b,a._a)}return"progid:DXImageTransform.Microsoft.gradient("+d+"startColorstr="+n+",endColorstr="+s+")"},toString:function e(t){var n=!!t;t=t||this._format;var s=!1,d=this._a<1&&this._a>=0,a=!n&&d&&(t==="hex"||t==="hex6"||t==="hex3"||t==="hex4"||t==="hex8"||t==="name");return a?t==="name"&&this._a===0?this.toName():this.toRgbString():(t==="rgb"&&(s=this.toRgbString()),t==="prgb"&&(s=this.toPercentageRgbString()),(t==="hex"||t==="hex6")&&(s=this.toHexString()),t==="hex3"&&(s=this.toHexString(!0)),t==="hex4"&&(s=this.toHex8String(!0)),t==="hex8"&&(s=this.toHex8String()),t==="name"&&(s=this.toName()),t==="hsl"&&(s=this.toHslString()),t==="hsv"&&(s=this.toHsvString()),s||this.toHexString())},clone:function e(){return tinycolor(this.toString())},_applyModification:function e(t,n){var s=t.apply(null,[this].concat([].slice.call(n)));return this._r=s._r,this._g=s._g,this._b=s._b,this.setAlpha(s._a),this},lighten:function e(){return this._applyModification(_lighten,arguments)},brighten:function e(){return this._applyModification(_brighten,arguments)},darken:function e(){return this._applyModification(_darken,arguments)},desaturate:function e(){return this._applyModification(_desaturate,arguments)},saturate:function e(){return this._applyModification(_saturate,arguments)},greyscale:function e(){return this._applyModification(_greyscale,arguments)},spin:function e(){return this._applyModification(_spin,arguments)},_applyCombination:function e(t,n){return t.apply(null,[this].concat([].slice.call(n)))},analogous:function e(){return this._applyCombination(_analogous,arguments)},complement:function e(){return this._applyCombination(_complement,arguments)},monochromatic:function e(){return this._applyCombination(_monochromatic,arguments)},splitcomplement:function e(){return this._applyCombination(_splitcomplement,arguments)},triad:function e(){return this._applyCombination(polyad,[3])},tetrad:function e(){return this._applyCombination(polyad,[4])}},tinycolor.fromRatio=function(e,t){if(_typeof(e)=="object"){var n={};for(var s in e)e.hasOwnProperty(s)&&(s==="a"?n[s]=e[s]:n[s]=convertToPercentage(e[s]));e=n}return tinycolor(e,t)};function inputToRGB(e){var t={r:0,g:0,b:0},n=1,s=null,d=null,a=null,u=!1,f=!1;return typeof e=="string"&&(e=stringInputToObject(e)),_typeof(e)=="object"&&(isValidCSSUnit(e.r)&&isValidCSSUnit(e.g)&&isValidCSSUnit(e.b)?(t=rgbToRgb(e.r,e.g,e.b),u=!0,f=String(e.r).substr(-1)==="%"?"prgb":"rgb"):isValidCSSUnit(e.h)&&isValidCSSUnit(e.s)&&isValidCSSUnit(e.v)?(s=convertToPercentage(e.s),d=convertToPercentage(e.v),t=hsvToRgb(e.h,s,d),u=!0,f="hsv"):isValidCSSUnit(e.h)&&isValidCSSUnit(e.s)&&isValidCSSUnit(e.l)&&(s=convertToPercentage(e.s),a=convertToPercentage(e.l),t=hslToRgb(e.h,s,a),u=!0,f="hsl"),e.hasOwnProperty("a")&&(n=e.a)),n=boundAlpha(n),{ok:u,format:e.format||f,r:Math.min(255,Math.max(t.r,0)),g:Math.min(255,Math.max(t.g,0)),b:Math.min(255,Math.max(t.b,0)),a:n}}function rgbToRgb(e,t,n){return{r:bound01(e,255)*255,g:bound01(t,255)*255,b:bound01(n,255)*255}}function rgbToHsl(e,t,n){e=bound01(e,255),t=bound01(t,255),n=bound01(n,255);var s=Math.max(e,t,n),d=Math.min(e,t,n),a,u,f=(s+d)/2;if(s==d)a=u=0;else{var r=s-d;switch(u=f>.5?r/(2-s-d):r/(s+d),s){case e:a=(t-n)/r+(t<n?6:0);break;case t:a=(n-e)/r+2;break;case n:a=(e-t)/r+4;break}a/=6}return{h:a,s:u,l:f}}function hslToRgb(e,t,n){var s,d,a;e=bound01(e,360),t=bound01(t,100),n=bound01(n,100);function u(i,o,c){return c<0&&(c+=1),c>1&&(c-=1),c<.16666666666666666?i+(o-i)*6*c:c<.5?o:c<.6666666666666666?i+(o-i)*(.6666666666666666-c)*6:i}if(t===0)s=d=a=n;else{var f=n<.5?n*(1+t):n+t-n*t,r=2*n-f;s=u(r,f,e+.3333333333333333),d=u(r,f,e),a=u(r,f,e-.3333333333333333)}return{r:s*255,g:d*255,b:a*255}}function rgbToHsv(e,t,n){e=bound01(e,255),t=bound01(t,255),n=bound01(n,255);var s=Math.max(e,t,n),d=Math.min(e,t,n),a,u,f=s,r=s-d;if(u=s===0?0:r/s,s==d)a=0;else{switch(s){case e:a=(t-n)/r+(t<n?6:0);break;case t:a=(n-e)/r+2;break;case n:a=(e-t)/r+4;break}a/=6}return{h:a,s:u,v:f}}function hsvToRgb(e,t,n){e=bound01(e,360)*6,t=bound01(t,100),n=bound01(n,100);var s=Math.floor(e),d=e-s,a=n*(1-t),u=n*(1-d*t),f=n*(1-(1-d)*t),r=s%6,i=[n,u,a,a,f,n][r],o=[f,n,n,u,a,a][r],c=[a,a,f,n,n,u][r];return{r:i*255,g:o*255,b:c*255}}function rgbToHex(e,t,n,s){var d=[pad2(Math.round(e).toString(16)),pad2(Math.round(t).toString(16)),pad2(Math.round(n).toString(16))];return s&&d[0].charAt(0)==d[0].charAt(1)&&d[1].charAt(0)==d[1].charAt(1)&&d[2].charAt(0)==d[2].charAt(1)?d[0].charAt(0)+d[1].charAt(0)+d[2].charAt(0):d.join("")}function rgbaToHex(e,t,n,s,d){var a=[pad2(Math.round(e).toString(16)),pad2(Math.round(t).toString(16)),pad2(Math.round(n).toString(16)),pad2(convertDecimalToHex(s))];return d&&a[0].charAt(0)==a[0].charAt(1)&&a[1].charAt(0)==a[1].charAt(1)&&a[2].charAt(0)==a[2].charAt(1)&&a[3].charAt(0)==a[3].charAt(1)?a[0].charAt(0)+a[1].charAt(0)+a[2].charAt(0)+a[3].charAt(0):a.join("")}function rgbaToArgbHex(e,t,n,s){var d=[pad2(convertDecimalToHex(s)),pad2(Math.round(e).toString(16)),pad2(Math.round(t).toString(16)),pad2(Math.round(n).toString(16))];return d.join("")}tinycolor.equals=function(e,t){return!e||!t?!1:tinycolor(e).toRgbString()==tinycolor(t).toRgbString()},tinycolor.random=function(){return tinycolor.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})};function _desaturate(e,t){t=t===0?0:t||10;var n=tinycolor(e).toHsl();return n.s-=t/100,n.s=clamp01(n.s),tinycolor(n)}function _saturate(e,t){t=t===0?0:t||10;var n=tinycolor(e).toHsl();return n.s+=t/100,n.s=clamp01(n.s),tinycolor(n)}function _greyscale(e){return tinycolor(e).desaturate(100)}function _lighten(e,t){t=t===0?0:t||10;var n=tinycolor(e).toHsl();return n.l+=t/100,n.l=clamp01(n.l),tinycolor(n)}function _brighten(e,t){t=t===0?0:t||10;var n=tinycolor(e).toRgb();return n.r=Math.max(0,Math.min(255,n.r-Math.round(255*-(t/100)))),n.g=Math.max(0,Math.min(255,n.g-Math.round(255*-(t/100)))),n.b=Math.max(0,Math.min(255,n.b-Math.round(255*-(t/100)))),tinycolor(n)}function _darken(e,t){t=t===0?0:t||10;var n=tinycolor(e).toHsl();return n.l-=t/100,n.l=clamp01(n.l),tinycolor(n)}function _spin(e,t){var n=tinycolor(e).toHsl(),s=(n.h+t)%360;return n.h=s<0?360+s:s,tinycolor(n)}function _complement(e){var t=tinycolor(e).toHsl();return t.h=(t.h+180)%360,tinycolor(t)}function polyad(e,t){if(isNaN(t)||t<=0)throw new Error("Argument to polyad must be a positive number");for(var n=tinycolor(e).toHsl(),s=[tinycolor(e)],d=360/t,a=1;a<t;a++)s.push(tinycolor({h:(n.h+a*d)%360,s:n.s,l:n.l}));return s}function _splitcomplement(e){var t=tinycolor(e).toHsl(),n=t.h;return[tinycolor(e),tinycolor({h:(n+72)%360,s:t.s,l:t.l}),tinycolor({h:(n+216)%360,s:t.s,l:t.l})]}function _analogous(e,t,n){t=t||6,n=n||30;var s=tinycolor(e).toHsl(),d=360/n,a=[tinycolor(e)];for(s.h=(s.h-(d*t>>1)+720)%360;--t;)s.h=(s.h+d)%360,a.push(tinycolor(s));return a}function _monochromatic(e,t){t=t||6;for(var n=tinycolor(e).toHsv(),s=n.h,d=n.s,a=n.v,u=[],f=1/t;t--;)u.push(tinycolor({h:s,s:d,v:a})),a=(a+f)%1;return u}tinycolor.mix=function(e,t,n){n=n===0?0:n||50;var s=tinycolor(e).toRgb(),d=tinycolor(t).toRgb(),a=n/100,u={r:(d.r-s.r)*a+s.r,g:(d.g-s.g)*a+s.g,b:(d.b-s.b)*a+s.b,a:(d.a-s.a)*a+s.a};return tinycolor(u)},tinycolor.readability=function(e,t){var n=tinycolor(e),s=tinycolor(t);return(Math.max(n.getLuminance(),s.getLuminance())+.05)/(Math.min(n.getLuminance(),s.getLuminance())+.05)},tinycolor.isReadable=function(e,t,n){var s=tinycolor.readability(e,t),d,a;switch(a=!1,d=validateWCAG2Parms(n),d.level+d.size){case"AAsmall":case"AAAlarge":a=s>=4.5;break;case"AAlarge":a=s>=3;break;case"AAAsmall":a=s>=7;break}return a},tinycolor.mostReadable=function(e,t,n){var s=null,d=0,a,u,f,r;n=n||{},u=n.includeFallbackColors,f=n.level,r=n.size;for(var i=0;i<t.length;i++)a=tinycolor.readability(e,t[i]),a>d&&(d=a,s=tinycolor(t[i]));return tinycolor.isReadable(e,s,{level:f,size:r})||!u?s:(n.includeFallbackColors=!1,tinycolor.mostReadable(e,["#fff","#000"],n))};var names=tinycolor.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},hexNames=tinycolor.hexNames=flip(names);function flip(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[e[n]]=n);return t}function boundAlpha(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function bound01(e,t){isOnePointZero(e)&&(e="100%");var n=isPercentage(e);return e=Math.min(t,Math.max(0,parseFloat(e))),n&&(e=parseInt(e*t,10)/100),Math.abs(e-t)<1e-6?1:e%t/parseFloat(t)}function clamp01(e){return Math.min(1,Math.max(0,e))}function parseIntFromHex(e){return parseInt(e,16)}function isOnePointZero(e){return typeof e=="string"&&e.indexOf(".")!=-1&&parseFloat(e)===1}function isPercentage(e){return typeof e=="string"&&e.indexOf("%")!=-1}function pad2(e){return e.length==1?"0"+e:""+e}function convertToPercentage(e){return e<=1&&(e=e*100+"%"),e}function convertDecimalToHex(e){return Math.round(parseFloat(e)*255).toString(16)}function convertHexToDecimal(e){return parseIntFromHex(e)/255}var matchers=function(){var e="[-\\+]?\\d+%?",t="[-\\+]?\\d*\\.\\d+%?",n="(?:"+t+")|(?:"+e+")",s="[\\s|\\(]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")\\s*\\)?",d="[\\s|\\(]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")\\s*\\)?";return{CSS_UNIT:new RegExp(n),rgb:new RegExp("rgb"+s),rgba:new RegExp("rgba"+d),hsl:new RegExp("hsl"+s),hsla:new RegExp("hsla"+d),hsv:new RegExp("hsv"+s),hsva:new RegExp("hsva"+d),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function isValidCSSUnit(e){return!!matchers.CSS_UNIT.exec(e)}function stringInputToObject(e){e=e.replace(trimLeft,"").replace(trimRight,"").toLowerCase();var t=!1;if(names[e])e=names[e],t=!0;else if(e=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var n;return(n=matchers.rgb.exec(e))?{r:n[1],g:n[2],b:n[3]}:(n=matchers.rgba.exec(e))?{r:n[1],g:n[2],b:n[3],a:n[4]}:(n=matchers.hsl.exec(e))?{h:n[1],s:n[2],l:n[3]}:(n=matchers.hsla.exec(e))?{h:n[1],s:n[2],l:n[3],a:n[4]}:(n=matchers.hsv.exec(e))?{h:n[1],s:n[2],v:n[3]}:(n=matchers.hsva.exec(e))?{h:n[1],s:n[2],v:n[3],a:n[4]}:(n=matchers.hex8.exec(e))?{r:parseIntFromHex(n[1]),g:parseIntFromHex(n[2]),b:parseIntFromHex(n[3]),a:convertHexToDecimal(n[4]),format:t?"name":"hex8"}:(n=matchers.hex6.exec(e))?{r:parseIntFromHex(n[1]),g:parseIntFromHex(n[2]),b:parseIntFromHex(n[3]),format:t?"name":"hex"}:(n=matchers.hex4.exec(e))?{r:parseIntFromHex(n[1]+""+n[1]),g:parseIntFromHex(n[2]+""+n[2]),b:parseIntFromHex(n[3]+""+n[3]),a:convertHexToDecimal(n[4]+""+n[4]),format:t?"name":"hex8"}:(n=matchers.hex3.exec(e))?{r:parseIntFromHex(n[1]+""+n[1]),g:parseIntFromHex(n[2]+""+n[2]),b:parseIntFromHex(n[3]+""+n[3]),format:t?"name":"hex"}:!1}function validateWCAG2Parms(e){var t,n;return e=e||{level:"AA",size:"small"},t=(e.level||"AA").toUpperCase(),n=(e.size||"small").toLowerCase(),t!=="AA"&&t!=="AAA"&&(t="AA"),n!=="small"&&n!=="large"&&(n="small"),{level:t,size:n}}var QueryTable;(e=>{function t(s,d){if(DOM.clearChildren(s),!Array.isArray(d)){for(const[a,u]of Object.entries(d)){const f=n(a,u);DOM.append(s,f)}return}for(const a of Object.values(d))for(const[u,f]of Object.entries(a)){const r=n(u,f,defaultOptions.colors[a[LAYER]]);DOM.append(s,r)}}e.formatQueryTable=t;function n(s,d,a){const u=DOM.element("tr"),f=DOM.element("td",{classes:tw("tw-border tw-border-black tw-px-3 tw-py-1"),textContent:s}),r=DOM.element("td",{classes:tw("tw-border tw-border-black tw-px-3 tw-py-1 tw-font-mono"),textContent:formatLabel(d)});if(a){const[i,o]=[a,"black"];DOM.setStyles(f,{backgroundColor:i,borderColor:o}),DOM.setStyles(r,{backgroundColor:i,borderColor:o}),tinycolor(a).getBrightness()<127&&(DOM.setStyles(f,{color:"white"}),DOM.setStyles(r,{color:"white"}))}return DOM.append(u,f),DOM.append(u,r),u}})(QueryTable||(QueryTable={})),exports.Plot=void 0,(e=>{(E=>{E.Select="select",E.Pan="pan",E.Query="query"})(e.Mode||(e.Mode={}));function t(E,T,P){const F=DOM.element("div",{id:"plot",classes:tw("tw-relative tw-h-full tw-w-full tw-drop-shadow-md")});E=E??[],T=T??exports.Scales.of();const _={},H=[],q=[],N=[],G={...structuredClone(defaultOptions),...P},{expandX:B,expandY:j}=G,U=[[B,j,1-B,1-j]],V={active:!1,locked:!1,mousedown:!1,mousebutton:MouseButton.Left,mode:"select",mousecoords:[0,0,0,0],lastkey:"",ratio:(P==null?void 0:P.ratio)??void 0},$=P.type??"unknown",X=P.representation??"absolute",Q=Reactive.of()({type:$,representation:X,data:E,container:F,frames:_,scales:T,renderables:H,selectables:q,queryables:N,zoomStack:U,parameters:V,options:G});return setupFrames(Q,G),setupScales(Q),setupEvents$1(Q),Q}e.of=t,e.scatter=Scatterplot,e.bar=Barplot,e.fluct=Fluctuationplot,e.histo=Histogram,e.histo2d=Histogram2d,e.pcoords=Pcoordsplot,e.bibar=Bibarplot;function n(E,T){E.appendChild(T.container),e.resize(T)}e.append=n;function s(E,T){const{renderables:P,selectables:F,queryables:_}=E;for(const H of[P,F,_])H.push(T)}e.addGeom=s;function d(E,T){const{renderables:P,selectables:F,queryables:_}=E;for(const H of[P,F,_])remove(H,T)}e.deleteGeom=d;const a=tw("tw-outline tw-outline-2 tw-outline-slate-600");function u(E){DOM.addClasses(E.container,a),E.parameters.active=!0,Reactive.dispatch(E,"activated")}e.activate=u;function f(E){DOM.removeClasses(E.container,a),E.parameters.active=!1,Reactive.dispatch(E,"deactivated")}e.deactivate=f;function r(E){E.parameters.locked=!0}e.lock=r;function i(E){E.parameters.locked=!1}e.unlock=i;function o(E){for(const T of dataLayers)Frame.clear(E.frames[T]);for(const T of E.renderables)Geom.render(T,E.frames)}e.render=o;function c(E){for(const T of["base","xAxis","yAxis"])Frame.clear(E.frames[T]);renderAxisLabels(E),renderAxisTitles(E)}e.renderAxes=c;function l(E){Frame.clear(E.frames.user)}e.clearUserFrame=l;function p(E){const{container:T,scales:P,frames:F,parameters:_,options:H}=E,{clientWidth:q,clientHeight:N}=T,{x:G,y:B,width:j,height:U,area:V}=P,{margins:$,marginLines:X}=H,Q=getComputedStyle(E.container),Z=parseFloat(Q.fontSize);for(let J=0;J<$.length;J++)$[J]=X[J]*Z;for(const J of Object.values(E.frames))Frame.resize(J);const[K,W]=[$[0],$[1]],[te,Y]=[N-$[2],q-$[3]];DOM.setStyles(F.under.canvas,{width:`calc(100% - ${W}px - ${$[3]}px)`,height:`calc(100% - ${K}px - ${$[2]}px)`,top:`${$[2]}px`,right:`${$[3]}px`}),DOM.setStyles(F.over.canvas,{width:`calc(100% - ${W}px - ${$[3]}px)`,height:`calc(100% - ${K}px - ${$[2]}px)`,top:`${$[2]}px`,right:`${$[3]}px`});const ee={default:!0,silent:!0};exports.Expanse.set(G.codomain,()=>({min:W,max:Y}),ee),exports.Expanse.set(B.codomain,()=>({min:K,max:te}),ee);const[ne,re]=[Y-W,te-K];if(exports.Expanse.set(j.codomain,()=>({max:ne}),ee),exports.Expanse.set(U.codomain,()=>({max:re}),ee),exports.Expanse.set(V.codomain,()=>({max:Math.min(ne,re)}),ee),_.ratio){const{expandX:J,expandY:oe}=defaultOptions;exports.Scale.set(G,()=>({zero:J,one:1-J}),ee),exports.Scale.set(B,()=>({zero:oe,one:1-oe}),ee),e.applyRatio(E,_.ratio)}e.render(E),e.renderAxes(E)}e.resize=p;function x(E){const{selectables:T,parameters:P}=E,F=new Set;for(const _ of T){const H=Geom.check(_,P.mousecoords);for(let q=0;q<H.length;q++)F.add(H[q])}Reactive.dispatch(E,"set-selected",{cases:Array.from(F)})}e.checkSelection=x;function v(E,T){E.parameters.mode=T}e.setMode=v;function m(E,T){E.parameters.mousedown=T}e.setMousedown=m;function y(E,T){E.parameters.mousebutton=T}e.setMouseButton=y,e.mousemoveHandlers={select:S,pan:R,query:A};function S(E,T){const{container:P,parameters:F,frames:_}=E;if(!F.active||!F.mousedown)return;const{mousecoords:H}=F,{clientHeight:q}=P,N=T.offsetX,G=q-T.offsetY;H[2]=N,H[3]=G,e.checkSelection(E),Reactive.dispatch(E,"lock-others"),Frame.clear(_.user),Frame.rectangleXY(_.user,...F.mousecoords,1)}function R(E,T){const{container:P,scales:F,parameters:_}=E;if(!_.active||!_.mousedown)return;const{mousecoords:H}=_,{clientWidth:q,clientHeight:N}=P,[G,B]=H,j=T.offsetX,U=N-T.offsetY,V=(j-G)/q,$=(U-B)/N;exports.Scale.move(F.x,V),exports.Scale.move(F.y,$),H[0]=j,H[1]=U,e.clearUserFrame(E)}function A(E,T){const{offsetX:P,offsetY:F}=T,{queryTable:_,queryables:H,container:q}=E,{clientHeight:N}=q;if(!_)return;DOM.setStyles(_,{display:"none"});const[G,B]=[P,N-F];let j;for(const U of H)if(j=Geom.query(U,[G,B]),j)break;j&&(QueryTable.formatQueryTable(_,j),_.style.display="inline-block")}e.keybindings={"=":"grow","-":"shrink","]":"unfade","[":"fade",z:"zoom",x:"pop-zoom",o:"reorder",";":"decrement-anchor","'":"increment-anchor",n:"normalize"};function M(E){const{area:T,size:P,width:F}=E.scales,_=10/9,H={silent:!0};exports.Expanse.set(T.codomain,q=>({min:q.min*_,max:q.max*_}),H),exports.Expanse.set(P.codomain,q=>({min:q.min*_,max:q.max*_}),H),exports.Expanse.set(F.codomain,q=>q.mult<1?{mult:q.mult*_}:{},H),e.render(E)}e.grow=M;function g(E){const{area:T,size:P,width:F}=E.scales,_=9/10,H={silent:!0};exports.Expanse.set(T.codomain,q=>({min:q.min*_,max:q.max*_}),H),exports.Expanse.set(P.codomain,q=>({min:q.min*_,max:q.max*_}),H),exports.Expanse.set(F.codomain,q=>({mult:q.mult*9/10}),H),e.render(E)}e.shrink=g;function b(E){const{frames:T}=E;for(const P of baseLayers)Frame.setAlpha(T[P],F=>F*9/10);e.render(E)}e.fade=b;function k(E){const{frames:T}=E;for(const P of baseLayers)Frame.setAlpha(T[P],F=>F*10/9);e.render(E)}e.unfade=k;function h(E){const{frames:T,scales:P}=E;for(const F of baseLayers)Frame.resetAlpha(T[F]);for(const F of Object.values(P))exports.Scale.restore(F);E.zoomStack.length=1,e.clearUserFrame(E)}e.reset=h;function w(E){e.setMode(E,"query")}e.setQueryMode=w;function z(E,T){const{scales:P,parameters:F,zoomStack:_}=E;let{coords:H,units:q}=T??{};q=q??"screen";let[N,G,B,j]=H??F.mousecoords;const{x:U,y:V}=P;if(q==="data"){const Y={silent:!0};exports.Scale.set(U,()=>({zero:0,one:1}),Y),exports.Scale.set(V,()=>({zero:0,one:1}),Y),N=exports.Expanse.normalize(U.domain,N),B=exports.Expanse.normalize(U.domain,B),G=exports.Expanse.normalize(V.domain,G),j=exports.Expanse.normalize(V.domain,j)}if(q==="screen"){if(Math.abs(B-N)<10||Math.abs(j-G)<10)return;N=trunc(exports.Expanse.normalize(U.codomain,N)),B=trunc(exports.Expanse.normalize(U.codomain,B)),G=trunc(exports.Expanse.normalize(V.codomain,G)),j=trunc(exports.Expanse.normalize(V.codomain,j))}[N,B]=[N,B].sort(diff),[G,j]=[G,j].sort(diff),exports.Scale.expand(P.x,N,B),exports.Scale.expand(P.y,G,j);const $=rangeInverse(N,B),X=rangeInverse(G,j),Q=sqrt(max($,X)),{width:Z,height:K,area:W,size:te}=P;Z.codomain!==W.codomain&&exports.Expanse.set(Z.codomain,Y=>({max:Y.max*$})),K.codomain!==W.codomain&&exports.Expanse.set(K.codomain,Y=>({max:Y.max*X})),exports.Expanse.set(W.codomain,Y=>({max:Y.max*Q})),exports.Expanse.set(te.codomain,Y=>({max:Y.max*Q})),_.push([N,G,B,j]),Reactive.dispatch(E,"clear-transient"),e.render(E)}e.zoom=z;function O(E){const{scales:T,zoomStack:P}=E;if(P.length===1)return;const[F,_,H,q]=P[P.length-1],[N,G]=invertRange(F,H),[B,j]=invertRange(_,q);exports.Scale.expand(T.x,N,G),exports.Scale.expand(T.y,B,j);const U=rangeInverse(N,G),V=rangeInverse(B,j),$=1/sqrt(max(1/U,1/V)),{width:X,height:Q,area:Z,size:K}=T;X.codomain!==Z.codomain&&exports.Expanse.set(X.codomain,W=>({max:W.max*U})),Q.codomain!==Z.codomain&&exports.Expanse.set(Q.codomain,W=>({max:W.max*V})),exports.Expanse.set(Z.codomain,W=>({max:W.max*$})),exports.Expanse.set(K.codomain,W=>({max:W.max*$})),P.pop(),e.clearUserFrame(E),e.render(E)}e.popZoom=O;function I(E,T){const{x:P,y:F}=E.scales;if(!exports.Expanse.isContinuous(P.domain)||!exports.Expanse.isContinuous(F.domain))throw new Error("Both axes need to be continuous to set a ratio");E.parameters.ratio=T,e.resize(E)}e.setRatio=I;function L(E,T){const{scales:P}=E,{x:F,y:_}=P,H=exports.Scale.unitRatio(F),q=exports.Scale.unitRatio(_)*T,N={default:!0,silent:!0};if(H>q){const G=q/H*exports.Scale.unitRange(_),[B,j]=[(1-G)/2,(1+G)/2];exports.Scale.set(F,()=>({zero:B,one:j}),N)}else{const G=H/q*exports.Scale.unitRange(F),[B,j]=[(1-G)/2,(1+G)/2];exports.Scale.set(_,()=>({zero:B,one:j}),N)}}e.applyRatio=L;function C(E,T){return E.scales[T].domain}e.getScale=C;function D(E,T,P){let{min:F,max:_,zero:H,one:q,mult:N,labels:G,direction:B}=P;const j=E.scales[T],U=j.domain,V=j.codomain;if(!Object.keys(E.scales).includes(T))throw new Error(`Unrecognized scale '${T}'`);const $={default:P.default??!1,unfreeze:P.unfreeze??!1};if([H,q].some(isDefined)&&(H=H??j.props.zero,q=q??j.props.one,exports.Scale.set(j,()=>({zero:H,one:q}),$),E.parameters.ratio=void 0),[F,_].some(isDefined)){if(!exports.Expanse.isContinuous(U))throw new Error("Limits can only be set with a continuous domain");H=F?H??0:j.props.zero,q=_?q??1:j.props.one,F=F??U.props.min,_=_??U.props.max,exports.Expanse.set(U,()=>({min:F,max:_}),$),exports.Scale.set(j,()=>({zero:H,one:q}),$),E.parameters.ratio=void 0}if(G){if(!exports.Expanse.isDiscrete(U))throw new Error("Labels can be ordered with a discrete domain only");if(!stringArraysMatch(U.props.labels,G))throw new Error("Labels must match the scale's labels");const X=orderIndicesByTable(U.props.labels,G);exports.Expanse.reorder(U,X)}B&&exports.Scale.set(j,()=>({direction:B}),$),N&&exports.Expanse.set(V,()=>({mult:N}),$)}e.setScale=D})(exports.Plot||(exports.Plot={}));function setupFrames(e,t){const{container:n,frames:s}=e,{margins:d,colors:a,axisLabelSize:u,axisTitleSize:f}=t,[r,i,o,c]=d,l=[7,6,5,4,3,2,1,0],p="tw-absolute tw-top-0 tw-right-0 tw-w-full tw-h-full ";for(const h of l){const w={zIndex:`${7-h+2}`},z=a[h],O={fillStyle:z,strokeStyle:z},I=Frame.of({classes:p,contextProps:O,canvasStyles:w,margins:d});s[h]=I}const x=Frame.of({classes:p+"tw-bg-gray-100"});Frame.setContext(x,{font:`${f}em sans-serif`,textBaseline:"middle",textAlign:"center"});const v=`calc(100% - ${i}px - ${c}px)`,m=`calc(100% - ${r}px - ${o}px)`,y={width:v,height:m,top:o+"px",right:c+"px"},S=Frame.of({classes:p+"tw-z-1 tw-bg-white",canvasStyles:y}),A=Frame.of({classes:p+"tw-z-10 tw-border tw-border-b-black tw-border-l-black",canvasStyles:y}),M=Frame.of({classes:p+"tw-z-10",margins:d});Frame.setContext(M,{globalAlpha:.06666666666666667});const g="#3B4854",b=Frame.of({classes:p});Frame.setContext(b,{fillStyle:g,textBaseline:"top",textAlign:"center",font:`${u}em serif`});const k=Frame.of({classes:p});Frame.setContext(k,{fillStyle:"#3B4854",textBaseline:"middle",textAlign:"right",font:`${u}em serif`}),Object.assign(s,{base:x,under:S,over:A,user:M,xAxis:b,yAxis:k});for(let[h,w]of Object.entries(s))isNaN(parseFloat(h))||(h="data-"+h),w.canvas.id=`frame-${h}`,Frame.append(w,n)}function setupEvents$1(e){const{container:t,parameters:n,frames:s}=e,{mousecoords:d}=n;for(const[a,u]of Object.entries(exports.Plot.keybindings))Reactive.listen(e,a,()=>Reactive.dispatch(e,u));t.addEventListener("mousedown",a=>{a.stopPropagation();const{locked:u}=n;exports.Plot.activate(e),exports.Plot.setMousedown(e,!0),exports.Plot.setMouseButton(e,a.button),a.button===MouseButton.Left?exports.Plot.setMode(e,"select"):a.button===MouseButton.Right&&exports.Plot.setMode(e,"pan");const f=a.offsetX,r=t.clientHeight-a.offsetY;copyValues([f,r,f,r],d),!u&&n.mode==="select"&&(Reactive.dispatch(e,"clear-transient"),exports.Plot.checkSelection(e)),exports.Plot.unlock(e)}),t.addEventListener("contextmenu",a=>{a.preventDefault(),exports.Plot.setMousedown(e,!0),exports.Plot.setMouseButton(e,MouseButton.Right),exports.Plot.setMode(e,"pan"),d[0]=a.offsetX,d[1]=t.clientHeight-a.offsetY,Frame.clear(s.user)}),t.addEventListener("mouseup",()=>exports.Plot.setMousedown(e,!1)),t.addEventListener("mousemove",throttle(a=>{exports.Plot.mousemoveHandlers[n.mode](e,a)},20)),Reactive.listen(e,"reset",()=>exports.Plot.reset(e)),Reactive.listen(e,"resize",()=>exports.Plot.resize(e)),Reactive.listen(e,"activate",()=>exports.Plot.activate(e)),Reactive.listen(e,"deactivate",()=>exports.Plot.deactivate(e)),Reactive.listen(e,"render",()=>exports.Plot.render(e)),Reactive.listen(e,"lock",()=>exports.Plot.lock(e)),Reactive.listen(e,"unlock",()=>exports.Plot.unlock(e)),Reactive.listen(e,"query-mode",()=>exports.Plot.setMode(e,"query")),Reactive.listen(e,"render-axes",()=>exports.Plot.renderAxes(e)),Reactive.listen(e,"clear-transient",()=>exports.Plot.clearUserFrame(e)),Reactive.listen(e,"get-scale",a=>{if(!(!a||!a.scale))return exports.Plot.getScale(e,a.scale)}),Reactive.listen(e,"set-scale",a=>{!a||!a.scale||exports.Plot.setScale(e,a.scale,a)}),Reactive.listen(e,"grow",()=>exports.Plot.grow(e),{throttle:10}),Reactive.listen(e,"shrink",()=>exports.Plot.shrink(e),{throttle:10}),Reactive.listen(e,"fade",()=>exports.Plot.fade(e),{throttle:10}),Reactive.listen(e,"unfade",()=>exports.Plot.unfade(e),{throttle:10}),Reactive.listen(e,"zoom",a=>exports.Plot.zoom(e,a)),Reactive.listen(e,"pop-zoom",()=>exports.Plot.popZoom(e));for(const a of Object.values(e.scales))Reactive.listen(a,"changed",()=>{exports.Plot.render(e),exports.Plot.renderAxes(e)})}function setupScales(e){const{scales:t}=e,{x:n,y:s,width:d,height:a,size:u,area:f,areaPct:r}=t,i={default:!0,silent:!0},{expandX:o,expandY:c}=defaultOptions;exports.Expanse.set(f.domain,()=>({ratio:!0}),i),exports.Expanse.set(r.domain,()=>({ratio:!0}),i),exports.Expanse.set(u.domain,()=>({ratio:!0}),i),exports.Expanse.set(u.codomain,()=>({trans:square,inv:sqrt}),i),exports.Expanse.set(f.codomain,()=>({trans:square,inv:sqrt}),i),exports.Expanse.set(r.codomain,()=>({trans:square,inv:sqrt}),i),exports.Scale.set(n,()=>({zero:o,one:1-o}),i),exports.Scale.set(s,()=>({zero:c,one:1-c}),i),exports.Scale.set(d,()=>({one:1-2*o}),i),exports.Scale.set(a,()=>({one:1-2*c}),i),exports.Scale.set(f,()=>({one:1-2*Math.max(o,c)}),i);const l=p=>Math.max(p,0);exports.Expanse.set(d.codomain,()=>({inv:l}),i),exports.Expanse.set(a.codomain,()=>({inv:l}),i)}var KeybindingsMenu;(e=>{function t(s){const d=DOM.element("div"),a=DOM.element("div",{id:"modal"}),u=DOM.element("div",{id:"bindings"}),f=DOM.element("button",{textContent:"key bindings"});DOM.addClasses(a,tw("tw-absolute tw-left-0 tw-top-0 tw-z-50 tw-flex tw-size-full tw-flex-col tw-items-center tw-bg-slate-800 tw-bg-opacity-80 tw-p-10")),DOM.addClasses(u,tw("tw-relative tw-flex tw-h-full tw-w-fit tw-flex-col tw-flex-wrap tw-justify-start tw-py-10")),DOM.addClasses(f,tw("tw-absolute tw-right-0 tw-top-0 tw-z-30 tw-select-none tw-rounded-bl-md tw-bg-gray-300 tw-p-1 tw-px-2 tw-text-sm tw-text-white hover:tw-bg-gray-400")),DOM.append(d,a),DOM.append(d,f),DOM.append(a,u),u.style.columnFill="auto",a.style.display="none";let r=!1;function i(){a.style.display="flex"}function o(){r||(a.style.display="none")}f.addEventListener("click",i),a.addEventListener("click",o);for(const[c,l]of Object.entries(s)){const p=DOM.element("span",{classes:tw("tw-m-1 tw-flex tw-flex-row")}),x=DOM.element("button",{textContent:c}),v=DOM.element("div",{classes:tw("tw-m-1 tw-p-1 tw-px-2 tw-text-white"),textContent:capitalize(l.replaceAll("-"," "))});DOM.addClasses(x,tw("tw-m-1 tw-w-8 tw-rounded-md tw-bg-gray-400 tw-p-1 tw-px-2 tw-text-center tw-text-white tw-outline-none hover:tw-bg-gray-500")),DOM.append(p,x),DOM.append(p,v),v.addEventListener("click",y=>y.stopPropagation()),x.addEventListener("click",y=>{r||(y.stopPropagation(),DOM.addClasses(x,tw("text-black bg-slate-200 hover:bg-slate-200")),window.addEventListener("keydown",m),r=!0)});const m=y=>{const{key:S}=y,R=x.innerText;S in s&&S!==R||(n(s,S,l),x.innerText=y.key,DOM.removeClasses(x,tw("tw-text-black tw-bg-slate-200 hover:tw-bg-slate-200")),window.removeEventListener("keydown",m),r=!1)};u.appendChild(p)}return d}e.of=t;function n(s,d,a){let u;for(const[f,r]of Object.entries(s))if(r===a){u=f;break}u&&delete s[u],s[d]=a}})(KeybindingsMenu||(KeybindingsMenu={})),exports.Scene=void 0,(e=>{function t(h,w){const z=DOM.element("div",{id:"scene-container"}),O=DOM.element("div",{id:"plots-container"});DOM.addClasses(z,tw("tailwind tw-pr-15 tw-relative tw-flex tw-h-full tw-w-full tw-content-center tw-items-center tw-justify-center tw-bg-[#deded9] tw-p-10")),DOM.addClasses(O,tw("tw-grid tw-h-full tw-w-full tw-grid-cols-1 tw-grid-rows-1 tw-gap-[1em]"));const I=DOM.element("table",{classes:tw("tw-absolute tw-z-30 tw-bg-gray-100 tw-shadow-md")});DOM.setStyles(I,{pointerEvents:"none"});const L={...e.keybindings,...exports.Plot.keybindings},C=KeybindingsMenu.of(L);DOM.append(z,O),DOM.append(z,C),DOM.append(z,I);const[D,E]=[1,1],T=Marker.of(Object.values(h)[0].length),P=[],F={},_={send:console.log},H=Object.assign(defaultOptions,w);for(const[N,G]of Object.entries(h))Meta.hasMetadata(G)||(h[N]=Meta.of(G)),Meta.has(G,"name")||Meta.set(G,{name:N});const q=Reactive.of()({data:h,container:z,plotsContainer:O,queryTable:I,rows:D,cols:E,marker:T,client:_,plots:P,plotIndicesByType:F,options:H,keybindings:L});if(w!=null&&w.websocketURL){const N=new WebSocket(w.websocketURL),G={sender:"scene",target:"server",type:"connected"};N.addEventListener("open",()=>N.send(JSON.stringify(G))),N.addEventListener("message",B=>{m(q,JSON.parse(B.data))}),window.addEventListener("beforeunload",()=>N.close()),q.client=N}return setupEvents(q),q}e.of=t;async function n(h,w){const z=await fetchJSON(h);return e.of(z,w)}e.ofAsync=n;function s(h,w){h.appendChild(w.container),e.resize(w)}e.append=s;function d(h,w){const{plotsContainer:z,marker:O,plots:I,plotIndicesByType:L}=h;Reactive.listen(w,"activated",()=>{for(const E of I)E!=w&&Reactive.dispatch(E,"deactivate");const D=I.indexOf(w);h.activePlotIndex=D}),Reactive.listen(w,"lock-others",()=>{for(const D of I)D!==w&&Reactive.dispatch(D,"lock")}),Reactive.listen(w,"set-selected",D=>{Marker.update(O,D.cases)}),Reactive.listen(w,"clear-transient",()=>{for(const D of I)exports.Plot.clearUserFrame(D);Marker.clearTransient(O)}),Reactive.listen(w,"render-all",()=>{for(const D of I)Reactive.dispatch(D,"render")});const{type:C}=w;L[C]||(L[C]=[]),L[C].push(I.length),I.push(w),exports.Plot.append(z,w),w.queryTable=h.queryTable,u(h),l(h),e.resize(h)}e.addPlot=d;function a(h,w){const{type:z,variables:O,reducer:I,queries:L}=w??{};if(!z||z==="unknown"||!O)return;for(const T of O)if(!Object.keys(h.data).includes(T))throw new Error(`Variable '${T}' is not present in the data`);const C=keysToSelectors(O),D={};if(I&&(D.reducer=exports.Reducer.parse(I)),L)if(isStringArray(L))D.queries=keysToSelectors(L);else{const T=P=>L.map(([F,_])=>[P[F],exports.Reducer.parse(_)]);D.queries=T}const E=exports.Plot[z](h,C,D);e.addPlot(h,E)}e.addPlotBySpec=a;function u(h){for(let w=0;w<h.plots.length;w++)h.plots[w].container.id=`plot${w+1}`}function f(h){const w=last(h.plots);w&&i(h,w)}e.popPlot=f;function r(h,w){const z=c(h,w);z&&i(h,z)}e.removePlot=r;function i(h,w){const{plots:z,plotIndicesByType:O,plotsContainer:I}=h,L=z.indexOf(w);for(const C of Object.values(O))if(C.indexOf(L)!==-1){remove(C,L);break}remove(z,w),I.removeChild(w.container),Reactive.removeAllListeners(w),u(h),l(h),e.resize(h)}function o(h,w){return w==="scene"?h:c(h,w)}e.getTarget=o;function c(h,w){const{plots:z,plotIndicesByType:O}=h;let[I,L]=splitNumericSuffix(w);const C=parseInt(L,10)-1;if(I==="plot"||I==="p")return z[C];if(I=I.replace("plot","").replace("gram",""),I in Object.keys(plotIdShort)&&(I=plotIdShort[I]),I in O)return z[O[I][C]]}e.getPlot=c;function l(h){const{plots:w}=h;if(w.length===0)return;const z=Math.ceil(Math.sqrt(w.length)),O=Math.ceil(w.length/z);e.setDimensions(h,O,z)}function p(h,w,z){const{plotsContainer:O}=h;h.rows=w,h.cols=z;const I=Array(w).fill("1fr").join(" "),L=Array(z).fill("1fr").join(" ");DOM.setStyles(O,{gridTemplateRows:I,gridTemplateColumns:L}),e.resize(h)}e.setDimensions=p;function x(h,w){const{plotsContainer:z,plots:O}=h,I=new Set(w.flat()),L=new Set(seq(0,O.length-1));for(const _ of I)L.delete(_);L.size>0&&alert("Warning: Some plots are not included in the layout and will be hidden.");for(let _=0;_<O.length;_++)DOM.setStyles(O[_].container,{gridArea:`plot${_}`});let D="";for(const _ of w)D+=`"${_.map(H=>`plot${H}`).join(" ")}" `;const[E,T]=[w.length,w[0].length],P=Array(E).fill("1fr").join(" "),F=Array(T).fill("1fr").join(" ");DOM.setStyles(z,{gridTemplateAreas:D,gridTemplateRows:P,gridTemplateColumns:F}),e.resize(h)}e.setLayout=x;function v(h){const{plotsContainer:w,plots:z}=h;DOM.setStyles(w,{gridTemplateAreas:""});for(const O of z)DOM.setStyles(O.container,{gridArea:"auto"});l(h)}e.clearLayout=v;function m(h,w){if(!h.client)return;const{type:z,target:O,data:I}=w,L=o(h,O);L&&Reactive.dispatch(L,z,I)}e.handleMessage=m;function y(h,w,z){const[O,I]=["scene","server"],L=JSON.stringify({sender:O,target:I,type:w,data:z});h.client.send(L)}e.sendMessage=y;function S(h,w){const{container:z}=h;let{fontSize:O}=w??{};if(!O){const{clientWidth:I,clientHeight:L}=z,C=Math.min(I,L)/100;O=Math.min(Math.max(8,3*C),16)}DOM.setStyles(z,{fontSize:O+"px"});for(const I of h.plots)Reactive.dispatch(I,"resize")}e.resize=S;function R(h){for(const w of h.plots)exports.Plot.render(w)}e.render=R;function A(h){for(const w of h.plots)Reactive.dispatch(w,"reset");Marker.clearTransient(h.marker)}e.reset=A;function M(h){for(const w of h.plots)Reactive.dispatch(w,"query-mode")}e.setQueryMode=M;function g(h){Marker.setGroup(h.marker,Group.First)}e.setGroupFirst=g;function b(h){Marker.setGroup(h.marker,Group.Second)}e.setGroupSecond=b;function k(h){Marker.setGroup(h.marker,Group.Third)}e.setGroupThird=k,e.keybindings={r:"reset",q:"query-mode",1:"group-1",2:"group-2",3:"group-3"}})(exports.Scene||(exports.Scene={}));function setupEvents(e){const{marker:t,plots:n,container:s,plotsContainer:d,keybindings:a,queryTable:u}=e;window.addEventListener("pageshow",()=>{exports.Scene.resize(e),exports.Scene.render(e)}),document.addEventListener("load",()=>{exports.Scene.resize(e),exports.Scene.render(e)}),s.addEventListener("mousedown",()=>{for(const r of n)Reactive.dispatch(r,"deactivate")}),s.addEventListener("dblclick",()=>{for(const r of n)Reactive.dispatch(r,"deactivate"),Frame.clear(r.frames.user);Marker.clearAll(e.marker),e.activePlotIndex=void 0}),d.addEventListener("mousemove",throttle(r=>{const{clientWidth:i,clientHeight:o}=d,{clientWidth:c,clientHeight:l}=u;let{offsetX:p,offsetY:x}=r,v=r.target;for(;v!==d;){if(v===null)return;p+=v.offsetLeft,x+=v.offsetTop,v=v.parentElement}let[m,y]=[p+2,x+2];p+c>i&&(m=m-c-4),x+l>o&&(y=y-l-4),DOM.setStyles(u,{left:m+"px",top:y+"px"})},20)),window.addEventListener("keydown",r=>{const i=a[r.key],{activePlotIndex:o}=e;if(i){if(o!==void 0){const c=n[o];Reactive.dispatch(c,i)}Reactive.dispatch(e,i)}}),window.addEventListener("keyup",()=>{Marker.setGroup(t,Transient);for(const r of e.plots)r.parameters.mode=exports.Plot.Mode.Select,DOM.setStyles(u,{display:"none"})}),window.addEventListener("resize",throttle(()=>exports.Scene.resize(e),10));const f={throttle:20};Reactive.listen(t,"changed",()=>exports.Scene.render(e),f),Reactive.listen(t,"cleared",()=>{for(const r of n)Reactive.dispatch(r,"unlock")}),Reactive.listen(e,"resize",()=>exports.Scene.resize(e)),Reactive.listen(e,"reset",()=>exports.Scene.reset(e)),Reactive.listen(e,"query-mode",()=>exports.Scene.setQueryMode(e)),Reactive.listen(e,"group-1",()=>exports.Scene.setGroupFirst(e)),Reactive.listen(e,"group-2",()=>exports.Scene.setGroupSecond(e)),Reactive.listen(e,"group-3",()=>exports.Scene.setGroupThird(e)),Reactive.listen(e,"connected",()=>{var r;return console.log(`Connected to Websocket server on: ${(r=e.client)==null?void 0:r.url}`)}),Reactive.listen(e,"set-dims",r=>{!r||!r.rows||!r.columns||exports.Scene.setDimensions(e,r.rows,r.cols)}),Reactive.listen(e,"add-plot",r=>{r&&exports.Scene.addPlotBySpec(e,r)}),Reactive.listen(e,"pop-plot",()=>exports.Scene.popPlot(e)),Reactive.listen(e,"remove-plot",r=>{!r||!r.id||exports.Scene.removePlot(e,r.id)}),Reactive.listen(e,"set-selected",r=>{!r||!r.cases||Marker.update(t,r.cases)}),Reactive.listen(e,"set-assigned",r=>{if(!r||!r.group)return;const i=7-Math.min(r.group,3);Marker.update(t,r.cases,{group:i})}),Reactive.listen(e,"get-selected",()=>{const r=filterIndices(Array.from(t.indices),Marker.isTransient);exports.Scene.sendMessage(e,"get-selected",{cases:r})}),Reactive.listen(e,"get-assigned",r=>{if(!r||!r.group)return;const i=c=>(c|4)===7-Math.min(r.group,3),o=filterIndices(Array.from(t.indices),i);exports.Scene.sendMessage(e,"get-assigned",{cases:o,group:r.group})}),Reactive.listen(e,"clear-selection",()=>Marker.clearAll(t)),Reactive.listen(e,"get-scale",r=>{if(!r||!r.id)return;const i=exports.Scene.getPlot(e,r.id);i&&Reactive.dispatch(i,"get-scale",r)}),Reactive.listen(e,"set-scale",r=>{if(!r||!r.id)return;const i=exports.Scene.getPlot(e,r.id);i&&Reactive.dispatch(i,"set-scale",r)}),Reactive.listen(e,"normalize",r=>{if(!r||!r.id)return;const i=exports.Scene.getPlot(e,r.id);i&&Reactive.dispatch(i,"normalize")}),Reactive.listen(e,"zoom",r=>{if(!r||!r.id)return;const i=exports.Scene.getPlot(e,r.id);i&&Reactive.dispatch(i,"zoom",r)}),Reactive.listen(e,"set-layout",r=>{!r||!r.layout||exports.Scene.setLayout(e,r.layout)}),Reactive.listen(e,"set-parameters",r=>{if(!r||!r.id)return;const i=exports.Scene.getPlot(e,r.id);i&&Reactive.dispatch(i,"set-parameters",r)}),Reactive.listen(e,"clear-layout",()=>exports.Scene.clearLayout(e))}const plotIdShort={s:"scatter",b:"bar",bb:"bibar",h:"histo",f:"fluct",hh:"histo2d",pc:"pcoords"};return exports.METHODS=METHODS,exports.addIndexed=addIndexed,exports.addTailwind=addTailwind,exports.applyDirection=applyDirection,exports.applyWith=applyWith,exports.bimap=bimap,exports.binBreaks=binBreaks,exports.call=call,exports.capitalize=capitalize,exports.compareAlphaNumeric=compareAlphaNumeric,exports.convertToSuperscript=convertToSuperscript,exports.copyProps=copyProps,exports.copyValues=copyValues,exports.cumsum=cumsum,exports.dec=dec,exports.diff=diff,exports.exp10=exp10,exports.exponentialToSuperscript=exponentialToSuperscript,exports.fetchJSON=fetchJSON,exports.filterIndices=filterIndices,exports.findLength=findLength,exports.formatAxisLabels=formatAxisLabels,exports.formatLabel=formatLabel,exports.formatText=formatText,exports.identity=identity,exports.inc=inc,exports.invertRange=invertRange,exports.isDefined=isDefined,exports.isEventTarget=isEventTarget,exports.isIntegerString=isIntegerString,exports.isNumber=isNumber,exports.isNumberArray=isNumberArray,exports.isObject=isObject,exports.isPrimitive=isPrimitive,exports.isStringArray=isStringArray,exports.isTypedArray=isTypedArray,exports.just=just,exports.keysToSelectors=keysToSelectors,exports.last=last,exports.log10=log10,exports.max=max,exports.merge=merge,exports.minDecimal=minDecimal,exports.minmax=minmax,exports.one=one,exports.orderBy=orderBy,exports.orderIndices=orderIndices,exports.orderIndicesByTable=orderIndicesByTable,exports.ordered=ordered,exports.pointInRect=pointInRect,exports.prettyBreaks=prettyBreaks,exports.prod=prod,exports.randomInteger=randomInteger,exports.rangeInverse=rangeInverse,exports.rectSegmentIntersect=rectSegmentIntersect,exports.rectsIntersect=rectsIntersect,exports.remove=remove,exports.removeTailwind=removeTailwind,exports.rep=rep,exports.round=round,exports.row=row,exports.segmentsIntersect=segmentsIntersect,exports.selector=selector,exports.seq=seq,exports.seqLength=seqLength,exports.splitNumericSuffix=splitNumericSuffix,exports.sqrt=sqrt,exports.square=square,exports.stringArraysMatch=stringArraysMatch,exports.stripWS=stripWS,exports.subset=subset,exports.sum=sum,exports.throttle=throttle,exports.timeExecution=timeExecution,exports.toLowerCase=toLowerCase,exports.toUpperCase=toUpperCase,exports.trunc=trunc,exports.tw=tw,exports.uniqueIntegers=uniqueIntegers,exports.zero=zero,Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),exports}({});
